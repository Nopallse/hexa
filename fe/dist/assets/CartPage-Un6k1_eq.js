import{c as E,j as r,p as _,r as m,a9 as S,B as i,A as K,ac as P,T as n,S as j,w as q,I as z,ad as I,q as B,t as w,ag as F,C as L}from"./index-aASFK1tJ.js";import{u as W}from"./useCurrencyConversion-DlJ_RGo8.js";import{a as D}from"./image-CeHRN-zl.js";import{C as M,a as T}from"./CardContent-CZ8AkO-X.js";import{A as f}from"./Alert-CgLHgHYO.js";import{D as H}from"./Delete-Dvlkfiey.js";import{A as $}from"./Add-rwwkErMU.js";import{S as O}from"./Skeleton-UyT1_vOM.js";import{O as U}from"./ShoppingBag-DjVGJAst.js";const G=E(r.jsx("path",{d:"M5 13h14v-2H5zm-2 4h14v-2H3zM7 7v2h14V7z"}),"ClearAll"),N=E(r.jsx("path",{d:"M19 13H5v-2h14z"}),"Remove");function A({item:e,onUpdate:v,onRemove:k}){const l=_(),[o,u]=m.useState(e.quantity),[x,h]=m.useState(null),{formatPrice:b}=W(),{updateQuantity:C,removeItem:y}=S();m.useEffect(()=>{u(e.quantity)},[e.quantity]);const s=e.product_variant.product.deleted_at!==null,p=a=>{const c=typeof a=="string"?parseFloat(a):a;return b(c)},g=async a=>{if(!(a<1||a>e.product_variant.stock))try{h(null),await C(e.id,a),u(a),await v(),I.success("Jumlah item berhasil diupdate",{duration:2e3,position:"bottom-right"})}catch(c){console.error("Error updating cart item:",c);const R=c.response?.data?.error||"Gagal mengupdate quantity";h(R),I.error(R,{duration:3e3,position:"bottom-right"})}},t=async()=>{try{h(null),await y(e.id),await k(),I.success("Item berhasil dihapus dari keranjang",{duration:2e3,position:"bottom-right"})}catch(a){console.error("Error removing cart item:",a);const c=a.response?.data?.error||"Gagal menghapus item";h(c),I.error(c,{duration:3e3,position:"bottom-right"})}},d=e.product_variant.display_image||e.product_variant.image||e.product_variant.product.product_images?.find(a=>a.is_primary)?.image_name||e.product_variant.product.product_images?.[0]?.image_name;return r.jsx(M,{sx:{mb:2,border:s?`1px solid ${l.palette.error.main}`:"none",opacity:s?.6:1,borderRadius:2,boxShadow:s?`0 2px 8px ${l.palette.error.main}20`:"0 1px 3px rgba(0,0,0,0.1)",transition:"all 0.2s ease","&:hover":{boxShadow:s?`0 4px 12px ${l.palette.error.main}30`:"0 2px 8px rgba(0,0,0,0.15)"}},children:r.jsxs(T,{sx:{p:3},children:[s&&r.jsx(f,{severity:"error",sx:{mb:3,borderRadius:3,"& .MuiAlert-message":{fontWeight:600}},children:"Produk ini sudah tidak tersedia"}),x&&r.jsx(f,{severity:"error",sx:{mb:3,borderRadius:3,"& .MuiAlert-message":{fontWeight:600}},onClose:()=>h(null),children:x}),r.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:3},children:[r.jsx(i,{sx:{flexShrink:0},children:r.jsx(K,{src:D(d),alt:e.product_variant.product.name,sx:{width:80,height:80,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},variant:"rounded",children:r.jsx(P,{sx:{fontSize:32}})})}),r.jsxs(i,{sx:{flex:1,minWidth:0},children:[r.jsx(n,{variant:"h6",fontWeight:600,sx:{mb:1,color:"text.primary",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.3,fontSize:"1rem"},title:e.product_variant.product.name,children:e.product_variant.product.name}),e.product_variant.variant_options&&e.product_variant.variant_options.length>0&&r.jsx(j,{direction:"row",spacing:.5,sx:{mb:1,flexWrap:"wrap"},children:e.product_variant.variant_options.map((a,c)=>r.jsx(q,{label:`${a.option_value}`,size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:20,borderColor:"primary.main",color:"primary.main","& .MuiChip-label":{px:1}}},c))}),r.jsxs(n,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:["Stok: ",s?"Tidak tersedia":`${e.product_variant.stock} unit`]})]}),r.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,flexShrink:0},children:[r.jsxs(i,{sx:{textAlign:"right",minWidth:100},children:[r.jsx(n,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:p(parseFloat(e.product_variant.price))}),r.jsx(n,{variant:"h6",color:"primary.main",fontWeight:700,sx:{fontSize:"1rem"},children:p(parseFloat(e.product_variant.price)*o)})]}),r.jsxs(i,{sx:{display:"flex",alignItems:"center",backgroundColor:"grey.50",borderRadius:2,p:.5,gap:.5},children:[r.jsx(z,{onClick:o===1?t:()=>g(o-1),disabled:s,size:"small",sx:{width:28,height:28,borderRadius:1,backgroundColor:o===1?"error.main":"white",color:o===1?"white":"text.primary",boxShadow:"0 1px 2px rgba(0,0,0,0.1)","&:hover":{backgroundColor:o===1?"error.dark":"primary.light",color:o===1?"white":"primary.main"},"&:disabled":{opacity:.5,backgroundColor:"grey.200"}},children:o===1?r.jsx(H,{sx:{fontSize:14}}):r.jsx(N,{sx:{fontSize:14}})}),r.jsx(n,{variant:"body2",fontWeight:600,sx:{minWidth:24,textAlign:"center",fontSize:"0.9rem"},children:o}),r.jsx(z,{onClick:()=>g(o+1),disabled:o>=e.product_variant.stock||s,size:"small",sx:{width:28,height:28,borderRadius:1,backgroundColor:"white",color:"text.primary",boxShadow:"0 1px 2px rgba(0,0,0,0.1)","&:hover":{backgroundColor:"primary.light",color:"primary.main"},"&:disabled":{opacity:.5,backgroundColor:"grey.200"}},children:r.jsx($,{sx:{fontSize:14}})})]})]})]})]})})}function J({items:e,onCartCleared:v}){_();const k=B(),[l,o]=m.useState(!1),{formatPrice:u}=W(),{clearCart:x}=S(),h=t=>{const d=typeof t=="string"?parseFloat(t):t;return u(d)},b=async()=>{if(window.confirm("Apakah Anda yakin ingin mengosongkan keranjang?"))try{o(!0),await x(),v()}catch(t){console.error("Error clearing cart:",t),alert(t.response?.data?.error||"Gagal mengosongkan keranjang")}finally{o(!1)}},C=()=>{try{if(p===0){console.warn("Cannot checkout: No available items in cart");return}k("/checkout")}catch(t){console.error("Error navigating to checkout:",t)}},y=e.filter(t=>t.product_variant.product.deleted_at===null),s=e.filter(t=>t.product_variant.product.deleted_at!==null),p=y.reduce((t,d)=>t+d.quantity,0),g=y.reduce((t,d)=>t+parseFloat(d.product_variant.price)*d.quantity,0);return r.jsx(M,{sx:{position:"sticky",top:24,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:"none"},children:r.jsxs(T,{sx:{p:3},children:[r.jsx(n,{variant:"h6",fontWeight:600,sx:{mb:3,color:"text.primary"},children:"Ringkasan Belanja"}),r.jsxs(j,{spacing:2,children:[r.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsxs(n,{variant:"body1",fontWeight:500,children:["Total Item (",p,")"]}),r.jsx(n,{variant:"h6",fontWeight:600,color:"primary.main",children:g>0?h(g):"Rp 0"})]}),s.length>0&&r.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:1.5,px:2,backgroundColor:"error.light",borderRadius:2},children:[r.jsxs(n,{variant:"body2",color:"error.dark",fontWeight:500,children:["Item tidak tersedia (",s.length,")"]}),r.jsx(n,{variant:"body2",color:"error.dark",fontWeight:500,children:"Tidak dihitung"})]}),r.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,px:2,backgroundColor:"primary.main",borderRadius:2,color:"white"},children:[r.jsx(n,{variant:"h6",fontWeight:600,children:"Total Belanja"}),r.jsx(n,{variant:"h5",fontWeight:700,children:u(g)})]}),r.jsxs(j,{spacing:1.5,children:[r.jsx(w,{variant:"contained",size:"large",startIcon:r.jsx(F,{}),onClick:C,disabled:p===0,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:600,fontSize:"1rem",backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"},"&:disabled":{backgroundColor:"grey.300",color:"grey.500"}},children:p===0?"Keranjang Kosong":"Lanjut ke Checkout"}),e.length>0&&r.jsx(w,{variant:"outlined",size:"large",startIcon:r.jsx(G,{}),onClick:b,disabled:l,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:500,fontSize:"0.9rem",borderColor:"error.main",color:"error.main","&:hover":{backgroundColor:"error.light",borderColor:"error.dark"}},children:l?"Mengosongkan...":"Kosongkan Keranjang"})]})]})]})})}function nr(){_();const e=B(),{loading:v,error:k}=W(),{items:l,isLoading:o,error:u,syncWithServer:x}=S(),[h,b]=m.useState(null),[C,y]=m.useState(!0);m.useEffect(()=>{(async()=>{await x(),y(!1)})()},[x]),m.useEffect(()=>{u&&b(u)},[u]);const s=async()=>{await x()},p=async()=>{await x()},g=async()=>{await x()},t=l.filter(a=>a.product_variant.product.deleted_at===null),d=l.filter(a=>a.product_variant.product.deleted_at!==null);return r.jsx(i,{sx:{minHeight:"100vh",py:4},children:r.jsxs(L,{maxWidth:"xl",children:[r.jsxs(i,{sx:{mb:3},children:[r.jsx(n,{variant:"h4",fontWeight:600,sx:{mb:1,color:"text.primary"},children:"Keranjang Belanja"}),r.jsx(n,{variant:"body1",color:"text.secondary",children:"Kelola item di keranjang belanja Anda"})]}),v&&r.jsx(f,{severity:"info",sx:{mb:2},children:"Loading exchange rates..."}),k&&r.jsx(f,{severity:"warning",sx:{mb:2},children:"Failed to load exchange rates. Prices will be displayed in default currency."}),h&&r.jsx(f,{severity:"error",sx:{mb:4},onClose:()=>b(null),children:h}),r.jsxs(i,{sx:{display:"flex",flexDirection:{xs:"column",lg:"row"},gap:4,alignItems:"flex-start"},children:[r.jsx(i,{sx:{flex:1,minWidth:0,order:{xs:1,lg:1}},children:C?r.jsx(j,{spacing:2,children:[...Array(3)].map((a,c)=>r.jsx(O,{variant:"rectangular",height:120,sx:{borderRadius:2}},c))}):l.length===0?r.jsxs(i,{sx:{textAlign:"center",py:8,px:4,borderRadius:2,backgroundColor:"grey.50"},children:[r.jsx(P,{sx:{fontSize:64,color:"text.secondary",mb:2}}),r.jsx(n,{variant:"h5",fontWeight:600,sx:{mb:1,color:"text.primary"},children:"Keranjang Anda Kosong"}),r.jsx(n,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Belum ada item di keranjang belanja Anda"}),r.jsxs(j,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"center",children:[r.jsx(w,{variant:"contained",size:"large",startIcon:r.jsx(U,{}),onClick:()=>e("/products"),sx:{px:3,py:1.5,borderRadius:2,fontWeight:600},children:"Mulai Berbelanja"}),r.jsx(w,{variant:"outlined",size:"large",onClick:()=>e("/"),sx:{px:3,py:1.5,borderRadius:2,fontWeight:500},children:"Kembali ke Beranda"})]})]}):r.jsxs(j,{spacing:2,children:[t.length>0&&r.jsxs(r.Fragment,{children:[r.jsxs(n,{variant:"h6",fontWeight:600,sx:{mb:2,color:"text.primary"},children:["Item Tersedia (",t.length,")"]}),t.map(a=>r.jsx(A,{item:a,onUpdate:s,onRemove:p},a.id))]}),d.length>0&&r.jsxs(r.Fragment,{children:[r.jsxs(n,{variant:"h6",fontWeight:600,sx:{mb:2,color:"error.main"},children:["Item Tidak Tersedia (",d.length,")"]}),r.jsx(f,{severity:"warning",sx:{mb:2,borderRadius:2},children:"Beberapa item di keranjang Anda sudah tidak tersedia. Item ini akan diabaikan saat checkout."}),d.map(a=>r.jsx(A,{item:a,onUpdate:s,onRemove:p},a.id))]})]})}),l.length>0&&r.jsx(i,{sx:{width:{xs:"100%",lg:"400px"},flexShrink:0,order:{xs:2,lg:2}},children:r.jsx(J,{items:l,onCartCleared:g})})]})]})})}export{nr as default};
