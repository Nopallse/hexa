import{p as D,Z as A,r as d,j as e,B as t,ad as z,T as i,x as T,v as w,q as B,C as W,y as S,O as P}from"./index-tvCmUXkA.js";import{u as R}from"./orderStore-CYhWohAJ.js";import{o as I}from"./orderApi-BOQ5SOkY.js";import{u as M}from"./useCurrencyConversion-DM705tyN.js";import{a as $}from"./image-CeHRN-zl.js";import{C as N,a as E}from"./CardContent-BO7gwO4c.js";import{A as G}from"./Avatar-Cw6JEpzV.js";import{V as U}from"./Visibility-Bvwl8cdA.js";import{C as L}from"./Cancel-BxQ_5SwZ.js";import{A as q}from"./AccountSidebar-BXLQb6Eg.js";import{G as C}from"./Grid-CE62ACEJ.js";import{T as V,a as H}from"./Tabs-DHZHkHBI.js";import{A as K}from"./Alert-iJ2nvuQL.js";import{O as Q}from"./Receipt-CJT1sDb7.js";import"./useSlot-Dd61XFNI.js";import"./ShoppingBag-DpDyVGo5.js";import"./KeyboardArrowRight-GxyP2UjW.js";function Z({order:a,onView:h}){const b=D();A(b.breakpoints.down("sm"));const[x,f]=d.useState(!1),{formatPrice:y}=M(),g=s=>new Date(s).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}),r=s=>{switch(s){case"belum_bayar":return"warning";case"dikemas":return"primary";case"dikirim":return"info";case"diterima":return"success";case"dibatalkan":return"error";default:return"default"}},m=s=>{switch(s){case"belum_bayar":return"Belum Bayar";case"dikemas":return"Dikemas";case"dikirim":return"Dikirim";case"diterima":return"Diterima";case"dibatalkan":return"Dibatalkan";default:return s}},j=async()=>{if(!a?.id){console.error("Order ID is missing");return}if(window.confirm("Apakah Anda yakin ingin membatalkan pesanan ini?"))try{f(!0),(await I.cancelOrder(a.id)).success&&window.location.reload()}catch(s){console.error("Error cancelling order:",s),alert(s.response?.data?.error||"Gagal membatalkan pesanan")}finally{f(!1)}},v=a?.status==="belum_bayar",l=a?.order_items&&a.order_items.length>0?a.order_items[0]:null,u=l?.product_variant?.product?.product_images,p=(u&&u.length>0?u[0]?.image_name:null)||null;return e.jsx(N,{sx:{mb:{xs:1.5,sm:2},borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"none",transition:"all 0.2s ease","&:hover":{boxShadow:"0 2px 8px rgba(0,0,0,0.15)"}},children:e.jsx(E,{sx:{p:{xs:1,sm:3}},children:e.jsxs(t,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"flex-start",sm:"center"},gap:{xs:1,sm:3}},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:{xs:1,sm:3},flex:1,minWidth:0,width:{xs:"100%",sm:"auto"}},children:[e.jsx(t,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:1,flexShrink:0},children:e.jsx(G,{src:p?$(p):void 0,alt:l?.product_variant?.product?.name||"Order",sx:{width:{xs:70,sm:80},height:{xs:70,sm:80},borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},variant:"rounded",children:e.jsx(z,{sx:{fontSize:{xs:28,sm:32}}})})}),e.jsxs(t,{sx:{flex:1,minWidth:0},children:[e.jsxs(i,{variant:"h6",fontWeight:600,sx:{mb:1,color:"text.primary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:{xs:"0.875rem",sm:"1rem"}},title:`Order #${a.id?a.id.slice(-8).toUpperCase():"N/A"}`,children:["Order #",a.id?a.id.slice(-8).toUpperCase():"N/A"]}),e.jsx(t,{sx:{mb:1},children:e.jsx(T,{label:m(a?.status||""),size:"small",variant:"outlined",sx:{fontSize:{xs:"0.65rem",sm:"0.7rem"},height:{xs:18,sm:20},borderColor:r(a?.status||"")==="warning"?"warning.main":r(a?.status||"")==="success"?"success.main":r(a?.status||"")==="error"?"error.main":r(a?.status||"")==="info"?"info.main":"primary.main",color:r(a?.status||"")==="warning"?"warning.main":r(a?.status||"")==="success"?"success.main":r(a?.status||"")==="error"?"error.main":r(a?.status||"")==="info"?"info.main":"primary.main","& .MuiChip-label":{px:{xs:.75,sm:1}}}})}),e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.7rem",sm:"0.75rem"},mb:.5},children:["Dibuat: ",a?.created_at?g(a.created_at):"N/A"]}),e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.7rem",sm:"0.75rem"},mb:.5},children:[a?.order_items?.length||0," item",(a?.order_items?.length||0)>1?"s":""]}),e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:[a?.address?.city||"",", ",a?.address?.province||""]})]})]}),e.jsxs(t,{sx:{display:"flex",flexDirection:{xs:"row",sm:"column"},alignItems:{xs:"center",sm:"flex-end"},justifyContent:{xs:"space-between",sm:"flex-end"},gap:{xs:2,sm:2},flexShrink:0,width:{xs:"100%",sm:"auto"}},children:[e.jsxs(t,{sx:{textAlign:{xs:"left",sm:"right"},minWidth:{xs:"auto",sm:100}},children:[e.jsx(i,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.7rem",sm:"0.75rem"},mb:.5},children:"Total"}),e.jsx(i,{variant:"h6",color:"primary.main",fontWeight:700,sx:{fontSize:{xs:"0.875rem",sm:"1rem"}},children:y((Number(a?.total_amount)||0)+(Number(a?.shipping_cost)||0))})]}),e.jsxs(t,{sx:{display:"flex",flexDirection:{xs:"row",sm:"column"},gap:1},children:[e.jsx(w,{variant:"contained",size:"small",startIcon:e.jsx(U,{}),onClick:()=>h(a),sx:{borderRadius:2,fontWeight:600,fontSize:{xs:"0.7rem",sm:"0.75rem"},py:{xs:.5,sm:.5},px:{xs:1,sm:1.5},backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:"Detail"}),v&&e.jsx(w,{variant:"outlined",size:"small",startIcon:e.jsx(L,{}),onClick:j,disabled:x,color:"error",sx:{borderRadius:2,fontWeight:600,fontSize:{xs:"0.7rem",sm:"0.75rem"},py:{xs:.5,sm:.5},px:{xs:1,sm:1.5},borderColor:"error.main",color:"error.main","&:hover":{backgroundColor:"error.light",borderColor:"error.dark"}},children:x?"Batal...":"Batal"})]})]})]})})})}function F(a){return{id:`orders-tab-${a}`,"aria-controls":`orders-tabpanel-${a}`}}function pe(){const a=D(),h=A(a.breakpoints.down("md")),b=B(),{orders:x,setOrders:f}=R(),[y,g]=d.useState(!1),[r,m]=d.useState(null),[j,v]=d.useState(0),[l,u]=d.useState({page:1,limit:10,total:0,pages:0}),k=[{label:"Semua",value:""},{label:"Belum Bayar",value:"belum_bayar"},{label:"Dikemas",value:"dikemas"},{label:"Dikirim",value:"dikirim"},{label:"Diterima",value:"diterima"},{label:"Dibatalkan",value:"dibatalkan"}],p=async(n={})=>{try{g(!0),m(null);const o={page:l.page,limit:l.limit,...n},c=await I.getUserOrders(o);c.success?(f(c.data),u(_=>({..._,total:c.pagination?.total||0,pages:c.pagination?.pages||0}))):m("Gagal memuat pesanan")}catch(o){m(o.message||"Gagal memuat pesanan")}finally{g(!1)}};d.useEffect(()=>{p()},[l.page,l.limit]);const s=(n,o)=>{v(o);const c=k[o].value;p({status:c})},O=n=>{b(`/orders/${n.id}`)};return e.jsx(W,{maxWidth:"xl",sx:{py:4},children:e.jsxs(C,{container:!0,spacing:4,children:[e.jsx(C,{item:!0,xs:12,md:3,children:e.jsx(q,{})}),e.jsxs(C,{item:!0,xs:12,md:9,children:[e.jsxs(t,{sx:{mb:4},children:[e.jsx(i,{variant:"h4",component:"h1",sx:{fontWeight:600,color:"text.primary",mb:1},children:"Pesanan Saya"}),e.jsx(i,{variant:"body1",color:"text.secondary",children:"Kelola dan lacak pesanan Anda"})]}),e.jsx(S,{elevation:0,sx:{mb:3,borderRadius:2,border:`1px solid ${a.palette.grey[200]}`,overflow:"hidden"},children:e.jsx(V,{value:j,onChange:s,variant:h?"scrollable":"standard",scrollButtons:h?"auto":!1,allowScrollButtonsMobile:!0,sx:{borderBottom:`1px solid ${a.palette.grey[200]}`,"& .MuiTab-root":{textTransform:"none",fontWeight:500,fontSize:"1rem",py:2,px:3,minHeight:"auto","&.Mui-selected":{fontWeight:600,color:"primary.main"}},"& .MuiTabs-indicator":{height:3,borderRadius:"3px 3px 0 0"}},children:k.map((n,o)=>e.jsx(H,{label:n.label,...F(o)},n.value))})}),r&&e.jsx(K,{severity:"error",sx:{mb:3,borderRadius:2},onClose:()=>m(null),children:r}),y?e.jsx(t,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(P,{})}):x.length===0?e.jsxs(S,{elevation:0,sx:{borderRadius:2,border:`1px solid ${a.palette.grey[200]}`,p:4,textAlign:"center"},children:[e.jsx(Q,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(i,{variant:"h6",sx:{fontWeight:600,color:"text.primary",mb:1},children:"Belum Ada Pesanan"}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Pesanan Anda akan muncul di sini setelah melakukan pembelian"}),e.jsx(w,{variant:"contained",onClick:()=>b("/products"),sx:{borderRadius:2,textTransform:"none",fontWeight:500,backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:"Mulai Belanja"})]}):e.jsx(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:x.map(n=>e.jsx(Z,{order:n,onView:O},n.id))})]})]})})}export{pe as default};
