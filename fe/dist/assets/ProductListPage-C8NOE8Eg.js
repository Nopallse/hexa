import{r as o,j as e,x as B,T as h,B as t,t as w,av as Y,v as C,I as D,D as F,N as J,Y as S,am as T,Z as A,$ as k,M as Q,q as X,aw as ee,a6 as ae,C as re,z as te}from"./index-Idy1NCQZ.js";import{p as R}from"./productApi-CQPWcGws.js";import{a as se}from"./image-DX-k4_re.js";import{D as ie}from"./RestoreFromTrash-CvgzR_0x.js";import{T as ne,a as le,b as oe,c as $,d as l,e as ce}from"./TableRow-BIbOTJIu.js";import{A as de}from"./Avatar-BJbDu4KS.js";import{T as W}from"./Tooltip-Ba_JqsKN.js";import{V as he}from"./Visibility-B5An8ykM.js";import{E as xe}from"./Edit-BAZVwRWz.js";import{D as ue}from"./Delete-W7umIrU5.js";import{D as me,a as ge,b as pe}from"./DialogTitle-BkdEpzB-.js";import{A as M}from"./Alert-Cw7awSGM.js";import{D as je}from"./DialogActions-Bk-lbUWj.js";import{F as fe}from"./FilterList-DVlFQTe9.js";import{A as ve}from"./Add-CFf7PY0f.js";import{T as be}from"./TablePagination-UcP0WmK0.js";import"./KeyboardArrowRight-BxK0sE0P.js";import"./LastPage-CLOY8yT0.js";function ye({products:u,isLoading:P=!1,onEdit:d,onDelete:_,onView:s,onViewDeleted:j}){const[c,m]=o.useState({open:!1,product:null,loading:!1}),g=a=>{m({open:!0,product:a,loading:!1})},y=async()=>{if(c.product){m(a=>({...a,loading:!0}));try{await _(c.product.id),m({open:!1,product:null,loading:!1})}catch{m(x=>({...x,loading:!1}))}}},f=()=>{m({open:!1,product:null,loading:!1})},v=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a),p=a=>a.product_images&&a.product_images.length>0?a.product_images.find(i=>i.is_primary)||a.product_images[0]:null;return u.length===0&&!P?e.jsxs(B,{sx:{p:4,textAlign:"center"},children:[e.jsx(h,{variant:"h6",color:"textSecondary",children:"Belum ada produk"}),e.jsx(h,{variant:"body2",color:"textSecondary",children:"Tambah produk pertama untuk mulai menjual"})]}):e.jsxs(e.Fragment,{children:[j&&e.jsx(t,{sx:{mb:2,display:"flex",justifyContent:"flex-end"},children:e.jsx(w,{variant:"outlined",startIcon:e.jsx(ie,{}),onClick:j,color:"secondary",children:"Lihat Produk Dihapus"})}),e.jsx(ne,{component:B,children:e.jsxs(le,{children:[e.jsx(oe,{children:e.jsxs($,{children:[e.jsx(l,{children:"Gambar"}),e.jsx(l,{children:"Nama Produk"}),e.jsx(l,{children:"Kategori"}),e.jsx(l,{align:"right",children:"Harga"}),e.jsx(l,{align:"center",children:"Stok"}),e.jsx(l,{align:"center",children:"Pre-order"}),e.jsx(l,{align:"center",children:"Info Varian"}),e.jsx(l,{align:"center",children:"Aksi"})]})}),e.jsx(ce,{children:u.map(a=>{const x=p(a);return e.jsxs($,{hover:!0,children:[e.jsx(l,{children:e.jsx(de,{src:se(x?.image_name),variant:"rounded",sx:{width:56,height:56},children:e.jsx(Y,{})})}),e.jsx(l,{children:e.jsxs(t,{children:[e.jsx(h,{variant:"subtitle2",fontWeight:"medium",gutterBottom:!0,children:a.name}),e.jsx(h,{variant:"body2",color:"textSecondary",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a.description||"-"})]})}),e.jsx(l,{children:e.jsx(C,{label:a.category?.name||"Tidak ada kategori",size:"small",color:"primary",variant:"outlined"})}),e.jsx(l,{align:"right",children:a.product_variants&&a.product_variants.length>0?e.jsx(t,{sx:{textAlign:"right"},children:e.jsxs(h,{variant:"body1",fontWeight:"medium",color:"primary",children:[v(Math.min(...a.product_variants.map(i=>parseFloat(i.price))))," - ",v(Math.max(...a.product_variants.map(i=>parseFloat(i.price))))]})}):e.jsx(h,{variant:"body1",fontWeight:"medium",children:v(parseFloat(a.price||"0"))})}),e.jsx(l,{align:"center",children:a.product_variants&&a.product_variants.length>0?e.jsx(t,{sx:{display:"flex",flexDirection:"column",gap:.5,alignItems:"center"},children:e.jsx(C,{label:`Total: ${a.product_variants.reduce((i,b)=>i+(b.stock||0),0)}`,size:"small",color:a.product_variants.reduce((i,b)=>i+(b.stock||0),0)>0?"success":"error",variant:a.product_variants.reduce((i,b)=>i+(b.stock||0),0)>0?"filled":"outlined"})}):e.jsx(C,{label:a.stock||0,size:"small",color:(a.stock||0)>0?"success":"error",variant:(a.stock||0)>0?"filled":"outlined"})}),e.jsx(l,{align:"center",children:e.jsx(C,{label:`${a.pre_order||0} hari`,size:"small",color:a.pre_order&&a.pre_order>0?"warning":"default",variant:a.pre_order&&a.pre_order>0?"filled":"outlined"})}),e.jsx(l,{align:"center",children:a.product_variants&&a.product_variants.length>0?e.jsx(t,{sx:{display:"flex",flexDirection:"column",gap:.5,alignItems:"center"},children:e.jsx(C,{label:`${a.product_variants.length} Varian`,size:"small",color:"primary",variant:"filled",sx:{fontWeight:"bold"}})}):e.jsx(C,{label:"Tidak Ada Varian",size:"small",color:"default",variant:"outlined",sx:{fontSize:"0.7rem"}})}),e.jsx(l,{align:"center",children:e.jsxs(t,{sx:{display:"flex",justifyContent:"center",gap:.5},children:[e.jsx(W,{title:"Lihat Detail",children:e.jsx(D,{size:"small",onClick:()=>s(a),color:"info",children:e.jsx(he,{fontSize:"small"})})}),e.jsx(W,{title:"Edit Produk",children:e.jsx(D,{size:"small",onClick:()=>d(a),color:"primary",children:e.jsx(xe,{fontSize:"small"})})}),e.jsx(W,{title:"Hapus Produk",children:e.jsx(D,{size:"small",onClick:()=>g(a),color:"error",children:e.jsx(ue,{fontSize:"small"})})})]})})]},a.id)})})]})}),e.jsxs(me,{open:c.open,onClose:f,maxWidth:"sm",fullWidth:!0,children:[e.jsx(ge,{children:"Hapus Produk"}),e.jsxs(pe,{children:[e.jsx(M,{severity:"warning",sx:{mb:2},children:e.jsxs(h,{variant:"body2",children:["Anda yakin ingin menghapus produk ",e.jsx("strong",{children:c.product?.name}),"?"]})}),e.jsx(h,{variant:"body2",sx:{mt:2},children:"Produk akan dihapus secara soft delete dan dapat dipulihkan nanti."})]}),e.jsxs(je,{children:[e.jsx(w,{onClick:f,disabled:c.loading,children:"Batal"}),e.jsx(w,{onClick:y,color:"error",variant:"contained",disabled:c.loading,children:c.loading?"Menghapus...":"Hapus"})]})]})]})}function ke({onFilterChange:u,categories:P=[],loading:d=!1,initialFilters:_}){const[s,j]=o.useState({search:"",category:"",min_price:void 0,max_price:void 0,sort:"created_at",sortOrder:"desc",..._}),[c,m]=o.useState(!1),g=(a,x)=>{const i={...s,[a]:x};j(i),a!=="search"&&u(i)},y=a=>{const x={...s,search:a};j(x);const i=setTimeout(()=>{u(x)},500);return()=>clearTimeout(i)},f=()=>{const a={search:"",category:"",min_price:void 0,max_price:void 0,sort:"created_at",sortOrder:"desc"};j(a),u(a)},p=(()=>{let a=0;return s.search&&a++,s.category&&a++,s.min_price&&a++,s.max_price&&a++,s.sort!=="created_at"&&a++,s.sortOrder!=="desc"&&a++,a})();return e.jsxs(t,{sx:{mb:3},children:[e.jsxs(t,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[e.jsx(t,{sx:{flex:"1 1 300px",minWidth:200},children:e.jsx(F,{fullWidth:!0,placeholder:"Cari produk...",value:s.search||"",onChange:a=>y(a.target.value),InputProps:{startAdornment:e.jsx(J,{sx:{mr:1,color:"text.secondary"}})},disabled:d})}),e.jsx(t,{sx:{flex:"1 1 200px",minWidth:150},children:e.jsxs(S,{fullWidth:!0,disabled:d,children:[e.jsx(T,{children:"Kategori"}),e.jsxs(A,{value:s.category||"",onChange:a=>g("category",a.target.value),label:"Kategori",children:[e.jsx(k,{value:"",children:"Semua Kategori"}),P.map(a=>e.jsx(k,{value:a.id,children:a.name},a.id))]})]})}),e.jsx(t,{sx:{flex:"1 1 150px",minWidth:120},children:e.jsxs(S,{fullWidth:!0,disabled:d,children:[e.jsx(T,{children:"Urutkan"}),e.jsxs(A,{value:s.sort||"created_at",onChange:a=>g("sort",a.target.value),label:"Urutkan",children:[e.jsx(k,{value:"name",children:"Nama"}),e.jsx(k,{value:"price",children:"Harga"}),e.jsx(k,{value:"created_at",children:"Tanggal Dibuat"})]})]})}),e.jsx(t,{sx:{flex:"1 1 150px",minWidth:120},children:e.jsxs(S,{fullWidth:!0,disabled:d,children:[e.jsx(T,{children:"Urutan"}),e.jsxs(A,{value:s.sortOrder||"desc",onChange:a=>g("sortOrder",a.target.value),label:"Urutan",children:[e.jsx(k,{value:"asc",children:"A-Z / Terendah"}),e.jsx(k,{value:"desc",children:"Z-A / Tertinggi"})]})]})}),e.jsxs(t,{sx:{display:"flex",gap:1,flexShrink:0},children:[e.jsxs(w,{variant:"outlined",startIcon:e.jsx(fe,{}),onClick:()=>m(!c),disabled:d,children:["Filter",p>0&&e.jsx(C,{label:p,size:"small",color:"primary",sx:{ml:1,minWidth:20,height:20}})]}),p>0&&e.jsx(w,{variant:"outlined",startIcon:e.jsx(Q,{}),onClick:f,disabled:d,color:"error",children:"Clear"})]})]}),c&&e.jsxs(t,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:[e.jsx(h,{variant:"subtitle2",gutterBottom:!0,children:"Filter Lanjutan"}),e.jsxs(t,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(t,{sx:{flex:"1 1 200px",minWidth:150},children:e.jsx(F,{fullWidth:!0,label:"Harga Minimum",type:"number",value:s.min_price||"",onChange:a=>g("min_price",a.target.value?Number(a.target.value):void 0),disabled:d,InputProps:{startAdornment:e.jsx(h,{sx:{mr:1},children:"Rp"})}})}),e.jsx(t,{sx:{flex:"1 1 200px",minWidth:150},children:e.jsx(F,{fullWidth:!0,label:"Harga Maksimum",type:"number",value:s.max_price||"",onChange:a=>g("max_price",a.target.value?Number(a.target.value):void 0),disabled:d,InputProps:{startAdornment:e.jsx(h,{sx:{mr:1},children:"Rp"})}})})]})]})]})}function He(){const u=X(),{showNotification:P}=ee(),[d,_]=o.useState([]),[s,j]=o.useState([]),[c,m]=o.useState(!0),[g,y]=o.useState(null),[f,v]=o.useState(0),[p,a]=o.useState(10),[x,i]=o.useState(0),[b,N]=o.useState({}),I=o.useMemo(()=>b,[b]),z=async r=>{try{m(!0),y(null);const n=await R.getProducts({page:(f||0)+1,limit:p,...r});if(n.success)_(n.data),i(n.pagination?.total||0);else throw new Error("Failed to fetch products")}catch(n){y(n.message||"Gagal memuat data produk")}finally{m(!1)}},H=async()=>{try{const r=await te.getCategories();r.success&&j(r.data)}catch(r){console.error("Failed to fetch categories:",r)}};o.useEffect(()=>{z(I)},[f,p,I]),o.useEffect(()=>{H()},[]);const L=r=>{u(`/admin/products/${r.id}/edit`)},V=r=>{u(`/admin/products/${r.id}`)},O=async r=>{try{const n=await R.deleteProduct(r);if(n.success)P({type:"success",message:"Produk berhasil dihapus"}),await z(I);else throw new Error(n.message||"Failed to delete product")}catch(n){throw P({type:"error",message:n.message||"Gagal menghapus produk"}),n}},K=()=>{u("/admin/products/create")},U=()=>{u("/admin/products/deleted")},G=o.useCallback(r=>{N(r),v(0)},[]),Z=(r,n)=>{v(n)},q=r=>{a(parseInt(r.target.value,10)),v(0)};return c&&d.length===0?e.jsx(ae,{message:"Memuat data produk..."}):e.jsxs(re,{maxWidth:!1,children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(t,{children:[e.jsx(h,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Kelola Produk"}),e.jsx(h,{variant:"body1",color:"textSecondary",children:"Kelola produk dan inventori toko Anda"})]}),e.jsx(w,{variant:"contained",startIcon:e.jsx(ve,{}),onClick:K,size:"large",children:"Tambah Produk"})]}),g&&e.jsx(M,{severity:"error",sx:{mb:3},onClose:()=>y(null),children:g}),e.jsx(ke,{onFilterChange:G,categories:s,loading:c,initialFilters:I}),e.jsx(ye,{products:d,isLoading:c,onEdit:L,onDelete:O,onView:V,onViewDeleted:U}),x>0&&e.jsx(be,{rowsPerPageOptions:[5,10,25,50],component:"div",count:x,rowsPerPage:p,page:f,onPageChange:Z,onRowsPerPageChange:q,labelRowsPerPage:"Baris per halaman:",labelDisplayedRows:({from:r,to:n,count:E})=>`${r}-${n} dari ${E!==-1?E:`lebih dari ${n}`}`})]})}export{He as default};
