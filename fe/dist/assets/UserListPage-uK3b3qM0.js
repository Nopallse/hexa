import{l as me,k as pe,r as n,m as fe,_ as be,j as e,s as ve,o as se,t as ye,v as Ce,T as d,a3 as Se,c as ae,P as Z,B as a,R as te,e as I,a0 as we,W as ne,i as ke,aQ as Pe,M as f,b as U,al as M,h as Te,y as Re,F as O,z as B,E as L,x as De,ap as Ie,f as Ue,ak as _e,a as Ae,ar as Fe,Y as We,C as Ee}from"./index-BNHkdQXN.js";import{A as z,u as E}from"./userApi-DWvBAE7f.js";import{T as Q,a as Y,b as q,c as A,d as i,e as J}from"./TableRow-B4eIPwcd.js";import{S as y}from"./Skeleton-C7Iai6me.js";import{T as K}from"./Tooltip-B_Lp-BkP.js";import{O as Oe}from"./Receipt-DHsC4Of4.js";import{V as Be}from"./Visibility-pX7bN8d5.js";import{E as Le}from"./Edit-jAiCsqyQ.js";import{D as Me}from"./Delete-C5OGYaUx.js";import{D as re,a as le,b as ie}from"./DialogTitle-CzRdnrxR.js";import{D as oe}from"./DialogActions-Bz3wEnKU.js";import{F as ze}from"./FilterList-BlCgivxD.js";import{C as X,a as ee}from"./CardContent-Xxy-Rqsq.js";import{A as Ve}from"./Alert-CGwzUP-j.js";import{T as $e}from"./TablePagination-Db_fT23d.js";import"./KeyboardArrowRight-CkSo5XDM.js";import"./LastPage-DHkSoxah.js";function Ne(o){return me("MuiDialogContentText",o)}pe("MuiDialogContentText",["root"]);const He=["children","className"],Ke=o=>{const{classes:s}=o,t=Ce({root:["root"]},Ne,s);return se({},s,t)},Ge=ve(d,{shouldForwardProp:o=>Se(o)||o==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(o,s)=>s.root})({}),Ze=n.forwardRef(function(s,m){const t=fe({props:s,name:"MuiDialogContentText"}),{className:x}=t,g=be(t,He),p=Ke(g);return e.jsx(Ge,se({component:"p",variant:"body1",color:"text.secondary",ref:m,ownerState:g,className:ye(p.root,x)},t,{classes:p}))}),Qe=ae(e.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert"),Ye=ae(e.jsx("path",{d:"M8.65 5.82C9.36 4.72 10.6 4 12 4c2.21 0 4 1.79 4 4 0 1.4-.72 2.64-1.82 3.35zM20 17.17c-.02-1.1-.63-2.11-1.61-2.62-.54-.28-1.13-.54-1.77-.76zm1.19 4.02L2.81 2.81 1.39 4.22l8.89 8.89c-1.81.23-3.39.79-4.67 1.45-1 .51-1.61 1.54-1.61 2.66V20h13.17l2.61 2.61z"}),"PersonOff");function qe({users:o,isLoading:s,onView:m,onEditRole:t,onDelete:x}){const[g,p]=n.useState(null),[h,k]=n.useState(null),[S,b]=n.useState(!1),[C,j]=n.useState(null),D=(l,R)=>{p(l.currentTarget),k(R)},v=()=>{p(null),k(null)},r=()=>{h&&m(h),v()},P=()=>{h&&t(h),v()},_=()=>{h&&(j(h.id),b(!0)),v()},T=()=>{C&&(x(C),b(!1),j(null))},F=()=>{b(!1),j(null)},V=l=>new Date(l).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),W=l=>l==="admin"?"error":"default",$=l=>l==="admin"?e.jsx(z,{}):e.jsx(M,{});return s?e.jsx(Q,{component:Z,children:e.jsxs(Y,{children:[e.jsx(q,{children:e.jsxs(A,{children:[e.jsx(i,{children:"Pengguna"}),e.jsx(i,{children:"Email"}),e.jsx(i,{children:"Role"}),e.jsx(i,{children:"Statistik"}),e.jsx(i,{children:"Tanggal Dibuat"}),e.jsx(i,{align:"center",children:"Aksi"})]})}),e.jsx(J,{children:[...Array(5)].map((l,R)=>e.jsxs(A,{children:[e.jsx(i,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(y,{variant:"circular",width:40,height:40}),e.jsxs(a,{children:[e.jsx(y,{variant:"text",width:120}),e.jsx(y,{variant:"text",width:80})]})]})}),e.jsx(i,{children:e.jsx(y,{variant:"text",width:150})}),e.jsx(i,{children:e.jsx(y,{variant:"text",width:60})}),e.jsx(i,{children:e.jsx(y,{variant:"text",width:100})}),e.jsx(i,{children:e.jsx(y,{variant:"text",width:120})}),e.jsx(i,{align:"center",children:e.jsx(y,{variant:"circular",width:32,height:32})})]},R))})]})}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{component:Z,children:e.jsxs(Y,{children:[e.jsx(q,{children:e.jsxs(A,{children:[e.jsx(i,{children:"Pengguna"}),e.jsx(i,{children:"Email"}),e.jsx(i,{children:"Role"}),e.jsx(i,{children:"Statistik"}),e.jsx(i,{children:"Tanggal Dibuat"}),e.jsx(i,{align:"center",children:"Aksi"})]})}),e.jsx(J,{children:o.length===0?e.jsx(A,{children:e.jsx(i,{colSpan:6,align:"center",sx:{py:4},children:e.jsx(d,{variant:"body1",color:"textSecondary",children:"Tidak ada data pengguna"})})}):o.map(l=>e.jsxs(A,{hover:!0,children:[e.jsx(i,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(te,{sx:{bgcolor:"primary.main"},children:l.full_name.charAt(0).toUpperCase()}),e.jsxs(a,{children:[e.jsx(d,{variant:"subtitle2",fontWeight:"medium",children:l.full_name}),l.phone&&e.jsx(d,{variant:"caption",color:"textSecondary",children:l.phone})]})]})}),e.jsx(i,{children:e.jsx(d,{variant:"body2",children:l.email})}),e.jsx(i,{children:e.jsx(I,{icon:$(l.role),label:l.role==="admin"?"Admin":"User",color:W(l.role),size:"small"})}),e.jsx(i,{children:e.jsxs(a,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(K,{title:"Alamat",children:e.jsx(I,{icon:e.jsx(we,{}),label:l._count?.addresses||0,size:"small",variant:"outlined"})}),e.jsx(K,{title:"Keranjang",children:e.jsx(I,{icon:e.jsx(ne,{}),label:l._count?.cart_items||0,size:"small",variant:"outlined"})}),e.jsx(K,{title:"Pesanan",children:e.jsx(I,{icon:e.jsx(Oe,{}),label:l._count?.orders||0,size:"small",variant:"outlined"})})]})}),e.jsx(i,{children:e.jsx(d,{variant:"body2",children:V(l.created_at)})}),e.jsx(i,{align:"center",children:e.jsx(ke,{onClick:R=>D(R,l),size:"small",children:e.jsx(Qe,{})})})]},l.id))})]})}),e.jsxs(Pe,{anchorEl:g,open:!!g,onClose:v,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[e.jsxs(f,{onClick:r,children:[e.jsx(Be,{sx:{mr:1}}),"Lihat Detail"]}),e.jsxs(f,{onClick:P,children:[e.jsx(Le,{sx:{mr:1}}),"Ubah Role"]}),e.jsxs(f,{onClick:_,sx:{color:"error.main"},children:[e.jsx(Me,{sx:{mr:1}}),"Hapus"]})]}),e.jsxs(re,{open:S,onClose:F,"aria-labelledby":"delete-dialog-title","aria-describedby":"delete-dialog-description",children:[e.jsx(le,{id:"delete-dialog-title",children:"Konfirmasi Hapus Pengguna"}),e.jsx(ie,{children:e.jsxs(Ze,{id:"delete-dialog-description",children:["Apakah Anda yakin ingin menghapus pengguna"," ",e.jsx("strong",{children:h?.full_name}),"? Tindakan ini tidak dapat dibatalkan dan akan menghapus semua data terkait pengguna."]})}),e.jsxs(oe,{children:[e.jsx(U,{onClick:F,color:"inherit",children:"Batal"}),e.jsx(U,{onClick:T,color:"error",variant:"contained",children:"Hapus"})]})]})]})}function Je({onFilterChange:o,loading:s=!1,initialFilters:m}){const[t,x]=n.useState({search:"",role:"",sort:"created_at",sortOrder:"desc",...m}),[g,p]=n.useState(!1),[h,k]=n.useState(null),S=n.useCallback(o,[]);n.useEffect(()=>{h&&clearTimeout(h);const r=setTimeout(()=>{S(t)},t.search?500:0);return k(r),()=>{r&&clearTimeout(r)}},[t,S]),n.useEffect(()=>()=>{h&&clearTimeout(h)},[h]);const b=(r,P)=>{x(_=>({..._,[r]:P}))},C=r=>{x(P=>({...P,search:r}))},j=()=>{x({search:"",role:"",sort:"created_at",sortOrder:"desc"})},v=(()=>{let r=0;return t.search&&r++,t.role&&r++,t.sort!=="created_at"&&r++,t.sortOrder!=="desc"&&r++,r})();return e.jsxs(a,{sx:{mb:3},children:[e.jsxs(a,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[e.jsx(a,{sx:{flex:"1 1 300px",minWidth:200},children:e.jsx(Te,{fullWidth:!0,placeholder:"Cari pengguna...",value:t.search||"",onChange:r=>C(r.target.value),InputProps:{startAdornment:e.jsx(Re,{sx:{mr:1,color:"text.secondary"}})},disabled:s})}),e.jsx(a,{sx:{flex:"1 1 200px",minWidth:150},children:e.jsxs(O,{fullWidth:!0,disabled:s,children:[e.jsx(B,{children:"Role"}),e.jsxs(L,{value:t.role||"",onChange:r=>b("role",r.target.value),label:"Role",children:[e.jsx(f,{value:"",children:"Semua Role"}),e.jsx(f,{value:"user",children:"User"}),e.jsx(f,{value:"admin",children:"Admin"})]})]})}),e.jsx(a,{sx:{flex:"1 1 150px",minWidth:120},children:e.jsxs(O,{fullWidth:!0,disabled:s,children:[e.jsx(B,{children:"Urutkan"}),e.jsxs(L,{value:t.sort||"created_at",onChange:r=>b("sort",r.target.value),label:"Urutkan",children:[e.jsx(f,{value:"name",children:"Nama"}),e.jsx(f,{value:"email",children:"Email"}),e.jsx(f,{value:"role",children:"Role"}),e.jsx(f,{value:"created_at",children:"Tanggal Dibuat"})]})]})}),e.jsx(a,{sx:{flex:"1 1 150px",minWidth:120},children:e.jsxs(O,{fullWidth:!0,disabled:s,children:[e.jsx(B,{children:"Urutan"}),e.jsxs(L,{value:t.sortOrder||"desc",onChange:r=>b("sortOrder",r.target.value),label:"Urutan",children:[e.jsx(f,{value:"asc",children:"A-Z / Terendah"}),e.jsx(f,{value:"desc",children:"Z-A / Tertinggi"})]})]})}),e.jsxs(a,{sx:{display:"flex",gap:1,flexShrink:0},children:[e.jsxs(U,{variant:"outlined",startIcon:e.jsx(ze,{}),onClick:()=>p(!g),disabled:s,children:["Filter",v>0&&e.jsx(I,{label:v,size:"small",color:"primary",sx:{ml:1,minWidth:20,height:20}})]}),v>0&&e.jsx(U,{variant:"outlined",startIcon:e.jsx(De,{}),onClick:j,disabled:s,color:"error",children:"Clear"})]})]}),g&&e.jsxs(a,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:[e.jsx(d,{variant:"subtitle2",gutterBottom:!0,children:"Filter Lanjutan"}),e.jsx(a,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:e.jsx(d,{variant:"body2",color:"textSecondary",children:"Filter lanjutan akan ditambahkan sesuai kebutuhan."})})]})]})}function Xe({stats:o,isLoading:s}){const m=[{title:"Total Pengguna",value:o?.total_users||0,icon:e.jsx(Ie,{}),color:"primary",description:"Semua pengguna terdaftar"},{title:"Admin",value:o?.total_admins||0,icon:e.jsx(z,{}),color:"error",description:"Pengguna dengan akses admin"},{title:"User Biasa",value:o?.total_regular_users||0,icon:e.jsx(M,{}),color:"info",description:"Pengguna dengan akses terbatas"},{title:"Pengguna Baru",value:o?.recent_users||0,icon:e.jsx(Ue,{}),color:"success",description:"Bergabung dalam 30 hari terakhir"},{title:"Dengan Pesanan",value:o?.users_with_orders||0,icon:e.jsx(ne,{}),color:"warning",description:"Pengguna yang pernah berbelanja"},{title:"Tanpa Pesanan",value:o?.users_without_orders||0,icon:e.jsx(Ye,{}),color:"default",description:"Pengguna yang belum berbelanja"}];return s?e.jsx(a,{sx:{display:"flex",flexWrap:"wrap",gap:3,mb:3},children:m.map((t,x)=>e.jsx(a,{sx:{flex:"1 1 250px",minWidth:"250px"},children:e.jsx(X,{children:e.jsxs(ee,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(y,{variant:"circular",width:40,height:40}),e.jsxs(a,{sx:{ml:2,flex:1},children:[e.jsx(y,{variant:"text",width:"80%"}),e.jsx(y,{variant:"text",width:"60%"})]})]}),e.jsx(y,{variant:"text",width:"40%"})]})})},x))}):e.jsx(a,{sx:{display:"flex",flexWrap:"wrap",gap:3,mb:3},children:m.map((t,x)=>e.jsx(a,{sx:{flex:"1 1 250px",minWidth:"250px"},children:e.jsx(X,{sx:{height:"100%"},children:e.jsxs(ee,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(a,{sx:{p:1,borderRadius:1,bgcolor:`${t.color}.light`,color:`${t.color}.main`,display:"flex",alignItems:"center",justifyContent:"center"},children:t.icon}),e.jsxs(a,{sx:{ml:2,flex:1},children:[e.jsx(d,{variant:"subtitle2",color:"textSecondary",children:t.title}),e.jsx(d,{variant:"h4",fontWeight:"bold",children:t.value.toLocaleString("id-ID")})]})]}),e.jsx(d,{variant:"caption",color:"textSecondary",children:t.description})]})})},x))})}function es({open:o,user:s,onClose:m,onSave:t,loading:x=!1}){const[g,p]=n.useState("user"),h=()=>{x||(p("user"),m())},k=async()=>{s&&g!==s.role&&await t(s.id,g),h()},S=j=>{p(j.target.value)},b=j=>j==="admin"?e.jsx(z,{}):e.jsx(M,{}),C=j=>j==="admin"?"error":"default";return s?e.jsxs(re,{open:o,onClose:h,maxWidth:"sm",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(te,{sx:{bgcolor:"primary.main"},children:s.full_name.charAt(0).toUpperCase()}),e.jsxs(a,{children:[e.jsx(d,{variant:"h6",children:"Ubah Role Pengguna"}),e.jsxs(d,{variant:"body2",color:"textSecondary",children:[s.full_name," (",s.email,")"]})]})]})}),e.jsxs(ie,{children:[e.jsxs(a,{sx:{mb:3},children:[e.jsx(d,{variant:"subtitle2",gutterBottom:!0,children:"Role Saat Ini:"}),e.jsx(I,{icon:b(s.role),label:s.role==="admin"?"Admin":"User",color:C(s.role),size:"medium"})]}),e.jsxs(O,{fullWidth:!0,children:[e.jsx(B,{children:"Role Baru"}),e.jsxs(L,{value:g,onChange:S,label:"Role Baru",disabled:x,children:[e.jsx(f,{value:"user",children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(M,{}),e.jsxs(a,{children:[e.jsx(d,{variant:"body2",children:"User"}),e.jsx(d,{variant:"caption",color:"textSecondary",children:"Akses terbatas, hanya dapat berbelanja"})]})]})}),e.jsx(f,{value:"admin",children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(z,{}),e.jsxs(a,{children:[e.jsx(d,{variant:"body2",children:"Admin"}),e.jsx(d,{variant:"caption",color:"textSecondary",children:"Akses penuh ke sistem administrasi"})]})]})})]})]}),g!==s.role&&e.jsx(a,{sx:{mt:2,p:2,bgcolor:"warning.light",borderRadius:1},children:e.jsx(d,{variant:"body2",color:"warning.dark",children:"⚠️ Perubahan role akan mempengaruhi akses pengguna ke sistem. Pastikan perubahan ini sesuai dengan kebutuhan."})})]}),e.jsxs(oe,{children:[e.jsx(U,{onClick:h,disabled:x,children:"Batal"}),e.jsx(U,{onClick:k,variant:"contained",disabled:x||g===s.role,startIcon:x?e.jsx(_e,{size:16}):null,children:x?"Menyimpan...":"Simpan"})]})]}):null}function fs(){const o=Ae(),{showNotification:s}=Fe(),[m,t]=n.useState([]),[x,g]=n.useState(null),[p,h]=n.useState(!0),[k,S]=n.useState(!0),[b,C]=n.useState(null),[j,D]=n.useState(0),[v,r]=n.useState(10),[P,_]=n.useState(0),[T,F]=n.useState({}),[V,W]=n.useState(!1),[$,l]=n.useState(null),[R,G]=n.useState(!1),N=async c=>{try{h(!0),C(null);const u=await E.getUsers({page:(j||0)+1,limit:v,...c});if(u.success)t(u.data),_(u.pagination?.total_items||0);else throw new Error("Failed to fetch users")}catch(u){C(u.message||"Gagal memuat data pengguna")}finally{h(!1)}},H=async()=>{try{S(!0);const c=await E.getUserStats();c.success&&g(c.data)}catch(c){console.error("Failed to fetch user stats:",c)}finally{S(!1)}};n.useEffect(()=>{N(T)},[j,v,T]),n.useEffect(()=>{H()},[]);const ce=c=>{o(`/admin/users/${c.id}`)},de=c=>{l(c),W(!0)},xe=async(c,u)=>{try{G(!0);const w=await E.updateUserRole(c,{role:u});if(w.success)s({type:"success",message:w.message||"Role pengguna berhasil diperbarui"}),await N(T),await H();else throw new Error(w.message||"Failed to update user role")}catch(w){throw s({type:"error",message:w.message||"Gagal memperbarui role pengguna"}),w}finally{G(!1)}},he=async c=>{try{const u=await E.deleteUser(c);if(u.success)s({type:"success",message:u.message||"Pengguna berhasil dihapus"}),await N(T),await H();else throw new Error(u.message||"Failed to delete user")}catch(u){throw s({type:"error",message:u.message||"Gagal menghapus pengguna"}),u}},ue=n.useCallback(c=>{F(c),D(0)},[]),ge=(c,u)=>{D(u)},je=c=>{r(parseInt(c.target.value,10)),D(0)};return p&&m.length===0?e.jsx(We,{message:"Memuat data pengguna..."}):e.jsxs(Ee,{maxWidth:!1,children:[e.jsxs(a,{sx:{mb:4},children:[e.jsx(d,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Kelola Pengguna"}),e.jsx(d,{variant:"body1",color:"textSecondary",children:"Kelola pengguna dan akses sistem"})]}),e.jsx(Xe,{stats:x,isLoading:k}),b&&e.jsx(Ve,{severity:"error",sx:{mb:3},onClose:()=>C(null),children:b}),e.jsx(Je,{onFilterChange:ue,loading:p,initialFilters:T}),e.jsx(qe,{users:m,isLoading:p,onView:ce,onEditRole:de,onDelete:he}),P>0&&e.jsx($e,{rowsPerPageOptions:[5,10,25,50],component:"div",count:P,rowsPerPage:v,page:j,onPageChange:ge,onRowsPerPageChange:je,labelRowsPerPage:"Baris per halaman:",labelDisplayedRows:({from:c,to:u,count:w})=>`${c}-${u} dari ${w!==-1?w:`lebih dari ${u}`}`}),e.jsx(es,{open:V,user:$,onClose:()=>W(!1),onSave:xe,loading:R})]})}export{fs as default};
