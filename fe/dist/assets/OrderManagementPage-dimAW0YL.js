import{r as o,j as e,x as C,T as g,B as E,a4 as O,a5 as $,a6 as l,w as J,I as Z,b2 as ee,p as L,E as ae,X as se,ay as te,t as re,W as ne,q as ie,aB as le,Y as oe,af as de,C as ce}from"./index-5OgQjLSC.js";import{a as _}from"./orderApi-B9d10Yor.js";import{u as ue}from"./useCurrencyConversion-Qw05_SY9.js";import{T as A,a as M,b as R,c as P,d as s,e as W}from"./TableRow-CXYZx9vg.js";import{S as v}from"./Skeleton-DryWEUlh.js";import{T as he}from"./Tooltip-CoK2AUtP.js";import{V as z}from"./Visibility-C9za9tFr.js";import{G as D}from"./Grid-DC0V799Y.js";import{A as me}from"./Alert-3VKlMIM5.js";import{T as xe,a as be}from"./Tabs-DV9nmTeh.js";import{T as je}from"./TablePagination-BQyDseL3.js";import"./Popper-C_GdxfKp.js";import"./KeyboardArrowRight-BkxWvQqw.js";import"./LastPage-CrPVfBc1.js";const pe=n=>{switch(n){case"unpaid":return"error";case"paid":return"success";case"failed":return"error";case"refunded":return"warning";default:return"default"}},ge=n=>{switch(n){case"unpaid":return"Belum Dibayar";case"paid":return"Sudah Dibayar";case"failed":return"Gagal Bayar";case"refunded":return"Dikembalikan";default:return n}};function fe({orders:n,isLoading:j,onView:c,onStatusUpdate:S}){const{formatPrice:u}=ue(),[x,h]=o.useState(null),[f,k]=o.useState(null),b=()=>{h(null),k(null)},y=()=>{f&&c(f),b()},p=(a,d)=>{S(a,d),b()},t=a=>new Date(a).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return j&&n.length===0?e.jsx(A,{component:C,elevation:0,sx:{borderRadius:2,border:"1px solid",borderColor:"divider"},children:e.jsxs(M,{children:[e.jsx(R,{children:e.jsxs(P,{children:[e.jsx(s,{children:"ID Pesanan"}),e.jsx(s,{children:"Pelanggan"}),e.jsx(s,{children:"Status"}),e.jsx(s,{children:"Pembayaran"}),e.jsx(s,{children:"Total"}),e.jsx(s,{children:"Tanggal"}),e.jsx(s,{align:"right",children:"Aksi"})]})}),e.jsx(W,{children:[...Array(5)].map((a,d)=>e.jsxs(P,{children:[e.jsx(s,{children:e.jsx(v,{})}),e.jsx(s,{children:e.jsx(v,{})}),e.jsx(s,{children:e.jsx(v,{})}),e.jsx(s,{children:e.jsx(v,{})}),e.jsx(s,{children:e.jsx(v,{})}),e.jsx(s,{children:e.jsx(v,{})}),e.jsx(s,{align:"right",children:e.jsx(v,{})})]},d))})]})}):n.length===0?e.jsx(C,{elevation:0,sx:{p:4,textAlign:"center",borderRadius:2,border:"1px solid",borderColor:"divider"},children:e.jsx(g,{variant:"body1",color:"textSecondary",children:"Tidak ada pesanan ditemukan"})}):e.jsxs(e.Fragment,{children:[e.jsx(A,{component:C,elevation:0,sx:{borderRadius:2,border:"1px solid",borderColor:"divider"},children:e.jsxs(M,{children:[e.jsx(R,{children:e.jsxs(P,{children:[e.jsx(s,{children:"ID Pesanan"}),e.jsx(s,{children:"Pelanggan"}),e.jsx(s,{children:"Status"}),e.jsx(s,{children:"Pembayaran"}),e.jsx(s,{children:"Total"}),e.jsx(s,{children:"Tanggal"}),e.jsx(s,{align:"right",children:"Aksi"})]})}),e.jsx(W,{children:n.map(a=>e.jsxs(P,{hover:!0,children:[e.jsx(s,{children:e.jsxs(g,{variant:"body2",fontWeight:500,children:["#",a.id.slice(-8).toUpperCase()]})}),e.jsx(s,{children:e.jsxs(E,{children:[e.jsx(g,{variant:"body2",fontWeight:500,children:a.user?.full_name||"N/A"}),e.jsx(g,{variant:"caption",color:"textSecondary",children:a.user?.email||"N/A"})]})}),e.jsx(s,{children:e.jsx(O,{size:"small",sx:{minWidth:120},children:e.jsxs($,{value:a.status,onChange:d=>p(a.id,d.target.value),sx:{height:28,fontSize:"0.75rem","& .MuiSelect-select":{py:.5}},children:[a.status==="belum_bayar"&&[e.jsx(l,{value:"belum_bayar",disabled:!0,children:"Belum Bayar (Current)"},"belum_bayar"),e.jsx(l,{value:"dikemas",children:"Dikemas"},"dikemas"),e.jsx(l,{value:"dibatalkan",children:"Dibatalkan"},"dibatalkan")],a.status==="dikemas"&&[e.jsx(l,{value:"dikemas",disabled:!0,children:"Dikemas (Current)"},"dikemas"),e.jsx(l,{value:"dikirim",children:"Dikirim"},"dikirim"),e.jsx(l,{value:"dibatalkan",children:"Dibatalkan"},"dibatalkan")],a.status==="dikirim"&&[e.jsx(l,{value:"dikirim",disabled:!0,children:"Dikirim (Current)"},"dikirim"),e.jsx(l,{value:"diterima",children:"Diterima"},"diterima")],a.status==="diterima"&&e.jsx(l,{value:"diterima",disabled:!0,children:"Diterima (Final)"}),a.status==="dibatalkan"&&e.jsx(l,{value:"dibatalkan",disabled:!0,children:"Dibatalkan (Final)"})]})})}),e.jsx(s,{children:e.jsx(J,{label:ge(a.payment_status),size:"small",color:pe(a.payment_status),variant:"outlined",sx:{fontSize:"0.7rem",height:24}})}),e.jsx(s,{children:e.jsx(g,{variant:"body2",fontWeight:600,children:u((Number(a.total_amount)||0)+(Number(a.shipping_cost)||0))})}),e.jsx(s,{children:e.jsx(g,{variant:"body2",color:"textSecondary",children:t(a.created_at)})}),e.jsx(s,{align:"right",children:e.jsx(he,{title:"Lihat Detail",children:e.jsx(Z,{size:"small",onClick:()=>c(a),sx:{color:"primary.main"},children:e.jsx(z,{fontSize:"small"})})})})]},a.id))})]})}),e.jsx(ee,{anchorEl:x,open:!!x,onClose:b,children:e.jsxs(l,{onClick:y,children:[e.jsx(z,{sx:{mr:1,fontSize:20}}),"Lihat Detail"]})})]})}function ye({onFilterChange:n,loading:j=!1,initialFilters:c}){const S=L(),[u,x]=o.useState({search:"",payment_status:"",...c}),[h,f]=o.useState(null);o.useEffect(()=>{c&&x(t=>({...t,...c}))},[c]);const k=(t,a)=>{const d={...u,[t]:a};x(d),n(d)},b=t=>{const a={...u,search:t};x(a),h&&clearTimeout(h);const d=setTimeout(()=>{n(a)},500);f(d)},y=()=>{const t={search:"",payment_status:""};x(t),n(t)};o.useEffect(()=>()=>{h&&clearTimeout(h)},[h]);const p=u.search||u.payment_status;return e.jsx(C,{elevation:0,sx:{p:2,mb:3,borderRadius:2,border:`1px solid ${S.palette.grey[200]}`},children:e.jsxs(D,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(D,{item:!0,xs:12,md:4,children:e.jsx(ae,{fullWidth:!0,size:"small",placeholder:"Cari ID pesanan, nama, atau email...",value:u.search||"",onChange:t=>b(t.target.value),InputProps:{startAdornment:e.jsx(se,{sx:{mr:1,color:"text.secondary"}})},disabled:j})}),e.jsx(D,{item:!0,xs:12,md:3,children:e.jsxs(O,{fullWidth:!0,size:"small",children:[e.jsx(te,{children:"Status Pembayaran"}),e.jsxs($,{value:u.payment_status||"",onChange:t=>k("payment_status",t.target.value),label:"Status Pembayaran",disabled:j,children:[e.jsx(l,{value:"",children:"Semua"}),e.jsx(l,{value:"unpaid",children:"Belum Dibayar"}),e.jsx(l,{value:"paid",children:"Sudah Dibayar"}),e.jsx(l,{value:"failed",children:"Gagal Bayar"}),e.jsx(l,{value:"refunded",children:"Dikembalikan"})]})]})}),e.jsx(D,{item:!0,xs:12,md:2,children:e.jsx(re,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(ne,{}),onClick:y,disabled:j||!p,sx:{height:40},children:"Hapus Filter"})})]})})}function ve(n){return{id:`order-tab-${n}`,"aria-controls":`order-tabpanel-${n}`}}function We(){const n=ie(),{showNotification:j}=le(),c=L(),S=oe(c.breakpoints.down("md")),[u,x]=o.useState([]),[h,f]=o.useState(!0),[k,b]=o.useState(null),[y,p]=o.useState(0),[t,a]=o.useState(10),[d,G]=o.useState(0),[N,U]=o.useState(0),[w,B]=o.useState({}),F=[{label:"Semua",value:""},{label:"Belum Bayar",value:"belum_bayar"},{label:"Dikemas",value:"dikemas"},{label:"Dikirim",value:"dikirim"},{label:"Diterima",value:"diterima"},{label:"Dibatalkan",value:"dibatalkan"}],T=o.useMemo(()=>w,[w]),I=async i=>{try{f(!0),b(null);const r=await _.getAllOrders({page:(y||0)+1,limit:t,...i});if(r.success)x(r.data),G(r.pagination?.total||0);else throw new Error("Failed to fetch orders")}catch(r){b(r.response?.data?.error||r.message||"Gagal memuat data pesanan")}finally{f(!1)}};o.useEffect(()=>{I(T)},[y,t,T]);const H=(i,r)=>{U(r);const m=F[r].value;B(Y=>({...Y,status:m})),p(0)},V=i=>{B(i),p(0)},K=i=>{n(`/admin/orders/${i.id}`)},q=async(i,r)=>{try{const m=await _.updateOrderStatus(i,r);if(m.success)j({type:"success",message:"Status pesanan berhasil diperbarui"}),I(T);else throw new Error(m.error||"Failed to update order status")}catch(m){j({type:"error",message:m.response?.data?.error||m.message||"Gagal memperbarui status pesanan"})}},Q=(i,r)=>{p(r)},X=i=>{a(parseInt(i.target.value,10)),p(0)};return h&&u.length===0?e.jsx(de,{message:"Memuat data pesanan..."}):e.jsxs(ce,{maxWidth:!1,children:[e.jsxs(E,{sx:{mb:4},children:[e.jsx(g,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Kelola Pesanan"}),e.jsx(g,{variant:"body1",color:"textSecondary",children:"Kelola dan lacak semua pesanan pelanggan"})]}),k&&e.jsx(me,{severity:"error",sx:{mb:3},onClose:()=>b(null),children:k}),e.jsx(C,{elevation:0,sx:{mb:3,borderRadius:2,border:`1px solid ${c.palette.grey[200]}`},children:e.jsx(xe,{value:N,onChange:H,variant:S?"scrollable":"standard",scrollButtons:S?"auto":!1,allowScrollButtonsMobile:!0,sx:{borderBottom:`1px solid ${c.palette.grey[200]}`,"& .MuiTab-root":{textTransform:"none",fontWeight:500,fontSize:"1rem",py:2,px:3,minHeight:"auto","&.Mui-selected":{fontWeight:600,color:"primary.main"}},"& .MuiTabs-indicator":{height:3,borderRadius:"3px 3px 0 0"}},children:F.map((i,r)=>e.jsx(be,{label:i.label,...ve(r)},i.value))})}),e.jsx(ye,{onFilterChange:V,loading:h,initialFilters:T}),e.jsx(fe,{orders:u,isLoading:h,onView:K,onStatusUpdate:q}),d>0&&e.jsx(je,{rowsPerPageOptions:[5,10,25,50],component:"div",count:d,rowsPerPage:t,page:y,onPageChange:Q,onRowsPerPageChange:X,labelRowsPerPage:"Baris per halaman:",labelDisplayedRows:({from:i,to:r,count:m})=>`${i}-${r} dari ${m!==-1?m:`lebih dari ${r}`}`})]})}export{We as default};
