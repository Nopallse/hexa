import{r as o,j as e,y as E,T as d,B as r,v as I,aA as J,x as g,I as z,D,Y as ee,a4 as T,al as F,a5 as A,a6 as C,X as ae,q as re,aB as se,p as te,Z as ie,ag as ne,C as le,A as oe}from"./index-tvCmUXkA.js";import{p as R}from"./productApi-uU0QhFhc.js";import{a as ce}from"./image-CeHRN-zl.js";import{D as de}from"./RestoreFromTrash-BHXXrcUQ.js";import{T as he,a as me,b as xe,c as M,d as n,e as ue}from"./TableRow-Bx2Iwbxr.js";import{A as ge}from"./Avatar-Cw6JEpzV.js";import{T as S}from"./Tooltip-CRdXSvuP.js";import{V as pe}from"./Visibility-Bvwl8cdA.js";import{E as je}from"./Edit-EiFO075a.js";import{D as fe}from"./Delete-n8OHpdJZ.js";import{D as ve,a as be,b as ye}from"./DialogTitle-yi9wgBEI.js";import{A as L}from"./Alert-iJ2nvuQL.js";import{D as ke}from"./DialogActions-Bmmc9LId.js";import{F as Ce}from"./FilterList-DwFV5sJn.js";import{A as H}from"./Add-DOZR1gGR.js";import{T as we}from"./TablePagination-BcG9v-ci.js";import"./useSlot-Dd61XFNI.js";import"./Popper-DMWFBkOI.js";import"./KeyboardArrowRight-GxyP2UjW.js";import"./LastPage-Unmxpdhm.js";function Pe({products:x,isLoading:w=!1,onEdit:h,onDelete:y,onView:s,onViewDeleted:f}){const[m,p]=o.useState({open:!1,product:null,loading:!1}),u=a=>{p({open:!0,product:a,loading:!1})},P=async()=>{if(m.product){p(a=>({...a,loading:!0}));try{await y(m.product.id),p({open:!1,product:null,loading:!1})}catch{p(c=>({...c,loading:!1}))}}},k=()=>{p({open:!1,product:null,loading:!1})},v=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a),j=a=>a.product_images&&a.product_images.length>0?a.product_images.find(i=>i.is_primary)||a.product_images[0]:null;return x.length===0&&!w?e.jsxs(E,{sx:{p:4,textAlign:"center"},children:[e.jsx(d,{variant:"h6",color:"textSecondary",children:"Belum ada produk"}),e.jsx(d,{variant:"body2",color:"textSecondary",children:"Tambah produk pertama untuk mulai menjual"})]}):e.jsxs(e.Fragment,{children:[f&&e.jsx(r,{sx:{mb:2,display:"flex",justifyContent:"flex-end"},children:e.jsx(I,{variant:"outlined",startIcon:e.jsx(de,{}),onClick:f,color:"secondary",children:"Lihat Produk Dihapus"})}),e.jsx(he,{component:E,children:e.jsxs(me,{children:[e.jsx(xe,{children:e.jsxs(M,{children:[e.jsx(n,{children:"Gambar"}),e.jsx(n,{children:"Nama Produk"}),e.jsx(n,{children:"Kategori"}),e.jsx(n,{align:"right",children:"Harga"}),e.jsx(n,{align:"center",children:"Stok"}),e.jsx(n,{align:"center",children:"Pre-order"}),e.jsx(n,{align:"center",children:"Dimensi"}),e.jsx(n,{align:"center",children:"Info Varian"}),e.jsx(n,{align:"center",children:"Aksi"})]})}),e.jsx(ue,{children:x.map(a=>{const c=j(a);return e.jsxs(M,{hover:!0,children:[e.jsx(n,{children:e.jsx(ge,{src:ce(c?.image_name),variant:"rounded",sx:{width:56,height:56},children:e.jsx(J,{})})}),e.jsx(n,{children:e.jsxs(r,{children:[e.jsx(d,{variant:"subtitle2",fontWeight:"medium",gutterBottom:!0,children:a.name}),e.jsx(d,{variant:"body2",color:"textSecondary",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a.description||"-"})]})}),e.jsx(n,{children:e.jsx(g,{label:a.category?.name||"Tidak ada kategori",size:"small",color:"primary",variant:"outlined"})}),e.jsx(n,{align:"right",children:a.product_variants&&a.product_variants.length>0?e.jsx(r,{sx:{textAlign:"right"},children:e.jsxs(d,{variant:"body1",fontWeight:"medium",color:"primary",children:[v(Math.min(...a.product_variants.map(i=>parseFloat(i.price))))," - ",v(Math.max(...a.product_variants.map(i=>parseFloat(i.price))))]})}):e.jsx(d,{variant:"body1",fontWeight:"medium",children:v(parseFloat(a.price||"0"))})}),e.jsx(n,{align:"center",children:a.product_variants&&a.product_variants.length>0?e.jsx(r,{sx:{display:"flex",flexDirection:"column",gap:.5,alignItems:"center"},children:e.jsx(g,{label:`Total: ${a.product_variants.reduce((i,b)=>i+(b.stock||0),0)}`,size:"small",color:a.product_variants.reduce((i,b)=>i+(b.stock||0),0)>0?"success":"error",variant:a.product_variants.reduce((i,b)=>i+(b.stock||0),0)>0?"filled":"outlined"})}):e.jsx(g,{label:a.stock||0,size:"small",color:(a.stock||0)>0?"success":"error",variant:(a.stock||0)>0?"filled":"outlined"})}),e.jsx(n,{align:"center",children:e.jsx(g,{label:`${a.pre_order||0} hari`,size:"small",color:a.pre_order&&a.pre_order>0?"warning":"default",variant:a.pre_order&&a.pre_order>0?"filled":"outlined"})}),e.jsx(n,{align:"center",children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:.5,alignItems:"center"},children:[a.length&&a.width&&a.height?e.jsx(S,{title:`${a.length}×${a.width}×${a.height} cm`,children:e.jsx(g,{label:`${a.length}×${a.width}×${a.height}`,size:"small",color:"info",variant:"outlined",sx:{fontSize:"0.7rem"}})}):e.jsx(g,{label:"Belum diatur",size:"small",color:"default",variant:"outlined",sx:{fontSize:"0.7rem"}}),a.weight&&e.jsx(S,{title:`${a.weight} gram`,children:e.jsx(g,{label:`${a.weight}g`,size:"small",color:"secondary",variant:"outlined",sx:{fontSize:"0.7rem"}})})]})}),e.jsx(n,{align:"center",children:a.product_variants&&a.product_variants.length>0?e.jsx(r,{sx:{display:"flex",flexDirection:"column",gap:.5,alignItems:"center"},children:e.jsx(g,{label:`${a.product_variants.length} Varian`,size:"small",color:"primary",variant:"filled",sx:{fontWeight:"bold"}})}):e.jsx(g,{label:"Tidak Ada Varian",size:"small",color:"default",variant:"outlined",sx:{fontSize:"0.7rem"}})}),e.jsx(n,{align:"center",children:e.jsxs(r,{sx:{display:"flex",justifyContent:"center",gap:.5},children:[e.jsx(S,{title:"Lihat Detail",children:e.jsx(z,{size:"small",onClick:()=>s(a),color:"info",children:e.jsx(pe,{fontSize:"small"})})}),e.jsx(S,{title:"Edit Produk",children:e.jsx(z,{size:"small",onClick:()=>h(a),color:"primary",children:e.jsx(je,{fontSize:"small"})})}),e.jsx(S,{title:"Hapus Produk",children:e.jsx(z,{size:"small",onClick:()=>u(a),color:"error",children:e.jsx(fe,{fontSize:"small"})})})]})})]},a.id)})})]})}),e.jsxs(ve,{open:m.open,onClose:k,maxWidth:"sm",fullWidth:!0,children:[e.jsx(be,{children:"Hapus Produk"}),e.jsxs(ye,{children:[e.jsx(L,{severity:"warning",sx:{mb:2},children:e.jsxs(d,{variant:"body2",children:["Anda yakin ingin menghapus produk ",e.jsx("strong",{children:m.product?.name}),"?"]})}),e.jsx(d,{variant:"body2",sx:{mt:2},children:"Produk akan dihapus secara soft delete dan dapat dipulihkan nanti."})]}),e.jsxs(ke,{children:[e.jsx(I,{onClick:k,disabled:m.loading,children:"Batal"}),e.jsx(I,{onClick:P,color:"error",variant:"contained",disabled:m.loading,children:m.loading?"Menghapus...":"Hapus"})]})]})]})}function Ie({onFilterChange:x,categories:w=[],loading:h=!1,initialFilters:y}){const[s,f]=o.useState({search:"",category:"",min_price:void 0,max_price:void 0,sort:"created_at",sortOrder:"desc",...y}),[m,p]=o.useState(!1),u=(a,c)=>{const i={...s,[a]:c};f(i),a!=="search"&&x(i)},P=a=>{const c={...s,search:a};f(c);const i=setTimeout(()=>{x(c)},500);return()=>clearTimeout(i)},k=()=>{const a={search:"",category:"",min_price:void 0,max_price:void 0,sort:"created_at",sortOrder:"desc"};f(a),x(a)},j=(()=>{let a=0;return s.search&&a++,s.category&&a++,s.min_price&&a++,s.max_price&&a++,s.sort!=="created_at"&&a++,s.sortOrder!=="desc"&&a++,a})();return e.jsxs(r,{sx:{mb:2},children:[e.jsxs(r,{sx:{display:"flex",gap:1.5,flexWrap:"wrap",alignItems:"center"},children:[e.jsx(r,{sx:{flex:"1 1 250px",minWidth:180},children:e.jsx(D,{fullWidth:!0,size:"small",placeholder:"Cari produk...",value:s.search||"",onChange:a=>P(a.target.value),InputProps:{startAdornment:e.jsx(ee,{sx:{mr:.5,fontSize:18,color:"text.secondary"}})},disabled:h})}),e.jsx(r,{sx:{flex:"1 1 160px",minWidth:130},children:e.jsxs(T,{fullWidth:!0,size:"small",disabled:h,children:[e.jsx(F,{children:"Kategori"}),e.jsxs(A,{value:s.category||"",onChange:a=>u("category",a.target.value),label:"Kategori",children:[e.jsx(C,{value:"",children:"Semua Kategori"}),w.map(a=>e.jsx(C,{value:a.id,children:a.name},a.id))]})]})}),e.jsx(r,{sx:{flex:"1 1 130px",minWidth:110},children:e.jsxs(T,{fullWidth:!0,size:"small",disabled:h,children:[e.jsx(F,{children:"Urutkan"}),e.jsxs(A,{value:s.sort||"created_at",onChange:a=>u("sort",a.target.value),label:"Urutkan",children:[e.jsx(C,{value:"name",children:"Nama"}),e.jsx(C,{value:"price",children:"Harga"}),e.jsx(C,{value:"created_at",children:"Tanggal Dibuat"})]})]})}),e.jsx(r,{sx:{flex:"1 1 130px",minWidth:110},children:e.jsxs(T,{fullWidth:!0,size:"small",disabled:h,children:[e.jsx(F,{children:"Urutan"}),e.jsxs(A,{value:s.sortOrder||"desc",onChange:a=>u("sortOrder",a.target.value),label:"Urutan",children:[e.jsx(C,{value:"asc",children:"A-Z / Terendah"}),e.jsx(C,{value:"desc",children:"Z-A / Tertinggi"})]})]})}),e.jsxs(r,{sx:{display:"flex",gap:1,flexShrink:0},children:[e.jsxs(I,{variant:"outlined",size:"small",startIcon:e.jsx(Ce,{fontSize:"small"}),onClick:()=>p(!m),disabled:h,children:["Filter",j>0&&e.jsx(g,{label:j,size:"small",color:"primary",sx:{ml:.5,minWidth:18,height:18,fontSize:"0.7rem"}})]}),j>0&&e.jsx(I,{variant:"outlined",size:"small",startIcon:e.jsx(ae,{fontSize:"small"}),onClick:k,disabled:h,color:"error",children:"Clear"})]})]}),m&&e.jsxs(r,{sx:{mt:1.5,p:1.5,bgcolor:"grey.50",borderRadius:1},children:[e.jsx(d,{variant:"subtitle2",gutterBottom:!0,sx:{fontSize:"0.875rem"},children:"Filter Lanjutan"}),e.jsxs(r,{sx:{display:"flex",gap:1.5,flexWrap:"wrap"},children:[e.jsx(r,{sx:{flex:"1 1 180px",minWidth:140},children:e.jsx(D,{fullWidth:!0,size:"small",label:"Harga Minimum",type:"number",value:s.min_price||"",onChange:a=>u("min_price",a.target.value?Number(a.target.value):void 0),disabled:h,InputProps:{startAdornment:e.jsx(d,{sx:{mr:.5,fontSize:"0.875rem"},children:"Rp"})}})}),e.jsx(r,{sx:{flex:"1 1 180px",minWidth:140},children:e.jsx(D,{fullWidth:!0,size:"small",label:"Harga Maksimum",type:"number",value:s.max_price||"",onChange:a=>u("max_price",a.target.value?Number(a.target.value):void 0),disabled:h,InputProps:{startAdornment:e.jsx(d,{sx:{mr:.5,fontSize:"0.875rem"},children:"Rp"})}})})]})]})]})}function Ge(){const x=re(),{showNotification:w}=se(),h=te(),y=ie(h.breakpoints.down("md")),[s,f]=o.useState([]),[m,p]=o.useState([]),[u,P]=o.useState(!0),[k,v]=o.useState(null),[j,a]=o.useState(0),[c,i]=o.useState(10),[b,N]=o.useState(0),[W,V]=o.useState({}),_=o.useMemo(()=>W,[W]),$=async t=>{try{P(!0),v(null);const l=await R.getProducts({page:(j||0)+1,limit:c,...t});if(l.success)f(l.data),N(l.pagination?.total||0);else throw new Error("Failed to fetch products")}catch(l){v(l.message||"Gagal memuat data produk")}finally{P(!1)}},O=async()=>{try{const t=await oe.getCategories();t.success&&p(t.data)}catch(t){console.error("Failed to fetch categories:",t)}};o.useEffect(()=>{$(_)},[j,c,_]),o.useEffect(()=>{O()},[]);const K=t=>{x(`/admin/products/${t.id}/edit`)},U=t=>{x(`/admin/products/${t.id}`)},G=async t=>{try{const l=await R.deleteProduct(t);if(l.success)w({type:"success",message:"Produk berhasil dihapus"}),await $(_);else throw new Error(l.message||"Failed to delete product")}catch(l){throw w({type:"error",message:l.message||"Gagal menghapus produk"}),l}},Z=()=>{x("/admin/products/create")},q=()=>{x("/admin/products/deleted")},Q=o.useCallback(t=>{V(t),a(0)},[]),X=(t,l)=>{a(l)},Y=t=>{i(parseInt(t.target.value,10)),a(0)};return u&&s.length===0?e.jsx(ne,{message:"Memuat data produk..."}):e.jsxs(le,{maxWidth:!1,children:[e.jsx(r,{sx:{mb:4},children:e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[e.jsxs(r,{children:[e.jsx(d,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Kelola Produk"}),e.jsx(d,{variant:"body1",color:"textSecondary",children:"Kelola produk dan inventori toko Anda"})]}),e.jsx(I,{variant:"contained",startIcon:y?void 0:e.jsx(H,{}),onClick:Z,size:"large",sx:{minWidth:y?"auto":160,textTransform:"none"},children:y?e.jsx(H,{}):"Tambah Produk"})]})}),k&&e.jsx(L,{severity:"error",sx:{mb:3},onClose:()=>v(null),children:k}),e.jsx(Ie,{onFilterChange:Q,categories:m,loading:u,initialFilters:_}),e.jsx(Pe,{products:s,isLoading:u,onEdit:K,onDelete:G,onView:U,onViewDeleted:q}),b>0&&e.jsx(we,{rowsPerPageOptions:[5,10,25,50],component:"div",count:b,rowsPerPage:c,page:j,onPageChange:X,onRowsPerPageChange:Y,labelRowsPerPage:"Baris per halaman:",labelDisplayedRows:({from:t,to:l,count:B})=>`${t}-${l} dari ${B!==-1?B:`lebih dari ${l}`}`})]})}export{Ge as default};
