import{c as O,j as e,r as b,T as o,B as p,t as w,I as Q,N as f,a3 as X,av as Y,a4 as Z,a5 as C,D as l,x as L,S as v,M as u}from"./index-NjOUpROL.js";import{u as ee,a as re,o as D,n as m,s as c,l as H}from"./schemas-CFjc3X59.js";import{P as ae}from"./ProductVariantManager-CvuPpTlY.js";import{P as te}from"./ProductImageManager-Dn9hlQ8K.js";import{C as y,a as ie}from"./CardContent-DjhJP1Qj.js";import{A as N}from"./Alert-B1gb4VHd.js";import{U as ne}from"./CloudUpload-CRaoohSf.js";import{C as se}from"./CardMedia-CN5Tfa3C.js";import{D as le}from"./Delete-Pt9chjFM.js";import{F as oe}from"./FormControlLabel-DIKxYHSe.js";import{S as me}from"./Switch-CoM2UWnk.js";const de=O(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-6h2zm0-8h-2V7h2z"}),"Info"),ue=D({category_id:c().min(1,"Kategori wajib dipilih").uuid("ID kategori tidak valid"),name:c().min(1,"Nama produk wajib diisi").min(2,"Nama produk minimal 2 karakter").max(200,"Nama produk maksimal 200 karakter"),description:c().max(1e3,"Deskripsi maksimal 1000 karakter").optional().or(H("")),price:m().min(0,"Harga tidak boleh negatif").max(999999999,"Harga terlalu besar"),stock:m().int("Stok harus berupa bilangan bulat").min(0,"Stok tidak boleh negatif").max(99999,"Stok maksimal 99999"),pre_order:m().int("Pre-order harus berupa bilangan bulat").min(0,"Pre-order tidak boleh negatif").max(365,"Pre-order maksimal 365 hari"),length:m().min(0,"Panjang tidak boleh negatif").max(9999,"Panjang maksimal 9999 cm").optional(),width:m().min(0,"Lebar tidak boleh negatif").max(9999,"Lebar maksimal 9999 cm").optional(),height:m().min(0,"Tinggi tidak boleh negatif").max(9999,"Tinggi maksimal 9999 cm").optional(),weight:m().min(0,"Berat tidak boleh negatif").max(999999,"Berat maksimal 999999 gram").optional()}),he=D({category_id:c().min(1,"Kategori wajib dipilih").uuid("ID kategori tidak valid"),name:c().min(1,"Nama produk wajib diisi").min(2,"Nama produk minimal 2 karakter").max(200,"Nama produk maksimal 200 karakter"),description:c().max(1e3,"Deskripsi maksimal 1000 karakter").optional().or(H("")),price:m().min(0,"Harga tidak boleh negatif").max(999999999,"Harga terlalu besar"),pre_order:m().int("Pre-order harus berupa bilangan bulat").min(0,"Pre-order tidak boleh negatif").max(365,"Pre-order maksimal 365 hari"),length:m().min(0,"Panjang tidak boleh negatif").max(9999,"Panjang maksimal 9999 cm").optional(),width:m().min(0,"Lebar tidak boleh negatif").max(9999,"Lebar maksimal 9999 cm").optional(),height:m().min(0,"Tinggi tidak boleh negatif").max(9999,"Tinggi maksimal 9999 cm").optional(),weight:m().min(0,"Berat tidak boleh negatif").max(999999,"Berat maksimal 999999 gram").optional()});function Ne({product:i,categories:M,isLoading:n=!1,error:S,onSubmit:R,onCancel:I,mode:d}){const k=i?.product_variants&&i.product_variants.length>0,[g,_]=b.useState(k||!1),[P,V]=b.useState([]),[T,F]=b.useState([]),[pe,ge]=b.useState(!1),z=g?he:ue,{register:s,handleSubmit:U,formState:{errors:t},reset:W,setValue:q,watch:G}=ee({resolver:re(z),defaultValues:{category_id:"",name:"",description:"",price:0,stock:0,pre_order:0,length:void 0,width:void 0,height:void 0,weight:void 0}});b.useEffect(()=>{if(i&&d==="edit"){const a=!!(i.product_variants&&i.product_variants.length>0);_(a),W({category_id:i.category_id,name:i.name,description:i.description||"",price:typeof i.price=="string"?parseFloat(i.price):i.price||0,stock:i.stock||0,pre_order:i.pre_order||0,length:i.length||void 0,width:i.width||void 0,height:i.height||void 0,weight:i.weight||void 0})}},[i,d,W]);const K=a=>{const r=Array.from(a.target.files||[]);if(r.length===0)return;const j=r.filter(h=>h.type.startsWith("image/")?h.size>5*1024*1024?(alert(`${h.name} terlalu besar (max 5MB)`),!1):!0:(alert(`${h.name} bukan file gambar`),!1));if(j.length===0)return;const x=5-P.length,B=j.slice(0,x);V(h=>[...h,...B]),B.forEach(h=>{const A=new FileReader;A.onloadend=()=>{F(J=>[...J,A.result])},A.readAsDataURL(h)})},E=a=>{V(r=>r.filter((j,x)=>x!==a)),F(r=>r.filter((j,x)=>x!==a))},$=async a=>{const r={category_id:a.category_id,name:a.name,description:a.description||void 0,_imageFiles:P,length:a.length||void 0,width:a.width||void 0,height:a.height||void 0,weight:a.weight||void 0};g?(r.price=a.price,r.stock=0,r.pre_order=a.pre_order):(r.price=a.price,r.stock=a.stock,r.pre_order=a.pre_order),await R(r)};return e.jsxs(e.Fragment,{children:[d==="edit"&&i&&e.jsx(y,{sx:{mb:3},children:e.jsx(te,{productId:i.id,productName:i.name})}),e.jsx(y,{children:e.jsxs(ie,{children:[e.jsx(o,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:d==="create"?"Tambah Produk Baru":"Edit Produk"}),S&&e.jsx(N,{severity:"error",sx:{mb:3},children:S}),e.jsxs(p,{component:"form",onSubmit:U($),sx:{mt:3,maxWidth:800,mx:"auto"},children:[d==="create"&&e.jsxs(p,{sx:{mb:3},children:[e.jsx(o,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Gambar Produk"}),e.jsxs(w,{component:"label",variant:"outlined",startIcon:e.jsx(ne,{}),disabled:n||P.length>=5,sx:{mb:2},children:["Pilih Gambar (Max 5)",e.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:K})]}),e.jsx(o,{variant:"caption",display:"block",color:"text.secondary",sx:{mb:2},children:"Format: JPG, PNG, WebP (Max 5MB per file). Gambar pertama akan menjadi gambar utama."}),T.length>0&&e.jsx(p,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(3, 1fr)",md:"repeat(4, 1fr)"},gap:2},children:T.map((a,r)=>e.jsxs(y,{sx:{position:"relative"},children:[e.jsx(se,{component:"img",height:"150",image:a,alt:`Preview ${r+1}`,sx:{objectFit:"cover"}}),e.jsx(Q,{onClick:()=>E(r),disabled:n,sx:{position:"absolute",top:4,right:4,bgcolor:"background.paper","&:hover":{bgcolor:"error.light",color:"white"}},size:"small",children:e.jsx(le,{fontSize:"small"})}),r===0&&e.jsx(p,{sx:{position:"absolute",bottom:0,left:0,right:0,bgcolor:"primary.main",color:"white",py:.5,px:1,textAlign:"center"},children:e.jsx(o,{variant:"caption",children:"Gambar Utama"})})]},r))}),e.jsx(f,{sx:{my:3}})]}),e.jsxs(X,{fullWidth:!0,margin:"normal",error:!!t.category_id,children:[e.jsx(Y,{children:"Kategori *"}),e.jsxs(Z,{...s("category_id"),label:"Kategori *",disabled:n,value:G("category_id")||"",onChange:a=>q("category_id",a.target.value),children:[e.jsx(C,{value:"",children:e.jsx("em",{children:"Pilih Kategori"})}),M.map(a=>e.jsx(C,{value:a.id,children:a.name},a.id))]}),t.category_id&&e.jsx(o,{variant:"caption",color:"error",sx:{mt:.5,ml:1.75},children:String(t.category_id.message||"")})]}),e.jsx(l,{...s("name"),label:"Nama Produk",fullWidth:!0,margin:"normal",error:!!t.name,helperText:t.name?.message?String(t.name.message):"",disabled:n,placeholder:"Contoh: Boneka Rajutan Hello Kitty",required:!0}),e.jsx(l,{...s("description"),label:"Deskripsi Produk",fullWidth:!0,margin:"normal",multiline:!0,rows:4,error:!!t.description,helperText:t.description?.message?String(t.description.message):"",disabled:n,placeholder:"Deskripsi produk (opsional)"}),(d==="create"||d==="edit"&&!k)&&e.jsxs(e.Fragment,{children:[e.jsx(L,{sx:{p:2,my:3,bgcolor:"info.50",border:"1px solid",borderColor:"info.200"},children:e.jsxs(p,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(de,{color:"info",sx:{mt:.5}}),e.jsx(p,{sx:{flex:1},children:e.jsx(oe,{control:e.jsx(me,{checked:g,onChange:a=>_(a.target.checked),disabled:n||d==="edit"&&k,color:"primary"}),label:e.jsxs(p,{children:[e.jsx(o,{variant:"subtitle2",fontWeight:"bold",children:"Produk ini memiliki varian"}),e.jsx(o,{variant:"caption",color:"text.secondary",display:"block",children:g?"âœ“ Harga dan stok akan diatur per varian (contoh: warna, ukuran)":"Produk sederhana dengan 1 harga dan stok"}),d==="edit"&&g&&!k&&e.jsx(N,{severity:"warning",sx:{mt:1},children:e.jsx(o,{variant:"caption",children:'Setelah mengaktifkan mode varian, klik "Update" kemudian tambahkan varian di bawah.'})})]}),sx:{m:0}})})]})}),e.jsx(f,{sx:{my:3}})]}),g?e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"h6",fontWeight:"bold",gutterBottom:!0,sx:{mt:2},children:"Informasi Produk & Harga Default"}),e.jsxs(v,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsx(l,{...s("price",{valueAsNumber:!0,setValueAs:a=>{const r=parseFloat(a);return isNaN(r)?0:r}}),label:"Harga Default",fullWidth:!0,margin:"normal",type:"number",error:!!t.price,helperText:t.price?.message?String(t.price.message):"Harga default untuk generate varian baru",disabled:n,placeholder:"0",required:!0,InputProps:{startAdornment:e.jsx(u,{position:"start",children:"Rp"}),inputProps:{min:0,step:"0.01",style:{textAlign:"right"}}}}),e.jsx(l,{label:"Total Stok Varian",fullWidth:!0,margin:"normal",type:"number",disabled:!0,value:i?.product_variants?i.product_variants.reduce((a,r)=>a+(r.stock||0),0):0,helperText:"Total stok dari semua varian (read-only)",InputProps:{inputProps:{style:{textAlign:"right"}}}}),e.jsx(l,{...s("pre_order",{valueAsNumber:!0,setValueAs:a=>{const r=parseInt(a);return isNaN(r)?0:r}}),label:"Pre-order (Hari)",fullWidth:!0,margin:"normal",type:"number",error:!!t.pre_order,helperText:t.pre_order?.message?String(t.pre_order.message):"Berapa hari produk dibuat setelah order",disabled:n,placeholder:"0",required:!0,InputProps:{inputProps:{min:0,step:1,style:{textAlign:"right"}}}})]}),e.jsx(o,{variant:"h6",fontWeight:"bold",gutterBottom:!0,sx:{mt:2},children:"Dimensi Fisik (untuk perhitungan shipping)"}),e.jsxs(v,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsx(l,{...s("length",{valueAsNumber:!0,setValueAs:a=>{const r=parseFloat(a);return isNaN(r)?void 0:r}}),label:"Panjang",fullWidth:!0,margin:"normal",type:"number",error:!!t.length,helperText:t.length?.message?String(t.length.message):"Panjang dalam cm",disabled:n,placeholder:"10",InputProps:{endAdornment:e.jsx(u,{position:"end",children:"cm"}),inputProps:{min:0,step:.1,style:{textAlign:"right"}}}}),e.jsx(l,{...s("width",{valueAsNumber:!0,setValueAs:a=>{const r=parseFloat(a);return isNaN(r)?void 0:r}}),label:"Lebar",fullWidth:!0,margin:"normal",type:"number",error:!!t.width,helperText:t.width?.message?String(t.width.message):"Lebar dalam cm",disabled:n,placeholder:"10",InputProps:{endAdornment:e.jsx(u,{position:"end",children:"cm"}),inputProps:{min:0,step:.1,style:{textAlign:"right"}}}}),e.jsx(l,{...s("height",{valueAsNumber:!0,setValueAs:a=>{const r=parseFloat(a);return isNaN(r)?void 0:r}}),label:"Tinggi",fullWidth:!0,margin:"normal",type:"number",error:!!t.height,helperText:t.height?.message?String(t.height.message):"Tinggi dalam cm",disabled:n,placeholder:"1",InputProps:{endAdornment:e.jsx(u,{position:"end",children:"cm"}),inputProps:{min:0,step:.1,style:{textAlign:"right"}}}}),e.jsx(l,{...s("weight",{valueAsNumber:!0,setValueAs:a=>{const r=parseFloat(a);return isNaN(r)?void 0:r}}),label:"Berat",fullWidth:!0,margin:"normal",type:"number",error:!!t.weight,helperText:t.weight?.message?String(t.weight.message):"Berat dalam gram",disabled:n,placeholder:"1000",InputProps:{endAdornment:e.jsx(u,{position:"end",children:"g"}),inputProps:{min:0,step:1,style:{textAlign:"right"}}}})]}),e.jsx(N,{severity:"info",sx:{my:3},children:e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"Mode Varian Aktif!"}),e.jsx("br",{}),"â€¢ Harga default akan digunakan saat membuat varian baru",e.jsx("br",{}),"â€¢ Stok ditampilkan dari total semua varian",e.jsx("br",{}),"â€¢ Setelah produk dibuat, tambahkan varian di halaman detail produk",e.jsx("br",{}),"â€¢ Contoh varian: ",e.jsx("em",{children:"Merah - S (Rp 100.000, stok: 10), Biru - M (Rp 120.000, stok: 15)"}),e.jsx("br",{}),"â€¢ Setiap varian bisa punya gambar sendiri (opsional untuk warna yang berbeda)"]})}),e.jsx(f,{sx:{my:3}})]}):e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"h6",fontWeight:"bold",gutterBottom:!0,sx:{mt:2},children:"Harga & Stok"}),e.jsxs(v,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsx(l,{...s("price",{valueAsNumber:!0,setValueAs:a=>{const r=parseFloat(a);return isNaN(r)?0:r}}),label:"Harga",fullWidth:!0,margin:"normal",type:"number",error:!!t.price,helperText:t.price?.message?String(t.price.message):"",disabled:n,placeholder:"0",required:!0,InputProps:{startAdornment:e.jsx(u,{position:"start",children:"Rp"}),inputProps:{min:0,step:"0.01",style:{textAlign:"right"}}}}),e.jsx(l,{...s("stock",{valueAsNumber:!0,setValueAs:a=>{const r=parseInt(a);return isNaN(r)?0:r}}),label:"Stok",fullWidth:!0,margin:"normal",type:"number",error:!!t.stock,helperText:t.stock?.message?String(t.stock.message):"",disabled:n,placeholder:"0",required:!0,InputProps:{inputProps:{min:0,step:1,style:{textAlign:"right"}}}}),e.jsx(l,{...s("pre_order",{valueAsNumber:!0,setValueAs:a=>{const r=parseInt(a);return isNaN(r)?0:r}}),label:"Pre-order (Hari)",fullWidth:!0,margin:"normal",type:"number",error:!!t.pre_order,helperText:t.pre_order?.message?String(t.pre_order.message):"Berapa hari produk dibuat setelah order",disabled:n,placeholder:"0",required:!0,InputProps:{inputProps:{min:0,step:1,style:{textAlign:"right"}}}})]}),e.jsx(o,{variant:"h6",fontWeight:"bold",gutterBottom:!0,sx:{mt:2},children:"Dimensi Fisik (untuk perhitungan shipping)"}),e.jsxs(v,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsx(l,{...s("length",{valueAsNumber:!0,setValueAs:a=>{const r=parseFloat(a);return isNaN(r)?void 0:r}}),label:"Panjang",fullWidth:!0,margin:"normal",type:"number",error:!!t.length,helperText:t.length?.message?String(t.length.message):"Panjang dalam cm",disabled:n,placeholder:"10",InputProps:{endAdornment:e.jsx(u,{position:"end",children:"cm"}),inputProps:{min:0,step:.1,style:{textAlign:"right"}}}}),e.jsx(l,{...s("width",{valueAsNumber:!0,setValueAs:a=>{const r=parseFloat(a);return isNaN(r)?void 0:r}}),label:"Lebar",fullWidth:!0,margin:"normal",type:"number",error:!!t.width,helperText:t.width?.message?String(t.width.message):"Lebar dalam cm",disabled:n,placeholder:"10",InputProps:{endAdornment:e.jsx(u,{position:"end",children:"cm"}),inputProps:{min:0,step:.1,style:{textAlign:"right"}}}}),e.jsx(l,{...s("height",{valueAsNumber:!0,setValueAs:a=>{const r=parseFloat(a);return isNaN(r)?void 0:r}}),label:"Tinggi",fullWidth:!0,margin:"normal",type:"number",error:!!t.height,helperText:t.height?.message?String(t.height.message):"Tinggi dalam cm",disabled:n,placeholder:"1",InputProps:{endAdornment:e.jsx(u,{position:"end",children:"cm"}),inputProps:{min:0,step:.1,style:{textAlign:"right"}}}}),e.jsx(l,{...s("weight",{valueAsNumber:!0,setValueAs:a=>{const r=parseFloat(a);return isNaN(r)?void 0:r}}),label:"Berat",fullWidth:!0,margin:"normal",type:"number",error:!!t.weight,helperText:t.weight?.message?String(t.weight.message):"Berat dalam gram",disabled:n,placeholder:"1000",InputProps:{endAdornment:e.jsx(u,{position:"end",children:"g"}),inputProps:{min:0,step:1,style:{textAlign:"right"}}}})]}),e.jsx(f,{sx:{my:3}})]}),e.jsxs(p,{sx:{display:"flex",gap:2,mt:4},children:[e.jsx(w,{type:"submit",variant:"contained",size:"large",disabled:n,sx:{minWidth:120},children:n?d==="create"?"Menyimpan...":"Mengupdate...":d==="create"?"Simpan":"Update"}),I&&e.jsx(w,{variant:"outlined",size:"large",onClick:I,disabled:n,children:"Batal"})]})]})]})}),d==="edit"&&i&&e.jsx(y,{sx:{mt:3},children:e.jsx(ae,{productId:i.id,productName:i.name})})]})}export{Ne as P};
