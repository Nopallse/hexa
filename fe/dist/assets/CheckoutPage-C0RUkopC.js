import{a as ae,g as te,r as i,u as xe,_ as ne,ai as Se,aj as Ie,i as z,j as e,s as Z,k as se,m as ie,c as fe,V as ge,ak as Re,l as Q,W as we,d as Me,h as Pe,b as Fe,p as oe,T as d,B as m,S as H,ad as $e,M as de,w as V,t as L,ah as We,O as re,E as De,D as N,a4 as ye,al as Ee,a5 as Ae,a6 as ze,af as J,ab as O,H as Oe,ac as Te,q as Be,am as Ge,a9 as Ne,C as X}from"./index-CLjvjqZT.js";import{u as Le}from"./orderStore-D4mXfcoI.js";import{o as ue}from"./orderApi-Cxa2AtbH.js";import{u as ce}from"./useCurrencyConversion-DcYLh6Vv.js";import{C as q,a as U}from"./CardContent-Dqpv-NXF.js";import{A as qe}from"./Avatar-B6RLlSql.js";import{A as Ue,a as ee}from"./AreaAutocomplete-Dp1gv3zM.js";import{A}from"./Alert-Cs6zeJMp.js";import{A as Ke}from"./Add-DNYdkQit.js";import{D as Ve,a as He,b as Ze}from"./DialogTitle-D4zLwdK6.js";import{G as E}from"./Grid-Yhwe_G7n.js";import{F as ve,S as Je}from"./Switch-CbuNdoIY.js";import{l as Qe}from"./locationApi-w2u0ht2W.js";import{S as Ye}from"./SwitchBase-BbVYm7cH.js";import{A as Xe}from"./AttachMoney-DmqEmfqx.js";import{S as er}from"./Schedule-CIX9P0lB.js";import"./useSlot-CDkgSjON.js";import"./Popper-Bu6D8dQx.js";function rr(r){return ae("MuiFormGroup",r)}te("MuiFormGroup",["root","row","error"]);const ar=["className","row"],tr=r=>{const{classes:a,row:n,error:s}=r;return ie({root:["root",n&&"row",s&&"error"]},rr,a)},nr=Z("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(r,a)=>{const{ownerState:n}=r;return[a.root,n.row&&a.row]}})(({ownerState:r})=>z({display:"flex",flexDirection:"column",flexWrap:"wrap"},r.row&&{flexDirection:"row"})),sr=i.forwardRef(function(a,n){const s=xe({props:a,name:"MuiFormGroup"}),{className:p,row:I=!1}=s,C=ne(s,ar),R=Se(),x=Ie({props:s,muiFormControl:R,states:["error"]}),k=z({},s,{row:I,error:x.error}),S=tr(k);return e.jsx(nr,z({className:se(S.root,p),ownerState:k,ref:n},C))}),ir=fe(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),or=fe(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),cr=Z("span",{name:"MuiRadioButtonIcon",shouldForwardProp:ge})({position:"relative",display:"flex"}),lr=Z(ir,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),dr=Z(or,{name:"MuiRadioButtonIcon"})(({theme:r,ownerState:a})=>z({left:0,position:"absolute",transform:"scale(0)",transition:r.transitions.create("transform",{easing:r.transitions.easing.easeIn,duration:r.transitions.duration.shortest})},a.checked&&{transform:"scale(1)",transition:r.transitions.create("transform",{easing:r.transitions.easing.easeOut,duration:r.transitions.duration.shortest})}));function be(r){const{checked:a=!1,classes:n={},fontSize:s}=r,p=z({},r,{checked:a});return e.jsxs(cr,{className:n.root,ownerState:p,children:[e.jsx(lr,{fontSize:s,className:n.background,ownerState:p}),e.jsx(dr,{fontSize:s,className:n.dot,ownerState:p})]})}const je=i.createContext(void 0);function ur(){return i.useContext(je)}function pr(r){return ae("MuiRadio",r)}const pe=te("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),mr=["checked","checkedIcon","color","icon","name","onChange","size","className"],hr=r=>{const{classes:a,color:n,size:s}=r,p={root:["root",`color${Q(n)}`,s!=="medium"&&`size${Q(s)}`]};return z({},a,ie(p,pr,a))},xr=Z(Ye,{shouldForwardProp:r=>ge(r)||r==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(r,a)=>{const{ownerState:n}=r;return[a.root,n.size!=="medium"&&a[`size${Q(n.size)}`],a[`color${Q(n.color)}`]]}})(({theme:r,ownerState:a})=>z({color:(r.vars||r).palette.text.secondary},!a.disableRipple&&{"&:hover":{backgroundColor:r.vars?`rgba(${a.color==="default"?r.vars.palette.action.activeChannel:r.vars.palette[a.color].mainChannel} / ${r.vars.palette.action.hoverOpacity})`:we.alpha(a.color==="default"?r.palette.action.active:r.palette[a.color].main,r.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},a.color!=="default"&&{[`&.${pe.checked}`]:{color:(r.vars||r).palette[a.color].main}},{[`&.${pe.disabled}`]:{color:(r.vars||r).palette.action.disabled}}));function fr(r,a){return typeof a=="object"&&a!==null?r===a:String(r)===String(a)}const me=e.jsx(be,{checked:!0}),he=e.jsx(be,{}),gr=i.forwardRef(function(a,n){var s,p;const I=xe({props:a,name:"MuiRadio"}),{checked:C,checkedIcon:R=me,color:x="primary",icon:k=he,name:S,onChange:v,size:l="medium",className:P}=I,f=ne(I,mr),o=z({},I,{color:x,size:l}),g=hr(o),j=ur();let _=C;const D=Re(v,j&&j.onChange);let y=S;return j&&(typeof _>"u"&&(_=fr(j.value,I.value)),typeof y>"u"&&(y=j.name)),e.jsx(xr,z({type:"radio",icon:i.cloneElement(k,{fontSize:(s=he.props.fontSize)!=null?s:l}),checkedIcon:i.cloneElement(R,{fontSize:(p=me.props.fontSize)!=null?p:l}),ownerState:o,classes:g,name:y,checked:_,onChange:D,ref:n,className:se(g.root,P)},f))});function yr(r){return ae("MuiRadioGroup",r)}te("MuiRadioGroup",["root","row","error"]);const vr=["actions","children","className","defaultValue","name","onChange","value"],br=r=>{const{classes:a,row:n,error:s}=r;return ie({root:["root",n&&"row",s&&"error"]},yr,a)},jr=i.forwardRef(function(a,n){const{actions:s,children:p,className:I,defaultValue:C,name:R,onChange:x,value:k}=a,S=ne(a,vr),v=i.useRef(null),l=br(a),[P,f]=Me({controlled:k,default:C,name:"RadioGroup"});i.useImperativeHandle(s,()=>({focus:()=>{let _=v.current.querySelector("input:not(:disabled):checked");_||(_=v.current.querySelector("input:not(:disabled)")),_&&_.focus()}}),[]);const o=Pe(n,v),g=Fe(R),j=i.useMemo(()=>({name:g,onChange(_){f(_.target.value),x&&x(_,_.target.value)},value:P}),[g,x,f,P]);return e.jsx(je.Provider,{value:j,children:e.jsx(sr,z({role:"radiogroup",ref:o,className:se(l.root,I)},S,{children:p}))})});function _r({items:r,subtotal:a,shippingCost:n,total:s,onCreateOrder:p,creatingOrder:I,disabled:C,selectedPaymentMethod:R,selectedShippingMethod:x}){oe();const{formatPrice:k}=ce(),S=l=>{switch(l){case"biteship":return"ðŸšš Biteship";case"fedex":return"ðŸ“¦ FedEx";case"fedex-estimated":return"ðŸ“¦ FedEx (Est.)";case"indonesia-estimated":return"ðŸ‡®ðŸ‡© Indonesia (Est.)";default:return"ðŸ“¦ Shipping"}},v=l=>{switch(l){case"biteship":return"primary";case"fedex":return"error";case"fedex-estimated":return"warning";case"indonesia-estimated":return"info";default:return"default"}};return e.jsx(q,{sx:{position:"sticky",top:24,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:"none"},children:e.jsxs(U,{sx:{p:3},children:[e.jsx(d,{variant:"h6",fontWeight:600,sx:{mb:3,color:"text.primary"},children:"Ringkasan Pesanan"}),e.jsxs(m,{sx:{mb:3},children:[e.jsxs(d,{variant:"subtitle1",fontWeight:600,sx:{mb:2},children:["Item (",r.length,")"]}),e.jsx(H,{spacing:2,children:r.map(l=>{const P=l.product_variant.product.product_images?.[0]?.image_name;return e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:2,p:2,borderRadius:2,backgroundColor:"grey.50"},children:[e.jsx(qe,{src:P||`https://placehold.co/50x50/9682DB/FFFFFF/png?text=${encodeURIComponent(l.product_variant.product.name.substring(0,10))}`,alt:l.product_variant.product.name,sx:{width:50,height:50,borderRadius:2,flexShrink:0,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},variant:"rounded",children:e.jsx($e,{})}),e.jsxs(m,{sx:{flex:1,minWidth:0},children:[e.jsx(d,{variant:"subtitle2",fontWeight:600,sx:{mb:.5,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:l.product_variant.product.name,children:l.product_variant.product.name}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:l.product_variant.variant_name}),e.jsxs(d,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:["Qty: ",l.quantity]})]}),e.jsx(d,{variant:"body2",fontWeight:600,color:"primary.main",sx:{fontSize:"0.9rem"},children:k(parseFloat(l.product_variant.price)*l.quantity)})]},l.id)})})]}),e.jsx(de,{sx:{my:2}}),e.jsxs(H,{spacing:2,children:[e.jsxs(m,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[e.jsx(d,{variant:"body1",fontWeight:500,children:"Subtotal"}),e.jsx(d,{variant:"body1",fontWeight:600,children:k(a)})]}),e.jsxs(m,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[e.jsxs(m,{children:[e.jsx(d,{variant:"body1",fontWeight:500,children:"Biaya Pengiriman"}),x&&e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsxs(d,{variant:"body2",color:"text.secondary",children:[x.courier_name," - ",x.courier_service_name]}),x.provider&&e.jsx(V,{label:S(x.provider),size:"small",color:v(x.provider),variant:"outlined"})]})]}),e.jsx(d,{variant:"body1",fontWeight:600,children:k(n)})]}),e.jsxs(m,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"primary.main",borderRadius:2,color:"white"},children:[e.jsx(d,{variant:"h6",fontWeight:600,children:"Total"}),e.jsx(d,{variant:"h6",fontWeight:700,children:k(s)})]})]}),e.jsx(de,{sx:{my:3}}),e.jsx(L,{variant:"contained",size:"large",startIcon:e.jsx(We,{}),onClick:p,disabled:C||I,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:600,fontSize:"1rem",backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"},"&:disabled":{backgroundColor:"grey.300",color:"grey.500"}},children:I?"Membuat Order...":"Buat Order & Bayar"}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mt:2,textAlign:"center"},children:"Dengan melanjutkan, Anda menyetujui syarat dan ketentuan kami"})]})})}function kr({selectedAddress:r,onAddressSelect:a,onAddressesLoaded:n}){const[s,p]=i.useState([]),[I,C]=i.useState(!0),[R,x]=i.useState(null),[k,S]=i.useState(!1),[v,l]=i.useState(!1),[P,f]=i.useState(null),[o,g]=i.useState({recipient_name:"",phone_number:"",address_line:"",city:"",province:"",postal_code:"",country:"ID",is_primary:!1}),[j,_]=i.useState(null),D=[{code:"ID",name:"Indonesia",flag:"ðŸ‡®ðŸ‡©"},{code:"US",name:"United States",flag:"ðŸ‡ºðŸ‡¸"},{code:"SG",name:"Singapore",flag:"ðŸ‡¸ðŸ‡¬"},{code:"MY",name:"Malaysia",flag:"ðŸ‡²ðŸ‡¾"},{code:"TH",name:"Thailand",flag:"ðŸ‡¹ðŸ‡­"},{code:"PH",name:"Philippines",flag:"ðŸ‡µðŸ‡­"},{code:"VN",name:"Vietnam",flag:"ðŸ‡»ðŸ‡³"},{code:"AU",name:"Australia",flag:"ðŸ‡¦ðŸ‡º"},{code:"JP",name:"Japan",flag:"ðŸ‡¯ðŸ‡µ"},{code:"KR",name:"South Korea",flag:"ðŸ‡°ðŸ‡·"}];i.useEffect(()=>{(async()=>{try{C(!0),x(null);const h=await ee.getAddresses();if(h.success&&h.data){if(p(h.data),n?.(h.data),h.data.length>0&&!r){const $=h.data.find(t=>t.is_primary)||h.data[0];$&&a($.id)}}else x("Gagal memuat alamat")}catch(h){console.error("Error fetching addresses:",h),x(h.response?.data?.error||"Gagal memuat alamat")}finally{C(!1)}})()},[]);const y=c=>h=>{g($=>({...$,[c]:h.target.value}))},B=c=>{_(c),c&&g(h=>({...h,city:c.administrative_division_level_2_name,province:c.administrative_division_level_1_name,postal_code:c.postal_code.toString()}))},W=async()=>{if(!o.recipient_name.trim()){f("Nama penerima wajib diisi");return}if(!o.phone_number.trim()){f("Nomor telepon wajib diisi");return}if(!o.address_line.trim()){f("Alamat lengkap wajib diisi");return}if(!o.city.trim()){f("Kota wajib diisi");return}if(!o.province.trim()){f("Provinsi wajib diisi");return}if(!o.postal_code.trim()){f("Kode pos wajib diisi");return}try{l(!0),f(null);const c=await ee.createAddress(o);if(c.success&&c.data){const h=await ee.getAddresses();h.success&&h.data&&(p(h.data),n?.(h.data),a(c.data.id)),g({recipient_name:"",phone_number:"",address_line:"",city:"",province:"",postal_code:"",country:"ID",is_primary:!1}),_(null),S(!1)}else f(c.error||"Gagal menambah alamat")}catch(c){console.error("Error creating address:",c),f(c.response?.data?.error||"Gagal menambah alamat")}finally{l(!1)}},G=()=>{g({recipient_name:"",phone_number:"",address_line:"",city:"",province:"",postal_code:"",country:"ID",is_primary:!1}),_(null),S(!1),f(null)};if(I)return e.jsx(q,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsx(U,{sx:{p:3},children:e.jsx(m,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(re,{})})})});const w=s.length>0?s.find(c=>c.id===r)||s.find(c=>c.is_primary)||s[0]:null;return e.jsxs(e.Fragment,{children:[e.jsx(q,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(U,{sx:{p:3},children:[e.jsx(d,{variant:"h6",fontWeight:600,sx:{mb:2,color:"text.primary"},children:"Alamat Pengiriman"}),R&&e.jsx(A,{severity:"error",sx:{mb:2,borderRadius:2},onClose:()=>x(null),children:R}),s.length===0&&e.jsx(A,{severity:"info",sx:{mb:3,borderRadius:2},children:"Anda belum memiliki alamat pengiriman. Silakan tambahkan alamat terlebih dahulu."}),w&&e.jsx(m,{sx:{p:2,border:"2px solid",borderColor:"primary.main",borderRadius:2,backgroundColor:"action.hover",mb:2},children:e.jsxs(H,{direction:"row",spacing:2,alignItems:"flex-start",children:[e.jsx(De,{color:"primary",sx:{mt:.5,flexShrink:0}}),e.jsxs(m,{sx:{flex:1},children:[e.jsx(d,{variant:"subtitle1",fontWeight:600,children:w.recipient_name}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:w.phone_number}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mt:1},children:w.address_line}),e.jsxs(d,{variant:"body2",color:"text.secondary",children:[w.city,", ",w.province," ",w.postal_code]})]})]})}),!k&&e.jsx(L,{variant:s.length===0?"contained":"outlined",startIcon:e.jsx(Ke,{}),onClick:()=>S(!0),fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:s.length===0?600:500,...s.length===0&&{backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}}},children:s.length===0?"Tambah Alamat":"Tambah Alamat Baru"})]})}),e.jsxs(Ve,{open:k,onClose:G,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsx(He,{children:e.jsx(d,{variant:"h6",fontWeight:600,children:"Tambah Alamat Baru"})}),e.jsxs(Ze,{sx:{p:3},children:[P&&e.jsx(A,{severity:"error",sx:{mb:3,borderRadius:2},onClose:()=>f(null),children:P}),e.jsxs(E,{container:!0,spacing:3,children:[e.jsx(E,{item:!0,xs:12,sm:6,children:e.jsx(N,{fullWidth:!0,label:"Nama Penerima",value:o.recipient_name,onChange:y("recipient_name"),variant:"outlined",required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(E,{item:!0,xs:12,sm:6,children:e.jsx(N,{fullWidth:!0,label:"Nomor Telepon",value:o.phone_number,onChange:y("phone_number"),variant:"outlined",required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(N,{fullWidth:!0,label:"Alamat Lengkap",value:o.address_line,onChange:y("address_line"),variant:"outlined",placeholder:"Masukkan alamat lengkap (nama jalan, nomor rumah, dll)",required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(E,{item:!0,xs:12,children:e.jsxs(ye,{fullWidth:!0,children:[e.jsx(Ee,{children:"Negara"}),e.jsx(Ae,{value:o.country,onChange:c=>{g(h=>({...h,country:c.target.value,city:"",province:"",postal_code:""})),_(null)},sx:{borderRadius:2},children:D.map(c=>e.jsx(ze,{value:c.code,children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx("span",{children:c.flag}),e.jsx("span",{children:c.name})]})},c.code))})]})}),e.jsx(E,{item:!0,xs:12,children:o.country==="ID"?e.jsx(Ue,{label:"Pilih Area",placeholder:"Ketik nama kota, kecamatan, atau kode pos...",value:j,onChange:B,required:!0,countries:"ID",limit:10}):e.jsx(N,{fullWidth:!0,label:"Manual Address Entry",placeholder:"Enter address details manually for international addresses",variant:"outlined",disabled:!0,helperText:`Area autocomplete is only available for Indonesia. Please fill the fields below manually for ${D.find(c=>c.code===o.country)?.name}.`,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(E,{item:!0,xs:12,sm:6,children:e.jsx(N,{fullWidth:!0,label:"Kota",value:o.city,onChange:y("city"),variant:"outlined",disabled:o.country==="ID"&&!!j,helperText:o.country==="ID"&&j?"Otomatis terisi dari area yang dipilih":o.country==="ID"?"Masukkan nama kota atau pilih dari area autocomplete":`Masukkan nama kota untuk ${D.find(c=>c.code===o.country)?.name}`,required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(E,{item:!0,xs:12,sm:6,children:e.jsx(N,{fullWidth:!0,label:"Provinsi/State",value:o.province,onChange:y("province"),variant:"outlined",disabled:o.country==="ID"&&!!j,helperText:o.country==="ID"&&j?"Otomatis terisi dari area yang dipilih":o.country==="ID"?"Masukkan nama provinsi atau pilih dari area autocomplete":`Masukkan nama provinsi/state untuk ${D.find(c=>c.code===o.country)?.name}`,required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(E,{item:!0,xs:12,sm:6,children:e.jsx(N,{fullWidth:!0,label:"Kode Pos/ZIP Code",value:o.postal_code,onChange:y("postal_code"),variant:"outlined",disabled:o.country==="ID"&&!!j,helperText:o.country==="ID"&&j?"Otomatis terisi dari area yang dipilih":o.country==="ID"?"Masukkan kode pos atau pilih dari area autocomplete":`Masukkan kode pos/ZIP code untuk ${D.find(c=>c.code===o.country)?.name}`,required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(ve,{control:e.jsx(Je,{checked:o.is_primary,onChange:c=>g(h=>({...h,is_primary:c.target.checked})),color:"primary"}),label:e.jsxs(m,{children:[e.jsx(d,{variant:"body1",fontWeight:500,children:"Set sebagai Alamat Utama"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:o.is_primary?"Alamat ini akan menjadi alamat utama untuk pengiriman":"Alamat ini akan menjadi alamat tambahan"})]}),sx:{alignItems:"flex-start",mt:1}})})]}),j&&e.jsxs(m,{sx:{mt:3,p:2,backgroundColor:"primary.light",borderRadius:2},children:[e.jsx(d,{variant:"subtitle2",fontWeight:600,sx:{mb:1,color:"primary.dark"},children:"Area yang Dipilih:"}),e.jsxs(d,{variant:"body2",sx:{color:"primary.dark"},children:[j.administrative_division_level_3_name,", ",j.administrative_division_level_2_name,", ",j.administrative_division_level_1_name," - ",j.postal_code]})]}),e.jsxs(m,{sx:{display:"flex",gap:2,mt:4,justifyContent:"flex-end"},children:[e.jsx(L,{variant:"outlined",onClick:G,disabled:v,sx:{borderRadius:2,textTransform:"none",fontWeight:500},children:"Batal"}),e.jsx(L,{variant:"contained",onClick:W,disabled:v,sx:{borderRadius:2,textTransform:"none",fontWeight:500,backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:v?e.jsx(re,{size:20}):"Simpan"})]})]})]})]})}const Cr={getShippingRates:async r=>{try{const a=await J.post("/shipping/rates",r);return{success:!0,data:a.data.data,provider:a.data.provider,origin_country:a.data.origin_country,destination_country:a.data.destination_country}}catch(a){return{success:!1,error:a.response?.data?.error||"Failed to fetch shipping rates"}}},getAreas:async(r={})=>{try{return{success:!0,data:(await J.get("/shipping/areas",{params:r})).data.data}}catch(a){return{success:!1,error:a.response?.data?.error||"Failed to fetch areas"}}},trackShipment:async(r,a)=>{try{const n=a?{courier:a}:{},s=await J.get(`/shipping/track/${r}`,{params:n});return{success:!0,data:s.data.data,provider:s.data.provider}}catch(n){return{success:!1,error:n.response?.data?.error||"Failed to track shipment"}}},trackFedExShipment:async r=>{try{const a=await J.get(`/shipping/track/fedex/${r}`);return{success:!0,data:a.data.data,provider:a.data.provider}}catch(a){return{success:!1,error:a.response?.data?.error||"Failed to track FedEx shipment"}}}};function Sr(r,a){const[n,s]=i.useState(r);return i.useEffect(()=>{const p=setTimeout(()=>{s(r)},a);return()=>{clearTimeout(p)}},[r,a]),n}const Ir=r=>{const n=r.trim().replace(/\s*days?\s*$/i,"").split(/\s*-\s*/),s=parseInt(n[0],10),p=n.length>1?parseInt(n[1],10):s;return{min_day:isNaN(s)?1:s,max_day:isNaN(p)?s||3:p}},Rr=r=>{const a=Ir(r.shipment_duration_range||r.duration||"1 - 3");let n="standard";return r.service_type==="overnight"?n="overnight":r.service_type==="express"?n="express":r.service_type==="economy"&&(n="economy"),{courier_name:r.courier_name||r.company||"",courier_code:r.courier_code||r.company||"",courier_service_name:r.courier_service_name||"",courier_service_code:r.courier_service_code||r.type||"",service_type:n,description:r.description||"",shipping_type:r.shipping_type||"parcel",ship_type:r.shipping_type||"parcel",service_name:r.courier_service_name||"",price:r.price||r.shipping_fee||0,currency:r.currency||"IDR",type:r.type||r.courier_service_code||"",min_day:a.min_day,max_day:a.max_day,provider:"biteship"}};function wr({selectedAddress:r,cartItems:a,selectedMethod:n,onMethodSelect:s}){const p=oe(),{formatPrice:I}=ce(),[C,R]=i.useState([]),[x,k]=i.useState(!1),[S,v]=i.useState(null),[l,P]=i.useState(null),[f,o]=i.useState(null),[g,j]=i.useState(""),[_,D]=i.useState(!1),y=O.useMemo(()=>a.map(t=>({name:t.product_variant.product.name,description:t.product_variant.product.description||"",length:t.product_variant.product.length||10,width:t.product_variant.product.width||10,height:t.product_variant.product.height||1,weight:t.product_variant.product.weight||t.product_variant.weight||1e3,quantity:t.quantity,value:t.product_variant.price*t.quantity})),[a]),B=O.useMemo(()=>r?`${r.id}_${r.country}_${r.postal_code}`:null,[r?.id,r?.country,r?.postal_code]),W=O.useMemo(()=>y.reduce((t,b)=>t+b.weight*b.quantity,0),[y]),G=O.useMemo(()=>!r||a.length===0?null:`${B}_${W}_${y.length}`,[B,W,y.length,a.length]);Sr(G,500),i.useEffect(()=>{(async()=>{try{const b=await Qe.getActiveOriginLocation();b.success&&b.data&&o(b.data)}catch(b){console.error("Failed to fetch active origin:",b)}})()},[]),i.useEffect(()=>{(async()=>{if(!r||!f||a.length===0){R([]),v(null);return}const b=`${r.id}_${r.postal_code}_${W}_${y.length}`;if(b!==l)try{k(!0),v(null),P(b);const M=await Cr.getShippingRates({origin_postal_code:f.postal_code,destination_postal_code:r.postal_code,origin_country:"ID",destination_country:r.country,items:y});if(b===l||!l)if(M.success&&M.data){const T=(M.data.pricing||[]).map(K=>Rr(K));R(T),j(M.provider||""),D(r.country!=="ID")}else v(M.error||"Failed to fetch shipping rates"),R([])}catch(M){(b===l||!l)&&(v(M.message||"Failed to fetch shipping rates"),R([]))}finally{k(!1)}})()},[r,f,a.length,W,y.length]),O.useEffect(()=>()=>{k(!1),v(null)},[]);const w=(t,b)=>t===b?`${t} hari`:`${t}-${b} hari`,c=t=>{switch(t){case"express":case"overnight":return"error";case"standard":return"primary";case"economy":return"success";default:return"default"}},h=t=>{switch(t){case"express":return"Express";case"standard":return"Standard";case"economy":return"Economy";case"overnight":return"Overnight";default:return t}},$=t=>{switch(t){case"biteship":return{name:"Biteship",color:"primary",icon:"ðŸšš"};case"fedex":return{name:"FedEx",color:"error",icon:"ðŸ“¦"};case"fedex-estimated":return{name:"FedEx (Estimated)",color:"warning",icon:"ðŸ“¦"};case"indonesia-estimated":return{name:"Indonesia (Estimated)",color:"info",icon:"ðŸ‡®ðŸ‡©"};default:return{name:"Shipping",color:"default",icon:"ðŸ“¦"}}};return r?e.jsx(q,{children:e.jsxs(U,{children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Oe,{sx:{fontSize:"1.5rem",mr:1,color:"primary.main"}}),e.jsx(d,{variant:"h6",fontWeight:600,children:"Pilih Metode Pengiriman"})]}),g&&e.jsx(V,{label:`${$(g).icon} ${$(g).name}`,color:$(g).color,size:"small",variant:"outlined"})]}),e.jsxs(m,{sx:{mb:3,p:2,backgroundColor:"grey.50",borderRadius:2},children:[e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Alamat Pengiriman:"}),e.jsx(d,{variant:"body1",fontWeight:500,children:r.recipient_name}),e.jsx(d,{variant:"body2",color:"text.secondary",children:r.address_line}),e.jsxs(d,{variant:"body2",color:"text.secondary",children:[r.city,", ",r.province," ",r.postal_code]}),e.jsxs(d,{variant:"body2",color:"text.secondary",children:[r.country==="ID"?"ðŸ‡®ðŸ‡© Indonesia":`ðŸŒ ${r.country}`,_&&e.jsx(V,{label:"Internasional",size:"small",color:"warning",variant:"outlined",sx:{ml:1,fontSize:"0.7rem"}})]})]}),x&&e.jsxs(m,{sx:{display:"flex",justifyContent:"center",py:3},children:[e.jsx(re,{size:24}),e.jsx(d,{variant:"body2",sx:{ml:2},children:"Mencari opsi pengiriman..."})]}),S&&e.jsxs(A,{severity:"error",sx:{mb:3},children:[S,e.jsx(L,{size:"small",onClick:()=>{P(null),v(null)},sx:{ml:2},children:"Coba Lagi"})]}),!x&&!S&&C.length>0&&e.jsxs(ye,{component:"fieldset",fullWidth:!0,children:[e.jsx(Te,{component:"legend",sx:{mb:2,fontWeight:600},children:"Pilih Metode Pengiriman"}),e.jsx(jr,{value:n||"",onChange:t=>{const b=C.find(M=>`${M.courier_code}_${M.courier_service_code}`===t.target.value);b&&s(b)},children:e.jsx(H,{spacing:2,children:C.map(t=>{const b=`${t.courier_code}_${t.courier_service_code}`,M=n===b;return e.jsx(q,{sx:{border:M?`2px solid ${p.palette.primary.main}`:"1px solid",borderColor:M?"primary.main":"grey.300",backgroundColor:M?"primary.light":"white",transition:"all 0.2s ease",cursor:"pointer","&:hover":{borderColor:"primary.main",backgroundColor:"primary.light"}},onClick:()=>{`${t.courier_code}${t.courier_service_code}`,s(t)},children:e.jsxs(U,{sx:{p:2},children:[e.jsx(ve,{value:b,control:e.jsx(gr,{}),label:"",sx:{m:0}}),e.jsxs(m,{sx:{ml:4},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",mb:1,flexWrap:"wrap",gap:1},children:[e.jsx(d,{variant:"subtitle1",fontWeight:600,children:t.courier_name}),e.jsx(V,{label:h(t.service_type),color:c(t.service_type),size:"small"}),t.provider&&t.provider!==g&&e.jsx(V,{label:`${$(t.provider).icon} ${$(t.provider).name}`,color:$(t.provider).color,size:"small",variant:"outlined"})]}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:2},children:t.description}),e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:3},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Xe,{sx:{fontSize:"1rem",mr:.5,color:"success.main"}}),e.jsx(d,{variant:"h6",fontWeight:600,color:"success.main",children:I(t.price,t.currency||"IDR")})]}),e.jsxs(m,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(er,{sx:{fontSize:"1rem",mr:.5,color:"text.secondary"}}),e.jsx(d,{variant:"body2",color:"text.secondary",children:w(t.min_day,t.max_day)})]})]})]})]})},b)})})})]}),!x&&!S&&C.length===0&&e.jsx(A,{severity:"warning",children:"Tidak ada opsi pengiriman tersedia untuk alamat inii"})]})}):e.jsx(q,{children:e.jsx(U,{children:e.jsx(A,{severity:"info",children:"Pilih alamat pengiriman terlebih dahulu untuk melihat opsi pengiriman"})})})}function Vr(){oe();const r=Be(),a=Ge(),{loading:n,error:s}=ce(),[p,I]=i.useState(!0),[C,R]=i.useState(!1),[x,k]=i.useState(!1),[S,v]=i.useState(null),[l,P]=i.useState(null),[f,o]=i.useState(null),[g,j]=i.useState([]),[_,D]=i.useState("midtrans"),[y,B]=i.useState(null),[W,G]=i.useState(15e3),[w,c]=i.useState([]),{items:h,clearCart:$,syncWithServer:t}=Ne(),{addOrder:b,setPaymentMethods:M,paymentMethods:Y}=Le();i.useEffect(()=>{const u=a.state;u?.selectedCartItemIds?c(u.selectedCartItemIds):r("/cart")},[a.state,r]);const T=O.useMemo(()=>{const u=h.filter(F=>F.product_variant.product.deleted_at===null);return w.length===0?u:u.filter(F=>w.includes(F.id))},[h,w]),K=O.useMemo(()=>T.reduce((u,F)=>u+parseFloat(F.product_variant.price)*F.quantity,0),[T]),_e=O.useMemo(()=>K+W,[K,W]),le=O.useCallback(async()=>{try{const u=await ue.getPaymentMethods();u.success&&M(u.data)}catch(u){console.error("Error fetching payment methods:",u)}},[M]),ke=async()=>{if(!l){v("Pilih alamat pengiriman terlebih dahulu");return}if(T.length===0){v("Tidak ada item yang tersedia untuk checkout");return}if(w.length===0){v("Tidak ada item yang dipilih untuk checkout");return}try{R(!0),v(null);const u=await ue.createOrder({address_id:l,shipping_cost:W,cart_item_ids:w,courier_code:y?.courier_code,courier_service_code:y?.courier_service_code});u.success&&(b(u.data),k(!0),r(`/orders/${u.data.order_id}`,{state:{message:"Order berhasil dibuat! Silakan lakukan pembayaran.",selectedPaymentMethod:_}}))}catch(u){console.error("Error creating order:",u),v(u.response?.data?.error||"Gagal membuat order")}finally{R(!1)}};return i.useEffect(()=>{(async()=>{try{await t()}catch(F){console.error("Error syncing cart:",F)}})()},[t]),i.useEffect(()=>{if(w.length===0&&!C&&!x&&!p){r("/cart");return}Y.length===0&&le(),p&&I(!1)},[w.length,r,C,x,le,Y.length,p]),i.useEffect(()=>{if(l&&g.length>0){const u=g.find(F=>F.id===l);u&&(!f||f.id!==u.id)&&o(u)}else if(!l&&g.length>0&&!f){const u=g.find(F=>F.is_primary)||g[0];u&&(P(u.id),o(u))}},[l,g,f]),p?e.jsx(m,{sx:{minHeight:"100vh",py:4},children:e.jsx(X,{maxWidth:"xl",children:e.jsx(d,{children:"Loading..."})})}):T.length===0?e.jsx(m,{sx:{minHeight:"100vh",py:4},children:e.jsxs(X,{maxWidth:"xl",children:[e.jsx(A,{severity:"warning",sx:{mb:4},children:"Tidak ada item yang tersedia untuk checkout. Semua item di keranjang sudah tidak tersedia."}),e.jsx(L,{variant:"contained",onClick:()=>r("/cart"),children:"Kembali ke Keranjang"})]})}):e.jsx(m,{sx:{minHeight:"100vh",py:4},children:e.jsxs(X,{maxWidth:"xl",children:[e.jsxs(m,{sx:{mb:3},children:[e.jsx(d,{variant:"h4",fontWeight:600,sx:{mb:1,color:"text.primary"},children:"Checkout"}),e.jsx(d,{variant:"body1",color:"text.secondary",children:"Lengkapi informasi pengiriman dan pembayaran"})]}),S&&e.jsx(A,{severity:"error",sx:{mb:4},onClose:()=>v(null),children:S}),n&&e.jsx(A,{severity:"info",sx:{mb:2},children:"Loading exchange rates..."}),s&&e.jsx(A,{severity:"warning",sx:{mb:2},children:"Failed to load exchange rates. Prices will be displayed in default currency."}),e.jsxs(m,{sx:{display:"flex",flexDirection:{xs:"column",lg:"row"},gap:4,alignItems:"flex-start"},children:[e.jsx(m,{sx:{flex:1,minWidth:0,order:{xs:1,lg:1}},children:e.jsxs(H,{spacing:4,children:[e.jsx(kr,{selectedAddress:l,onAddressSelect:u=>{P(u);const F=g.find(Ce=>Ce.id===u);F&&o(F),B(null),G(15e3)},onAddressesLoaded:u=>{j(u)}}),e.jsx(wr,{selectedAddress:f,cartItems:T,selectedMethod:y?`${y.courier_code}_${y.courier_service_code}`:null,onMethodSelect:u=>{B(u),G(u.price)}})]})}),e.jsx(m,{sx:{width:{xs:"100%",lg:"400px"},flexShrink:0,order:{xs:2,lg:2}},children:e.jsx(_r,{items:T,subtotal:K,shippingCost:W,total:_e,onCreateOrder:ke,creatingOrder:C,disabled:!l||!y,selectedPaymentMethod:_,selectedShippingMethod:y})})]})]})})}export{Vr as default};
