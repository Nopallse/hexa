import{c as Q,j as e,q as Y,a8 as Z,aB as ee,r as c,af as re,C as V,t as h,B as a,T as i,A as p,w as l,N as u,x as te}from"./index-sTH-7xwR.js";import{p as G}from"./productApi-DiSnTPLn.js";import{a as W}from"./image-CeHRN-zl.js";import{A as L}from"./Alert-B0PlZ22k.js";import{A as M}from"./ArrowBack-CXOXat9S.js";import{E as ae}from"./Edit-DZXLPxIL.js";import{D as ie}from"./Delete-CZf-Xqn3.js";import{C as b,a as y}from"./CardContent-CbD_XzoO.js";import{T as se,a as ne,b as oe,c as U,d,e as le}from"./TableRow-De_r54Cd.js";import{I as de}from"./Image-qMlDiC7F.js";const ce=Q(e.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");function ve(){const v=Y(),{id:_}=Z(),{showNotification:C}=ee(),[r,K]=c.useState(null),[H,k]=c.useState(!0),[P,B]=c.useState(!1),[T,S]=c.useState(null),[g,x]=c.useState(null),[m,D]=c.useState(null),[E,A]=c.useState({}),R=async()=>{if(!_){S("ID produk tidak valid"),k(!1);return}try{k(!0),S(null);const t=await G.getProductById(_);if(t.success)K(t.data);else throw new Error("Failed to fetch product")}catch(t){S(t.message||"Gagal memuat data produk")}finally{k(!1)}};c.useEffect(()=>{R()},[_]),c.useEffect(()=>{if(r){const t=w(r);if(x(t?t.image_name:null),r.product_variants&&r.product_variants.length>0){D(r.product_variants[0]);const s={};r.product_variants[0].variant_options&&r.product_variants[0].variant_options.forEach(n=>{s[n.option_name]=n.option_value}),A(s)}}},[r]);const q=()=>{if(!r?.product_variants||r.product_variants.length===0)return{};const t={};r.product_variants.forEach(n=>{n.variant_options?.forEach(o=>{t[o.option_name]||(t[o.option_name]=new Set),t[o.option_name].add(o.option_value)})});const s={};return Object.keys(t).forEach(n=>{s[n]=Array.from(t[n])}),s},N=(t,s)=>{const n={...E,[t]:s};A(n);const o=r?.product_variants?.find(f=>f.variant_options?.every(O=>n[O.option_name]===O.option_value));if(o){if(D(o),o.image)x(o.image);else if(o.display_image)x(o.display_image);else if(r){const f=w(r);x(f?f.image_name:null)}}},X=()=>{r&&v(`/admin/products/${r.id}/edit`)},J=async()=>{if(!(!r||!window.confirm(`Apakah Anda yakin ingin menghapus produk "${r.name}"? Tindakan ini tidak dapat dibatalkan.`)))try{B(!0);const s=await G.deleteProduct(r.id);if(s.success)C({type:"success",message:"Produk berhasil dihapus"}),v("/admin/products");else throw new Error(s.message||"Failed to delete product")}catch(s){C({type:"error",message:s.message||"Gagal menghapus produk"})}finally{B(!1)}},z=()=>{v("/admin/products")},I=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(t),w=t=>t.product_images&&t.product_images.length>0?t.product_images.find(n=>n.is_primary)||t.product_images[0]:null;if(H)return e.jsx(re,{message:"Memuat data produk..."});if(T||!r)return e.jsxs(V,{maxWidth:!1,children:[e.jsx(L,{severity:"error",sx:{mb:3},children:T||"Produk tidak ditemukan"}),e.jsx(h,{variant:"outlined",startIcon:e.jsx(M,{}),onClick:z,children:"Kembali ke Daftar Produk"})]});const j=w(r),$=g||(j?j.image_name:null),F=q();return e.jsxs(V,{maxWidth:!1,children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(a,{children:[e.jsx(i,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Detail Produk"}),e.jsxs(i,{variant:"body1",color:"textSecondary",children:['Informasi lengkap produk "',r.name,'"']})]}),e.jsxs(a,{sx:{display:"flex",gap:2},children:[e.jsx(h,{variant:"outlined",startIcon:e.jsx(M,{}),onClick:z,children:"Kembali"}),e.jsx(h,{variant:"contained",startIcon:e.jsx(ae,{}),onClick:X,children:"Edit"}),e.jsx(h,{variant:"outlined",color:"error",startIcon:e.jsx(ie,{}),onClick:J,disabled:P,children:P?"Menghapus...":"Hapus"})]})]}),e.jsxs(a,{sx:{display:"flex",gap:3,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 300px",minWidth:300},children:e.jsx(b,{children:e.jsxs(y,{children:[e.jsx(i,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Galeri Gambar"}),$?e.jsx(a,{sx:{textAlign:"center",mb:2},children:e.jsx(p,{src:W($),variant:"rounded",sx:{width:"100%",height:300,transition:"all 0.3s ease",boxShadow:2}})}):e.jsx(a,{sx:{textAlign:"center",mb:2},children:e.jsx(p,{variant:"rounded",sx:{width:"100%",height:300},children:r.name.charAt(0).toUpperCase()})}),r.product_images&&r.product_images.length>0?e.jsxs(a,{children:[e.jsxs(i,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:["Semua Gambar (",r.product_images.length,")"]}),e.jsx(a,{sx:{display:"flex",gap:1,flexWrap:"wrap",justifyContent:"center"},children:r.product_images.sort((t,s)=>(s.is_primary?1:0)-(t.is_primary?1:0)).map(t=>e.jsxs(a,{sx:{position:"relative"},onMouseEnter:()=>x(t.image_name),onMouseLeave:()=>x(j?j.image_name:null),children:[e.jsx(p,{src:W(t.image_name),variant:"rounded",sx:{width:70,height:70,cursor:"pointer",border:g===t.image_name?3:2,borderColor:g===t.image_name?"primary.main":"divider",transition:"all 0.2s ease",opacity:g===t.image_name?1:.7,"&:hover":{opacity:1,transform:"scale(1.05)",borderColor:"primary.main"}}}),t.is_primary&&e.jsx(l,{label:"Utama",size:"small",color:"primary",sx:{position:"absolute",bottom:-8,left:"50%",transform:"translateX(-50%)",fontSize:"0.65rem",height:16,"& .MuiChip-label":{px:.5}}})]},t.id))})]}):e.jsx(L,{severity:"info",sx:{mt:2},children:"Belum ada gambar produk"})]})})}),e.jsx(a,{sx:{flex:"2 1 500px",minWidth:500},children:e.jsx(b,{children:e.jsxs(y,{children:[e.jsxs(a,{sx:{mb:3},children:[e.jsx(i,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:r.name}),r.product_variants&&r.product_variants.length>0?e.jsxs(a,{children:[e.jsx(i,{variant:"h4",color:"primary",fontWeight:"bold",children:r.price_range?.display||"Harga bervariasi"}),e.jsxs(i,{variant:"body2",color:"textSecondary",children:["Total Stok: ",r.total_stock||0," unit"]})]}):e.jsx(i,{variant:"h4",color:"primary",fontWeight:"bold",children:I(parseFloat(r.price||"0"))})]}),e.jsx(u,{sx:{mb:3}}),e.jsxs(a,{sx:{mb:3},children:[e.jsx(i,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Deskripsi"}),e.jsx(i,{variant:"body1",color:"textSecondary",children:r.description||"Tidak ada deskripsi"})]}),e.jsx(u,{sx:{mb:3}}),e.jsxs(a,{sx:{mb:3},children:[e.jsx(i,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Kategori"}),r.category?e.jsxs(a,{children:[e.jsx(l,{label:r.category.name,color:"primary",variant:"outlined",sx:{mb:1}}),r.category.description&&e.jsx(i,{variant:"body2",color:"textSecondary",children:r.category.description})]}):e.jsx(i,{variant:"body2",color:"textSecondary",children:"Tidak ada kategori"})]}),e.jsx(u,{sx:{mb:3}}),e.jsxs(a,{sx:{mb:3},children:[e.jsx(i,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Informasi Produksi"}),e.jsxs(a,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(l,{label:`Pre-order: ${r.pre_order||0} hari`,color:r.pre_order&&r.pre_order>0?"warning":"default",variant:r.pre_order&&r.pre_order>0?"filled":"outlined",sx:{fontWeight:"bold"}}),r.product_variants&&r.product_variants.length>0?e.jsx(l,{label:`Total Stok: ${r.total_stock||0} unit`,color:(r.total_stock||0)>0?"success":"error",variant:(r.total_stock||0)>0?"filled":"outlined"}):e.jsx(l,{label:`Stok: ${r.stock||0} unit`,color:(r.stock||0)>0?"success":"error",variant:(r.stock||0)>0?"filled":"outlined"})]}),e.jsx(i,{variant:"body2",color:"textSecondary",sx:{mt:1},children:r.pre_order&&r.pre_order>0?`Produk ini membutuhkan ${r.pre_order} hari untuk dibuat setelah order`:"Produk tersedia langsung (tidak perlu pre-order)"})]}),r.product_variants&&r.product_variants.length>0&&Object.keys(F).length>0&&e.jsxs(e.Fragment,{children:[e.jsx(u,{sx:{mb:3}}),e.jsxs(a,{sx:{mb:3},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(i,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Pilih Varian"}),r.product_variants&&r.product_variants.length>0?e.jsx(l,{label:`${r.product_variants.length} Varian`,color:"primary",size:"small",variant:"filled",sx:{fontWeight:"bold",bgcolor:"primary.main",color:"white",border:"1px solid",borderColor:"primary.dark",letterSpacing:.5}}):e.jsx(l,{label:`Stok: ${r.stock||0}`,color:(r.stock||0)>0?"success":"error",size:"small",variant:(r.stock||0)>0?"filled":"outlined"})]}),Object.entries(F).map(([t,s])=>e.jsxs(a,{sx:{mb:2},children:[e.jsx(i,{variant:"subtitle2",fontWeight:"bold",gutterBottom:!0,children:t}),e.jsx(a,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:s.map(n=>{const o=E[t]===n;return e.jsxs(h,{variant:o?"contained":"outlined",onClick:()=>N(t,n),size:"large",sx:{minWidth:80,borderWidth:2,borderColor:o?"primary.main":"divider",position:"relative",textTransform:"none","&:hover":{borderWidth:2,borderColor:"primary.main"}},children:[e.jsx(i,{variant:"body2",fontWeight:o?"bold":"medium",children:n}),o&&e.jsx(ce,{sx:{position:"absolute",top:4,right:4,fontSize:16,bgcolor:"white",color:"primary.main",borderRadius:"50%",p:.25}})]},n)})})]},t))]}),m&&e.jsx(b,{variant:"outlined",sx:{mb:3,bgcolor:"primary.50",borderColor:"primary.main"},children:e.jsx(y,{children:e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[e.jsxs(a,{children:[e.jsx(i,{variant:"caption",color:"text.secondary",display:"block",children:"Varian Terpilih"}),e.jsx(i,{variant:"h6",fontWeight:"bold",children:m.variant_name}),e.jsxs(i,{variant:"caption",color:"text.secondary",children:["SKU: ",m.sku]})]}),e.jsxs(a,{sx:{textAlign:"right"},children:[e.jsx(i,{variant:"h4",color:"primary.main",fontWeight:"bold",children:I(parseFloat(m.price))}),e.jsx(l,{label:`Stok: ${m.stock} unit`,size:"small",color:m.stock>0?"success":"error",sx:{mt:.5}})]})]})})}),e.jsx(u,{sx:{mb:3}})]})]})})})]}),r.product_variants&&r.product_variants.length>0&&e.jsx(a,{sx:{mt:4},children:e.jsx(b,{children:e.jsxs(y,{children:[e.jsx(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:e.jsxs(i,{variant:"h6",fontWeight:"bold",children:["Semua Varian (",r.product_variants.length,")"]})}),e.jsx(se,{component:te,variant:"outlined",children:e.jsxs(ne,{children:[e.jsx(oe,{children:e.jsxs(U,{children:[e.jsx(d,{children:"SKU"}),e.jsx(d,{align:"right",children:"Harga"}),e.jsx(d,{align:"center",children:"Stok"}),e.jsx(d,{align:"center",children:"Gambar"}),e.jsx(d,{children:"Opsi Varian"})]})}),e.jsx(le,{children:r.product_variants.map(t=>{const s=m?.id===t.id;return e.jsxs(U,{hover:!0,sx:{bgcolor:s?"primary.50":"transparent","&:hover":{bgcolor:s?"primary.100":"action.hover"}},children:[e.jsx(d,{children:e.jsx(i,{variant:"body2",fontFamily:"monospace",fontWeight:"medium",children:t.sku})}),e.jsx(d,{align:"right",children:e.jsx(i,{variant:"body2",fontWeight:"medium",color:"primary",children:I(parseFloat(t.price))})}),e.jsx(d,{align:"center",children:e.jsx(l,{label:t.stock,size:"small",color:t.stock>0?"success":"error",variant:t.stock>0?"filled":"outlined"})}),e.jsx(d,{align:"center",children:t.image?e.jsx(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:e.jsx(p,{src:W(t.image),variant:"rounded",sx:{width:60,height:60}})}):e.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:[e.jsx(p,{variant:"rounded",sx:{width:60,height:60,bgcolor:"grey.200"},children:e.jsx(de,{color:"disabled"})}),e.jsx(l,{label:"Tidak Ada",size:"small",color:"default",variant:"outlined",sx:{fontSize:"0.7rem",height:18}}),s&&e.jsx(l,{label:"Selected",size:"small",color:"primary",sx:{height:18,fontSize:"0.65rem"}})]})}),e.jsx(d,{children:e.jsx(a,{sx:{display:"flex",gap:.5,flexWrap:"wrap"},children:t.variant_options&&t.variant_options.length>0?t.variant_options.map(n=>e.jsx(l,{label:`${n.option_name}: ${n.option_value}`,size:"small",variant:"outlined"},n.id)):e.jsx(i,{variant:"caption",color:"textSecondary",fontStyle:"italic",children:"Belum ada opsi"})})})]},t.id)})})]})})]})})})]})}export{ve as default};
