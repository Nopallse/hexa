import{p as sr,Z as ir,a8 as tr,q as nr,am as or,r as o,j as r,B as t,C,an as U,T as a,v as _,S as c,x as S,ad as cr,H as dr,I as H,O as lr,M}from"./index-tvCmUXkA.js";import{A as xr}from"./AccountSidebar-BXLQb6Eg.js";import{o as W}from"./orderApi-BOQ5SOkY.js";import{u as mr}from"./orderStore-CYhWohAJ.js";import{u as ur}from"./useCurrencyConversion-DM705tyN.js";import{M as pr}from"./MidtransPaymentButton-Delvt4eg.js";import{a as hr}from"./image-CeHRN-zl.js";import{S as gr}from"./Skeleton-DwS8Noa7.js";import{A as d}from"./Alert-iJ2nvuQL.js";import{G as n}from"./Grid-CE62ACEJ.js";import{B as br}from"./Breadcrumbs-BRY0wQO3.js";import{H as yr}from"./Home-FYrVyE1n.js";import{O as jr}from"./Receipt-CJT1sDb7.js";import{A as fr}from"./ArrowBack-BROWJOPA.js";import{C as g,a as b}from"./CardContent-BO7gwO4c.js";import{A as kr}from"./Avatar-Cw6JEpzV.js";import{T as G}from"./Tooltip-CRdXSvuP.js";import{O as vr}from"./OpenInNew-wJc69th9.js";import{R as wr}from"./Refresh-RespFlYJ.js";import{C as Cr}from"./Cancel-BxQ_5SwZ.js";import"./ShoppingBag-DpDyVGo5.js";import"./useSlot-Dd61XFNI.js";import"./Popper-DMWFBkOI.js";function Zr(){const K=sr();ir(K.breakpoints.down("sm"));const{id:y}=tr(),j=nr();or();const{formatPrice:l,loading:q,error:F}=ur(),[Q,R]=o.useState(!0),[I,x]=o.useState(null),[s,Z]=o.useState(null),[z,P]=o.useState(!1),[D,T]=o.useState(null),[A,f]=o.useState(null),[m,B]=o.useState(!1),[i,$]=o.useState(null),[E,u]=o.useState(null),{setCurrentOrder:J}=mr(),k=e=>new Date(e).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),V=e=>{switch(e){case"belum_bayar":return"warning";case"dikemas":return"primary";case"dikirim":return"info";case"diterima":return"success";case"dibatalkan":return"error";default:return"default"}},X=e=>{switch(e){case"belum_bayar":return"Belum Bayar";case"dikemas":return"Dikemas";case"dikirim":return"Dikirim";case"diterima":return"Diterima";case"dibatalkan":return"Dibatalkan";default:return e}},v=o.useCallback(async()=>{if(s?.shipping?.tracking_number){B(!0),u(null);try{const e=await W.trackShipment(s.shipping.tracking_number,s.shipping.courier?.toLowerCase());e.success?$(e):u(e.error||"Gagal mendapatkan informasi tracking")}catch(e){u(e.response?.data?.error||"Gagal mendapatkan informasi tracking")}finally{B(!1)}}},[s?.shipping?.tracking_number,s?.shipping?.courier]),O=(e,p)=>{const h=e.toLowerCase();return{jne:"https://www.jne.co.id/id/tracking/tariff-and-service",jnt:"https://www.jet.co.id/track",sicepat:"https://www.sicepat.com/check-resi",pos:"https://www.posindonesia.co.id/tracking",anteraja:"https://anteraja.id/tracking",ninja:"https://www.ninjaxpress.co.id/tracking",lion:"https://lionparcel.com/tracking",ide:"https://idexpress.com/tracking"}[h]||null},w=async()=>{if(y)try{R(!0),x(null);const e=await W.getOrderById(y);e.success?(Z(e.data),J(e.data)):x("Pesanan tidak ditemukan")}catch(e){console.error("Error fetching order:",e),x(e.response?.data?.error||"Gagal memuat pesanan")}finally{R(!1)}},Y=e=>{console.log("Payment successful:",e),T("Pembayaran berhasil! Status pesanan akan diperbarui."),f(null),w()},rr=e=>{console.error("Payment error:",e),f(e),T(null)},er=async()=>{if(!(!s||!window.confirm("Apakah Anda yakin ingin membatalkan pesanan ini?")))try{P(!0),(await W.cancelOrder(s.id)).success&&await w()}catch(e){console.error("Error cancelling order:",e),x(e.response?.data?.error||"Gagal membatalkan pesanan")}finally{P(!1)}};if(o.useEffect(()=>{w()},[y]),o.useEffect(()=>{s?.shipping?.tracking_number&&!i&&!m&&v()},[s?.shipping?.tracking_number,i,m,v]),Q)return r.jsx(t,{sx:{minHeight:"100vh",py:4},children:r.jsx(C,{maxWidth:"xl",children:r.jsx(gr,{variant:"rectangular",height:400,sx:{borderRadius:3}})})});if(I||!s)return r.jsx(t,{sx:{minHeight:"100vh",py:4},children:r.jsx(C,{maxWidth:"xl",children:r.jsx(d,{severity:"error",sx:{maxWidth:600,mx:"auto"},children:I||"Pesanan tidak ditemukan"})})});const L=s.status==="belum_bayar";return r.jsx(t,{sx:{minHeight:"100vh",py:4},children:r.jsx(C,{maxWidth:"xl",children:r.jsxs(n,{container:!0,spacing:4,children:[r.jsx(n,{item:!0,xs:12,md:3,children:r.jsx(xr,{})}),r.jsxs(n,{item:!0,xs:12,md:9,children:[r.jsxs(br,{sx:{mb:3},children:[r.jsxs(U,{component:"button",variant:"body2",onClick:()=>j("/"),sx:{display:"flex",alignItems:"center",textDecoration:"none",color:"text.secondary","&:hover":{color:"primary.main"}},children:[r.jsx(yr,{sx:{mr:.5,fontSize:"1rem"}}),"Beranda"]}),r.jsxs(U,{component:"button",variant:"body2",onClick:()=>j("/orders"),sx:{display:"flex",alignItems:"center",textDecoration:"none",color:"text.secondary","&:hover":{color:"primary.main"}},children:[r.jsx(jr,{sx:{mr:.5,fontSize:"1rem"}}),"Pesanan"]}),r.jsxs(a,{variant:"body2",color:"text.primary",children:["#",s.id.slice(-8).toUpperCase()]})]}),r.jsx(_,{startIcon:r.jsx(fr,{}),onClick:()=>j("/orders"),sx:{mb:3,borderRadius:2,fontWeight:500,color:"text.secondary","&:hover":{color:"primary.main",backgroundColor:"primary.light"}},children:"Kembali ke Daftar Pesanan"}),D&&r.jsx(d,{severity:"success",sx:{mb:3,borderRadius:2},children:D}),A&&r.jsx(d,{severity:"error",sx:{mb:3,borderRadius:2},onClose:()=>f(null),children:A}),q&&r.jsx(d,{severity:"info",sx:{mb:2,borderRadius:2},children:"Loading exchange rates..."}),F&&r.jsx(d,{severity:"warning",sx:{mb:2,borderRadius:2},children:"Failed to load exchange rates. Prices will be displayed in default currency."}),r.jsx(g,{sx:{mb:4,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:r.jsx(b,{sx:{p:3},children:r.jsxs(c,{direction:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"flex-start"},spacing:2,children:[r.jsxs(t,{sx:{flex:1},children:[r.jsxs(a,{variant:"h4",fontWeight:600,sx:{mb:1,color:"text.primary"},children:["Order #",s.id.slice(-8).toUpperCase()]}),r.jsxs(a,{variant:"body1",color:"text.secondary",children:["Dibuat pada ",k(s.created_at)]})]}),r.jsx(t,{sx:{display:"flex",alignItems:"flex-start"},children:r.jsx(S,{label:X(s.status),color:V(s.status),variant:"outlined",sx:{borderRadius:2}})})]})})}),r.jsxs(n,{container:!0,spacing:4,children:[r.jsxs(n,{item:!0,xs:12,lg:8,children:[r.jsx(g,{sx:{mb:4,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:r.jsxs(b,{sx:{p:3},children:[r.jsxs(a,{variant:"h6",fontWeight:600,sx:{mb:3,color:"text.primary"},children:["Item Pesanan (",s.order_items.length,")"]}),r.jsx(c,{spacing:2,children:s.order_items.map(e=>{const h=e.product_variant.product.product_images?.[0]?.image_name||null;return r.jsx(t,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"flex-start",sm:"center"},gap:{xs:1,sm:3},p:{xs:1,sm:3},borderRadius:2,backgroundColor:"grey.50",border:"none",transition:"all 0.2s ease","&:hover":{backgroundColor:"grey.100"}},children:r.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:{xs:1,sm:3},flex:1,minWidth:0,width:{xs:"100%",sm:"auto"}},children:[r.jsx(t,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:1,flexShrink:0},children:r.jsx(kr,{src:h?hr(h):void 0,alt:e.product_variant.product.name,sx:{width:{xs:70,sm:80},height:{xs:70,sm:80},borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},variant:"rounded",children:r.jsx(cr,{sx:{fontSize:{xs:28,sm:32}}})})}),r.jsxs(t,{sx:{flex:1,minWidth:0},children:[r.jsx(a,{variant:"h6",fontWeight:600,sx:{mb:1,color:"text.primary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:{xs:"0.875rem",sm:"1rem"}},title:e.product_variant.product.name,children:e.product_variant.product.name}),e.product_variant.variant_options&&e.product_variant.variant_options.length>0&&r.jsx(c,{direction:"row",spacing:.5,sx:{mb:1,flexWrap:"wrap",gap:{xs:.5,sm:.5}},children:e.product_variant.variant_options.map((N,ar)=>r.jsx(S,{label:`${N.option_value}`,size:"small",variant:"outlined",sx:{fontSize:{xs:"0.65rem",sm:"0.7rem"},height:{xs:18,sm:20},borderColor:"primary.main",color:"primary.main","& .MuiChip-label":{px:{xs:.75,sm:1}}}},ar))}),r.jsxs(t,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",mt:{xs:1,sm:1}},children:[r.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[r.jsxs(a,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:["Qty: ",e.quantity]}),r.jsx(a,{variant:"h6",color:"primary.main",fontWeight:700,sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},lineHeight:1.2},children:l(Number(e.price))})]}),r.jsxs(t,{sx:{ml:{xs:1,sm:2},minWidth:100,textAlign:"right"},children:[r.jsx(a,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.7rem",sm:"0.75rem"},mb:.5},children:"Total"}),r.jsx(a,{variant:"h6",color:"primary.main",fontWeight:700,sx:{fontSize:{xs:"0.875rem",sm:"1rem"}},children:l(Number(e.price)*Number(e.quantity))})]})]})]})]})},e.id)})})]})}),s.shipping&&r.jsx(g,{sx:{mb:4,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:r.jsxs(b,{sx:{p:3},children:[r.jsxs(c,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:3},children:[r.jsxs(a,{variant:"h6",fontWeight:600,sx:{color:"text.primary",display:"flex",alignItems:"center",gap:1},children:[r.jsx(dr,{}),"Informasi Pengiriman"]}),s.shipping.tracking_number&&r.jsxs(c,{direction:"row",spacing:1,children:[s.shipping.courier&&s.shipping.tracking_number&&O(s.shipping.courier,s.shipping.tracking_number)&&r.jsx(G,{title:"Buka di website kurir",children:r.jsx(H,{size:"small",onClick:()=>{const e=O(s.shipping.courier,s.shipping.tracking_number);e&&window.open(e,"_blank")},sx:{color:"primary.main"},children:r.jsx(vr,{fontSize:"small"})})}),r.jsx(G,{title:"Refresh tracking",children:r.jsx(H,{size:"small",onClick:v,disabled:m,sx:{color:"primary.main"},children:m?r.jsx(lr,{size:20}):r.jsx(wr,{fontSize:"small"})})})]})]}),E&&r.jsx(d,{severity:"warning",sx:{mb:2,borderRadius:2},onClose:()=>u(null),children:E}),r.jsxs(n,{container:!0,spacing:2,children:[r.jsx(n,{item:!0,xs:12,sm:6,children:r.jsxs(t,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Kurir"}),r.jsx(a,{variant:"body1",fontWeight:600,children:s.shipping.courier})]})}),r.jsx(n,{item:!0,xs:12,sm:6,children:r.jsxs(t,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Status Pengiriman"}),r.jsx(a,{variant:"body1",fontWeight:600,children:s.shipping.shipping_status})]})}),s.shipping.tracking_number&&r.jsx(n,{item:!0,xs:12,sm:6,children:r.jsxs(t,{sx:{p:2,backgroundColor:"primary.light",borderRadius:2},children:[r.jsx(a,{variant:"subtitle2",color:"primary.dark",sx:{fontSize:"0.75rem",mb:.5},children:"Nomor Resi"}),r.jsx(a,{variant:"body1",fontWeight:600,color:"primary.main",children:s.shipping.tracking_number})]})}),s.shipping.estimated_delivery&&r.jsx(n,{item:!0,xs:12,sm:6,children:r.jsxs(t,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Estimasi Sampai"}),r.jsx(a,{variant:"body1",fontWeight:600,children:k(s.shipping.estimated_delivery)})]})})]}),i&&r.jsxs(t,{sx:{mt:3,pt:3,borderTop:"1px solid",borderColor:"divider"},children:[r.jsx(a,{variant:"subtitle1",fontWeight:600,sx:{mb:3},children:"Detail Tracking"}),i.data&&r.jsxs(n,{container:!0,spacing:2,sx:{mb:3},children:[i.data.waybill_id&&r.jsx(n,{item:!0,xs:12,sm:6,children:r.jsxs(t,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Waybill ID"}),r.jsx(a,{variant:"body1",fontWeight:600,children:i.data.waybill_id})]})}),i.data.status&&r.jsx(n,{item:!0,xs:12,sm:6,children:r.jsxs(t,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Status Tracking"}),r.jsx(a,{variant:"body1",fontWeight:600,children:i.data.status})]})}),i.data.courier?.company&&r.jsx(n,{item:!0,xs:12,sm:6,children:r.jsxs(t,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Kurir"}),r.jsx(a,{variant:"body1",fontWeight:600,children:i.data.courier.company.toUpperCase()}),i.data.courier.service_type&&r.jsx(a,{variant:"caption",color:"text.secondary",children:i.data.courier.service_type})]})}),i.data.link&&r.jsx(n,{item:!0,xs:12,sm:6,children:r.jsxs(t,{sx:{p:2,backgroundColor:"primary.light",borderRadius:2},children:[r.jsx(a,{variant:"subtitle2",color:"primary.dark",sx:{fontSize:"0.75rem",mb:.5},children:"Link Tracking"}),r.jsx(_,{size:"small",variant:"text",onClick:()=>window.open(i.data.link,"_blank"),sx:{p:0,textTransform:"none",color:"primary.main","&:hover":{textDecoration:"underline"}},children:"Buka di Biteship"})]})})]}),i.data&&(i.data.origin||i.data.destination)&&r.jsxs(n,{container:!0,spacing:2,sx:{mb:3},children:[i.data.origin&&r.jsx(n,{item:!0,xs:12,sm:6,children:r.jsxs(t,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:1},children:"Asal Pengiriman"}),r.jsx(a,{variant:"body2",fontWeight:600,sx:{mb:.5},children:i.data.origin.contact_name}),r.jsx(a,{variant:"caption",color:"text.secondary",children:i.data.origin.address})]})}),i.data.destination&&r.jsx(n,{item:!0,xs:12,sm:6,children:r.jsxs(t,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:1},children:"Tujuan Pengiriman"}),r.jsx(a,{variant:"body2",fontWeight:600,sx:{mb:.5},children:i.data.destination.contact_name}),r.jsx(a,{variant:"caption",color:"text.secondary",children:i.data.destination.address})]})})]}),i.data?.courier&&(i.data.courier.driver_name||i.data.courier.driver_phone)&&r.jsxs(t,{sx:{p:2,backgroundColor:"info.light",borderRadius:2,mb:3},children:[r.jsx(a,{variant:"subtitle2",color:"info.dark",sx:{fontSize:"0.75rem",mb:1},children:"Informasi Kurir"}),i.data.courier.driver_name&&r.jsxs(a,{variant:"body2",fontWeight:600,sx:{mb:.5},children:["Nama Driver: ",i.data.courier.driver_name]}),i.data.courier.driver_phone&&r.jsxs(a,{variant:"body2",color:"text.secondary",children:["No. Telepon: ",i.data.courier.driver_phone]})]}),i.data?.history&&Array.isArray(i.data.history)&&i.data.history.length>0?r.jsxs(t,{children:[r.jsx(a,{variant:"subtitle2",fontWeight:600,sx:{mb:2},children:"Riwayat Tracking"}),r.jsx(c,{spacing:2,children:i.data.history.map((e,p)=>r.jsx(t,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2,borderLeft:"3px solid",borderColor:p===0?"primary.main":"grey.300"},children:r.jsxs(c,{direction:"row",justifyContent:"space-between",alignItems:"flex-start",spacing:2,children:[r.jsxs(t,{sx:{flex:1},children:[r.jsx(a,{variant:"body2",fontWeight:600,sx:{mb:.5},children:e.status?e.status.charAt(0).toUpperCase()+e.status.slice(1):"Update"}),e.note&&r.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.note}),e.service_type&&r.jsx(S,{label:e.service_type,size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:20,mr:1}})]}),e.updated_at&&r.jsx(a,{variant:"caption",color:"text.secondary",sx:{whiteSpace:"nowrap"},children:k(e.updated_at)})]})},p))})]}):r.jsx(d,{severity:"info",sx:{borderRadius:2},children:"Informasi tracking belum tersedia"})]})]})})]}),r.jsx(n,{item:!0,xs:12,lg:4,children:r.jsx(g,{sx:{position:"sticky",top:24,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:"none"},children:r.jsxs(b,{sx:{p:3},children:[r.jsx(a,{variant:"h6",fontWeight:600,sx:{mb:3,color:"text.primary"},children:"Ringkasan Pesanan"}),r.jsxs(c,{spacing:2,children:[r.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"body1",fontWeight:500,children:"Subtotal"}),r.jsx(a,{variant:"body1",fontWeight:600,children:l(Number(s.total_amount))})]}),r.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"body1",fontWeight:500,children:"Biaya Pengiriman"}),r.jsx(a,{variant:"body1",fontWeight:600,children:l(Number(s.shipping_cost))})]}),r.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"primary.main",borderRadius:2,color:"white"},children:[r.jsx(a,{variant:"h6",fontWeight:600,children:"Total"}),r.jsx(a,{variant:"h6",fontWeight:700,children:l(Number(s.total_amount)+Number(s.shipping_cost))})]})]}),r.jsx(M,{sx:{my:3}}),r.jsx(a,{variant:"subtitle1",fontWeight:600,sx:{mb:2,color:"text.primary"},children:"Alamat Pengiriman"}),r.jsxs(t,{sx:{p:2,borderRadius:2,backgroundColor:"grey.50"},children:[r.jsx(a,{variant:"body1",fontWeight:600,children:s.address.address_line}),r.jsxs(a,{variant:"body2",color:"text.secondary",children:[s.address.city,", ",s.address.province," ",s.address.postal_code]})]}),(s.payment_status==="unpaid"||s.payment_status==="pending")&&s.status!=="dibatalkan"||L?r.jsxs(r.Fragment,{children:[r.jsx(M,{sx:{my:3}}),r.jsxs(c,{spacing:2,children:[(s.payment_status==="unpaid"||s.payment_status==="pending")&&s.status!=="dibatalkan"&&r.jsx(pr,{order:s,onSuccess:Y,onError:rr,paymentMethod:"bank_transfer"}),L&&r.jsx(_,{variant:"outlined",fullWidth:!0,startIcon:r.jsx(Cr,{}),onClick:er,disabled:z,color:"error",sx:{borderRadius:2,fontWeight:500,"&:hover":{backgroundColor:"error.light"}},children:z?"Membatalkan...":"Batalkan Pesanan"})]})]}):null]})})})]})]})]})})})}export{Zr as default};
