import{c as be,j as e,aB as Se,r as _,B as s,T as o,E as P,t as C,w as k,I as T,x as we,ak as Ue,A as ye}from"./index-D0K_J5MH.js";import{u as je,a as fe,o as ve,s as J,n as ke}from"./schemas-CK4uTdXz.js";import{p as G}from"./productApi-BJP6DUOH.js";import{C as H,a as q}from"./CardContent-7fkJvOwG.js";import{A as W}from"./Alert-D2FNR8Ya.js";import{A as _e}from"./Add-DtNoIuQN.js";import{D as M}from"./Delete-BY8eW1nK.js";import{T as U}from"./Tooltip-qpArd1Jc.js";import{U as ae}from"./CloudUpload-CBIjH9ln.js";import{T as Ae,a as Ve,b as Ie,c as se,d as m,e as Fe}from"./TableRow-D7Wp4-LE.js";import{I as We}from"./Image-C6BbQOIn.js";import{E as Pe}from"./Edit-xqQzbt_u.js";import{D as ie,a as ne,b as re}from"./DialogTitle-BCSOKhKg.js";import{D as te}from"./DialogActions-DjBbw8WJ.js";import{a as Ce}from"./image-CeHRN-zl.js";const De=be(e.jsx("path",{d:"m19 9 1.25-2.75L23 5l-2.75-1.25L19 1l-1.25 2.75L15 5l2.75 1.25zm-7.5.5L9 4 6.5 9.5 1 12l5.5 2.5L9 20l2.5-5.5L17 12zM19 15l-1.25 2.75L15 19l2.75 1.25L19 23l1.25-2.75L23 19l-2.75-1.25z"}),"AutoAwesome"),R=be(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2m-9 14-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckBox"),pe=be(e.jsx("path",{d:"M19 5v14H5V5zm0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"}),"CheckBoxOutlineBlank"),Me=ve({name:J().min(1,"Nama atribut wajib diisi"),values:J().min(1,"Nilai atribut wajib diisi")});function Oe({productId:Z,productName:oe,onVariantsCreated:S}){const{showNotification:f}=Se(),[g,O]=_.useState([]),[l,F]=_.useState([]),[h,b]=_.useState([]),[D,A]=_.useState(!1),[v,V]=_.useState([]),[x,p]=_.useState({open:!1,variant:null,index:-1}),{register:X,handleSubmit:Y,formState:{errors:E},reset:L}=je({resolver:fe(Me)});_.useEffect(()=>{if(h.length===0||l.length===0)return;const a=h.map(n=>{if(!n.affects_image)return n;const i=l.find(d=>Object.entries(d.attributes).every(([c,y])=>n.attributes[c]===y));return i?n._imageFile!==i.imageFile||n._imagePreview!==i.imagePreview?{...n,_imageFile:i.imageFile,_imagePreview:i.imagePreview}:n:n._imageFile||n._imagePreview?{...n,_imageFile:void 0,_imagePreview:void 0}:n});a.some((n,i)=>n._imageFile!==h[i]._imageFile||n._imagePreview!==h[i]._imagePreview)&&(b(a),console.log("ðŸ”„ Synced images to variants"),console.log("ðŸ“¸ Variants with images after sync:",a.filter(n=>n._imageFile).length))},[l]);const le=a=>{const r=a.values.split(",").map(d=>d.trim()).filter(d=>d.length>0);if(r.length===0){f({type:"error",message:"Minimal satu nilai atribut"});return}if(g.some(d=>d.name.toLowerCase()===a.name.toLowerCase())){f({type:"error",message:"Nama atribut sudah ada"});return}const n=a.name.toLowerCase().includes("warna")||a.name.toLowerCase().includes("color")||a.name.toLowerCase().includes("bahan")||a.name.toLowerCase().includes("material"),i=[...g,{name:a.name,values:r,affects_image:n}];O(i),L(),K(i),N(i)},B=a=>{const r=g.filter((n,i)=>i!==a);O(r),r.length>0?(K(r),N(r)):(F([]),b([]))},ce=(a,r)=>{const i=g.map((d,c)=>c===a?{...d,values:d.values.filter((y,I)=>I!==r)}:d).filter(d=>d.values.length>0);O(i),K(i),N(i)},K=a=>{const r=a.filter(c=>c.affects_image);if(r.length===0){F([]);return}const n=[],i=(c,y)=>{if(y.length===0){n.push({...c});return}const[I,...z]=y;I.values.forEach(w=>{i({...c,[I.name]:w},z)})};i({},r);const d=n.map(c=>{const y=Object.entries(c).map(([w,j])=>`${j}`).join(" + "),I=Object.entries(c).sort(([w],[j])=>w.localeCompare(j)).map(([w,j])=>`${w}:${j}`).join("|"),z=l.find(w=>Object.entries(w.attributes).sort(([$],[ee])=>$.localeCompare(ee)).map(([$,ee])=>`${$}:${ee}`).join("|")===I);return{label:y,attributes:c,imageFile:z?.imageFile,imagePreview:z?.imagePreview}});F(d)},me=(a,r)=>{if(!r.type.startsWith("image/")){f({type:"error",message:"File harus berupa gambar"});return}if(r.size>5*1024*1024){f({type:"error",message:"Ukuran file maksimal 5MB"});return}const n=new FileReader;n.onloadend=()=>{const i=l.map((d,c)=>c===a?{...d,imageFile:r,imagePreview:n.result}:d);F(i),console.log("ðŸ“¸ Image uploaded for:",i[a].label)},n.readAsDataURL(r)},de=a=>{const r=l.map((n,i)=>i===a?{...n,imageFile:void 0,imagePreview:void 0}:n);F(r),console.log("ðŸ—‘ï¸ Image removed from:",l[a].label)},N=a=>{if(a.length===0){b([]);return}const r=[],n=(c,y)=>{if(y.length===0){r.push({...c});return}const[I,...z]=y;I.values.forEach(w=>{n({...c,[I.name]:w},z)})};n({},a);const i=a.some(c=>c.affects_image),d=r.map(c=>{const y=Object.entries(c).map(([j,$])=>`${j}: ${$}`).join(", "),I=`${oe.toUpperCase().replace(/\s+/g,"-")}-${Object.values(c).map(j=>j.toUpperCase().replace(/\s+/g,"")).join("-")}`;let z,w;if(i&&l.length>0){const j=l.find($=>Object.entries($.attributes).every(([ze,Te])=>c[ze]===Te));j?(z=j.imageFile,w=j.imagePreview,console.log("âœ… Matched variant:",y,"â†’ Image:",j.label)):console.warn("âŒ No image match for variant:",y,"Combo:",c)}return{sku:I,variant_name:y,price:0,stock:0,attributes:c,affects_image:i,_imageFile:z,_imagePreview:w}});console.log("ðŸ“Š Generated variants:",d.length),console.log("ðŸ“¸ Variants with images:",d.filter(c=>c._imageFile).length),b(d),V([])},he=(a,r)=>{p({open:!0,variant:a,index:r})},ue=a=>{b(r=>r.map((n,i)=>i===x.index?a:n)),p({open:!1,variant:null,index:-1})},ge=a=>{V(r=>r.includes(a)?r.filter(n=>n!==a):[...r,a])},xe=()=>{v.length===h.length?V([]):V(h.map((a,r)=>r))},t=()=>{if(v.length===0)return;window.confirm(`Apakah Anda yakin ingin menghapus ${v.length} varian yang dipilih?`)&&(b(r=>r.filter((n,i)=>!v.includes(i))),V([]),f({type:"success",message:`${v.length} varian draft telah dihapus`}))},u=async()=>{if(h.length===0)return;const r=h.filter(i=>i.affects_image).filter(i=>!i._imageFile);if(r.length>0){f({type:"error",message:`${r.length} varian masih belum punya foto! Upload semua foto kombinasi terlebih dahulu.`});return}const n=h.filter(i=>i.price===0);if(!(n.length>0&&!window.confirm(`Ada ${n.length} varian dengan harga Rp0. Apakah Anda yakin ingin melanjutkan?`)))try{A(!0);const i=await G.createProductVariantsBulk(Z,h);f({type:"success",message:i.message||`${h.length} varian berhasil dibuat`}),S(),O([]),F([]),b([])}catch(i){f({type:"error",message:i.message||"Gagal membuat varian"})}finally{A(!1)}},Q=()=>g.length===0?0:g.reduce((a,r)=>a*r.values.length,1),Be=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a);return e.jsx(H,{children:e.jsxs(q,{children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(De,{color:"primary"}),e.jsx(o,{variant:"h6",fontWeight:"bold",children:"Buat Varian Otomatis"})]}),e.jsx(o,{variant:"body2",color:"textSecondary",sx:{mb:3},children:"Tentukan atribut varian dan sistem akan otomatis membuat semua kombinasi dengan SKU dan nama yang konsisten."}),e.jsxs(W,{severity:"info",sx:{mb:3},children:[e.jsx(o,{variant:"body2",fontWeight:"medium",gutterBottom:!0,children:"ðŸ’¡ Cara Kerja Baru:"}),e.jsxs(o,{variant:"body2",component:"div",children:[e.jsx("strong",{children:"Contoh 1: Warna + Ukuran"}),e.jsx("br",{}),'1. Tambah atribut "Warna": Merah, Biru (affects_image âœ…)',e.jsx("br",{}),'2. Tambah atribut "Ukuran": S, M, L (affects_image âŒ)',e.jsx("br",{}),"3. Sistem generate 2 kombinasi foto: Merah, Biru",e.jsx("br",{}),'4. Upload foto di section "ðŸ“¸ Upload Foto untuk Kombinasi Varian"',e.jsx("br",{}),"5. Generate 6 varian (2 warna Ã— 3 ukuran)",e.jsx("br",{}),"6. Merah-S/M/L pakai foto Merah, Biru-S/M/L pakai foto Biru âœ¨",e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{children:"Contoh 2: Warna + Bahan + Ukuran"}),e.jsx("br",{}),"1. Warna: Merah, Biru (affects_image âœ…)",e.jsx("br",{}),"2. Bahan: Katun, Polyester (affects_image âœ…)",e.jsx("br",{}),"3. Ukuran: S, M (affects_image âŒ)",e.jsx("br",{}),"4. Generate 4 kombinasi foto: Merah+Katun, Merah+Polyester, Biru+Katun, Biru+Polyester",e.jsx("br",{}),"5. Upload 4 foto untuk setiap kombinasi",e.jsx("br",{}),"6. Generate 8 varian (2Ã—2Ã—2), setiap kombinasi punya 2 ukuran"]})]}),e.jsx(H,{variant:"outlined",sx:{mb:3},children:e.jsxs(q,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Tambah Atribut Varian"}),e.jsx(s,{component:"form",onSubmit:Y(le),children:e.jsxs(s,{sx:{display:"flex",gap:2,alignItems:"flex-end",flexWrap:"wrap"},children:[e.jsx(s,{sx:{flex:"1 1 200px",minWidth:200},children:e.jsx(P,{...X("name"),label:"Nama Atribut",fullWidth:!0,error:!!E.name,helperText:E.name?.message,placeholder:"Contoh: Warna"})}),e.jsx(s,{sx:{flex:"2 1 300px",minWidth:300},children:e.jsx(P,{...X("values"),label:"Nilai Atribut (pisahkan dengan koma)",fullWidth:!0,error:!!E.values,helperText:E.values?.message,placeholder:"Contoh: Merah, Biru, Hijau"})}),e.jsx(s,{sx:{flex:"0 0 auto"},children:e.jsx(C,{type:"submit",variant:"contained",startIcon:e.jsx(_e,{}),children:"Tambah"})})]})})]})}),g.length>0&&e.jsxs(s,{sx:{mb:3},children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Atribut yang Telah Didefinisikan"}),g.map((a,r)=>e.jsx(H,{variant:"outlined",sx:{mb:2},children:e.jsxs(q,{children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(o,{variant:"subtitle1",fontWeight:"medium",children:a.name}),e.jsx(k,{size:"small",icon:a.affects_image?e.jsx(R,{}):e.jsx(pe,{}),label:a.affects_image?"Mempengaruhi Foto":"Tidak Mempengaruhi Foto",color:a.affects_image?"secondary":"default",variant:"outlined",onClick:()=>{const n=g.map((i,d)=>d===r?{...i,affects_image:!i.affects_image}:i);O(n),K(n),N(n)},sx:{cursor:"pointer","&:hover":{bgcolor:"action.hover"}}})]}),e.jsx(T,{size:"small",color:"error",onClick:()=>B(r),children:e.jsx(M,{fontSize:"small"})})]}),e.jsx(s,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:a.values.map((n,i)=>e.jsx(k,{label:n,onDelete:()=>ce(r,i),deleteIcon:e.jsx(M,{}),color:"primary",variant:"outlined"},i))})]})},r))]}),l.length>0&&e.jsxs(s,{sx:{mb:3},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(o,{variant:"h6",fontWeight:"bold",children:"ðŸ“¸ Upload Foto untuk Kombinasi Varian"}),l.every(a=>a.imageFile)&&e.jsx(k,{label:"âœ“ Lengkap",size:"small",color:"success",icon:e.jsx(R,{})})]}),e.jsx(k,{label:`${l.filter(a=>a.imageFile).length} / ${l.length}`,color:l.every(a=>a.imageFile)?"success":"warning",variant:"filled",sx:{fontWeight:"bold"}})]}),e.jsx(W,{severity:l.every(a=>a.imageFile)?"success":"warning",sx:{mb:2},children:e.jsx(o,{variant:"body2",children:l.every(a=>a.imageFile)?'âœ… Semua kombinasi sudah punya foto! Silakan isi harga & stok di tabel varian, lalu klik "Buat Semua Varian".':`âš ï¸ Upload foto untuk ${l.filter(a=>!a.imageFile).length} kombinasi yang belum lengkap. Semua varian dengan kombinasi yang sama akan menggunakan foto ini.`})}),e.jsx(s,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(3, 1fr)",md:"repeat(4, 1fr)"},gap:2},children:l.map((a,r)=>e.jsx(H,{variant:"outlined",children:e.jsxs(q,{sx:{p:2},children:[a.imagePreview?e.jsxs(s,{sx:{position:"relative",mb:1},children:[e.jsx(s,{component:"img",src:a.imagePreview,alt:a.label,sx:{width:"100%",height:150,objectFit:"cover",borderRadius:1,border:"2px solid",borderColor:"secondary.main"}}),e.jsx(U,{title:"Hapus Gambar",children:e.jsx(T,{size:"small",onClick:()=>de(r),sx:{position:"absolute",top:-8,right:-8,bgcolor:"background.paper",boxShadow:2,"&:hover":{bgcolor:"error.light",color:"white"}},children:e.jsx(M,{fontSize:"small"})})})]}):e.jsxs(C,{component:"label",variant:"outlined",fullWidth:!0,sx:{height:150,mb:1,borderStyle:"dashed","&:hover":{borderStyle:"dashed",bgcolor:"action.hover"}},children:[e.jsxs(s,{sx:{textAlign:"center"},children:[e.jsx(ae,{sx:{fontSize:40,color:"text.secondary",mb:1}}),e.jsx(o,{variant:"caption",display:"block",color:"text.secondary",children:"Klik untuk Upload"})]}),e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:n=>{const i=n.target.files?.[0];i&&me(r,i)}})]}),e.jsx(o,{variant:"body2",fontWeight:"medium",textAlign:"center",sx:{mb:.5},children:a.label}),e.jsx(o,{variant:"caption",color:"text.secondary",textAlign:"center",display:"block",sx:{mb:1},children:Object.entries(a.attributes).map(([n,i])=>`${n}: ${i}`).join(", ")}),e.jsx(s,{sx:{textAlign:"center"},children:a.imageFile?e.jsx(k,{label:"âœ“ Siap",size:"small",color:"success",icon:e.jsx(R,{}),sx:{fontWeight:"bold"}}):e.jsx(k,{label:"âš  Perlu Upload",size:"small",color:"warning",icon:e.jsx(ae,{}),sx:{fontWeight:"bold"}})})]})},r))})]}),g.length>0&&e.jsx(H,{variant:"outlined",sx:{mb:3,bgcolor:"primary.50",borderColor:"primary.main"},children:e.jsxs(q,{children:[e.jsx(o,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"ðŸ“Š Ringkasan Varian"}),e.jsxs(s,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",md:"repeat(4, 1fr)"},gap:2},children:[e.jsxs(s,{children:[e.jsx(o,{variant:"caption",color:"text.secondary",children:"Total Atribut"}),e.jsx(o,{variant:"h5",fontWeight:"bold",children:g.length})]}),e.jsxs(s,{children:[e.jsx(o,{variant:"caption",color:"text.secondary",children:"Atribut Mempengaruhi Foto"}),e.jsx(o,{variant:"h5",fontWeight:"bold",color:"secondary.main",children:g.filter(a=>a.affects_image).length})]}),e.jsxs(s,{children:[e.jsx(o,{variant:"caption",color:"text.secondary",children:"Kombinasi Foto"}),e.jsxs(o,{variant:"h5",fontWeight:"bold",color:l.every(a=>a.imageFile)?"success.main":"warning.main",children:[l.filter(a=>a.imageFile).length," / ",l.length]})]}),e.jsxs(s,{children:[e.jsx(o,{variant:"caption",color:"text.secondary",children:"Total Varian"}),e.jsx(o,{variant:"h5",fontWeight:"bold",color:"primary.main",children:Q()})]})]})]})}),h.length>0&&e.jsxs(s,{children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(o,{variant:"h6",children:["Varian yang Akan Dibuat (",h.length,")"]}),e.jsxs(s,{sx:{display:"flex",gap:1},children:[v.length>0&&e.jsxs(C,{variant:"outlined",color:"error",startIcon:e.jsx(M,{}),onClick:t,children:["Hapus Terpilih (",v.length,")"]}),e.jsx(C,{variant:"outlined",color:"error",startIcon:e.jsx(M,{}),onClick:()=>{window.confirm(`Apakah Anda yakin ingin menghapus semua ${h.length} draft varian?`)&&(b([]),V([]),f({type:"success",message:"Semua draft varian telah dihapus"}))},children:"Hapus Semua Draft"})]})]}),l.length>0?l.every(a=>a.imageFile)?e.jsx(W,{severity:"success",sx:{mb:2},children:e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"âœ… Semua foto sudah lengkap!"}),e.jsx("br",{}),"â€¢ Klik tombol âœï¸ Edit untuk mengisi harga dan stok",e.jsx("br",{}),'â€¢ Setelah harga & stok terisi, klik "Buat Semua Varian"']})}):e.jsx(W,{severity:"warning",sx:{mb:2},children:e.jsxs(o,{variant:"body2",children:[e.jsxs("strong",{children:["âš ï¸ Masih ada ",l.filter(a=>!a.imageFile).length," foto yang belum diupload!"]}),e.jsx("br",{}),'â€¢ Scroll ke atas ke section "ðŸ“¸ Upload Foto untuk Kombinasi Varian"',e.jsx("br",{}),"â€¢ Upload semua foto terlebih dahulu"]})}):e.jsx(W,{severity:"info",sx:{mb:2},children:e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"â„¹ï¸ Info:"}),e.jsx("br",{}),"â€¢ Klik tombol âœï¸ Edit untuk mengisi harga dan stok setiap varian",e.jsx("br",{}),"â€¢ Varian akan menggunakan gambar produk utama"]})}),e.jsx(Ae,{component:we,variant:"outlined",children:e.jsxs(Ve,{children:[e.jsx(Ie,{children:e.jsxs(se,{children:[e.jsx(m,{padding:"checkbox",children:e.jsx(T,{size:"small",onClick:xe,color:"primary",children:v.length===h.length?e.jsx(R,{}):e.jsx(pe,{})})}),e.jsx(m,{children:"SKU"}),e.jsx(m,{children:"Nama Varian"}),e.jsx(m,{align:"right",children:"Harga"}),e.jsx(m,{align:"center",children:"Stok"}),e.jsx(m,{align:"center",children:"Gambar"}),e.jsx(m,{align:"center",children:"Aksi"})]})}),e.jsx(Fe,{children:h.map((a,r)=>e.jsxs(se,{children:[e.jsx(m,{padding:"checkbox",children:e.jsx(T,{size:"small",onClick:()=>ge(r),color:"primary",children:v.includes(r)?e.jsx(R,{}):e.jsx(pe,{})})}),e.jsx(m,{children:e.jsx(o,{variant:"body2",fontFamily:"monospace",children:a.sku})}),e.jsx(m,{children:e.jsx(o,{variant:"body2",children:a.variant_name})}),e.jsx(m,{align:"right",children:e.jsx(o,{variant:"body2",fontWeight:"medium",color:a.price===0?"error":"primary",children:Be(a.price)})}),e.jsx(m,{align:"center",children:e.jsx(k,{label:a.stock,size:"small",color:a.stock===0?"default":"success",variant:"outlined"})}),e.jsx(m,{align:"center",children:a._imagePreview?e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:[e.jsx(U,{title:e.jsxs(s,{children:[e.jsx(o,{variant:"caption",display:"block",children:"Foto dari kombinasi:"}),e.jsx(o,{variant:"caption",fontWeight:"bold",children:Object.entries(a.attributes).filter(([n])=>g.find(i=>i.name===n&&i.affects_image)).map(([n,i])=>`${n}: ${i}`).join(", ")})]}),children:e.jsx(s,{component:"img",src:a._imagePreview,alt:"Preview",sx:{width:60,height:60,objectFit:"cover",borderRadius:1,border:"2px solid",borderColor:"success.main",boxShadow:2,cursor:"help"}})}),e.jsx(k,{label:"âœ“ Ada Foto",size:"small",color:"success",sx:{fontSize:"0.7rem",height:20}})]}):a.affects_image?e.jsx(U,{title:e.jsxs(s,{children:[e.jsx(o,{variant:"caption",display:"block",children:"Upload foto untuk kombinasi:"}),e.jsx(o,{variant:"caption",fontWeight:"bold",children:Object.entries(a.attributes).filter(([n])=>g.find(i=>i.name===n&&i.affects_image)).map(([n,i])=>`${n}: ${i}`).join(", ")}),e.jsx(o,{variant:"caption",display:"block",sx:{mt:.5},children:'Scroll ke atas ke section "ðŸ“¸ Upload Foto untuk Kombinasi Varian"'})]}),children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:[e.jsx(s,{sx:{width:60,height:60,display:"flex",alignItems:"center",justifyContent:"center",border:"2px dashed",borderColor:"error.main",borderRadius:1,bgcolor:"error.50",cursor:"help"},children:e.jsx(ae,{color:"error"})}),e.jsx(k,{label:"âš  Perlu Upload",size:"small",color:"error",sx:{fontSize:"0.7rem",height:20}})]})}):e.jsx(U,{title:"Varian ini akan menggunakan gambar produk utama",children:e.jsx(k,{label:"Pakai Foto Produk",size:"small",variant:"outlined",icon:e.jsx(We,{}),sx:{cursor:"help"}})})}),e.jsx(m,{align:"center",children:e.jsxs(s,{sx:{display:"flex",gap:.5,justifyContent:"center"},children:[e.jsx(U,{title:"Edit Harga & Stok",children:e.jsx(T,{size:"small",onClick:()=>he(a,r),color:"primary",children:e.jsx(Pe,{fontSize:"small"})})}),e.jsx(U,{title:"Hapus Varian",children:e.jsx(T,{size:"small",onClick:()=>{window.confirm(`Apakah Anda yakin ingin menghapus varian "${a.variant_name}"?`)&&(b(i=>i.filter((d,c)=>c!==r)),f({type:"success",message:"Varian draft telah dihapus"}))},color:"error",children:e.jsx(M,{fontSize:"small"})})})]})})]},r))})]})}),e.jsxs(s,{sx:{textAlign:"center",mt:3},children:[l.length>0&&!l.every(a=>a.imageFile)&&e.jsx(W,{severity:"error",sx:{mb:2,maxWidth:600,mx:"auto"},children:e.jsxs(o,{variant:"body2",children:["âš ï¸ Belum bisa membuat varian! Upload semua ",l.filter(a=>!a.imageFile).length," foto kombinasi yang kurang."]})}),e.jsx(C,{variant:"contained",size:"large",onClick:u,disabled:D||l.length>0&&!l.every(a=>a.imageFile),startIcon:D?e.jsx(Ue,{size:20,color:"inherit"}):e.jsx(R,{}),children:D?"Membuat Varian...":`Buat Semua ${h.length} Varian`})]})]}),e.jsxs(ie,{open:x.open,onClose:()=>p({open:!1,variant:null,index:-1}),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ne,{children:"Edit Harga & Stok"}),e.jsx(re,{children:x.variant&&e.jsxs(s,{sx:{mt:2},children:[e.jsxs(W,{severity:"info",sx:{mb:2},children:[e.jsx(o,{variant:"body2",fontWeight:"medium",children:x.variant.variant_name}),e.jsxs(o,{variant:"caption",color:"textSecondary",children:["SKU: ",x.variant.sku]})]}),x.variant._imagePreview&&e.jsxs(s,{sx:{textAlign:"center",mb:2},children:[e.jsx(s,{component:"img",src:x.variant._imagePreview,alt:"Preview",sx:{width:120,height:120,objectFit:"cover",borderRadius:2,border:"2px solid",borderColor:"secondary.main"}}),e.jsx(o,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:1},children:"Gambar dari atribut"})]}),e.jsx(P,{label:"Harga (Rp)",type:"number",fullWidth:!0,margin:"normal",value:x.variant.price,onChange:a=>{const r={...x.variant,price:parseFloat(a.target.value)||0};p(n=>({...n,variant:r}))},InputProps:{inputProps:{min:0,step:"0.01"}},placeholder:"Masukkan harga"}),e.jsx(P,{label:"Stok",type:"number",fullWidth:!0,margin:"normal",value:x.variant.stock,onChange:a=>{const r={...x.variant,stock:parseInt(a.target.value)||0};p(n=>({...n,variant:r}))},InputProps:{inputProps:{min:0}},placeholder:"Masukkan stok"})]})}),e.jsxs(te,{children:[e.jsx(C,{onClick:()=>p({open:!1,variant:null,index:-1}),children:"Batal"}),e.jsx(C,{onClick:()=>x.variant&&ue(x.variant),variant:"contained",children:"Simpan"})]})]})]})})}const $e=ve({sku:J().min(1,"SKU wajib diisi").min(3,"SKU minimal 3 karakter"),variant_name:J().min(1,"Nama varian wajib diisi"),price:ke().min(0,"Harga tidak boleh negatif"),stock:ke().int().min(0,"Stok tidak boleh negatif")}),Ge=ve({option_name:J().min(1,"Nama opsi wajib diisi"),option_value:J().min(1,"Nilai opsi wajib diisi")});function na({productId:Z,productName:oe}){const{showNotification:S}=Se(),[f,g]=_.useState([]),[O,l]=_.useState(!1),[F,h]=_.useState({open:!1,mode:"create"}),[b,D]=_.useState({open:!1}),[A,v]=_.useState({open:!1}),{register:V,handleSubmit:x,formState:{errors:p},reset:X}=je({resolver:fe($e)}),{register:Y,handleSubmit:E,formState:{errors:L},reset:le}=je({resolver:fe(Ge)}),B=async()=>{try{l(!0);const t=await G.getProductVariants(Z);t.success&&g(t.data)}catch(t){S({type:"error",message:t.message||"Gagal memuat varian produk"})}finally{l(!1)}};_.useEffect(()=>{B()},[Z]);const ce=t=>{X({sku:t.sku,variant_name:t.variant_name,price:parseFloat(t.price),stock:t.stock}),h({open:!0,mode:"edit",variant:t})},K=async t=>{if(window.confirm(`Apakah Anda yakin ingin menghapus varian "${t.variant_name}"?`))try{await G.deleteProductVariant(t.id),S({type:"success",message:"Varian berhasil dihapus"}),B()}catch(Q){S({type:"error",message:Q.message||"Gagal menghapus varian"})}},me=async t=>{try{F.variant&&(await G.updateProductVariant(F.variant.id,t),S({type:"success",message:"Varian berhasil diperbarui"})),h({open:!1,mode:"create"}),B()}catch(u){S({type:"error",message:u.message||"Gagal menyimpan varian"})}},de=(t,u)=>{le(),D({open:!0,variantId:t,variantName:u})},N=async t=>{if(b.variantId)try{await G.createVariantOption(b.variantId,t),S({type:"success",message:"Opsi varian berhasil ditambahkan"}),D({open:!1}),B()}catch(u){S({type:"error",message:u.message||"Gagal menambahkan opsi varian"})}},he=async t=>{if(window.confirm("Apakah Anda yakin ingin menghapus opsi ini?"))try{await G.deleteVariantOption(t),S({type:"success",message:"Opsi varian berhasil dihapus"}),B()}catch(Q){S({type:"error",message:Q.message||"Gagal menghapus opsi varian"})}},ue=t=>{v({open:!0,variant:t})},ge=async t=>{if(A.variant)try{await G.updateVariantImage(A.variant.id,t),S({type:"success",message:"Gambar varian berhasil diperbarui"}),v({open:!1,variant:void 0}),B()}catch(u){S({type:"error",message:u.message||"Gagal mengupdate gambar varian"})}},xe=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(typeof t=="string"?parseFloat(t):t);return e.jsx(H,{children:e.jsxs(q,{children:[e.jsxs(s,{sx:{mb:4},children:[e.jsx(o,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Buat Varian Baru"}),e.jsx(Oe,{productId:Z,productName:oe,onVariantsCreated:()=>{B()}})]}),e.jsxs(s,{sx:{mt:4},children:[e.jsxs(o,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:["Varian Saat Ini (",f.length,")"]}),O?e.jsx(W,{severity:"info",children:"Memuat varian produk..."}):f.length===0?e.jsx(W,{severity:"info",children:"Belum ada varian produk. Gunakan form di atas untuk membuat varian baru."}):e.jsx(Ae,{component:we,variant:"outlined",children:e.jsxs(Ve,{children:[e.jsx(Ie,{children:e.jsxs(se,{children:[e.jsx(m,{children:"SKU"}),e.jsx(m,{align:"right",children:"Harga"}),e.jsx(m,{align:"center",children:"Stok"}),e.jsx(m,{align:"center",children:"Gambar"}),e.jsx(m,{children:"Opsi Varian"}),e.jsx(m,{align:"center",children:"Aksi"})]})}),e.jsx(Fe,{children:f.map(t=>e.jsxs(se,{hover:!0,children:[e.jsx(m,{children:e.jsx(o,{variant:"body2",fontFamily:"monospace",fontWeight:"medium",children:t.sku})}),e.jsx(m,{align:"right",children:e.jsx(o,{variant:"body2",fontWeight:"medium",color:"primary",children:xe(t.price)})}),e.jsx(m,{align:"center",children:e.jsx(k,{label:t.stock,size:"small",color:t.stock>0?"success":"error",variant:t.stock>0?"filled":"outlined"})}),e.jsx(m,{align:"center",children:t.image?e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:[e.jsx(ye,{src:Ce(t.image),variant:"rounded",sx:{width:40,height:40}}),e.jsx(k,{label:"Ada Gambar",size:"small",color:"success",sx:{fontSize:"0.7rem",height:18}})]}):e.jsx(k,{label:"Tidak Ada",size:"small",color:"default",variant:"outlined",sx:{fontSize:"0.7rem",height:18}})}),e.jsxs(m,{children:[e.jsx(s,{sx:{display:"flex",gap:.5,flexWrap:"wrap",mb:1},children:t.variant_options&&t.variant_options.length>0?t.variant_options.map(u=>e.jsx(k,{label:`${u.option_name}: ${u.option_value}`,size:"small",variant:"outlined",onDelete:()=>he(u.id),deleteIcon:e.jsx(M,{fontSize:"small"})},u.id)):e.jsx(o,{variant:"caption",color:"textSecondary",fontStyle:"italic",children:"Belum ada opsi"})}),e.jsx(C,{size:"small",startIcon:e.jsx(_e,{}),onClick:()=>de(t.id,t.variant_name),variant:"outlined",sx:{fontSize:"0.75rem",py:.5},children:"Tambah Opsi"})]}),e.jsx(m,{align:"center",children:e.jsxs(s,{sx:{display:"flex",gap:.5,justifyContent:"center"},children:[e.jsx(U,{title:"Edit Varian",children:e.jsx(T,{size:"small",onClick:()=>ce(t),color:"primary",children:e.jsx(Pe,{fontSize:"small"})})}),e.jsx(U,{title:"Edit Gambar",children:e.jsx(T,{size:"small",onClick:()=>ue(t),color:"secondary",children:e.jsx(We,{fontSize:"small"})})}),e.jsx(U,{title:"Hapus Varian",children:e.jsx(T,{size:"small",onClick:()=>K(t),color:"error",children:e.jsx(M,{fontSize:"small"})})})]})})]},t.id))})]})})]}),e.jsxs(ie,{open:F.open,onClose:()=>h({open:!1,mode:"create"}),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ne,{children:"Edit Varian"}),e.jsx(re,{children:e.jsxs(s,{component:"form",sx:{mt:2},children:[e.jsx(P,{...V("sku"),label:"SKU",fullWidth:!0,margin:"normal",error:!!p.sku,helperText:p.sku?.message,placeholder:"Contoh: PRD-001-RED"}),e.jsx(P,{...V("variant_name"),label:"Nama Varian",fullWidth:!0,margin:"normal",error:!!p.variant_name,helperText:p.variant_name?.message,placeholder:"Contoh: Warna Merah"}),e.jsx(P,{...V("price",{valueAsNumber:!0}),label:"Harga",type:"number",fullWidth:!0,margin:"normal",error:!!p.price,helperText:p.price?.message,InputProps:{inputProps:{min:0,step:"0.01"}}}),e.jsx(P,{...V("stock",{valueAsNumber:!0}),label:"Stok",type:"number",fullWidth:!0,margin:"normal",error:!!p.stock,helperText:p.stock?.message,InputProps:{inputProps:{min:0}}})]})}),e.jsxs(te,{children:[e.jsx(C,{onClick:()=>h({open:!1,mode:"create"}),children:"Batal"}),e.jsx(C,{onClick:x(me),variant:"contained",children:"Simpan"})]})]}),e.jsxs(ie,{open:b.open,onClose:()=>D({open:!1}),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(ne,{children:["Tambah Opsi untuk ",b.variantName]}),e.jsx(re,{children:e.jsxs(s,{component:"form",sx:{mt:2},children:[e.jsx(P,{...Y("option_name"),label:"Nama Opsi",fullWidth:!0,margin:"normal",error:!!L.option_name,helperText:L.option_name?.message,placeholder:"Contoh: Warna, Ukuran, Bahan"}),e.jsx(P,{...Y("option_value"),label:"Nilai Opsi",fullWidth:!0,margin:"normal",error:!!L.option_value,helperText:L.option_value?.message,placeholder:"Contoh: Merah, Large, Katun"})]})}),e.jsxs(te,{children:[e.jsx(C,{onClick:()=>D({open:!1}),children:"Batal"}),e.jsx(C,{onClick:E(N),variant:"contained",children:"Tambah Opsi"})]})]}),e.jsxs(ie,{open:A.open,onClose:()=>v({open:!1,variant:void 0}),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ne,{children:"Edit Gambar Varian"}),e.jsx(re,{children:A.variant&&e.jsxs(s,{sx:{mt:2},children:[e.jsxs(W,{severity:"info",sx:{mb:2},children:[e.jsx(o,{variant:"body2",fontWeight:"medium",children:A.variant.variant_name}),e.jsxs(o,{variant:"caption",color:"textSecondary",children:["SKU: ",A.variant.sku]})]}),A.variant.image&&e.jsxs(s,{sx:{textAlign:"center",mb:2},children:[e.jsx(o,{variant:"subtitle2",gutterBottom:!0,children:"Gambar Saat Ini:"}),e.jsx(ye,{src:Ce(A.variant.image),variant:"rounded",sx:{width:200,height:200,mx:"auto",border:"2px solid",borderColor:"primary.main"}})]}),e.jsxs(s,{sx:{textAlign:"center"},children:[e.jsxs(C,{component:"label",variant:"contained",startIcon:e.jsx(ae,{}),sx:{mb:2},children:[A.variant.image?"Ganti Gambar":"Upload Gambar",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:t=>{const u=t.target.files?.[0];u&&ge(u)}})]}),e.jsx(o,{variant:"caption",display:"block",color:"text.secondary",children:"Format: JPG, PNG, WebP (Max 5MB)"})]})]})}),e.jsx(te,{children:e.jsx(C,{onClick:()=>v({open:!1,variant:void 0}),children:"Tutup"})})]})]})})}export{na as P};
