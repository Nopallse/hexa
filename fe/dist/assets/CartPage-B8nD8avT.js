import{c as B,j as e,u as F,r as f,S as k,R as E,W as R,B as o,T as a,e as q,i as W,h as G,a as T,D as w,b as z,Z as H,C as L,$ as I,a0 as M}from"./index-sM3j39aj.js";import{c as _}from"./cartApi-DmehO5Dt.js";import{u as D}from"./cartStore-CCOIigdq.js";import{C as K,a as $}from"./CardContent-Cj-kD625.js";import{A as S}from"./Alert-CTAf5yxJ.js";import{A as U}from"./Add-DbcZ-5Mi.js";import{D as N}from"./Delete-D01o1oo-.js";import{B as V}from"./Breadcrumbs-BTyrJBjS.js";import{S as Z}from"./ShoppingBag-BVPgEm8S.js";import{S as J}from"./Skeleton-BLYaqpzf.js";const O=B(e.jsx("path",{d:"M5 13h14v-2H5zm-2 4h14v-2H3zM7 7v2h14V7z"}),"ClearAll"),X=B(e.jsx("path",{d:"M19 13H5v-2h14z"}),"Remove"),Y=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t);function A({item:t,onUpdate:p,onRemove:C}){const l=F(),[s,g]=f.useState(t.quantity),[c,j]=f.useState(!1),[v,d]=f.useState(null),{updateItem:b,removeItem:y}=D(),i=t.product_variant.product.deleted_at!==null,u=n=>{const h=typeof n=="string"?parseFloat(n):n;return Y(h)},x=async n=>{if(!(n<1||n>t.product_variant.stock))try{j(!0),d(null),(await _.updateCartItem(t.id,{quantity:n})).success&&(g(n),b(t.id,n),p())}catch(h){console.error("Error updating cart item:",h),d(h.response?.data?.error||"Gagal mengupdate quantity")}finally{j(!1)}},r=async()=>{try{j(!0),d(null),(await _.removeFromCart(t.id)).success&&(y(t.id),C())}catch(n){console.error("Error removing cart item:",n),d(n.response?.data?.error||"Gagal menghapus item")}finally{j(!1)}},m=t.product_variant.product.product_images?.[0]?.image_name;return e.jsx(K,{sx:{mb:2,border:i?`2px solid ${l.palette.error.main}`:"none",opacity:i?.7:1},children:e.jsxs($,{children:[i&&e.jsx(S,{severity:"error",sx:{mb:2},children:"Produk ini sudah tidak tersedia"}),v&&e.jsx(S,{severity:"error",sx:{mb:2},onClose:()=>d(null),children:v}),e.jsxs(k,{direction:{xs:"column",sm:"row"},spacing:3,alignItems:"center",children:[e.jsx(E,{src:m||`https://placehold.co/80x80/9682DB/FFFFFF/png?text=${encodeURIComponent(t.product_variant.product.name)}`,alt:t.product_variant.product.name,sx:{width:80,height:80,borderRadius:2,flexShrink:0},variant:"rounded",children:e.jsx(R,{})}),e.jsxs(o,{sx:{flex:1,minWidth:0},children:[e.jsx(a,{variant:"h6",fontWeight:600,sx:{mb:.5},children:t.product_variant.product.name}),e.jsx(a,{variant:"subtitle1",color:"primary.main",fontWeight:700,sx:{mb:1},children:t.product_variant.variant_name}),t.product_variant.variant_options&&t.product_variant.variant_options.length>0&&e.jsx(k,{direction:"row",spacing:1,sx:{mb:1,flexWrap:"wrap",gap:.5},children:t.product_variant.variant_options.map(n=>e.jsx(q,{label:`${n.option_name}: ${n.option_value}`,size:"small",variant:"outlined",sx:{fontSize:"0.75rem"}},n.id))}),e.jsxs(a,{variant:"body2",color:"text.secondary",children:["SKU: ",t.product_variant.sku]}),i?e.jsx(a,{variant:"body2",color:"error.main",fontWeight:600,children:"Stok: Tidak tersedia"}):e.jsxs(a,{variant:"body2",color:"text.secondary",children:["Stok: ",t.product_variant.stock," unit"]})]}),e.jsxs(o,{sx:{textAlign:"right",minWidth:120},children:[e.jsx(a,{variant:"h6",color:"primary.main",fontWeight:700,sx:{mb:1},children:u(parseFloat(t.product_variant.price))}),e.jsxs(a,{variant:"body2",color:"text.secondary",children:["Total: ",u(parseFloat(t.product_variant.price)*s)]})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(W,{onClick:()=>x(s-1),disabled:c||s<=1||i,size:"small",sx:{border:`1px solid ${l.palette.grey[300]}`,borderRadius:1},children:e.jsx(X,{})}),e.jsx(G,{type:"number",value:s,onChange:n=>{const h=parseInt(n.target.value)||1;h>=1&&h<=t.product_variant.stock&&x(h)},disabled:c||i,inputProps:{min:1,max:t.product_variant.stock},sx:{width:70},size:"small"}),e.jsx(W,{onClick:()=>x(s+1),disabled:c||s>=t.product_variant.stock||i,size:"small",sx:{border:`1px solid ${l.palette.grey[300]}`,borderRadius:1},children:e.jsx(U,{})})]}),e.jsx(W,{onClick:r,disabled:c,color:"error",sx:{border:`1px solid ${l.palette.error.light}`,"&:hover":{backgroundColor:l.palette.error.light+"20"}},children:e.jsx(N,{})})]})]})})}const P=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t);function Q({items:t,onCartCleared:p}){F();const C=T(),[l,s]=f.useState(!1),{clearCart:g,getTotalItems:c,getTotalPrice:j}=D(),v=r=>{const m=typeof r=="string"?parseFloat(r):r;return P(m)},d=async()=>{if(window.confirm("Apakah Anda yakin ingin mengosongkan keranjang?"))try{s(!0),(await _.clearCart()).success&&(g(),p())}catch(r){console.error("Error clearing cart:",r),alert(r.response?.data?.error||"Gagal mengosongkan keranjang")}finally{s(!1)}},b=()=>{C("/checkout")},y=t.filter(r=>r.product_variant.product.deleted_at===null),i=t.filter(r=>r.product_variant.product.deleted_at!==null),u=y.reduce((r,m)=>r+m.quantity,0),x=y.reduce((r,m)=>r+parseFloat(m.product_variant.price)*m.quantity,0);return e.jsx(K,{sx:{position:"sticky",top:24},children:e.jsxs($,{children:[e.jsx(a,{variant:"h6",fontWeight:700,sx:{mb:3},children:"Ringkasan Belanja"}),e.jsxs(k,{spacing:2,children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(a,{variant:"body1",children:["Total Item (",u,")"]}),e.jsx(a,{variant:"body1",fontWeight:600,children:x>0?v(x):"Rp 0"})]}),i.length>0&&e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(a,{variant:"body2",color:"error.main",children:["Item tidak tersedia (",i.length,")"]}),e.jsx(a,{variant:"body2",color:"error.main",children:"Tidak dihitung"})]}),e.jsx(w,{}),e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(a,{variant:"h6",fontWeight:700,children:"Total Belanja"}),e.jsx(a,{variant:"h6",fontWeight:700,color:"primary.main",children:P(x)})]}),e.jsx(w,{}),e.jsxs(k,{spacing:2,children:[e.jsx(z,{variant:"contained",size:"large",startIcon:e.jsx(H,{}),onClick:b,disabled:u===0,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:600,fontSize:"1rem"},children:u===0?"Keranjang Kosong":"Lanjut ke Checkout"}),t.length>0&&e.jsx(z,{variant:"outlined",size:"large",startIcon:e.jsx(O,{}),onClick:d,disabled:l,fullWidth:!0,color:"error",sx:{py:1.5,borderRadius:2,fontWeight:600,fontSize:"1rem"},children:l?"Mengosongkan...":"Kosongkan Keranjang"})]})]})]})})}function de(){const t=F(),p=T(),[C,l]=f.useState(!0),[s,g]=f.useState(null),[c,j]=f.useState([]),{setItems:v}=D(),d=async()=>{try{l(!0),g(null);const r=await _.getCart();r.success?(j(r.data),v(r.data)):g("Gagal memuat keranjang")}catch(r){console.error("Error fetching cart:",r),g(r.response?.data?.error||"Gagal memuat keranjang")}finally{l(!1)}},b=()=>{d()},y=()=>{d()},i=()=>{j([])};f.useEffect(()=>{d()},[]);const u=c.filter(r=>r.product_variant.product.deleted_at===null),x=c.filter(r=>r.product_variant.product.deleted_at!==null);return e.jsx(o,{sx:{minHeight:"100vh",py:4},children:e.jsxs(L,{maxWidth:"xl",children:[e.jsxs(V,{sx:{mb:4},children:[e.jsxs(I,{component:"button",variant:"body2",onClick:()=>p("/"),sx:{display:"flex",alignItems:"center",textDecoration:"none",color:"text.secondary","&:hover":{color:"primary.main"}},children:[e.jsx(M,{sx:{mr:.5,fontSize:"1rem"}}),"Beranda"]}),e.jsxs(I,{component:"button",variant:"body2",onClick:()=>p("/products"),sx:{display:"flex",alignItems:"center",textDecoration:"none",color:"text.secondary","&:hover":{color:"primary.main"}},children:[e.jsx(Z,{sx:{mr:.5,fontSize:"1rem"}}),"Produk"]}),e.jsxs(a,{variant:"body2",color:"text.primary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(R,{sx:{mr:.5,fontSize:"1rem"}}),"Keranjang"]})]}),e.jsxs(o,{sx:{mb:4},children:[e.jsx(a,{variant:"h4",fontWeight:700,sx:{mb:1},children:"Keranjang Belanja"}),e.jsx(a,{variant:"body1",color:"text.secondary",children:"Kelola item di keranjang belanja Anda"})]}),s&&e.jsx(S,{severity:"error",sx:{mb:4},onClose:()=>g(null),children:s}),e.jsxs(o,{sx:{display:"flex",flexDirection:{xs:"column",lg:"row"},gap:4,alignItems:"flex-start"},children:[e.jsx(o,{sx:{flex:1,minWidth:0,order:{xs:1,lg:1}},children:C?e.jsx(k,{spacing:2,children:[...Array(3)].map((r,m)=>e.jsx(J,{variant:"rectangular",height:120,sx:{borderRadius:2}},m))}):c.length===0?e.jsxs(o,{sx:{textAlign:"center",py:8,px:4,borderRadius:3,background:"linear-gradient(135deg, #faf8ff 0%, #f0f4ff 100%)",border:`1px solid ${t.palette.primary.light}20`},children:[e.jsx(R,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(a,{variant:"h6",color:"text.secondary",fontWeight:600,sx:{mb:1},children:"Keranjang Anda Kosong"}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Mulai berbelanja dan tambahkan produk ke keranjang Anda"}),e.jsxs(o,{sx:{display:"flex",gap:2,justifyContent:"center",flexWrap:"wrap"},children:[e.jsx(I,{component:"button",variant:"button",onClick:()=>p("/products"),sx:{px:3,py:1.5,borderRadius:2,backgroundColor:"primary.main",color:"white",textDecoration:"none",fontWeight:600,"&:hover":{backgroundColor:"primary.dark"}},children:"Lihat Produk"}),e.jsx(I,{component:"button",variant:"button",onClick:()=>p("/"),sx:{px:3,py:1.5,borderRadius:2,backgroundColor:"grey.100",color:"text.primary",textDecoration:"none",fontWeight:600,"&:hover":{backgroundColor:"grey.200"}},children:"Kembali ke Beranda"})]})]}):e.jsxs(k,{spacing:2,children:[u.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(a,{variant:"h6",fontWeight:600,sx:{mb:2},children:["Item Tersedia (",u.length,")"]}),u.map(r=>e.jsx(A,{item:r,onUpdate:b,onRemove:y},r.id))]}),x.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(a,{variant:"h6",fontWeight:600,sx:{mb:2,color:"error.main"},children:["Item Tidak Tersedia (",x.length,")"]}),e.jsx(S,{severity:"warning",sx:{mb:2},children:"Beberapa item di keranjang Anda sudah tidak tersedia. Item ini akan diabaikan saat checkout."}),x.map(r=>e.jsx(A,{item:r,onUpdate:b,onRemove:y},r.id))]})]})}),c.length>0&&e.jsx(o,{sx:{width:{xs:"100%",lg:"400px"},flexShrink:0,order:{xs:2,lg:2}},children:e.jsx(Q,{items:c,onCartCleared:i})})]})]})})}export{de as default};
