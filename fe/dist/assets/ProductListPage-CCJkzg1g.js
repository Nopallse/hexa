import{r as n,j as e,P as R,T as x,B as i,b as w,R as q,aq as Y,e as P,i as S,h as D,y as J,F,z as W,E as A,M as C,x as Q,a as X,ar as ee,Y as ae,C as re}from"./index-sM3j39aj.js";import{p as B}from"./productApi-D6IUj1rX.js";import{c as te}from"./categoryApi-BIN-ORWv.js";import{g as se}from"./image-DkS5CVTc.js";import{D as ie}from"./RestoreFromTrash-BqaVimEp.js";import{T as ne,a as le,b as oe,c as H,d,e as ce}from"./TableRow-CP6VPFQV.js";import{T as z}from"./Tooltip-DnMiuNJ3.js";import{V as de}from"./Visibility-ByCn1Zw0.js";import{E as he}from"./Edit-CZ-tgljX.js";import{D as ue}from"./Delete-D01o1oo-.js";import{D as xe,a as me,b as ge}from"./DialogTitle-ChUapDp-.js";import{A as L}from"./Alert-CTAf5yxJ.js";import{D as pe}from"./DialogActions-ZoeYf55a.js";import{F as je}from"./FilterList-DTyGzIxs.js";import{A as fe}from"./Add-DbcZ-5Mi.js";import{T as ve}from"./TablePagination-CY7R9_ti.js";import"./KeyboardArrowRight-Wpht8mkc.js";import"./LastPage-CHxysHhu.js";function be({products:p,isLoading:k=!1,onEdit:h,onDelete:I,onView:t,onViewDeleted:f}){const[c,m]=n.useState({open:!1,product:null,loading:!1}),g=r=>{m({open:!0,product:r,loading:!1})},b=async()=>{if(c.product){m(r=>({...r,loading:!0}));try{await I(c.product.id),m({open:!1,product:null,loading:!1})}catch{m(v=>({...v,loading:!1}))}}},j=()=>{m({open:!1,product:null,loading:!1})},u=r=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(r),y=r=>r.product_images&&r.product_images.length>0?r.product_images.find(l=>l.is_primary)||r.product_images[0]:null;return p.length===0&&!k?e.jsxs(R,{sx:{p:4,textAlign:"center"},children:[e.jsx(x,{variant:"h6",color:"textSecondary",children:"Belum ada produk"}),e.jsx(x,{variant:"body2",color:"textSecondary",children:"Tambah produk pertama untuk mulai menjual"})]}):e.jsxs(e.Fragment,{children:[f&&e.jsx(i,{sx:{mb:2,display:"flex",justifyContent:"flex-end"},children:e.jsx(w,{variant:"outlined",startIcon:e.jsx(ie,{}),onClick:f,color:"secondary",children:"Lihat Produk Dihapus"})}),e.jsx(ne,{component:R,children:e.jsxs(le,{children:[e.jsx(oe,{children:e.jsxs(H,{children:[e.jsx(d,{children:"Gambar"}),e.jsx(d,{children:"Nama Produk"}),e.jsx(d,{children:"Kategori"}),e.jsx(d,{align:"right",children:"Harga"}),e.jsx(d,{align:"center",children:"Stok"}),e.jsx(d,{align:"center",children:"Info Varian"}),e.jsx(d,{align:"center",children:"Aksi"})]})}),e.jsx(ce,{children:p.map(r=>{const v=y(r);return e.jsxs(H,{hover:!0,children:[e.jsx(d,{children:e.jsx(q,{src:se(v?.image_name),variant:"rounded",sx:{width:56,height:56},children:e.jsx(Y,{})})}),e.jsx(d,{children:e.jsxs(i,{children:[e.jsx(x,{variant:"subtitle2",fontWeight:"medium",gutterBottom:!0,children:r.name}),e.jsx(x,{variant:"body2",color:"textSecondary",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.description||"-"})]})}),e.jsx(d,{children:e.jsx(P,{label:r.category?.name||"Tidak ada kategori",size:"small",color:"primary",variant:"outlined"})}),e.jsx(d,{align:"right",children:r.product_variants&&r.product_variants.length>0?e.jsx(i,{sx:{textAlign:"right"},children:e.jsxs(x,{variant:"body1",fontWeight:"medium",color:"primary",children:[u(Math.min(...r.product_variants.map(l=>parseFloat(l.price))))," - ",u(Math.max(...r.product_variants.map(l=>parseFloat(l.price))))]})}):e.jsx(x,{variant:"body1",fontWeight:"medium",children:u(parseFloat(r.price||"0"))})}),e.jsx(d,{align:"center",children:r.product_variants&&r.product_variants.length>0?e.jsx(i,{sx:{display:"flex",flexDirection:"column",gap:.5,alignItems:"center"},children:e.jsx(P,{label:`Total: ${r.product_variants.reduce((l,a)=>l+(a.stock||0),0)}`,size:"small",color:r.product_variants.reduce((l,a)=>l+(a.stock||0),0)>0?"success":"error",variant:r.product_variants.reduce((l,a)=>l+(a.stock||0),0)>0?"filled":"outlined"})}):e.jsx(P,{label:r.stock||0,size:"small",color:(r.stock||0)>0?"success":"error",variant:(r.stock||0)>0?"filled":"outlined"})}),e.jsx(d,{align:"center",children:r.product_variants&&r.product_variants.length>0?e.jsx(i,{sx:{display:"flex",flexDirection:"column",gap:.5,alignItems:"center"},children:e.jsx(P,{label:`${r.product_variants.length} Varian`,size:"small",color:"primary",variant:"filled",sx:{fontWeight:"bold"}})}):e.jsx(P,{label:"Tidak Ada Varian",size:"small",color:"default",variant:"outlined",sx:{fontSize:"0.7rem"}})}),e.jsx(d,{align:"center",children:e.jsxs(i,{sx:{display:"flex",justifyContent:"center",gap:.5},children:[e.jsx(z,{title:"Lihat Detail",children:e.jsx(S,{size:"small",onClick:()=>t(r),color:"info",children:e.jsx(de,{fontSize:"small"})})}),e.jsx(z,{title:"Edit Produk",children:e.jsx(S,{size:"small",onClick:()=>h(r),color:"primary",children:e.jsx(he,{fontSize:"small"})})}),e.jsx(z,{title:"Hapus Produk",children:e.jsx(S,{size:"small",onClick:()=>g(r),color:"error",children:e.jsx(ue,{fontSize:"small"})})})]})})]},r.id)})})]})}),e.jsxs(xe,{open:c.open,onClose:j,maxWidth:"sm",fullWidth:!0,children:[e.jsx(me,{children:"Hapus Produk"}),e.jsxs(ge,{children:[e.jsx(L,{severity:"warning",sx:{mb:2},children:e.jsxs(x,{variant:"body2",children:["Anda yakin ingin menghapus produk ",e.jsx("strong",{children:c.product?.name}),"?"]})}),e.jsx(x,{variant:"body2",sx:{mt:2},children:"Produk akan dihapus secara soft delete dan dapat dipulihkan nanti."})]}),e.jsxs(pe,{children:[e.jsx(w,{onClick:j,disabled:c.loading,children:"Batal"}),e.jsx(w,{onClick:b,color:"error",variant:"contained",disabled:c.loading,children:c.loading?"Menghapus...":"Hapus"})]})]})]})}function ye({onFilterChange:p,categories:k=[],loading:h=!1,initialFilters:I}){const[t,f]=n.useState({search:"",category:"",min_price:void 0,max_price:void 0,sort:"created_at",sortOrder:"desc",...I}),[c,m]=n.useState(!1),[g,b]=n.useState(null),j=n.useCallback(p,[]);n.useEffect(()=>{g&&clearTimeout(g);const a=setTimeout(()=>{j(t)},t.search?500:0);return b(a),()=>{a&&clearTimeout(a)}},[t,j]),n.useEffect(()=>()=>{g&&clearTimeout(g)},[g]);const u=(a,_)=>{f(T=>({...T,[a]:_}))},y=a=>{f(_=>({..._,search:a}))},r=()=>{f({search:"",category:"",min_price:void 0,max_price:void 0,sort:"created_at",sortOrder:"desc"})},l=(()=>{let a=0;return t.search&&a++,t.category&&a++,t.min_price&&a++,t.max_price&&a++,t.sort!=="created_at"&&a++,t.sortOrder!=="desc"&&a++,a})();return e.jsxs(i,{sx:{mb:3},children:[e.jsxs(i,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[e.jsx(i,{sx:{flex:"1 1 300px",minWidth:200},children:e.jsx(D,{fullWidth:!0,placeholder:"Cari produk...",value:t.search||"",onChange:a=>y(a.target.value),InputProps:{startAdornment:e.jsx(J,{sx:{mr:1,color:"text.secondary"}})},disabled:h})}),e.jsx(i,{sx:{flex:"1 1 200px",minWidth:150},children:e.jsxs(F,{fullWidth:!0,disabled:h,children:[e.jsx(W,{children:"Kategori"}),e.jsxs(A,{value:t.category||"",onChange:a=>u("category",a.target.value),label:"Kategori",children:[e.jsx(C,{value:"",children:"Semua Kategori"}),k.map(a=>e.jsx(C,{value:a.id,children:a.name},a.id))]})]})}),e.jsx(i,{sx:{flex:"1 1 150px",minWidth:120},children:e.jsxs(F,{fullWidth:!0,disabled:h,children:[e.jsx(W,{children:"Urutkan"}),e.jsxs(A,{value:t.sort||"created_at",onChange:a=>u("sort",a.target.value),label:"Urutkan",children:[e.jsx(C,{value:"name",children:"Nama"}),e.jsx(C,{value:"price",children:"Harga"}),e.jsx(C,{value:"created_at",children:"Tanggal Dibuat"})]})]})}),e.jsx(i,{sx:{flex:"1 1 150px",minWidth:120},children:e.jsxs(F,{fullWidth:!0,disabled:h,children:[e.jsx(W,{children:"Urutan"}),e.jsxs(A,{value:t.sortOrder||"desc",onChange:a=>u("sortOrder",a.target.value),label:"Urutan",children:[e.jsx(C,{value:"asc",children:"A-Z / Terendah"}),e.jsx(C,{value:"desc",children:"Z-A / Tertinggi"})]})]})}),e.jsxs(i,{sx:{display:"flex",gap:1,flexShrink:0},children:[e.jsxs(w,{variant:"outlined",startIcon:e.jsx(je,{}),onClick:()=>m(!c),disabled:h,children:["Filter",l>0&&e.jsx(P,{label:l,size:"small",color:"primary",sx:{ml:1,minWidth:20,height:20}})]}),l>0&&e.jsx(w,{variant:"outlined",startIcon:e.jsx(Q,{}),onClick:r,disabled:h,color:"error",children:"Clear"})]})]}),c&&e.jsxs(i,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:[e.jsx(x,{variant:"subtitle2",gutterBottom:!0,children:"Filter Lanjutan"}),e.jsxs(i,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(i,{sx:{flex:"1 1 200px",minWidth:150},children:e.jsx(D,{fullWidth:!0,label:"Harga Minimum",type:"number",value:t.min_price||"",onChange:a=>u("min_price",a.target.value?Number(a.target.value):void 0),disabled:h,InputProps:{startAdornment:e.jsx(x,{sx:{mr:1},children:"Rp"})}})}),e.jsx(i,{sx:{flex:"1 1 200px",minWidth:150},children:e.jsx(D,{fullWidth:!0,label:"Harga Maksimum",type:"number",value:t.max_price||"",onChange:a=>u("max_price",a.target.value?Number(a.target.value):void 0),disabled:h,InputProps:{startAdornment:e.jsx(x,{sx:{mr:1},children:"Rp"})}})})]})]})]})}function Me(){const p=X(),{showNotification:k}=ee(),[h,I]=n.useState([]),[t,f]=n.useState([]),[c,m]=n.useState(!0),[g,b]=n.useState(null),[j,u]=n.useState(0),[y,r]=n.useState(10),[v,l]=n.useState(0),[a,_]=n.useState({}),T=async s=>{try{m(!0),b(null);const o=await B.getProducts({page:(j||0)+1,limit:y,...s});if(o.success)I(o.data),l(o.pagination?.total||0);else throw new Error("Failed to fetch products")}catch(o){b(o.message||"Gagal memuat data produk")}finally{m(!1)}},M=async()=>{try{const s=await te.getCategories();s.success&&f(s.data)}catch(s){console.error("Failed to fetch categories:",s)}};n.useEffect(()=>{T(a)},[j,y,a]),n.useEffect(()=>{M()},[]);const N=s=>{p(`/admin/products/${s.id}/edit`)},O=s=>{p(`/admin/products/${s.id}`)},V=async s=>{try{const o=await B.deleteProduct(s);if(o.success)k({type:"success",message:"Produk berhasil dihapus"}),await T(a);else throw new Error(o.message||"Failed to delete product")}catch(o){throw k({type:"error",message:o.message||"Gagal menghapus produk"}),o}},$=()=>{p("/admin/products/create")},K=()=>{p("/admin/products/deleted")},U=n.useCallback(s=>{_(s),u(0)},[]),G=(s,o)=>{u(o)},Z=s=>{r(parseInt(s.target.value,10)),u(0)};return c&&h.length===0?e.jsx(ae,{message:"Memuat data produk..."}):e.jsxs(re,{maxWidth:!1,children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(i,{children:[e.jsx(x,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Kelola Produk"}),e.jsx(x,{variant:"body1",color:"textSecondary",children:"Kelola produk dan inventori toko Anda"})]}),e.jsx(w,{variant:"contained",startIcon:e.jsx(fe,{}),onClick:$,size:"large",children:"Tambah Produk"})]}),g&&e.jsx(L,{severity:"error",sx:{mb:3},onClose:()=>b(null),children:g}),e.jsx(ye,{onFilterChange:U,categories:t,loading:c,initialFilters:a}),e.jsx(be,{products:h,isLoading:c,onEdit:N,onDelete:V,onView:O,onViewDeleted:K}),v>0&&e.jsx(ve,{rowsPerPageOptions:[5,10,25,50],component:"div",count:v,rowsPerPage:y,page:j,onPageChange:G,onRowsPerPageChange:Z,labelRowsPerPage:"Baris per halaman:",labelDisplayedRows:({from:s,to:o,count:E})=>`${s}-${o} dari ${E!==-1?E:`lebih dari ${o}`}`})]})}export{Me as default};
