import{p as $,a7 as Q,q as J,aj as V,r as i,j as r,B as s,C as b,ak as R,T as n,t as P,S as d,v as y,N as D}from"./index-CZFAEO2y.js";import{o as I}from"./orderApi-BZ9ScYhU.js";import{u as X}from"./orderStore-C_2rb-4t.js";import{u as Y}from"./useCurrencyConversion-BCvfb8ro.js";import{M as Z}from"./MidtransPaymentButton-jcc6emck.js";import{S as rr}from"./Skeleton-CfZ67nOg.js";import{A as c}from"./Alert-Dhgb7HXh.js";import{B as er}from"./Breadcrumbs-rukODYMy.js";import{H as ar}from"./Home-DOPYlfgE.js";import{O as nr}from"./Receipt-D4oLEU22.js";import{A as sr}from"./ArrowBack-DFlSZlgN.js";import{C as x,a as u}from"./CardContent-CEZafFSD.js";import{C as tr}from"./Cancel-63tQ3qzr.js";import{G as t}from"./Grid-CPtrRmh_.js";import{A as ir}from"./Avatar-BK2nAYkE.js";import"./useSlot-CExgq9at.js";function Cr(){$();const{id:m}=Q(),p=J();V();const{formatPrice:o,loading:B,error:O}=Y(),[z,f]=i.useState(!0),[j,l]=i.useState(null),[a,E]=i.useState(null),[v,k]=i.useState(!1),[C,S]=i.useState(null),[w,h]=i.useState(null),{setCurrentOrder:A}=X(),_=e=>new Date(e).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),N=e=>{switch(e){case"pending":return"warning";case"processing":return"primary";case"shipped":return"primary";case"delivered":return"success";case"cancelled":return"error";default:return"default"}},L=e=>{switch(e){case"pending":return"Menunggu Konfirmasi";case"processing":return"Sedang Diproses";case"shipped":return"Dikirim";case"delivered":return"Selesai";case"cancelled":return"Dibatalkan";default:return e}},F=e=>{switch(e){case"unpaid":return"error";case"paid":return"success";case"failed":return"error";case"refunded":return"warning";default:return"default"}},H=e=>{switch(e){case"unpaid":return"Belum Dibayar";case"paid":return"Sudah Dibayar";case"failed":return"Gagal Bayar";case"refunded":return"Dikembalikan";default:return e}},g=async()=>{if(m)try{f(!0),l(null);const e=await I.getOrderById(m);e.success?(E(e.data),A(e.data)):l("Pesanan tidak ditemukan")}catch(e){console.error("Error fetching order:",e),l(e.response?.data?.error||"Gagal memuat pesanan")}finally{f(!1)}},M=e=>{console.log("Payment successful:",e),S("Pembayaran berhasil! Status pesanan akan diperbarui."),h(null),g()},G=e=>{console.error("Payment error:",e),h(e),S(null)},T=async()=>{if(!(!a||!window.confirm("Apakah Anda yakin ingin membatalkan pesanan ini?")))try{k(!0),(await I.cancelOrder(a.id)).success&&await g()}catch(e){console.error("Error cancelling order:",e),l(e.response?.data?.error||"Gagal membatalkan pesanan")}finally{k(!1)}};if(i.useEffect(()=>{g()},[m]),z)return r.jsx(s,{sx:{minHeight:"100vh",py:4},children:r.jsx(b,{maxWidth:"xl",children:r.jsx(rr,{variant:"rectangular",height:400,sx:{borderRadius:3}})})});if(j||!a)return r.jsx(s,{sx:{minHeight:"100vh",py:4},children:r.jsx(b,{maxWidth:"xl",children:r.jsx(c,{severity:"error",sx:{maxWidth:600,mx:"auto"},children:j||"Pesanan tidak ditemukan"})})});const q=a.status==="pending";return r.jsx(s,{sx:{minHeight:"100vh",py:4},children:r.jsxs(b,{maxWidth:"xl",children:[r.jsxs(er,{sx:{mb:3},children:[r.jsxs(R,{component:"button",variant:"body2",onClick:()=>p("/"),sx:{display:"flex",alignItems:"center",textDecoration:"none",color:"text.secondary","&:hover":{color:"primary.main"}},children:[r.jsx(ar,{sx:{mr:.5,fontSize:"1rem"}}),"Beranda"]}),r.jsxs(R,{component:"button",variant:"body2",onClick:()=>p("/orders"),sx:{display:"flex",alignItems:"center",textDecoration:"none",color:"text.secondary","&:hover":{color:"primary.main"}},children:[r.jsx(nr,{sx:{mr:.5,fontSize:"1rem"}}),"Pesanan"]}),r.jsxs(n,{variant:"body2",color:"text.primary",children:["#",a.id.slice(-8).toUpperCase()]})]}),r.jsx(P,{startIcon:r.jsx(sr,{}),onClick:()=>p("/orders"),sx:{mb:3,borderRadius:2,fontWeight:500,color:"text.secondary","&:hover":{color:"primary.main",backgroundColor:"primary.light"}},children:"Kembali ke Daftar Pesanan"}),C&&r.jsx(c,{severity:"success",sx:{mb:3,borderRadius:2},children:C}),w&&r.jsx(c,{severity:"error",sx:{mb:3,borderRadius:2},onClose:()=>h(null),children:w}),B&&r.jsx(c,{severity:"info",sx:{mb:2,borderRadius:2},children:"Loading exchange rates..."}),O&&r.jsx(c,{severity:"warning",sx:{mb:2,borderRadius:2},children:"Failed to load exchange rates. Prices will be displayed in default currency."}),r.jsx(x,{sx:{mb:4,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:r.jsx(u,{sx:{p:3},children:r.jsxs(d,{direction:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:"flex-start",spacing:2,children:[r.jsxs(s,{children:[r.jsxs(n,{variant:"h4",fontWeight:600,sx:{mb:1,color:"text.primary"},children:["Order #",a.id.slice(-8).toUpperCase()]}),r.jsxs(n,{variant:"body1",color:"text.secondary",sx:{mb:2},children:["Dibuat pada ",_(a.created_at)]}),r.jsxs(d,{direction:"row",spacing:1,children:[r.jsx(y,{label:L(a.status),color:N(a.status),variant:"outlined",sx:{borderRadius:2}}),r.jsx(y,{label:H(a.payment_status),color:F(a.payment_status),variant:"outlined",sx:{borderRadius:2}})]})]}),q&&r.jsx(P,{variant:"outlined",startIcon:r.jsx(tr,{}),onClick:T,disabled:v,color:"error",sx:{borderRadius:2,fontWeight:500,"&:hover":{backgroundColor:"error.light"}},children:v?"Membatalkan...":"Batalkan Pesanan"})]})})}),r.jsxs(t,{container:!0,spacing:4,children:[r.jsxs(t,{item:!0,xs:12,lg:8,children:[r.jsx(x,{sx:{mb:4,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:r.jsxs(u,{sx:{p:3},children:[r.jsxs(n,{variant:"h6",fontWeight:600,sx:{mb:3,color:"text.primary"},children:["Item Pesanan (",a.order_items.length,")"]}),r.jsx(d,{spacing:2,children:a.order_items.map(e=>{const W=e.product_variant.product.product_images?.[0]?.image_name;return r.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:3,p:3,borderRadius:2,backgroundColor:"grey.50",border:"none",transition:"all 0.2s ease","&:hover":{backgroundColor:"grey.100"}},children:[r.jsx(s,{sx:{flexShrink:0},children:r.jsx(ir,{src:W?`/uploads/${W}`:`https://placehold.co/80x80/9682DB/FFFFFF/png?text=${encodeURIComponent(e.product_variant.product.name.substring(0,10))}`,alt:e.product_variant.product.name,sx:{width:80,height:80,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},variant:"rounded"})}),r.jsxs(s,{sx:{flex:1,minWidth:0},children:[r.jsx(n,{variant:"h6",fontWeight:600,sx:{mb:1,color:"text.primary",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.3,fontSize:"1rem"},title:e.product_variant.product.name,children:e.product_variant.product.name}),e.product_variant.variant_options&&e.product_variant.variant_options.length>0&&r.jsx(d,{direction:"row",spacing:.5,sx:{mb:1,flexWrap:"wrap"},children:e.product_variant.variant_options.map((K,U)=>r.jsx(y,{label:`${K.option_value}`,size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:20,borderColor:"primary.main",color:"primary.main","& .MuiChip-label":{px:1}}},U))}),r.jsxs(n,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:["Qty: ",e.quantity," Ã— ",o(Number(e.price))]})]}),r.jsxs(s,{sx:{textAlign:"right",minWidth:100},children:[r.jsx(n,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Total"}),r.jsx(n,{variant:"h6",color:"primary.main",fontWeight:700,sx:{fontSize:"1rem"},children:o(Number(e.price)*Number(e.quantity))})]})]},e.id)})})]})}),a.shipping&&r.jsx(x,{sx:{mb:4,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:r.jsxs(u,{sx:{p:3},children:[r.jsx(n,{variant:"h6",fontWeight:600,sx:{mb:3,color:"text.primary"},children:"Informasi Pengiriman"}),r.jsxs(t,{container:!0,spacing:2,children:[r.jsx(t,{item:!0,xs:12,sm:6,children:r.jsxs(s,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(n,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Kurir"}),r.jsx(n,{variant:"body1",fontWeight:600,children:a.shipping.courier})]})}),r.jsx(t,{item:!0,xs:12,sm:6,children:r.jsxs(s,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(n,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Status Pengiriman"}),r.jsx(n,{variant:"body1",fontWeight:600,children:a.shipping.shipping_status})]})}),a.shipping.tracking_number&&r.jsx(t,{item:!0,xs:12,sm:6,children:r.jsxs(s,{sx:{p:2,backgroundColor:"primary.light",borderRadius:2},children:[r.jsx(n,{variant:"subtitle2",color:"primary.dark",sx:{fontSize:"0.75rem",mb:.5},children:"Nomor Resi"}),r.jsx(n,{variant:"body1",fontWeight:600,color:"primary.main",children:a.shipping.tracking_number})]})}),a.shipping.estimated_delivery&&r.jsx(t,{item:!0,xs:12,sm:6,children:r.jsxs(s,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(n,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Estimasi Sampai"}),r.jsx(n,{variant:"body1",fontWeight:600,children:_(a.shipping.estimated_delivery)})]})})]})]})})]}),r.jsx(t,{item:!0,xs:12,lg:4,children:r.jsx(x,{sx:{position:"sticky",top:24,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:"none"},children:r.jsxs(u,{sx:{p:3},children:[r.jsx(n,{variant:"h6",fontWeight:600,sx:{mb:3,color:"text.primary"},children:"Ringkasan Pesanan"}),r.jsxs(d,{spacing:2,children:[r.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(n,{variant:"body1",fontWeight:500,children:"Subtotal"}),r.jsx(n,{variant:"body1",fontWeight:600,children:o(Number(a.total_amount))})]}),r.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(n,{variant:"body1",fontWeight:500,children:"Biaya Pengiriman"}),r.jsx(n,{variant:"body1",fontWeight:600,children:o(Number(a.shipping_cost))})]}),r.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"primary.main",borderRadius:2,color:"white"},children:[r.jsx(n,{variant:"h6",fontWeight:600,children:"Total"}),r.jsx(n,{variant:"h6",fontWeight:700,children:o(Number(a.total_amount)+Number(a.shipping_cost))})]})]}),r.jsx(D,{sx:{my:3}}),r.jsx(n,{variant:"subtitle1",fontWeight:600,sx:{mb:2,color:"text.primary"},children:"Alamat Pengiriman"}),r.jsxs(s,{sx:{p:2,borderRadius:2,backgroundColor:"grey.50"},children:[r.jsx(n,{variant:"body1",fontWeight:600,children:a.address.address_line}),r.jsxs(n,{variant:"body2",color:"text.secondary",children:[a.address.city,", ",a.address.province," ",a.address.postal_code]})]}),a.payment_status==="unpaid"&&a.status!=="cancelled"&&r.jsxs(r.Fragment,{children:[r.jsx(D,{sx:{my:3}}),r.jsx(Z,{order:a,onSuccess:M,onError:G,paymentMethod:"bank_transfer"})]})]})})})]})]})})}export{Cr as default};
