import{u as H,Q as K,a as T,aj as U,r as c,j as e,B as t,C as j,$ as I,a0 as N,T as n,b as f,S as i,e as u,R as q,D as y,Z as M}from"./index-BNHkdQXN.js";import{o as D}from"./orderApi-DClAlQUc.js";import{u as Q}from"./orderStore-DYwxBvNT.js";import{S as Z}from"./Skeleton-C7Iai6me.js";import{A as P}from"./Alert-CGwzUP-j.js";import{B as J}from"./Breadcrumbs-CE1cFXMC.js";import{O as V}from"./Receipt-DHsC4Of4.js";import{A as X}from"./ArrowBack-DVVDyWyV.js";import{C as d,a as l}from"./CardContent-Xxy-Rqsq.js";import{C as Y}from"./Cancel-DabKEnBc.js";import{G as s}from"./Grid-CafGNzNZ.js";function xe(){const m=H(),{id:p}=K(),x=T(),b=U(),[R,v]=c.useState(!0),[_,h]=c.useState(null),[a,B]=c.useState(null),[k,C]=c.useState(!1),{setCurrentOrder:O}=Q(),o=r=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(r),g=r=>new Date(r).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),A=r=>{switch(r){case"pending":return"warning";case"confirmed":return"info";case"shipped":return"primary";case"delivered":return"success";case"cancelled":return"error";default:return"default"}},F=r=>{switch(r){case"pending":return"Menunggu Konfirmasi";case"confirmed":return"Dikonfirmasi";case"shipped":return"Dikirim";case"delivered":return"Selesai";case"cancelled":return"Dibatalkan";default:return r}},W=r=>{switch(r){case"unpaid":return"error";case"paid":return"success";case"failed":return"error";case"refunded":return"warning";default:return"default"}},$=r=>{switch(r){case"unpaid":return"Belum Dibayar";case"paid":return"Sudah Dibayar";case"failed":return"Gagal Bayar";case"refunded":return"Dikembalikan";default:return r}},w=async()=>{if(p)try{v(!0),h(null);const r=await D.getOrderById(p);r.success?(B(r.data),O(r.data)):h("Pesanan tidak ditemukan")}catch(r){console.error("Error fetching order:",r),h(r.response?.data?.error||"Gagal memuat pesanan")}finally{v(!1)}},E=async()=>{if(!(!a||!window.confirm("Apakah Anda yakin ingin membatalkan pesanan ini?")))try{C(!0),(await D.cancelOrder(a.id)).success&&await w()}catch(r){console.error("Error cancelling order:",r),h(r.response?.data?.error||"Gagal membatalkan pesanan")}finally{C(!1)}};if(c.useEffect(()=>{w()},[p]),R)return e.jsx(t,{sx:{minHeight:"100vh",py:4},children:e.jsx(j,{maxWidth:"xl",children:e.jsx(Z,{variant:"rectangular",height:400,sx:{borderRadius:3}})})});if(_||!a)return e.jsx(t,{sx:{minHeight:"100vh",py:4},children:e.jsx(j,{maxWidth:"xl",children:e.jsx(P,{severity:"error",sx:{maxWidth:600,mx:"auto"},children:_||"Pesanan tidak ditemukan"})})});const z=a.status==="pending";return e.jsx(t,{sx:{minHeight:"100vh",py:4},children:e.jsxs(j,{maxWidth:"xl",children:[e.jsxs(J,{sx:{mb:4},children:[e.jsxs(I,{component:"button",variant:"body2",onClick:()=>x("/"),sx:{display:"flex",alignItems:"center",textDecoration:"none",color:"text.secondary","&:hover":{color:"primary.main"}},children:[e.jsx(N,{sx:{mr:.5,fontSize:"1rem"}}),"Beranda"]}),e.jsxs(I,{component:"button",variant:"body2",onClick:()=>x("/orders"),sx:{display:"flex",alignItems:"center",textDecoration:"none",color:"text.secondary","&:hover":{color:"primary.main"}},children:[e.jsx(V,{sx:{mr:.5,fontSize:"1rem"}}),"Pesanan"]}),e.jsxs(n,{variant:"body2",color:"text.primary",children:["#",a.id.slice(-8).toUpperCase()]})]}),e.jsx(f,{startIcon:e.jsx(X,{}),onClick:()=>x("/orders"),sx:{mb:4},children:"Kembali ke Daftar Pesanan"}),b.state?.message&&e.jsx(P,{severity:"success",sx:{mb:4},children:b.state.message}),e.jsx(d,{sx:{mb:4},children:e.jsx(l,{children:e.jsxs(i,{direction:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:"flex-start",spacing:2,children:[e.jsxs(t,{children:[e.jsxs(n,{variant:"h4",fontWeight:700,sx:{mb:1},children:["Order #",a.id.slice(-8).toUpperCase()]}),e.jsxs(n,{variant:"body1",color:"text.secondary",sx:{mb:2},children:["Dibuat pada ",g(a.created_at)]}),e.jsxs(i,{direction:"row",spacing:1,children:[e.jsx(u,{label:F(a.status),color:A(a.status),variant:"outlined"}),e.jsx(u,{label:$(a.payment_status),color:W(a.payment_status),variant:"outlined"})]})]}),z&&e.jsx(f,{variant:"outlined",startIcon:e.jsx(Y,{}),onClick:E,disabled:k,color:"error",sx:{borderRadius:2},children:k?"Membatalkan...":"Batalkan Pesanan"})]})})}),e.jsxs(s,{container:!0,spacing:4,children:[e.jsxs(s,{item:!0,xs:12,lg:8,children:[e.jsx(d,{sx:{mb:4},children:e.jsxs(l,{children:[e.jsxs(n,{variant:"h6",fontWeight:600,sx:{mb:3},children:["Item Pesanan (",a.order_items.length,")"]}),e.jsx(i,{spacing:3,children:a.order_items.map(r=>{const L=r.product_variant.product.product_images?.[0]?.image_name;return e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:3,p:3,borderRadius:2,backgroundColor:"#f8f9fa",border:`1px solid ${m.palette.grey[200]}`},children:[e.jsx(q,{src:L||`https://placehold.co/80x80/9682DB/FFFFFF/png?text=${encodeURIComponent(r.product_variant.product.name)}`,alt:r.product_variant.product.name,sx:{width:80,height:80,borderRadius:2,flexShrink:0},variant:"rounded"}),e.jsxs(t,{sx:{flex:1,minWidth:0},children:[e.jsx(n,{variant:"h6",fontWeight:600,sx:{mb:1},children:r.product_variant.product.name}),e.jsx(n,{variant:"subtitle1",color:"primary.main",fontWeight:600,sx:{mb:1},children:r.product_variant.variant_name}),e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["SKU: ",r.product_variant.sku]}),r.product_variant.variant_options&&r.product_variant.variant_options.length>0&&e.jsx(i,{direction:"row",spacing:1,sx:{mb:1,flexWrap:"wrap",gap:.5},children:r.product_variant.variant_options.map((S,G)=>e.jsx(u,{label:`${S.option_name}: ${S.option_value}`,size:"small",variant:"outlined",sx:{fontSize:"0.75rem"}},G))}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:["Qty: ",r.quantity," Ã— ",o(r.price)]})]}),e.jsx(n,{variant:"h6",color:"primary.main",fontWeight:700,children:o(r.price*r.quantity)})]},r.id)})})]})}),a.shipping&&e.jsx(d,{sx:{mb:4},children:e.jsxs(l,{children:[e.jsx(n,{variant:"h6",fontWeight:600,sx:{mb:3},children:"Informasi Pengiriman"}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(n,{variant:"subtitle2",color:"text.secondary",children:"Kurir"}),e.jsx(n,{variant:"body1",fontWeight:600,children:a.shipping.courier})]}),e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(n,{variant:"subtitle2",color:"text.secondary",children:"Status Pengiriman"}),e.jsx(n,{variant:"body1",fontWeight:600,children:a.shipping.shipping_status})]}),a.shipping.tracking_number&&e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(n,{variant:"subtitle2",color:"text.secondary",children:"Nomor Resi"}),e.jsx(n,{variant:"body1",fontWeight:600,color:"primary.main",children:a.shipping.tracking_number})]}),a.shipping.estimated_delivery&&e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(n,{variant:"subtitle2",color:"text.secondary",children:"Estimasi Sampai"}),e.jsx(n,{variant:"body1",fontWeight:600,children:g(a.shipping.estimated_delivery)})]})]})]})}),a.payments&&a.payments.length>0&&e.jsx(d,{children:e.jsxs(l,{children:[e.jsx(n,{variant:"h6",fontWeight:600,sx:{mb:3},children:"Riwayat Pembayaran"}),e.jsx(i,{spacing:2,children:a.payments.map(r=>e.jsx(t,{sx:{p:2,borderRadius:2,backgroundColor:"#f8f9fa",border:`1px solid ${m.palette.grey[200]}`},children:e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(t,{children:[e.jsx(n,{variant:"subtitle1",fontWeight:600,children:r.payment_method}),e.jsx(n,{variant:"body2",color:"text.secondary",children:g(r.payment_date)}),r.payment_reference&&e.jsxs(n,{variant:"body2",color:"text.secondary",children:["Ref: ",r.payment_reference]})]}),e.jsxs(t,{sx:{textAlign:"right"},children:[e.jsx(n,{variant:"h6",fontWeight:700,color:"primary.main",children:o(r.amount)}),e.jsx(u,{label:r.payment_status,color:W(r.payment_status),size:"small",variant:"outlined"})]})]})},r.id))})]})})]}),e.jsx(s,{item:!0,xs:12,lg:4,children:e.jsx(d,{sx:{position:"sticky",top:24},children:e.jsxs(l,{children:[e.jsx(n,{variant:"h6",fontWeight:600,sx:{mb:3},children:"Ringkasan Pesanan"}),e.jsxs(i,{spacing:2,children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(n,{variant:"body1",children:"Subtotal"}),e.jsx(n,{variant:"body1",fontWeight:600,children:o(a.total_amount)})]}),e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(n,{variant:"body1",children:"Biaya Pengiriman"}),e.jsx(n,{variant:"body1",fontWeight:600,children:o(a.shipping_cost)})]}),e.jsx(y,{}),e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(n,{variant:"h6",fontWeight:700,children:"Total"}),e.jsx(n,{variant:"h6",fontWeight:700,color:"primary.main",children:o(a.total_amount+a.shipping_cost)})]})]}),e.jsx(y,{sx:{my:3}}),e.jsx(n,{variant:"subtitle1",fontWeight:600,sx:{mb:2},children:"Alamat Pengiriman"}),e.jsxs(t,{sx:{p:2,borderRadius:2,backgroundColor:"#f8f9fa",border:`1px solid ${m.palette.grey[200]}`},children:[e.jsx(n,{variant:"body1",fontWeight:600,children:a.address.address_line}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:[a.address.city,", ",a.address.province," ",a.address.postal_code]})]}),a.payment_status==="unpaid"&&a.status!=="cancelled"&&e.jsxs(e.Fragment,{children:[e.jsx(y,{sx:{my:3}}),e.jsx(f,{variant:"contained",size:"large",startIcon:e.jsx(M,{}),onClick:()=>x(`/payment/${a.id}`),fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:600},children:"Bayar Sekarang"})]})]})})})]})]})})}export{xe as default};
