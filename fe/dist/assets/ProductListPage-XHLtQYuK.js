import{r as o,j as e,x as E,T as h,B as r,t as P,aD as J,v as p,I as S,D as F,W as Q,a3 as T,av as W,a4 as A,a5 as C,V as X,q as Y,aE as ee,ab as ae,C as re,z as te}from"./index-NjOUpROL.js";import{p as B}from"./productApi-DhVD_DaF.js";import{a as se}from"./image-DX-k4_re.js";import{D as ie}from"./RestoreFromTrash-CBlindRN.js";import{T as ne,a as le,b as oe,c as R,d as n,e as ce}from"./TableRow-CKHg7t_r.js";import{A as de}from"./Avatar-Biv38vKB.js";import{T as I}from"./Tooltip-BqxVikQj.js";import{V as he}from"./Visibility-D-R6GlmV.js";import{E as xe}from"./Edit-xMMHaww5.js";import{D as me}from"./Delete-Pt9chjFM.js";import{D as ue,a as ge,b as pe}from"./DialogTitle-B_i1_nQf.js";import{A as V}from"./Alert-B1gb4VHd.js";import{D as je}from"./DialogActions-B0inp8uh.js";import{F as fe}from"./FilterList-CF_87VVX.js";import{A as ve}from"./Add-nXatFD1z.js";import{T as be}from"./TablePagination-Bji2-Eg8.js";import"./useSlot-Cabyblz0.js";import"./Popper-5OroGEJm.js";import"./KeyboardArrowRight-C2Qmb_Qw.js";import"./LastPage-Sw0IO4Jp.js";function ye({products:m,isLoading:w=!1,onEdit:d,onDelete:_,onView:s,onViewDeleted:f}){const[c,u]=o.useState({open:!1,product:null,loading:!1}),g=a=>{u({open:!0,product:a,loading:!1})},k=async()=>{if(c.product){u(a=>({...a,loading:!0}));try{await _(c.product.id),u({open:!1,product:null,loading:!1})}catch{u(x=>({...x,loading:!1}))}}},v=()=>{u({open:!1,product:null,loading:!1})},b=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a),j=a=>a.product_images&&a.product_images.length>0?a.product_images.find(i=>i.is_primary)||a.product_images[0]:null;return m.length===0&&!w?e.jsxs(E,{sx:{p:4,textAlign:"center"},children:[e.jsx(h,{variant:"h6",color:"textSecondary",children:"Belum ada produk"}),e.jsx(h,{variant:"body2",color:"textSecondary",children:"Tambah produk pertama untuk mulai menjual"})]}):e.jsxs(e.Fragment,{children:[f&&e.jsx(r,{sx:{mb:2,display:"flex",justifyContent:"flex-end"},children:e.jsx(P,{variant:"outlined",startIcon:e.jsx(ie,{}),onClick:f,color:"secondary",children:"Lihat Produk Dihapus"})}),e.jsx(ne,{component:E,children:e.jsxs(le,{children:[e.jsx(oe,{children:e.jsxs(R,{children:[e.jsx(n,{children:"Gambar"}),e.jsx(n,{children:"Nama Produk"}),e.jsx(n,{children:"Kategori"}),e.jsx(n,{align:"right",children:"Harga"}),e.jsx(n,{align:"center",children:"Stok"}),e.jsx(n,{align:"center",children:"Pre-order"}),e.jsx(n,{align:"center",children:"Dimensi"}),e.jsx(n,{align:"center",children:"Info Varian"}),e.jsx(n,{align:"center",children:"Aksi"})]})}),e.jsx(ce,{children:m.map(a=>{const x=j(a);return e.jsxs(R,{hover:!0,children:[e.jsx(n,{children:e.jsx(de,{src:se(x?.image_name),variant:"rounded",sx:{width:56,height:56},children:e.jsx(J,{})})}),e.jsx(n,{children:e.jsxs(r,{children:[e.jsx(h,{variant:"subtitle2",fontWeight:"medium",gutterBottom:!0,children:a.name}),e.jsx(h,{variant:"body2",color:"textSecondary",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a.description||"-"})]})}),e.jsx(n,{children:e.jsx(p,{label:a.category?.name||"Tidak ada kategori",size:"small",color:"primary",variant:"outlined"})}),e.jsx(n,{align:"right",children:a.product_variants&&a.product_variants.length>0?e.jsx(r,{sx:{textAlign:"right"},children:e.jsxs(h,{variant:"body1",fontWeight:"medium",color:"primary",children:[b(Math.min(...a.product_variants.map(i=>parseFloat(i.price))))," - ",b(Math.max(...a.product_variants.map(i=>parseFloat(i.price))))]})}):e.jsx(h,{variant:"body1",fontWeight:"medium",children:b(parseFloat(a.price||"0"))})}),e.jsx(n,{align:"center",children:a.product_variants&&a.product_variants.length>0?e.jsx(r,{sx:{display:"flex",flexDirection:"column",gap:.5,alignItems:"center"},children:e.jsx(p,{label:`Total: ${a.product_variants.reduce((i,y)=>i+(y.stock||0),0)}`,size:"small",color:a.product_variants.reduce((i,y)=>i+(y.stock||0),0)>0?"success":"error",variant:a.product_variants.reduce((i,y)=>i+(y.stock||0),0)>0?"filled":"outlined"})}):e.jsx(p,{label:a.stock||0,size:"small",color:(a.stock||0)>0?"success":"error",variant:(a.stock||0)>0?"filled":"outlined"})}),e.jsx(n,{align:"center",children:e.jsx(p,{label:`${a.pre_order||0} hari`,size:"small",color:a.pre_order&&a.pre_order>0?"warning":"default",variant:a.pre_order&&a.pre_order>0?"filled":"outlined"})}),e.jsx(n,{align:"center",children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:.5,alignItems:"center"},children:[a.length&&a.width&&a.height?e.jsx(I,{title:`${a.length}×${a.width}×${a.height} cm`,children:e.jsx(p,{label:`${a.length}×${a.width}×${a.height}`,size:"small",color:"info",variant:"outlined",sx:{fontSize:"0.7rem"}})}):e.jsx(p,{label:"Belum diatur",size:"small",color:"default",variant:"outlined",sx:{fontSize:"0.7rem"}}),a.weight&&e.jsx(I,{title:`${a.weight} gram`,children:e.jsx(p,{label:`${a.weight}g`,size:"small",color:"secondary",variant:"outlined",sx:{fontSize:"0.7rem"}})})]})}),e.jsx(n,{align:"center",children:a.product_variants&&a.product_variants.length>0?e.jsx(r,{sx:{display:"flex",flexDirection:"column",gap:.5,alignItems:"center"},children:e.jsx(p,{label:`${a.product_variants.length} Varian`,size:"small",color:"primary",variant:"filled",sx:{fontWeight:"bold"}})}):e.jsx(p,{label:"Tidak Ada Varian",size:"small",color:"default",variant:"outlined",sx:{fontSize:"0.7rem"}})}),e.jsx(n,{align:"center",children:e.jsxs(r,{sx:{display:"flex",justifyContent:"center",gap:.5},children:[e.jsx(I,{title:"Lihat Detail",children:e.jsx(S,{size:"small",onClick:()=>s(a),color:"info",children:e.jsx(he,{fontSize:"small"})})}),e.jsx(I,{title:"Edit Produk",children:e.jsx(S,{size:"small",onClick:()=>d(a),color:"primary",children:e.jsx(xe,{fontSize:"small"})})}),e.jsx(I,{title:"Hapus Produk",children:e.jsx(S,{size:"small",onClick:()=>g(a),color:"error",children:e.jsx(me,{fontSize:"small"})})})]})})]},a.id)})})]})}),e.jsxs(ue,{open:c.open,onClose:v,maxWidth:"sm",fullWidth:!0,children:[e.jsx(ge,{children:"Hapus Produk"}),e.jsxs(pe,{children:[e.jsx(V,{severity:"warning",sx:{mb:2},children:e.jsxs(h,{variant:"body2",children:["Anda yakin ingin menghapus produk ",e.jsx("strong",{children:c.product?.name}),"?"]})}),e.jsx(h,{variant:"body2",sx:{mt:2},children:"Produk akan dihapus secara soft delete dan dapat dipulihkan nanti."})]}),e.jsxs(je,{children:[e.jsx(P,{onClick:v,disabled:c.loading,children:"Batal"}),e.jsx(P,{onClick:k,color:"error",variant:"contained",disabled:c.loading,children:c.loading?"Menghapus...":"Hapus"})]})]})]})}function ke({onFilterChange:m,categories:w=[],loading:d=!1,initialFilters:_}){const[s,f]=o.useState({search:"",category:"",min_price:void 0,max_price:void 0,sort:"created_at",sortOrder:"desc",..._}),[c,u]=o.useState(!1),g=(a,x)=>{const i={...s,[a]:x};f(i),a!=="search"&&m(i)},k=a=>{const x={...s,search:a};f(x);const i=setTimeout(()=>{m(x)},500);return()=>clearTimeout(i)},v=()=>{const a={search:"",category:"",min_price:void 0,max_price:void 0,sort:"created_at",sortOrder:"desc"};f(a),m(a)},j=(()=>{let a=0;return s.search&&a++,s.category&&a++,s.min_price&&a++,s.max_price&&a++,s.sort!=="created_at"&&a++,s.sortOrder!=="desc"&&a++,a})();return e.jsxs(r,{sx:{mb:3},children:[e.jsxs(r,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[e.jsx(r,{sx:{flex:"1 1 300px",minWidth:200},children:e.jsx(F,{fullWidth:!0,placeholder:"Cari produk...",value:s.search||"",onChange:a=>k(a.target.value),InputProps:{startAdornment:e.jsx(Q,{sx:{mr:1,color:"text.secondary"}})},disabled:d})}),e.jsx(r,{sx:{flex:"1 1 200px",minWidth:150},children:e.jsxs(T,{fullWidth:!0,disabled:d,children:[e.jsx(W,{children:"Kategori"}),e.jsxs(A,{value:s.category||"",onChange:a=>g("category",a.target.value),label:"Kategori",children:[e.jsx(C,{value:"",children:"Semua Kategori"}),w.map(a=>e.jsx(C,{value:a.id,children:a.name},a.id))]})]})}),e.jsx(r,{sx:{flex:"1 1 150px",minWidth:120},children:e.jsxs(T,{fullWidth:!0,disabled:d,children:[e.jsx(W,{children:"Urutkan"}),e.jsxs(A,{value:s.sort||"created_at",onChange:a=>g("sort",a.target.value),label:"Urutkan",children:[e.jsx(C,{value:"name",children:"Nama"}),e.jsx(C,{value:"price",children:"Harga"}),e.jsx(C,{value:"created_at",children:"Tanggal Dibuat"})]})]})}),e.jsx(r,{sx:{flex:"1 1 150px",minWidth:120},children:e.jsxs(T,{fullWidth:!0,disabled:d,children:[e.jsx(W,{children:"Urutan"}),e.jsxs(A,{value:s.sortOrder||"desc",onChange:a=>g("sortOrder",a.target.value),label:"Urutan",children:[e.jsx(C,{value:"asc",children:"A-Z / Terendah"}),e.jsx(C,{value:"desc",children:"Z-A / Tertinggi"})]})]})}),e.jsxs(r,{sx:{display:"flex",gap:1,flexShrink:0},children:[e.jsxs(P,{variant:"outlined",startIcon:e.jsx(fe,{}),onClick:()=>u(!c),disabled:d,children:["Filter",j>0&&e.jsx(p,{label:j,size:"small",color:"primary",sx:{ml:1,minWidth:20,height:20}})]}),j>0&&e.jsx(P,{variant:"outlined",startIcon:e.jsx(X,{}),onClick:v,disabled:d,color:"error",children:"Clear"})]})]}),c&&e.jsxs(r,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:[e.jsx(h,{variant:"subtitle2",gutterBottom:!0,children:"Filter Lanjutan"}),e.jsxs(r,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(r,{sx:{flex:"1 1 200px",minWidth:150},children:e.jsx(F,{fullWidth:!0,label:"Harga Minimum",type:"number",value:s.min_price||"",onChange:a=>g("min_price",a.target.value?Number(a.target.value):void 0),disabled:d,InputProps:{startAdornment:e.jsx(h,{sx:{mr:1},children:"Rp"})}})}),e.jsx(r,{sx:{flex:"1 1 200px",minWidth:150},children:e.jsx(F,{fullWidth:!0,label:"Harga Maksimum",type:"number",value:s.max_price||"",onChange:a=>g("max_price",a.target.value?Number(a.target.value):void 0),disabled:d,InputProps:{startAdornment:e.jsx(h,{sx:{mr:1},children:"Rp"})}})})]})]})]})}function Ne(){const m=Y(),{showNotification:w}=ee(),[d,_]=o.useState([]),[s,f]=o.useState([]),[c,u]=o.useState(!0),[g,k]=o.useState(null),[v,b]=o.useState(0),[j,a]=o.useState(10),[x,i]=o.useState(0),[y,H]=o.useState({}),D=o.useMemo(()=>y,[y]),z=async t=>{try{u(!0),k(null);const l=await B.getProducts({page:(v||0)+1,limit:j,...t});if(l.success)_(l.data),i(l.pagination?.total||0);else throw new Error("Failed to fetch products")}catch(l){k(l.message||"Gagal memuat data produk")}finally{u(!1)}},L=async()=>{try{const t=await te.getCategories();t.success&&f(t.data)}catch(t){console.error("Failed to fetch categories:",t)}};o.useEffect(()=>{z(D)},[v,j,D]),o.useEffect(()=>{L()},[]);const M=t=>{m(`/admin/products/${t.id}/edit`)},N=t=>{m(`/admin/products/${t.id}`)},O=async t=>{try{const l=await B.deleteProduct(t);if(l.success)w({type:"success",message:"Produk berhasil dihapus"}),await z(D);else throw new Error(l.message||"Failed to delete product")}catch(l){throw w({type:"error",message:l.message||"Gagal menghapus produk"}),l}},K=()=>{m("/admin/products/create")},U=()=>{m("/admin/products/deleted")},G=o.useCallback(t=>{H(t),b(0)},[]),Z=(t,l)=>{b(l)},q=t=>{a(parseInt(t.target.value,10)),b(0)};return c&&d.length===0?e.jsx(ae,{message:"Memuat data produk..."}):e.jsxs(re,{maxWidth:!1,children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(r,{children:[e.jsx(h,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Kelola Produk"}),e.jsx(h,{variant:"body1",color:"textSecondary",children:"Kelola produk dan inventori toko Anda"})]}),e.jsx(P,{variant:"contained",startIcon:e.jsx(ve,{}),onClick:K,size:"large",children:"Tambah Produk"})]}),g&&e.jsx(V,{severity:"error",sx:{mb:3},onClose:()=>k(null),children:g}),e.jsx(ke,{onFilterChange:G,categories:s,loading:c,initialFilters:D}),e.jsx(ye,{products:d,isLoading:c,onEdit:M,onDelete:O,onView:N,onViewDeleted:U}),x>0&&e.jsx(be,{rowsPerPageOptions:[5,10,25,50],component:"div",count:x,rowsPerPage:j,page:v,onPageChange:Z,onRowsPerPageChange:q,labelRowsPerPage:"Baris per halaman:",labelDisplayedRows:({from:t,to:l,count:$})=>`${t}-${l} dari ${$!==-1?$:`lebih dari ${l}`}`})]})}export{Ne as default};
