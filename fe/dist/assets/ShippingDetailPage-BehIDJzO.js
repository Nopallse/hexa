import{a8 as ae,q as te,aB as se,r as o,j as e,af as ie,C as O,t as m,am as U,T as t,B as d,I as D,J as F,w as b,ak as K,x as S,$ as M,a0 as y,a2 as C,E as I,a4 as ne,ay as oe,a5 as de,a6 as f}from"./index-aASFK1tJ.js";import{s as T}from"./shippingApi-CbctwEcz.js";import{u as le}from"./useCurrencyConversion-DlJ_RGo8.js";import{A}from"./Alert-CgLHgHYO.js";import{A as H}from"./ArrowBack-LBm-QOgJ.js";import{B as ce}from"./Breadcrumbs-Bs6AffS5.js";import{H as xe}from"./Home-DeLk4JvE.js";import{E as me}from"./Edit-C8FYPv4Q.js";import{G as s}from"./Grid-DFF2Am1R.js";import{C as v,a as k}from"./CardContent-CZ8AkO-X.js";import{T as q}from"./Tooltip-C8ajhJyt.js";import{O as J}from"./OpenInNew-LsKXiDXF.js";import{R as he}from"./Refresh-BTo0viWr.js";import{D as ue,a as pe,b as ge}from"./DialogTitle-fhJ-s9NB.js";import{D as je}from"./DialogActions-DXpXqY53.js";import"./Popper-t_rnaNgN.js";const be=l=>{switch(l){case"delivered":return"success";case"in_transit":return"info";case"pending":return"warning";default:return"default"}},ye=l=>{switch(l){case"delivered":return"Terkirim";case"in_transit":return"Dalam Perjalanan";case"pending":return"Menunggu Pengiriman";default:return l}};function ze(){const{id:l}=ae(),h=te(),{showNotification:$}=se(),{formatPrice:W}=le(),u=a=>new Date(a).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}),[r,Q]=o.useState(null),[V,N]=o.useState(!0),[p,c]=o.useState(null),[g,P]=o.useState(!1),[i,X]=o.useState(null),[E,_]=o.useState(null),[Y,j]=o.useState(!1),[B,L]=o.useState(!1),[n,x]=o.useState({courier:"",tracking_number:"",shipping_status:"",estimated_delivery:""}),z=async()=>{if(l)try{N(!0),c(null);const a=await T.getShippingDetail(l);a.success&&a.data?(Q(a.data),x({courier:a.data.courier||"",tracking_number:a.data.tracking_number||"",shipping_status:a.data.shipping_status||"",estimated_delivery:a.data.estimated_delivery?new Date(a.data.estimated_delivery).toISOString().split("T")[0]:""})):c(a.error||"Gagal memuat data pengiriman")}catch(a){c(a.response?.data?.error||"Gagal memuat data pengiriman")}finally{N(!1)}},w=o.useCallback(async()=>{if(r?.tracking_number){P(!0),_(null);try{const a=await T.getTrackingInfo(r.tracking_number,r.courier?.toLowerCase());a.success?X(a):_(a.error||"Gagal mendapatkan informasi tracking")}catch(a){_(a.response?.data?.error||"Gagal mendapatkan informasi tracking")}finally{P(!1)}}},[r?.tracking_number,r?.courier]),Z=(a,G)=>{const re=a?.toLowerCase();return{jne:"https://www.jne.co.id/id/tracking/tariff-and-service",jnt:"https://www.jet.co.id/track",sicepat:"https://www.sicepat.com/check-resi",pos:"https://www.posindonesia.co.id/tracking",anteraja:"https://anteraja.id/tracking",tiki:"https://tiki.id/tracking"}[re||""]||null},ee=async()=>{if(l)try{L(!0),c(null);const a=await T.updateShippingStatus(l,{courier:n.courier,tracking_number:n.tracking_number,shipping_status:n.shipping_status,estimated_delivery:n.estimated_delivery||void 0});a.success?($({type:"success",message:"Data pengiriman berhasil diperbarui"}),j(!1),await z()):c(a.error||"Gagal memperbarui data pengiriman")}catch(a){c(a.response?.data?.error||"Gagal memperbarui data pengiriman")}finally{L(!1)}};if(o.useEffect(()=>{z()},[l]),o.useEffect(()=>{r?.tracking_number&&!i&&!g&&w()},[r?.tracking_number,i,g,w]),V)return e.jsx(ie,{message:"Memuat data pengiriman..."});if(p&&!r)return e.jsxs(O,{maxWidth:"xl",sx:{py:4},children:[e.jsx(A,{severity:"error",sx:{mb:3},children:p}),e.jsx(m,{startIcon:e.jsx(H,{}),onClick:()=>h("/admin/shipping"),children:"Kembali ke Daftar Pengiriman"})]});if(!r)return null;const R=r.tracking_number?Z(r.courier,r.tracking_number):null;return e.jsxs(O,{maxWidth:"xl",sx:{py:4},children:[e.jsxs(ce,{sx:{mb:4},children:[e.jsxs(U,{component:"button",variant:"body2",onClick:()=>h("/admin"),sx:{display:"flex",alignItems:"center",gap:.5,color:"text.secondary",textDecoration:"none","&:hover":{color:"primary.main",textDecoration:"underline"}},children:[e.jsx(xe,{fontSize:"small"}),"Dashboard"]}),e.jsx(U,{component:"button",variant:"body2",onClick:()=>h("/admin/shipping"),sx:{color:"text.secondary",textDecoration:"none","&:hover":{color:"primary.main",textDecoration:"underline"}},children:"Pengiriman"}),e.jsx(t,{variant:"body2",color:"textPrimary",sx:{fontWeight:500},children:"Detail Pengiriman"})]}),e.jsxs(d,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(D,{onClick:()=>h("/admin/shipping"),sx:{mr:1},children:e.jsx(H,{})}),e.jsx(F,{sx:{fontSize:"2rem",color:"primary.main"}}),e.jsxs(d,{children:[e.jsx(t,{variant:"h4",fontWeight:700,color:"text.primary",children:"Detail Pengiriman"}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:["ID: ",r.id]})]})]}),e.jsx(m,{variant:"contained",startIcon:e.jsx(me,{}),onClick:()=>j(!0),sx:{borderRadius:2,px:3,py:1},children:"Edit"})]}),p&&e.jsx(A,{severity:"error",sx:{mb:3},children:p}),e.jsxs(s,{container:!0,spacing:3,children:[e.jsxs(s,{item:!0,xs:12,md:8,children:[e.jsx(v,{sx:{mb:3,borderRadius:3,boxShadow:"0 4px 16px rgba(150, 130, 219, 0.12)"},children:e.jsxs(k,{sx:{p:3},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:3},children:[e.jsx(F,{sx:{fontSize:"1.5rem",color:"primary.main"}}),e.jsx(t,{variant:"h6",fontWeight:600,children:"Informasi Pengiriman"})]}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Status"}),e.jsx(b,{label:ye(r.shipping_status),color:be(r.shipping_status),sx:{fontWeight:600}})]}),e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Kurir"}),e.jsx(t,{variant:"body1",fontWeight:500,children:r.courier||"N/A"})]}),e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Nomor Tracking"}),e.jsx(t,{variant:"body1",sx:{fontFamily:"monospace"},children:r.tracking_number||"Belum tersedia"})]}),e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Estimasi Pengiriman"}),e.jsx(t,{variant:"body1",children:r.estimated_delivery?u(new Date(r.estimated_delivery)):"Belum tersedia"})]}),r.shipped_at&&e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Tanggal Dikirim"}),e.jsx(t,{variant:"body1",children:u(new Date(r.shipped_at))})]}),r.delivered_at&&e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Tanggal Diterima"}),e.jsx(t,{variant:"body1",children:u(new Date(r.delivered_at))})]})]}),r.tracking_number&&e.jsxs(d,{sx:{mt:3,pt:3,borderTop:"1px solid rgba(150, 130, 219, 0.1)"},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(t,{variant:"h6",fontWeight:600,children:"Tracking"}),R&&e.jsx(q,{title:"Buka di website kurir",children:e.jsx(D,{size:"small",onClick:()=>window.open(R,"_blank"),children:e.jsx(J,{fontSize:"small"})})}),e.jsx(q,{title:"Refresh tracking",children:e.jsx(D,{size:"small",onClick:w,disabled:g,children:g?e.jsx(K,{size:20}):e.jsx(he,{fontSize:"small"})})})]}),E&&e.jsx(A,{severity:"error",sx:{mb:2},children:E}),i?.data?.data&&e.jsxs(d,{children:[e.jsxs(S,{sx:{p:2,mb:2,backgroundColor:"rgba(150, 130, 219, 0.05)"},children:[e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Waybill ID"}),e.jsx(t,{variant:"body1",fontWeight:500,sx:{fontFamily:"monospace"},children:i.data.data.waybill_id||"N/A"})]}),e.jsxs(S,{sx:{p:2,mb:2},children:[e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Status"}),e.jsx(b,{label:i.data.data.status||"N/A",color:"primary",size:"small"})]}),i.data.data.courier&&e.jsxs(S,{sx:{p:2,mb:2},children:[e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Kurir"}),e.jsxs(t,{variant:"body1",children:[i.data.data.courier.company||"N/A"," - ",i.data.data.courier.service_type||"N/A"]})]}),i.data.data.link&&e.jsx(d,{sx:{mb:2},children:e.jsx(m,{variant:"outlined",startIcon:e.jsx(J,{}),onClick:()=>window.open(i.data.data.link,"_blank"),fullWidth:!0,children:"Buka Tracking di Biteship"})}),i.data.data.history&&i.data.data.history.length>0&&e.jsxs(d,{children:[e.jsx(t,{variant:"body2",fontWeight:600,sx:{mb:1},children:"Riwayat Tracking"}),e.jsx(M,{children:i.data.data.history.map((a,G)=>e.jsxs(y,{sx:{flexDirection:"column",alignItems:"flex-start"},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(b,{label:a.status||"N/A",size:"small",color:"primary"}),e.jsx(t,{variant:"caption",color:"text.secondary",children:a.updated_at?u(new Date(a.updated_at)):"N/A"})]}),e.jsx(t,{variant:"body2",color:"text.secondary",children:a.note||"N/A"})]},G))})]})]})]})]})}),r.order&&e.jsx(v,{sx:{borderRadius:3,boxShadow:"0 4px 16px rgba(150, 130, 219, 0.12)"},children:e.jsxs(k,{sx:{p:3},children:[e.jsx(t,{variant:"h6",fontWeight:600,sx:{mb:2},children:"Informasi Order"}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Order ID"}),e.jsx(t,{variant:"body1",fontWeight:500,children:r.order.id})]}),e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Status Order"}),e.jsx(b,{label:r.order.status,size:"small",color:"primary"})]}),e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Total Amount"}),e.jsx(t,{variant:"body1",fontWeight:500,children:W(parseFloat(r.order.total_amount||0))})]}),e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Shipping Cost"}),e.jsx(t,{variant:"body1",fontWeight:500,children:W(parseFloat(r.order.shipping_cost||0))})]})]})]})})]}),e.jsxs(s,{item:!0,xs:12,md:4,children:[r.order?.user&&e.jsx(v,{sx:{mb:3,borderRadius:3,boxShadow:"0 4px 16px rgba(150, 130, 219, 0.12)"},children:e.jsxs(k,{sx:{p:3},children:[e.jsx(t,{variant:"h6",fontWeight:600,sx:{mb:2},children:"Informasi Customer"}),e.jsxs(M,{children:[e.jsx(y,{children:e.jsx(C,{primary:"Nama",secondary:r.order.user.full_name||"N/A"})}),e.jsx(y,{children:e.jsx(C,{primary:"Email",secondary:r.order.user.email||"N/A"})}),e.jsx(y,{children:e.jsx(C,{primary:"Telepon",secondary:r.order.user.phone||"N/A"})})]})]})}),r.order?.address&&e.jsx(v,{sx:{borderRadius:3,boxShadow:"0 4px 16px rgba(150, 130, 219, 0.12)"},children:e.jsxs(k,{sx:{p:3},children:[e.jsx(t,{variant:"h6",fontWeight:600,sx:{mb:2},children:"Alamat Pengiriman"}),e.jsx(t,{variant:"body2",sx:{mb:1},children:e.jsx("strong",{children:r.order.address.recipient_name||"N/A"})}),e.jsx(t,{variant:"body2",color:"text.secondary",children:r.order.address.address_line||"N/A"}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:[r.order.address.city||"N/A",", ",r.order.address.province||"N/A"," ",r.order.address.postal_code||"N/A"]})]})})]})]}),e.jsxs(ue,{open:Y,onClose:()=>j(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(pe,{children:"Edit Data Pengiriman"}),e.jsx(ge,{children:e.jsxs(d,{sx:{pt:2},children:[e.jsx(I,{fullWidth:!0,label:"Kurir",value:n.courier,onChange:a=>x({...n,courier:a.target.value}),sx:{mb:2}}),e.jsx(I,{fullWidth:!0,label:"Nomor Tracking",value:n.tracking_number,onChange:a=>x({...n,tracking_number:a.target.value}),sx:{mb:2}}),e.jsxs(ne,{fullWidth:!0,sx:{mb:2},children:[e.jsx(oe,{children:"Status"}),e.jsxs(de,{value:n.shipping_status,onChange:a=>x({...n,shipping_status:a.target.value}),label:"Status",children:[e.jsx(f,{value:"pending",children:"Menunggu Pengiriman"}),e.jsx(f,{value:"shipped",children:"Terkirim"}),e.jsx(f,{value:"in_transit",children:"Dalam Perjalanan"}),e.jsx(f,{value:"delivered",children:"Terkirim"})]})]}),e.jsx(I,{fullWidth:!0,label:"Estimasi Pengiriman",type:"date",value:n.estimated_delivery,onChange:a=>x({...n,estimated_delivery:a.target.value}),InputLabelProps:{shrink:!0}})]})}),e.jsxs(je,{children:[e.jsx(m,{onClick:()=>j(!1),children:"Batal"}),e.jsx(m,{onClick:ee,variant:"contained",disabled:B,children:B?e.jsx(K,{size:20}):"Simpan"})]})]})]})}export{ze as default};
