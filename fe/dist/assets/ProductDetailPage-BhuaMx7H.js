import{c as sr,j as r,p as nr,a8 as or,q as lr,r as c,a9 as cr,K as dr,B as a,C as A,t as B,T as s,A as V,w as d,N as u,aa as hr,ab as xr,E as mr,S as F,ac as pr,I as U,ad as f}from"./index-5OgQjLSC.js";import{p as ur}from"./productApi-hC1jLO6I.js";import{a as D}from"./image-CeHRN-zl.js";import{u as gr}from"./useCurrencyConversion-Qw05_SY9.js";import{S as p}from"./Skeleton-DryWEUlh.js";import{A as q}from"./Alert-3VKlMIM5.js";import{A as br}from"./ArrowBack-DeUH9sAc.js";import{C as v,a as y}from"./CardContent-ngkvzqv4.js";import{F as jr}from"./Favorite-JH49jxhq.js";const fr=sr(r.jsx("path",{d:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92"}),"Share");function Vr(){const h=nr(),{id:_}=or(),E=lr(),{formatPrice:k,formatPriceRange:N}=gr(),[t,J]=c.useState(null),[Q,z]=c.useState(!0),[$,S]=c.useState(null),[g,x]=c.useState(null),[vr,yr]=c.useState(0),[L,G]=c.useState(1),[n,C]=c.useState(null),[H,W]=c.useState({}),[M,w]=c.useState(!1),{addItem:X,isLoading:_r,error:kr}=cr(),{user:Y}=dr(),Z=async()=>{if(_)try{z(!0),S(null);const e=await ur.getProductById(_);e.success?J(e.data):S("Produk tidak ditemukan")}catch(e){console.error("Error fetching product:",e),S("Gagal memuat produk")}finally{z(!1)}},rr=async()=>{if(!t||!Y){E("/login");return}const e=t.product_variants&&t.product_variants.length>0;if(e&&t.product_variants&&t.product_variants.length>1&&!n){f.error("Pilih varian terlebih dahulu",{duration:3e3,position:"bottom-right"});return}try{w(!0);let i;if(e&&t.product_variants)if(t.product_variants.length===1)i=t.product_variants[0].id;else{if(!n){w(!1),f.error("Pilih varian terlebih dahulu",{duration:3e3,position:"bottom-right"});return}i=n.id}else i=t.id;await X({product_variant_id:i,quantity:L}),f.success("Item berhasil ditambahkan ke keranjang!",{duration:3e3,position:"bottom-right",icon:"ðŸ›’"}),G(1)}catch(i){console.error("Error adding to cart:",i),f.error(i.response?.data?.error||"Gagal menambahkan item ke keranjang",{duration:4e3,position:"bottom-right"})}finally{w(!1)}},tr=()=>{t&&console.log("Add to wishlist:",t)},er=()=>{t&&console.log("Share:",t)};c.useEffect(()=>{if(t){const e=I(t);if(x(e?e.image_name:null),C(null),W({}),t.product_variants&&t.product_variants.length===1){const i=t.product_variants[0];C(i);const o={};i.variant_options?.forEach(l=>{o[l.option_name]=l.option_value}),W(o),i.image?x(i.image):i.display_image&&x(i.display_image)}}},[t]);const ar=()=>{if(!t?.product_variants)return{};const e={};return t.product_variants.forEach(i=>{i.variant_options?.forEach(o=>{e[o.option_name]||(e[o.option_name]=[]),e[o.option_name].includes(o.option_value)||e[o.option_name].push(o.option_value)})}),e},ir=(e,i)=>{const o={...H,[e]:i};W(o);const l=t?.product_variants?.find(j=>j.variant_options?.every(O=>o[O.option_name]===O.option_value));if(l){if(C(l),l.image)x(l.image);else if(l.display_image)x(l.display_image);else if(t){const j=I(t);x(j?j.image_name:null)}}},I=e=>e.product_images&&e.product_images.length>0?e.product_images.find(o=>o.is_primary)||e.product_images[0]:null;if(c.useEffect(()=>{Z()},[_]),Q)return r.jsx(a,{sx:{minHeight:"100vh",py:4},children:r.jsxs(A,{maxWidth:!1,children:[r.jsx(p,{variant:"rectangular",height:400,sx:{mb:4,borderRadius:3}}),r.jsxs(a,{sx:{display:"flex",gap:4},children:[r.jsxs(a,{sx:{flex:1},children:[r.jsx(p,{variant:"text",height:48,sx:{mb:2}}),r.jsx(p,{variant:"text",height:24,sx:{mb:2}}),r.jsx(p,{variant:"text",height:32,sx:{mb:4}}),r.jsx(p,{variant:"rectangular",height:200})]}),r.jsx(a,{sx:{width:300},children:r.jsx(p,{variant:"rectangular",height:300,sx:{borderRadius:3}})})]})]})});if($||!t)return r.jsx(a,{sx:{minHeight:"100vh",py:4},children:r.jsx(A,{maxWidth:!1,children:r.jsx(q,{severity:"error",sx:{maxWidth:600,mx:"auto"},children:$||"Produk tidak ditemukan"})})});const m=t.product_variants&&t.product_variants.length>0,P=m&&t.product_variants&&t.product_variants.length>1,b=I(t),R=g||(b?b.image_name:null),K=ar(),T=m?t.product_variants.reduce((e,i)=>e+i.stock,0):t.stock;return r.jsx(a,{sx:{minHeight:"100vh",py:4},children:r.jsxs(A,{maxWidth:"xl",children:[r.jsx(B,{startIcon:r.jsx(br,{}),onClick:()=>E(-1),sx:{mb:4},children:"Kembali"}),r.jsxs(a,{sx:{display:"flex",gap:3,flexWrap:"wrap"},children:[r.jsx(a,{sx:{flex:"1 1 300px",minWidth:300},children:r.jsx(v,{children:r.jsxs(y,{children:[r.jsx(s,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Galeri Gambar"}),R?r.jsx(a,{sx:{textAlign:"center",mb:2},children:r.jsx(V,{src:D(R),variant:"rounded",sx:{width:"100%",height:300,transition:"all 0.3s ease",boxShadow:2}})}):r.jsx(a,{sx:{textAlign:"center",mb:2},children:r.jsx(V,{variant:"rounded",sx:{width:"100%",height:300},children:t.name.charAt(0).toUpperCase()})}),t.product_images&&t.product_images.length>0?r.jsxs(a,{children:[r.jsxs(s,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:["Semua Gambar (",t.product_images.length,")"]}),r.jsx(a,{sx:{display:"flex",gap:1,flexWrap:"wrap",justifyContent:"center"},children:t.product_images.sort((e,i)=>(i.is_primary?1:0)-(e.is_primary?1:0)).map(e=>r.jsxs(a,{sx:{position:"relative"},onMouseEnter:()=>x(e.image_name),onMouseLeave:()=>x(b?b.image_name:null),children:[r.jsx(V,{src:D(e.image_name),variant:"rounded",sx:{width:70,height:70,cursor:"pointer",border:g===e.image_name?3:2,borderColor:g===e.image_name?"primary.main":"divider",transition:"all 0.2s ease",opacity:g===e.image_name?1:.7,"&:hover":{opacity:1,transform:"scale(1.05)",borderColor:"primary.main"}}}),e.is_primary&&r.jsx(d,{label:"Utama",size:"small",color:"primary",sx:{position:"absolute",bottom:-8,left:"50%",transform:"translateX(-50%)",fontSize:"0.65rem",height:16,"& .MuiChip-label":{px:.5}}})]},e.id))})]}):r.jsx(q,{severity:"info",sx:{mt:2},children:"Belum ada gambar produk"})]})})}),r.jsx(a,{sx:{flex:"2 1 500px",minWidth:500},children:r.jsx(v,{children:r.jsxs(y,{children:[r.jsxs(a,{sx:{mb:3},children:[r.jsx(s,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:t.name}),t.product_variants&&t.product_variants.length>0?r.jsxs(a,{children:[r.jsx(s,{variant:"h4",color:"primary",fontWeight:"bold",children:N(t.product_variants)}),r.jsxs(s,{variant:"body2",color:"textSecondary",children:["Total Stok: ",t.total_stock||0," unit"]})]}):r.jsx(s,{variant:"h4",color:"primary",fontWeight:"bold",children:k(Number(t.price))})]}),r.jsx(u,{sx:{mb:3}}),r.jsxs(a,{sx:{mb:3},children:[r.jsx(s,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Deskripsi"}),r.jsx(s,{variant:"body1",color:"textSecondary",children:t.description||"Tidak ada deskripsi"})]}),r.jsx(u,{sx:{mb:3}}),r.jsxs(a,{sx:{mb:3},children:[r.jsx(s,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Kategori"}),t.category?r.jsxs(a,{children:[r.jsx(d,{label:t.category.name,color:"primary",variant:"outlined",sx:{mb:1}}),t.category.description&&r.jsx(s,{variant:"body2",color:"textSecondary",children:t.category.description})]}):r.jsx(s,{variant:"body2",color:"textSecondary",children:"Tidak ada kategori"})]}),r.jsx(u,{sx:{mb:3}}),r.jsxs(a,{sx:{mb:3},children:[r.jsx(s,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Informasi Produksi"}),r.jsxs(a,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[t.pre_order&&t.pre_order>0?r.jsx(d,{label:`Pre-order ${t.pre_order} hari`,color:"warning",variant:"filled",sx:{fontWeight:"bold"}}):r.jsx(d,{label:"Tersedia Langsung",color:"success",variant:"filled",sx:{fontWeight:"bold"}}),t.product_variants&&t.product_variants.length>0?r.jsx(d,{label:`Total Stok: ${t.total_stock||0} unit`,color:(t.total_stock||0)>0?"success":"error",variant:(t.total_stock||0)>0?"filled":"outlined"}):r.jsx(d,{label:`Stok: ${t.stock||0} unit`,color:(t.stock||0)>0?"success":"error",variant:(t.stock||0)>0?"filled":"outlined"})]}),r.jsx(s,{variant:"body2",color:"textSecondary",sx:{mt:1},children:t.pre_order&&t.pre_order>0?`Produk ini membutuhkan ${t.pre_order} hari untuk dibuat setelah order`:"Produk tersedia langsung dan siap dikirim"})]}),P&&Object.keys(K).length>0&&r.jsxs(hr.Fragment,{children:[r.jsx(u,{sx:{mb:3}}),r.jsxs(a,{sx:{mb:3},children:[r.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[r.jsx(s,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Pilih Varian"}),t.product_variants&&t.product_variants.length>0?r.jsx(d,{label:`${t.product_variants.length} Varian`,color:"primary",size:"small",variant:"filled",sx:{fontWeight:"bold",bgcolor:"primary.main",color:"white",border:"1px solid",borderColor:"primary.dark",letterSpacing:.5}}):r.jsx(d,{label:`Stok: ${t.stock||0}`,color:(t.stock||0)>0?"success":"error",size:"small",variant:(t.stock||0)>0?"filled":"outlined"})]}),Object.entries(K).map(([e,i])=>r.jsxs(a,{sx:{mb:2},children:[r.jsx(s,{variant:"subtitle2",fontWeight:"bold",gutterBottom:!0,children:e}),r.jsx(a,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:i.map(o=>{const l=H[e]===o;return r.jsxs(B,{variant:l?"contained":"outlined",onClick:()=>ir(e,o),size:"large",sx:{minWidth:80,borderWidth:2,borderColor:l?"primary.main":"divider",position:"relative",textTransform:"none","&:hover":{borderWidth:2,borderColor:"primary.main"}},children:[r.jsx(s,{variant:"body2",fontWeight:l?"bold":"medium",children:o}),l&&r.jsx(a,{sx:{position:"absolute",top:4,right:4,width:16,height:16,bgcolor:"white",color:"primary.main",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold"},children:"âœ“"})]},o)})})]},e)),n&&r.jsx(v,{variant:"outlined",sx:{mb:3,bgcolor:"primary.50",borderColor:"primary.main"},children:r.jsx(y,{children:r.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[r.jsxs(a,{children:[r.jsx(s,{variant:"caption",color:"text.secondary",display:"block",children:"Varian Terpilih"}),r.jsx(s,{variant:"h6",fontWeight:"bold",children:n.variant_name}),r.jsxs(s,{variant:"caption",color:"text.secondary",children:["SKU: ",n.sku]})]}),r.jsxs(a,{sx:{textAlign:"right"},children:[r.jsx(s,{variant:"h4",color:"primary.main",fontWeight:"bold",children:k(Number(n.price))}),r.jsx(d,{label:`Stok: ${n.stock} unit`,size:"small",color:n.stock>0?"success":"error",sx:{mt:.5}})]})]})})}),r.jsx(u,{sx:{mb:3}})]})]}),m&&t.product_variants&&t.product_variants.length===1&&n&&r.jsx(a,{sx:{mb:3},children:r.jsx(v,{variant:"outlined",sx:{bgcolor:"primary.50",borderColor:"primary.main"},children:r.jsx(y,{children:r.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[r.jsxs(a,{children:[r.jsx(s,{variant:"caption",color:"text.secondary",display:"block",children:"Varian Tersedia"}),r.jsx(s,{variant:"h6",fontWeight:"bold",children:n.variant_name}),r.jsxs(s,{variant:"caption",color:"text.secondary",children:["SKU: ",n.sku]})]}),r.jsxs(a,{sx:{textAlign:"right"},children:[r.jsx(s,{variant:"h4",color:"primary.main",fontWeight:"bold",children:k(Number(n.price))}),r.jsx(d,{label:`Stok: ${n.stock} unit`,size:"small",color:n.stock>0?"success":"error",sx:{mt:.5}})]})]})})})}),r.jsxs(a,{sx:{mb:4},children:[r.jsx(xr,{component:"legend",sx:{mb:1,fontWeight:600},children:"Jumlah:"}),r.jsx(mr,{type:"number",value:L,onChange:e=>G(Math.max(1,parseInt(e.target.value)||1)),inputProps:{min:1,max:m&&t.product_variants?t.product_variants.length===1?t.product_variants[0].stock||1:n&&n.stock||1:T},sx:{width:120},size:"small"})]}),r.jsxs(F,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:4},children:[r.jsx(B,{variant:"contained",size:"large",startIcon:r.jsx(pr,{}),onClick:rr,disabled:(T||0)===0||M||P&&!n||m&&n&&n.stock===0||m&&t.product_variants&&t.product_variants.length===1&&t.product_variants[0].stock===0,sx:{px:4,py:1.5,borderRadius:2,fontWeight:600,fontSize:"1rem",minHeight:48,flex:{xs:1,sm:"none"}},children:M?"Menambahkan...":(T||0)===0?"Stok Habis":P&&!n?"Pilih Varian":m&&n&&n.stock===0||m&&t.product_variants&&t.product_variants.length===1&&t.product_variants[0].stock===0?"Stok Habis":"Tambah ke Keranjang"}),r.jsxs(F,{direction:"row",spacing:1,sx:{justifyContent:{xs:"center",sm:"flex-start"}},children:[r.jsx(U,{onClick:tr,sx:{border:`1px solid ${h.palette.grey[300]}`,color:h.palette.primary.main,width:48,height:48,"&:hover":{backgroundColor:h.palette.primary.light+"20",borderColor:h.palette.primary.main}},children:r.jsx(jr,{})}),r.jsx(U,{onClick:er,sx:{border:`1px solid ${h.palette.grey[300]}`,color:h.palette.primary.main,width:48,height:48,"&:hover":{backgroundColor:h.palette.primary.light+"20",borderColor:h.palette.primary.main}},children:r.jsx(fr,{})})]})]})]})})})]})]})})}export{Vr as default};
