import{p as Y,a8 as Z,q as rr,aB as er,r as o,j as r,af as ar,C as N,t as g,am as O,T as i,S as l,B as s,w as y,a4 as ir,ay as tr,a5 as sr,a6 as d,ak as U,A as nr,J as or,I as E,N as dr}from"./index-5OgQjLSC.js";import{a as F}from"./orderApi-B9d10Yor.js";import{o as cr}from"./orderApi-CXXlxqDJ.js";import{u as lr}from"./useCurrencyConversion-Qw05_SY9.js";import{A as D}from"./Alert-3VKlMIM5.js";import{A as G}from"./ArrowBack-DeUH9sAc.js";import{B as xr}from"./Breadcrumbs-BUuzPEEd.js";import{H as ur}from"./Home-B7dig0Y_.js";import{O as mr}from"./Receipt-CtT2-Uer.js";import{C as j,a as f}from"./CardContent-ngkvzqv4.js";import{S as pr}from"./Save-BeCXx6oC.js";import{G as n}from"./Grid-DC0V799Y.js";import{T as K}from"./Tooltip-CoK2AUtP.js";import{O as hr}from"./OpenInNew-w_kMkyuF.js";import{R as br}from"./Refresh-Byc4XcDD.js";import"./Popper-C_GdxfKp.js";function Pr(){Y();const{id:k}=Z(),m=rr(),{formatPrice:u}=lr(),{showNotification:R}=er(),[M,v]=o.useState(!0),[p,I]=o.useState(!1),[z,w]=o.useState(null),[a,q]=o.useState(null),[x,C]=o.useState(""),[h,B]=o.useState(!1),[t,H]=o.useState(null),[P,b]=o.useState(null),S=e=>new Date(e).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),$=e=>{switch(e){case"belum_bayar":return"warning";case"dikemas":return"primary";case"dikirim":return"info";case"diterima":return"success";case"dibatalkan":return"error";default:return"default"}},J=e=>{switch(e){case"belum_bayar":return"Belum Bayar";case"dikemas":return"Dikemas";case"dikirim":return"Dikirim";case"diterima":return"Diterima";case"dibatalkan":return"Dibatalkan";default:return e}},Q=e=>{switch(e){case"unpaid":return"error";case"paid":return"success";case"failed":return"error";case"refunded":return"warning";default:return"default"}},V=e=>{switch(e){case"unpaid":return"Belum Dibayar";case"paid":return"Sudah Dibayar";case"failed":return"Gagal Bayar";case"refunded":return"Dikembalikan";default:return e}},_=o.useCallback(async()=>{if(a?.shipping?.tracking_number){B(!0),b(null);try{const e=await cr.trackShipment(a.shipping.tracking_number,a.shipping.courier?.toLowerCase());e.success?H(e):b(e.error||"Gagal mendapatkan informasi tracking")}catch(e){b(e.response?.data?.error||"Gagal mendapatkan informasi tracking")}finally{B(!1)}}},[a?.shipping?.tracking_number,a?.shipping?.courier]),T=(e,c)=>{const W=e.toLowerCase();return{jne:"https://www.jne.co.id/id/tracking/tariff-and-service",jnt:"https://www.jet.co.id/track",sicepat:"https://www.sicepat.com/check-resi",pos:"https://www.posindonesia.co.id/tracking",anteraja:"https://anteraja.id/tracking",ninja:"https://www.ninjaxpress.co.id/tracking",lion:"https://lionparcel.com/tracking",ide:"https://idexpress.com/tracking"}[W]||null},A=async()=>{if(!k){w("ID pesanan tidak valid"),v(!1);return}try{v(!0),w(null);const e=await F.getOrderById(k);if(e.success){const c=e.data;q(c),C(c.status)}else throw new Error("Failed to fetch order")}catch(e){w(e.response?.data?.error||e.message||"Gagal memuat data pesanan")}finally{v(!1)}};o.useEffect(()=>{A()},[k]),o.useEffect(()=>{a&&C(a.status)},[a]),o.useEffect(()=>{a?.shipping?.tracking_number&&!t&&!h&&_()},[a?.shipping?.tracking_number,t,h,_]);const X=async()=>{if(!(!a||!x||x===a.status))try{I(!0);const e=await F.updateOrderStatus(a.id,x);if(e.success)R({type:"success",message:"Status pesanan berhasil diperbarui"}),A();else throw new Error(e.error||"Failed to update order status")}catch(e){R({type:"error",message:e.response?.data?.error||e.message||"Gagal memperbarui status pesanan"})}finally{I(!1)}};return M?r.jsx(ar,{message:"Memuat data pesanan..."}):z||!a?r.jsxs(N,{maxWidth:"xl",sx:{py:4},children:[r.jsx(D,{severity:"error",children:z||"Pesanan tidak ditemukan"}),r.jsx(g,{startIcon:r.jsx(G,{}),onClick:()=>m("/admin/orders"),sx:{mt:2},children:"Kembali ke Daftar Pesanan"})]}):r.jsxs(N,{maxWidth:"xl",sx:{py:4},children:[r.jsxs(xr,{sx:{mb:3},children:[r.jsxs(O,{component:"button",variant:"body2",onClick:()=>m("/admin"),sx:{display:"flex",alignItems:"center",textDecoration:"none",color:"text.secondary","&:hover":{color:"primary.main"}},children:[r.jsx(ur,{sx:{mr:.5,fontSize:"1rem"}}),"Dashboard"]}),r.jsxs(O,{component:"button",variant:"body2",onClick:()=>m("/admin/orders"),sx:{display:"flex",alignItems:"center",textDecoration:"none",color:"text.secondary","&:hover":{color:"primary.main"}},children:[r.jsx(mr,{sx:{mr:.5,fontSize:"1rem"}}),"Pesanan"]}),r.jsxs(i,{variant:"body2",color:"text.primary",children:["#",a.id.slice(-8).toUpperCase()]})]}),r.jsx(g,{startIcon:r.jsx(G,{}),onClick:()=>m("/admin/orders"),sx:{mb:3,borderRadius:2,fontWeight:500,color:"text.secondary","&:hover":{color:"primary.main",backgroundColor:"primary.light"}},children:"Kembali ke Daftar Pesanan"}),r.jsx(j,{sx:{mb:4,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:r.jsx(f,{sx:{p:3},children:r.jsxs(l,{direction:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:"flex-start",spacing:2,children:[r.jsxs(s,{children:[r.jsxs(i,{variant:"h4",fontWeight:600,sx:{mb:1,color:"text.primary"},children:["Order #",a.id.slice(-8).toUpperCase()]}),r.jsxs(i,{variant:"body1",color:"text.secondary",sx:{mb:2},children:["Dibuat pada ",S(a.created_at)]}),r.jsxs(l,{direction:"row",spacing:1,sx:{mb:2},children:[r.jsx(y,{label:J(a.status),color:$(a.status),variant:"outlined",sx:{borderRadius:2}}),r.jsx(y,{label:V(a.payment_status),color:Q(a.payment_status),variant:"outlined",sx:{borderRadius:2}})]}),a.user&&r.jsxs(s,{sx:{mt:2},children:[r.jsx(i,{variant:"subtitle2",color:"text.secondary",sx:{mb:.5},children:"Pelanggan"}),r.jsx(i,{variant:"body1",fontWeight:500,children:a.user.full_name}),r.jsx(i,{variant:"body2",color:"text.secondary",children:a.user.email}),a.user.phone&&r.jsx(i,{variant:"body2",color:"text.secondary",children:a.user.phone})]})]}),r.jsxs(s,{sx:{minWidth:200},children:[r.jsxs(ir,{fullWidth:!0,size:"small",sx:{mb:2},children:[r.jsx(tr,{children:"Status Pesanan"}),r.jsxs(sr,{value:x,onChange:e=>C(e.target.value),label:"Status Pesanan",disabled:p,children:[a.status==="belum_bayar"&&[r.jsx(d,{value:"belum_bayar",disabled:!0,children:"Belum Bayar (Current)"},"belum_bayar"),r.jsx(d,{value:"dikemas",children:"Dikemas"},"dikemas"),r.jsx(d,{value:"dibatalkan",children:"Dibatalkan"},"dibatalkan")],a.status==="dikemas"&&[r.jsx(d,{value:"dikemas",disabled:!0,children:"Dikemas (Current)"},"dikemas"),r.jsx(d,{value:"dikirim",children:"Dikirim (Create Waybill)"},"dikirim"),r.jsx(d,{value:"dibatalkan",children:"Dibatalkan"},"dibatalkan")],a.status==="dikirim"&&[r.jsx(d,{value:"dikirim",disabled:!0,children:"Dikirim (Current)"},"dikirim"),r.jsx(d,{value:"diterima",children:"Diterima"},"diterima")],a.status==="diterima"&&r.jsx(d,{value:"diterima",disabled:!0,children:"Diterima (Final)"}),a.status==="dibatalkan"&&r.jsx(d,{value:"dibatalkan",disabled:!0,children:"Dibatalkan (Final)"})]})]}),r.jsx(g,{fullWidth:!0,variant:"contained",startIcon:p?r.jsx(U,{size:16}):r.jsx(pr,{}),onClick:X,disabled:p||x===a.status,sx:{borderRadius:2},children:p?"Menyimpan...":a.status==="dikemas"&&x==="dikirim"?"Kirim (Create Waybill)":"Simpan Status"}),a.status==="dikemas"&&x==="dikirim"&&r.jsx(i,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"Akan membuat waybill di Biteship"})]})]})})}),r.jsxs(n,{container:!0,spacing:4,children:[r.jsxs(n,{item:!0,xs:12,lg:8,children:[r.jsx(j,{sx:{mb:4,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:r.jsxs(f,{sx:{p:3},children:[r.jsxs(i,{variant:"h6",fontWeight:600,sx:{mb:3,color:"text.primary"},children:["Item Pesanan (",a.order_items.length,")"]}),r.jsx(l,{spacing:2,children:a.order_items.map(e=>{const c=e.product_variant.product.product_images?.[0]?.image_name;return r.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:3,p:3,borderRadius:2,backgroundColor:"grey.50",border:"none",transition:"all 0.2s ease","&:hover":{backgroundColor:"grey.100"}},children:[r.jsx(s,{sx:{flexShrink:0},children:r.jsx(nr,{src:c?`/uploads/${c}`:`https://placehold.co/80x80/9682DB/FFFFFF/png?text=${encodeURIComponent(e.product_variant.product.name.substring(0,10))}`,alt:e.product_variant.product.name,sx:{width:80,height:80,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},variant:"rounded"})}),r.jsxs(s,{sx:{flex:1,minWidth:0},children:[r.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:1,color:"text.primary",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.3,fontSize:"1rem"},title:e.product_variant.product.name,children:e.product_variant.product.name}),e.product_variant.variant_options&&e.product_variant.variant_options.length>0&&r.jsx(l,{direction:"row",spacing:.5,sx:{mb:1,flexWrap:"wrap"},children:e.product_variant.variant_options.map((W,L)=>r.jsx(y,{label:`${W.option_value}`,size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:20,borderColor:"primary.main",color:"primary.main","& .MuiChip-label":{px:1}}},L))}),r.jsxs(i,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:["Qty: ",e.quantity," Ã— ",u(Number(e.price))]})]}),r.jsxs(s,{sx:{textAlign:"right",minWidth:100},children:[r.jsx(i,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Total"}),r.jsx(i,{variant:"h6",color:"primary.main",fontWeight:700,sx:{fontSize:"1rem"},children:u(Number(e.price)*Number(e.quantity))})]})]},e.id)})})]})}),a.shipping&&r.jsx(j,{sx:{mb:4,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:r.jsxs(f,{sx:{p:3},children:[r.jsxs(l,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:3},children:[r.jsxs(i,{variant:"h6",fontWeight:600,sx:{color:"text.primary",display:"flex",alignItems:"center",gap:1},children:[r.jsx(or,{}),"Informasi Pengiriman"]}),a.shipping.tracking_number&&r.jsxs(l,{direction:"row",spacing:1,children:[a.shipping.courier&&a.shipping.tracking_number&&T(a.shipping.courier,a.shipping.tracking_number)&&r.jsx(K,{title:"Buka di website kurir",children:r.jsx(E,{size:"small",onClick:()=>{const e=T(a.shipping.courier,a.shipping.tracking_number);e&&window.open(e,"_blank")},sx:{color:"primary.main"},children:r.jsx(hr,{fontSize:"small"})})}),r.jsx(K,{title:"Refresh tracking",children:r.jsx(E,{size:"small",onClick:_,disabled:h,sx:{color:"primary.main"},children:h?r.jsx(U,{size:20}):r.jsx(br,{fontSize:"small"})})})]})]}),P&&r.jsx(D,{severity:"warning",sx:{mb:2,borderRadius:2},onClose:()=>b(null),children:P}),r.jsxs(n,{container:!0,spacing:2,children:[r.jsx(n,{item:!0,xs:12,sm:6,children:r.jsxs(s,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(i,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Kurir"}),r.jsx(i,{variant:"body1",fontWeight:600,children:a.shipping.courier})]})}),r.jsx(n,{item:!0,xs:12,sm:6,children:r.jsxs(s,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(i,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Status Pengiriman"}),r.jsx(i,{variant:"body1",fontWeight:600,children:a.shipping.shipping_status})]})}),a.shipping.tracking_number&&r.jsx(n,{item:!0,xs:12,sm:6,children:r.jsxs(s,{sx:{p:2,backgroundColor:"primary.light",borderRadius:2},children:[r.jsx(i,{variant:"subtitle2",color:"primary.dark",sx:{fontSize:"0.75rem",mb:.5},children:"Nomor Resi"}),r.jsx(i,{variant:"body1",fontWeight:600,color:"primary.main",children:a.shipping.tracking_number})]})}),a.shipping.estimated_delivery&&r.jsx(n,{item:!0,xs:12,sm:6,children:r.jsxs(s,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(i,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Estimasi Sampai"}),r.jsx(i,{variant:"body1",fontWeight:600,children:S(a.shipping.estimated_delivery)})]})})]}),t&&r.jsxs(s,{sx:{mt:3,pt:3,borderTop:"1px solid",borderColor:"divider"},children:[r.jsx(i,{variant:"subtitle1",fontWeight:600,sx:{mb:3},children:"Detail Tracking"}),t.data&&r.jsxs(n,{container:!0,spacing:2,sx:{mb:3},children:[t.data.waybill_id&&r.jsx(n,{item:!0,xs:12,sm:6,children:r.jsxs(s,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(i,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Waybill ID"}),r.jsx(i,{variant:"body1",fontWeight:600,children:t.data.waybill_id})]})}),t.data.status&&r.jsx(n,{item:!0,xs:12,sm:6,children:r.jsxs(s,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(i,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Status Tracking"}),r.jsx(i,{variant:"body1",fontWeight:600,children:t.data.status})]})}),t.data.courier?.company&&r.jsx(n,{item:!0,xs:12,sm:6,children:r.jsxs(s,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(i,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Kurir"}),r.jsx(i,{variant:"body1",fontWeight:600,children:t.data.courier.company.toUpperCase()}),t.data.courier.service_type&&r.jsx(i,{variant:"caption",color:"text.secondary",children:t.data.courier.service_type})]})}),t.data.link&&r.jsx(n,{item:!0,xs:12,sm:6,children:r.jsxs(s,{sx:{p:2,backgroundColor:"primary.light",borderRadius:2},children:[r.jsx(i,{variant:"subtitle2",color:"primary.dark",sx:{fontSize:"0.75rem",mb:.5},children:"Link Tracking"}),r.jsx(g,{size:"small",variant:"text",onClick:()=>window.open(t.data.link,"_blank"),sx:{p:0,textTransform:"none",color:"primary.main","&:hover":{textDecoration:"underline"}},children:"Buka di Biteship"})]})})]}),t.data&&(t.data.origin||t.data.destination)&&r.jsxs(n,{container:!0,spacing:2,sx:{mb:3},children:[t.data.origin&&r.jsx(n,{item:!0,xs:12,sm:6,children:r.jsxs(s,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(i,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:1},children:"Asal Pengiriman"}),r.jsx(i,{variant:"body2",fontWeight:600,sx:{mb:.5},children:t.data.origin.contact_name}),r.jsx(i,{variant:"caption",color:"text.secondary",children:t.data.origin.address})]})}),t.data.destination&&r.jsx(n,{item:!0,xs:12,sm:6,children:r.jsxs(s,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(i,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:1},children:"Tujuan Pengiriman"}),r.jsx(i,{variant:"body2",fontWeight:600,sx:{mb:.5},children:t.data.destination.contact_name}),r.jsx(i,{variant:"caption",color:"text.secondary",children:t.data.destination.address})]})})]}),t.data?.courier&&(t.data.courier.driver_name||t.data.courier.driver_phone)&&r.jsxs(s,{sx:{p:2,backgroundColor:"info.light",borderRadius:2,mb:3},children:[r.jsx(i,{variant:"subtitle2",color:"info.dark",sx:{fontSize:"0.75rem",mb:1},children:"Informasi Kurir"}),t.data.courier.driver_name&&r.jsxs(i,{variant:"body2",fontWeight:600,sx:{mb:.5},children:["Nama Driver: ",t.data.courier.driver_name]}),t.data.courier.driver_phone&&r.jsxs(i,{variant:"body2",color:"text.secondary",children:["No. Telepon: ",t.data.courier.driver_phone]})]}),t.data?.history&&Array.isArray(t.data.history)&&t.data.history.length>0?r.jsxs(s,{children:[r.jsx(i,{variant:"subtitle2",fontWeight:600,sx:{mb:2},children:"Riwayat Tracking"}),r.jsx(l,{spacing:2,children:t.data.history.map((e,c)=>r.jsx(s,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2,borderLeft:"3px solid",borderColor:c===0?"primary.main":"grey.300"},children:r.jsxs(l,{direction:"row",justifyContent:"space-between",alignItems:"flex-start",spacing:2,children:[r.jsxs(s,{sx:{flex:1},children:[r.jsx(i,{variant:"body2",fontWeight:600,sx:{mb:.5},children:e.status?e.status.charAt(0).toUpperCase()+e.status.slice(1):"Update"}),e.note&&r.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.note}),e.service_type&&r.jsx(y,{label:e.service_type,size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:20,mr:1}})]}),e.updated_at&&r.jsx(i,{variant:"caption",color:"text.secondary",sx:{whiteSpace:"nowrap"},children:S(e.updated_at)})]})},c))})]}):r.jsx(D,{severity:"info",sx:{borderRadius:2},children:"Informasi tracking belum tersedia"})]})]})})]}),r.jsx(n,{item:!0,xs:12,lg:4,children:r.jsx(j,{sx:{position:"sticky",top:24,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:"none"},children:r.jsxs(f,{sx:{p:3},children:[r.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:3,color:"text.primary"},children:"Ringkasan Pesanan"}),r.jsxs(l,{spacing:2,children:[r.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(i,{variant:"body1",fontWeight:500,children:"Subtotal"}),r.jsx(i,{variant:"body1",fontWeight:600,children:u(Number(a.total_amount))})]}),r.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(i,{variant:"body1",fontWeight:500,children:"Biaya Pengiriman"}),r.jsx(i,{variant:"body1",fontWeight:600,children:u(Number(a.shipping_cost))})]}),r.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"primary.main",borderRadius:2,color:"white"},children:[r.jsx(i,{variant:"h6",fontWeight:600,children:"Total"}),r.jsx(i,{variant:"h6",fontWeight:700,children:u(Number(a.total_amount)+Number(a.shipping_cost))})]})]}),r.jsx(dr,{sx:{my:3}}),r.jsx(i,{variant:"subtitle1",fontWeight:600,sx:{mb:2,color:"text.primary"},children:"Alamat Pengiriman"}),r.jsxs(s,{sx:{p:2,borderRadius:2,backgroundColor:"grey.50"},children:[r.jsx(i,{variant:"body1",fontWeight:600,children:a.address.address_line}),r.jsxs(i,{variant:"body2",color:"text.secondary",children:[a.address.city,", ",a.address.province," ",a.address.postal_code]})]})]})})})]})]})}export{Pr as default};
