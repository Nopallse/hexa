import{c as ae,j as e,r as t,y as q,B as a,T as d,x as U,ad as se,I as je,b6 as me,a6 as j,v as D,aq as z,D as pe,Y as fe,a4 as O,al as B,a5 as L,X as be,P as ve,b5 as ye,O as Ce,q as Se,aB as we,ag as ke,C as Ie}from"./index-tvCmUXkA.js";import{A as M,u as E}from"./userApi-CsZPJ4zf.js";import{T as Z,a as X,b as Y,c as _,d as i,e as J}from"./TableRow-Bx2Iwbxr.js";import{S as b}from"./Skeleton-DwS8Noa7.js";import{A as te}from"./Avatar-Cw6JEpzV.js";import{T as G}from"./Tooltip-CRdXSvuP.js";import{H as Pe}from"./Home-FYrVyE1n.js";import{O as Re}from"./Receipt-CJT1sDb7.js";import{V as Te}from"./Visibility-Bvwl8cdA.js";import{E as Ue}from"./Edit-EiFO075a.js";import{D as De}from"./Delete-n8OHpdJZ.js";import{D as ne,a as re,b as le}from"./DialogTitle-yi9wgBEI.js";import{D as Ae}from"./DialogContentText-Dr2ottoH.js";import{D as ie}from"./DialogActions-Bmmc9LId.js";import{F as _e}from"./FilterList-DwFV5sJn.js";import{C as Q,a as ee}from"./CardContent-BO7gwO4c.js";import{A as Fe}from"./Alert-iJ2nvuQL.js";import{T as We}from"./TablePagination-BcG9v-ci.js";import"./useSlot-Dd61XFNI.js";import"./Popper-DMWFBkOI.js";import"./KeyboardArrowRight-GxyP2UjW.js";import"./LastPage-Unmxpdhm.js";const Ee=ae(e.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert"),Oe=ae(e.jsx("path",{d:"M8.65 5.82C9.36 4.72 10.6 4 12 4c2.21 0 4 1.79 4 4 0 1.4-.72 2.64-1.82 3.35zM20 17.17c-.02-1.1-.63-2.11-1.61-2.62-.54-.28-1.13-.54-1.77-.76zm1.19 4.02L2.81 2.81 1.39 4.22l8.89 8.89c-1.81.23-3.39.79-4.67 1.45-1 .51-1.61 1.54-1.61 2.66V20h13.17l2.61 2.61z"}),"PersonOff");function Be({users:u,isLoading:s,onView:v,onEditRole:n,onDelete:x}){const[m,y]=t.useState(null),[c,k]=t.useState(null),[S,p]=t.useState(!1),[C,g]=t.useState(null),T=(l,R)=>{y(l.currentTarget),k(R)},f=()=>{y(null),k(null)},r=()=>{c&&v(c),f()},I=()=>{c&&n(c),f()},A=()=>{c&&(g(c.id),p(!0)),f()},P=()=>{C&&(x(C),p(!1),g(null))},F=()=>{p(!1),g(null)},V=l=>new Date(l).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),W=l=>l==="admin"?"error":"default",$=l=>l==="admin"?e.jsx(M,{}):e.jsx(z,{});return s?e.jsx(Z,{component:q,children:e.jsxs(X,{children:[e.jsx(Y,{children:e.jsxs(_,{children:[e.jsx(i,{children:"Pengguna"}),e.jsx(i,{children:"Email"}),e.jsx(i,{children:"Role"}),e.jsx(i,{children:"Statistik"}),e.jsx(i,{children:"Tanggal Dibuat"}),e.jsx(i,{align:"center",children:"Aksi"})]})}),e.jsx(J,{children:[...Array(5)].map((l,R)=>e.jsxs(_,{children:[e.jsx(i,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(b,{variant:"circular",width:40,height:40}),e.jsxs(a,{children:[e.jsx(b,{variant:"text",width:120}),e.jsx(b,{variant:"text",width:80})]})]})}),e.jsx(i,{children:e.jsx(b,{variant:"text",width:150})}),e.jsx(i,{children:e.jsx(b,{variant:"text",width:60})}),e.jsx(i,{children:e.jsx(b,{variant:"text",width:100})}),e.jsx(i,{children:e.jsx(b,{variant:"text",width:120})}),e.jsx(i,{align:"center",children:e.jsx(b,{variant:"circular",width:32,height:32})})]},R))})]})}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{component:q,children:e.jsxs(X,{children:[e.jsx(Y,{children:e.jsxs(_,{children:[e.jsx(i,{children:"Pengguna"}),e.jsx(i,{children:"Email"}),e.jsx(i,{children:"Role"}),e.jsx(i,{children:"Statistik"}),e.jsx(i,{children:"Tanggal Dibuat"}),e.jsx(i,{align:"center",children:"Aksi"})]})}),e.jsx(J,{children:u.length===0?e.jsx(_,{children:e.jsx(i,{colSpan:6,align:"center",sx:{py:4},children:e.jsx(d,{variant:"body1",color:"textSecondary",children:"Tidak ada data pengguna"})})}):u.map(l=>e.jsxs(_,{hover:!0,children:[e.jsx(i,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(te,{sx:{bgcolor:"primary.main"},children:l.full_name.charAt(0).toUpperCase()}),e.jsxs(a,{children:[e.jsx(d,{variant:"subtitle2",fontWeight:"medium",children:l.full_name}),l.phone&&e.jsx(d,{variant:"caption",color:"textSecondary",children:l.phone})]})]})}),e.jsx(i,{children:e.jsx(d,{variant:"body2",children:l.email})}),e.jsx(i,{children:e.jsx(U,{icon:$(l.role),label:l.role==="admin"?"Admin":"User",color:W(l.role),size:"small"})}),e.jsx(i,{children:e.jsxs(a,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(G,{title:"Alamat",children:e.jsx(U,{icon:e.jsx(Pe,{}),label:l._count?.addresses||0,size:"small",variant:"outlined"})}),e.jsx(G,{title:"Keranjang",children:e.jsx(U,{icon:e.jsx(se,{}),label:l._count?.cart_items||0,size:"small",variant:"outlined"})}),e.jsx(G,{title:"Pesanan",children:e.jsx(U,{icon:e.jsx(Re,{}),label:l._count?.orders||0,size:"small",variant:"outlined"})})]})}),e.jsx(i,{children:e.jsx(d,{variant:"body2",children:V(l.created_at)})}),e.jsx(i,{align:"center",children:e.jsx(je,{onClick:R=>T(R,l),size:"small",children:e.jsx(Ee,{})})})]},l.id))})]})}),e.jsxs(me,{anchorEl:m,open:!!m,onClose:f,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[e.jsxs(j,{onClick:r,children:[e.jsx(Te,{sx:{mr:1}}),"Lihat Detail"]}),e.jsxs(j,{onClick:I,children:[e.jsx(Ue,{sx:{mr:1}}),"Ubah Role"]}),e.jsxs(j,{onClick:A,sx:{color:"error.main"},children:[e.jsx(De,{sx:{mr:1}}),"Hapus"]})]}),e.jsxs(ne,{open:S,onClose:F,"aria-labelledby":"delete-dialog-title","aria-describedby":"delete-dialog-description",children:[e.jsx(re,{id:"delete-dialog-title",children:"Konfirmasi Hapus Pengguna"}),e.jsx(le,{children:e.jsxs(Ae,{id:"delete-dialog-description",children:["Apakah Anda yakin ingin menghapus pengguna"," ",e.jsx("strong",{children:c?.full_name}),"? Tindakan ini tidak dapat dibatalkan dan akan menghapus semua data terkait pengguna."]})}),e.jsxs(ie,{children:[e.jsx(D,{onClick:F,color:"inherit",children:"Batal"}),e.jsx(D,{onClick:P,color:"error",variant:"contained",children:"Hapus"})]})]})]})}function Le({onFilterChange:u,loading:s=!1,initialFilters:v}){const[n,x]=t.useState({search:"",role:"",sort:"created_at",sortOrder:"desc",...v}),[m,y]=t.useState(!1),[c,k]=t.useState(null),S=t.useCallback(u,[]);t.useEffect(()=>{c&&clearTimeout(c);const r=setTimeout(()=>{S(n)},n.search?500:0);return k(r),()=>{r&&clearTimeout(r)}},[n,S]),t.useEffect(()=>()=>{c&&clearTimeout(c)},[c]);const p=(r,I)=>{x(A=>({...A,[r]:I}))},C=r=>{x(I=>({...I,search:r}))},g=()=>{x({search:"",role:"",sort:"created_at",sortOrder:"desc"})},f=(()=>{let r=0;return n.search&&r++,n.role&&r++,n.sort!=="created_at"&&r++,n.sortOrder!=="desc"&&r++,r})();return e.jsxs(a,{sx:{mb:3},children:[e.jsxs(a,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[e.jsx(a,{sx:{flex:"1 1 300px",minWidth:200},children:e.jsx(pe,{fullWidth:!0,placeholder:"Cari pengguna...",value:n.search||"",onChange:r=>C(r.target.value),InputProps:{startAdornment:e.jsx(fe,{sx:{mr:1,color:"text.secondary"}})},disabled:s})}),e.jsx(a,{sx:{flex:"1 1 200px",minWidth:150},children:e.jsxs(O,{fullWidth:!0,disabled:s,children:[e.jsx(B,{children:"Role"}),e.jsxs(L,{value:n.role||"",onChange:r=>p("role",r.target.value),label:"Role",children:[e.jsx(j,{value:"",children:"Semua Role"}),e.jsx(j,{value:"user",children:"User"}),e.jsx(j,{value:"admin",children:"Admin"})]})]})}),e.jsx(a,{sx:{flex:"1 1 150px",minWidth:120},children:e.jsxs(O,{fullWidth:!0,disabled:s,children:[e.jsx(B,{children:"Urutkan"}),e.jsxs(L,{value:n.sort||"created_at",onChange:r=>p("sort",r.target.value),label:"Urutkan",children:[e.jsx(j,{value:"name",children:"Nama"}),e.jsx(j,{value:"email",children:"Email"}),e.jsx(j,{value:"role",children:"Role"}),e.jsx(j,{value:"created_at",children:"Tanggal Dibuat"})]})]})}),e.jsx(a,{sx:{flex:"1 1 150px",minWidth:120},children:e.jsxs(O,{fullWidth:!0,disabled:s,children:[e.jsx(B,{children:"Urutan"}),e.jsxs(L,{value:n.sortOrder||"desc",onChange:r=>p("sortOrder",r.target.value),label:"Urutan",children:[e.jsx(j,{value:"asc",children:"A-Z / Terendah"}),e.jsx(j,{value:"desc",children:"Z-A / Tertinggi"})]})]})}),e.jsxs(a,{sx:{display:"flex",gap:1,flexShrink:0},children:[e.jsxs(D,{variant:"outlined",startIcon:e.jsx(_e,{}),onClick:()=>y(!m),disabled:s,children:["Filter",f>0&&e.jsx(U,{label:f,size:"small",color:"primary",sx:{ml:1,minWidth:20,height:20}})]}),f>0&&e.jsx(D,{variant:"outlined",startIcon:e.jsx(be,{}),onClick:g,disabled:s,color:"error",children:"Clear"})]})]}),m&&e.jsxs(a,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:[e.jsx(d,{variant:"subtitle2",gutterBottom:!0,children:"Filter Lanjutan"}),e.jsx(a,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:e.jsx(d,{variant:"body2",color:"textSecondary",children:"Filter lanjutan akan ditambahkan sesuai kebutuhan."})})]})]})}function ze({stats:u,isLoading:s}){const v=[{title:"Total Pengguna",value:u?.total_users||0,icon:e.jsx(ve,{}),color:"primary",description:"Semua pengguna terdaftar"},{title:"Admin",value:u?.total_admins||0,icon:e.jsx(M,{}),color:"error",description:"Pengguna dengan akses admin"},{title:"User Biasa",value:u?.total_regular_users||0,icon:e.jsx(z,{}),color:"info",description:"Pengguna dengan akses terbatas"},{title:"Pengguna Baru",value:u?.recent_users||0,icon:e.jsx(ye,{}),color:"success",description:"Bergabung dalam 30 hari terakhir"},{title:"Dengan Pesanan",value:u?.users_with_orders||0,icon:e.jsx(se,{}),color:"warning",description:"Pengguna yang pernah berbelanja"},{title:"Tanpa Pesanan",value:u?.users_without_orders||0,icon:e.jsx(Oe,{}),color:"default",description:"Pengguna yang belum berbelanja"}];return s?e.jsx(a,{sx:{display:"flex",flexWrap:"wrap",gap:3,mb:3},children:v.map((n,x)=>e.jsx(a,{sx:{flex:"1 1 250px",minWidth:"250px"},children:e.jsx(Q,{children:e.jsxs(ee,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(b,{variant:"circular",width:40,height:40}),e.jsxs(a,{sx:{ml:2,flex:1},children:[e.jsx(b,{variant:"text",width:"80%"}),e.jsx(b,{variant:"text",width:"60%"})]})]}),e.jsx(b,{variant:"text",width:"40%"})]})})},x))}):e.jsx(a,{sx:{display:"flex",flexWrap:"wrap",gap:3,mb:3},children:v.map((n,x)=>e.jsx(a,{sx:{flex:"1 1 250px",minWidth:"250px"},children:e.jsx(Q,{sx:{height:"100%"},children:e.jsxs(ee,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(a,{sx:{p:1,borderRadius:1,bgcolor:`${n.color}.light`,color:`${n.color}.main`,display:"flex",alignItems:"center",justifyContent:"center"},children:n.icon}),e.jsxs(a,{sx:{ml:2,flex:1},children:[e.jsx(d,{variant:"subtitle2",color:"textSecondary",children:n.title}),e.jsx(d,{variant:"h4",fontWeight:"bold",children:n.value.toLocaleString("id-ID")})]})]}),e.jsx(d,{variant:"caption",color:"textSecondary",children:n.description})]})})},x))})}function Me({open:u,user:s,onClose:v,onSave:n,loading:x=!1}){const[m,y]=t.useState("user"),c=()=>{x||(y("user"),v())},k=async()=>{s&&m!==s.role&&await n(s.id,m),c()},S=g=>{y(g.target.value)},p=g=>g==="admin"?e.jsx(M,{}):e.jsx(z,{}),C=g=>g==="admin"?"error":"default";return s?e.jsxs(ne,{open:u,onClose:c,maxWidth:"sm",fullWidth:!0,children:[e.jsx(re,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(te,{sx:{bgcolor:"primary.main"},children:s.full_name.charAt(0).toUpperCase()}),e.jsxs(a,{children:[e.jsx(d,{variant:"h6",children:"Ubah Role Pengguna"}),e.jsxs(d,{variant:"body2",color:"textSecondary",children:[s.full_name," (",s.email,")"]})]})]})}),e.jsxs(le,{children:[e.jsxs(a,{sx:{mb:3},children:[e.jsx(d,{variant:"subtitle2",gutterBottom:!0,children:"Role Saat Ini:"}),e.jsx(U,{icon:p(s.role),label:s.role==="admin"?"Admin":"User",color:C(s.role),size:"medium"})]}),e.jsxs(O,{fullWidth:!0,children:[e.jsx(B,{children:"Role Baru"}),e.jsxs(L,{value:m,onChange:S,label:"Role Baru",disabled:x,children:[e.jsx(j,{value:"user",children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(z,{}),e.jsxs(a,{children:[e.jsx(d,{variant:"body2",children:"User"}),e.jsx(d,{variant:"caption",color:"textSecondary",children:"Akses terbatas, hanya dapat berbelanja"})]})]})}),e.jsx(j,{value:"admin",children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(M,{}),e.jsxs(a,{children:[e.jsx(d,{variant:"body2",children:"Admin"}),e.jsx(d,{variant:"caption",color:"textSecondary",children:"Akses penuh ke sistem administrasi"})]})]})})]})]}),m!==s.role&&e.jsx(a,{sx:{mt:2,p:2,bgcolor:"warning.light",borderRadius:1},children:e.jsx(d,{variant:"body2",color:"warning.dark",children:"⚠️ Perubahan role akan mempengaruhi akses pengguna ke sistem. Pastikan perubahan ini sesuai dengan kebutuhan."})})]}),e.jsxs(ie,{children:[e.jsx(D,{onClick:c,disabled:x,children:"Batal"}),e.jsx(D,{onClick:k,variant:"contained",disabled:x||m===s.role,startIcon:x?e.jsx(Ce,{size:16}):null,children:x?"Menyimpan...":"Simpan"})]})]}):null}function da(){const u=Se(),{showNotification:s}=we(),[v,n]=t.useState([]),[x,m]=t.useState(null),[y,c]=t.useState(!0),[k,S]=t.useState(!0),[p,C]=t.useState(null),[g,T]=t.useState(0),[f,r]=t.useState(10),[I,A]=t.useState(0),[P,F]=t.useState({}),[V,W]=t.useState(!1),[$,l]=t.useState(null),[R,N]=t.useState(!1),H=async o=>{try{c(!0),C(null);const h=await E.getUsers({page:(g||0)+1,limit:f,...o});if(h.success)n(h.data),A(h.pagination?.total_items||0);else throw new Error("Failed to fetch users")}catch(h){C(h.message||"Gagal memuat data pengguna")}finally{c(!1)}},K=async()=>{try{S(!0);const o=await E.getUserStats();o.success&&m(o.data)}catch(o){console.error("Failed to fetch user stats:",o)}finally{S(!1)}};t.useEffect(()=>{H(P)},[g,f,P]),t.useEffect(()=>{K()},[]);const oe=o=>{u(`/admin/users/${o.id}`)},ce=o=>{l(o),W(!0)},de=async(o,h)=>{try{N(!0);const w=await E.updateUserRole(o,{role:h});if(w.success)s({type:"success",message:w.message||"Role pengguna berhasil diperbarui"}),await H(P),await K();else throw new Error(w.message||"Failed to update user role")}catch(w){throw s({type:"error",message:w.message||"Gagal memperbarui role pengguna"}),w}finally{N(!1)}},he=async o=>{try{const h=await E.deleteUser(o);if(h.success)s({type:"success",message:h.message||"Pengguna berhasil dihapus"}),await H(P),await K();else throw new Error(h.message||"Failed to delete user")}catch(h){throw s({type:"error",message:h.message||"Gagal menghapus pengguna"}),h}},xe=t.useCallback(o=>{F(o),T(0)},[]),ue=(o,h)=>{T(h)},ge=o=>{r(parseInt(o.target.value,10)),T(0)};return y&&v.length===0?e.jsx(ke,{message:"Memuat data pengguna..."}):e.jsxs(Ie,{maxWidth:!1,children:[e.jsxs(a,{sx:{mb:4},children:[e.jsx(d,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Kelola Pengguna"}),e.jsx(d,{variant:"body1",color:"textSecondary",children:"Kelola pengguna dan akses sistem"})]}),e.jsx(ze,{stats:x,isLoading:k}),p&&e.jsx(Fe,{severity:"error",sx:{mb:3},onClose:()=>C(null),children:p}),e.jsx(Le,{onFilterChange:xe,loading:y,initialFilters:P}),e.jsx(Be,{users:v,isLoading:y,onView:oe,onEditRole:ce,onDelete:he}),I>0&&e.jsx(We,{rowsPerPageOptions:[5,10,25,50],component:"div",count:I,rowsPerPage:f,page:g,onPageChange:ue,onRowsPerPageChange:ge,labelRowsPerPage:"Baris per halaman:",labelDisplayedRows:({from:o,to:h,count:w})=>`${o}-${h} dari ${w!==-1?w:`lebih dari ${h}`}`}),e.jsx(Me,{open:V,user:$,onClose:()=>W(!1),onSave:de,loading:R})]})}export{da as default};
