import{c as J,j as e,a as N,Q as Z,ar as ee,r as c,Y as re,C as G,b as h,B as a,T as i,R as p,e as d,D as f,P as te}from"./index-DVLSGWYZ.js";import{p as $}from"./productApi-BSs2_-SD.js";import{g as C}from"./image-CL12PwSa.js";import{A as L}from"./Alert-DeMLxQ5q.js";import{A as M}from"./ArrowBack-BbA3cZTo.js";import{E as ae}from"./Edit-DzfA9IsF.js";import{D as ie}from"./Delete-4b1S9yqQ.js";import{C as b,a as y}from"./CardContent-DCJIVk1m.js";import{T as se,a as ne,b as oe,c as U,d as l,e as le}from"./TableRow-DDTYGfD8.js";import{I as ce}from"./Image-DbwDNlVa.js";const de=J(e.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");function ve(){const v=N(),{id:_}=Z(),{showNotification:W}=ee(),[t,K]=c.useState(null),[R,k]=c.useState(!0),[B,D]=c.useState(!1),[P,S]=c.useState(null),[u,x]=c.useState(null),[m,T]=c.useState(null),[E,z]=c.useState({}),H=async()=>{if(!_){S("ID produk tidak valid"),k(!1);return}try{k(!0),S(null);const r=await $.getProductById(_);if(r.success)K(r.data);else throw new Error("Failed to fetch product")}catch(r){S(r.message||"Gagal memuat data produk")}finally{k(!1)}};c.useEffect(()=>{H()},[_]),c.useEffect(()=>{if(t){const r=w(t);if(x(r?r.image_name:null),t.product_variants&&t.product_variants.length>0){T(t.product_variants[0]);const s={};t.product_variants[0].variant_options&&t.product_variants[0].variant_options.forEach(n=>{s[n.option_name]=n.option_value}),z(s)}}},[t]);const Q=()=>{if(!t?.product_variants||t.product_variants.length===0)return{};const r={};t.product_variants.forEach(n=>{n.variant_options?.forEach(o=>{r[o.option_name]||(r[o.option_name]=new Set),r[o.option_name].add(o.option_value)})});const s={};return Object.keys(r).forEach(n=>{s[n]=Array.from(r[n])}),s},X=(r,s)=>{const n={...E,[r]:s};z(n);const o=t?.product_variants?.find(j=>j.variant_options?.every(V=>n[V.option_name]===V.option_value));if(o){if(T(o),o.image)x(o.image);else if(o.display_image)x(o.display_image);else if(t){const j=w(t);x(j?j.image_name:null)}}},Y=()=>{t&&v(`/admin/products/${t.id}/edit`)},q=async()=>{if(!(!t||!window.confirm(`Apakah Anda yakin ingin menghapus produk "${t.name}"? Tindakan ini tidak dapat dibatalkan.`)))try{D(!0);const s=await $.deleteProduct(t.id);if(s.success)W({type:"success",message:"Produk berhasil dihapus"}),v("/admin/products");else throw new Error(s.message||"Failed to delete product")}catch(s){W({type:"error",message:s.message||"Gagal menghapus produk"})}finally{D(!1)}},A=()=>{v("/admin/products")},I=r=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(r),w=r=>r.product_images&&r.product_images.length>0?r.product_images.find(n=>n.is_primary)||r.product_images[0]:null;if(R)return e.jsx(re,{message:"Memuat data produk..."});if(P||!t)return e.jsxs(G,{maxWidth:!1,children:[e.jsx(L,{severity:"error",sx:{mb:3},children:P||"Produk tidak ditemukan"}),e.jsx(h,{variant:"outlined",startIcon:e.jsx(M,{}),onClick:A,children:"Kembali ke Daftar Produk"})]});const g=w(t),F=u||(g?g.image_name:null),O=Q();return e.jsxs(G,{maxWidth:!1,children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(a,{children:[e.jsx(i,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Detail Produk"}),e.jsxs(i,{variant:"body1",color:"textSecondary",children:['Informasi lengkap produk "',t.name,'"']})]}),e.jsxs(a,{sx:{display:"flex",gap:2},children:[e.jsx(h,{variant:"outlined",startIcon:e.jsx(M,{}),onClick:A,children:"Kembali"}),e.jsx(h,{variant:"contained",startIcon:e.jsx(ae,{}),onClick:Y,children:"Edit"}),e.jsx(h,{variant:"outlined",color:"error",startIcon:e.jsx(ie,{}),onClick:q,disabled:B,children:B?"Menghapus...":"Hapus"})]})]}),e.jsxs(a,{sx:{display:"flex",gap:3,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 300px",minWidth:300},children:e.jsx(b,{children:e.jsxs(y,{children:[e.jsx(i,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Galeri Gambar"}),F?e.jsx(a,{sx:{textAlign:"center",mb:2},children:e.jsx(p,{src:C(F),variant:"rounded",sx:{width:"100%",height:300,transition:"all 0.3s ease",boxShadow:2}})}):e.jsx(a,{sx:{textAlign:"center",mb:2},children:e.jsx(p,{variant:"rounded",sx:{width:"100%",height:300},children:t.name.charAt(0).toUpperCase()})}),t.product_images&&t.product_images.length>0?e.jsxs(a,{children:[e.jsxs(i,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:["Semua Gambar (",t.product_images.length,")"]}),e.jsx(a,{sx:{display:"flex",gap:1,flexWrap:"wrap",justifyContent:"center"},children:t.product_images.sort((r,s)=>(s.is_primary?1:0)-(r.is_primary?1:0)).map(r=>e.jsxs(a,{sx:{position:"relative"},onMouseEnter:()=>x(r.image_name),onMouseLeave:()=>x(g?g.image_name:null),children:[e.jsx(p,{src:C(r.image_name),variant:"rounded",sx:{width:70,height:70,cursor:"pointer",border:u===r.image_name?3:2,borderColor:u===r.image_name?"primary.main":"divider",transition:"all 0.2s ease",opacity:u===r.image_name?1:.7,"&:hover":{opacity:1,transform:"scale(1.05)",borderColor:"primary.main"}}}),r.is_primary&&e.jsx(d,{label:"Utama",size:"small",color:"primary",sx:{position:"absolute",bottom:-8,left:"50%",transform:"translateX(-50%)",fontSize:"0.65rem",height:16,"& .MuiChip-label":{px:.5}}})]},r.id))})]}):e.jsx(L,{severity:"info",sx:{mt:2},children:"Belum ada gambar produk"})]})})}),e.jsx(a,{sx:{flex:"2 1 500px",minWidth:500},children:e.jsx(b,{children:e.jsxs(y,{children:[e.jsxs(a,{sx:{mb:3},children:[e.jsx(i,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:t.name}),t.product_variants&&t.product_variants.length>0?e.jsxs(a,{children:[e.jsx(i,{variant:"h4",color:"primary",fontWeight:"bold",children:t.price_range?.display||"Harga bervariasi"}),e.jsxs(i,{variant:"body2",color:"textSecondary",children:["Total Stok: ",t.total_stock||0," unit"]})]}):e.jsx(i,{variant:"h4",color:"primary",fontWeight:"bold",children:I(parseFloat(t.price||"0"))})]}),e.jsx(f,{sx:{mb:3}}),e.jsxs(a,{sx:{mb:3},children:[e.jsx(i,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Deskripsi"}),e.jsx(i,{variant:"body1",color:"textSecondary",children:t.description||"Tidak ada deskripsi"})]}),e.jsx(f,{sx:{mb:3}}),e.jsxs(a,{sx:{mb:3},children:[e.jsx(i,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Kategori"}),t.category?e.jsxs(a,{children:[e.jsx(d,{label:t.category.name,color:"primary",variant:"outlined",sx:{mb:1}}),t.category.description&&e.jsx(i,{variant:"body2",color:"textSecondary",children:t.category.description})]}):e.jsx(i,{variant:"body2",color:"textSecondary",children:"Tidak ada kategori"})]}),t.product_variants&&t.product_variants.length>0&&Object.keys(O).length>0&&e.jsxs(e.Fragment,{children:[e.jsx(f,{sx:{mb:3}}),e.jsxs(a,{sx:{mb:3},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(i,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Pilih Varian"}),t.product_variants&&t.product_variants.length>0?e.jsx(d,{label:`${t.product_variants.length} Varian`,color:"primary",size:"small",variant:"filled",sx:{fontWeight:"bold",bgcolor:"primary.main",color:"white",border:"1px solid",borderColor:"primary.dark",letterSpacing:.5}}):e.jsx(d,{label:`Stok: ${t.stock||0}`,color:(t.stock||0)>0?"success":"error",size:"small",variant:(t.stock||0)>0?"filled":"outlined"})]}),Object.entries(O).map(([r,s])=>e.jsxs(a,{sx:{mb:2},children:[e.jsx(i,{variant:"subtitle2",fontWeight:"bold",gutterBottom:!0,children:r}),e.jsx(a,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:s.map(n=>{const o=E[r]===n;return e.jsxs(h,{variant:o?"contained":"outlined",onClick:()=>X(r,n),size:"large",sx:{minWidth:80,borderWidth:2,borderColor:o?"primary.main":"divider",position:"relative",textTransform:"none","&:hover":{borderWidth:2,borderColor:"primary.main"}},children:[e.jsx(i,{variant:"body2",fontWeight:o?"bold":"medium",children:n}),o&&e.jsx(de,{sx:{position:"absolute",top:4,right:4,fontSize:16,bgcolor:"white",color:"primary.main",borderRadius:"50%",p:.25}})]},n)})})]},r))]}),m&&e.jsx(b,{variant:"outlined",sx:{mb:3,bgcolor:"primary.50",borderColor:"primary.main"},children:e.jsx(y,{children:e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[e.jsxs(a,{children:[e.jsx(i,{variant:"caption",color:"text.secondary",display:"block",children:"Varian Terpilih"}),e.jsx(i,{variant:"h6",fontWeight:"bold",children:m.variant_name}),e.jsxs(i,{variant:"caption",color:"text.secondary",children:["SKU: ",m.sku]})]}),e.jsxs(a,{sx:{textAlign:"right"},children:[e.jsx(i,{variant:"h4",color:"primary.main",fontWeight:"bold",children:I(parseFloat(m.price))}),e.jsx(d,{label:`Stok: ${m.stock} unit`,size:"small",color:m.stock>0?"success":"error",sx:{mt:.5}})]})]})})}),e.jsx(f,{sx:{mb:3}})]})]})})})]}),t.product_variants&&t.product_variants.length>0&&e.jsx(a,{sx:{mt:4},children:e.jsx(b,{children:e.jsxs(y,{children:[e.jsx(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:e.jsxs(i,{variant:"h6",fontWeight:"bold",children:["Semua Varian (",t.product_variants.length,")"]})}),e.jsx(se,{component:te,variant:"outlined",children:e.jsxs(ne,{children:[e.jsx(oe,{children:e.jsxs(U,{children:[e.jsx(l,{children:"SKU"}),e.jsx(l,{align:"right",children:"Harga"}),e.jsx(l,{align:"center",children:"Stok"}),e.jsx(l,{align:"center",children:"Gambar"}),e.jsx(l,{children:"Opsi Varian"})]})}),e.jsx(le,{children:t.product_variants.map(r=>{const s=m?.id===r.id;return e.jsxs(U,{hover:!0,sx:{bgcolor:s?"primary.50":"transparent","&:hover":{bgcolor:s?"primary.100":"action.hover"}},children:[e.jsx(l,{children:e.jsx(i,{variant:"body2",fontFamily:"monospace",fontWeight:"medium",children:r.sku})}),e.jsx(l,{align:"right",children:e.jsx(i,{variant:"body2",fontWeight:"medium",color:"primary",children:I(parseFloat(r.price))})}),e.jsx(l,{align:"center",children:e.jsx(d,{label:r.stock,size:"small",color:r.stock>0?"success":"error",variant:r.stock>0?"filled":"outlined"})}),e.jsx(l,{align:"center",children:r.image?e.jsx(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:e.jsx(p,{src:C(r.image),variant:"rounded",sx:{width:60,height:60}})}):e.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:[e.jsx(p,{variant:"rounded",sx:{width:60,height:60,bgcolor:"grey.200"},children:e.jsx(ce,{color:"disabled"})}),e.jsx(d,{label:"Tidak Ada",size:"small",color:"default",variant:"outlined",sx:{fontSize:"0.7rem",height:18}}),s&&e.jsx(d,{label:"Selected",size:"small",color:"primary",sx:{height:18,fontSize:"0.65rem"}})]})}),e.jsx(l,{children:e.jsx(a,{sx:{display:"flex",gap:.5,flexWrap:"wrap"},children:r.variant_options&&r.variant_options.length>0?r.variant_options.map(n=>e.jsx(d,{label:`${n.option_name}: ${n.option_value}`,size:"small",variant:"outlined"},n.id)):e.jsx(i,{variant:"caption",color:"textSecondary",fontStyle:"italic",children:"Belum ada opsi"})})})]},r.id)})})]})})]})})})]})}export{ve as default};
