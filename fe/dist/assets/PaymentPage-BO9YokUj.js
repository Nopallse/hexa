import{c as T,j as a,aa as F,ab as R,X as b,u as A,r as u,B as d,ak as U,T as r,b as W,Q as $,a as G,aj as H,C as k,$ as I,a0 as K,Z as z,S as j,D as S,R as N}from"./index-sM3j39aj.js";import{o as J}from"./orderApi-CsCxL-GJ.js";import{A as g}from"./Alert-CTAf5yxJ.js";import{B as Y}from"./Breadcrumbs-BTyrJBjS.js";import{O as V}from"./Receipt-C-F9987q.js";import{A as Q}from"./ArrowBack-DMiYikXq.js";import{G as w}from"./Grid-B-Z98BME.js";import{C,a as _}from"./CardContent-Cj-kD625.js";const O=T(a.jsx("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2m0 14H4v-6h16zm0-10H4V6h16z"}),"CreditCard"),Z=F()(R((e,o)=>({payments:[],currentPaymentInfo:null,loading:!1,error:null,setPayments:t=>e({payments:t}),addPayment:t=>e(m=>({payments:[t,...m.payments]})),updatePayment:(t,m)=>e(x=>({payments:x.payments.map(p=>p.id===t?{...p,...m}:p),currentPaymentInfo:x.currentPaymentInfo?{...x.currentPaymentInfo,payments:x.currentPaymentInfo.payments.map(p=>p.id===t?{...p,...m}:p)}:null})),setCurrentPaymentInfo:t=>e({currentPaymentInfo:t}),setLoading:t=>e({loading:t}),setError:t=>e({error:t}),clearError:()=>e({error:null})}),{name:"payment-storage",partialize:e=>({payments:e.payments,currentPaymentInfo:e.currentPaymentInfo})})),D={createPayment:async e=>(await b.post("/payments",e)).data,createPayPalPayment:async e=>(await b.post("/payments/paypal/create",e)).data,capturePayPalPayment:async e=>(await b.post("/payments/paypal/capture",e)).data,refundPayPalPayment:async e=>(await b.post("/payments/paypal/refund",e)).data,getPaymentInfo:async e=>(await b.get(`/payments/${e}`)).data,verifyPayment:async(e,o)=>(await b.put(`/payments/${e}/verify`,o)).data},q={clientId:"AYKAvNoH0v3AJtyJ8UDHfNjb2Kh7vdwyNyAi59oFcVce8TNZFrz6stA4kklmkfAlur7RdJxhmpDA6yFM",currency:"USD",locale:"en_US",sandboxUrl:"https://www.sandbox.paypal.com/sdk/js"},X=()=>{const{clientId:e,currency:o,locale:t,sandboxUrl:m}=q;return`${m}?client-id=${e}&currency=${o}&locale=${t}`},aa={layout:"vertical",color:"blue",shape:"rect",label:"paypal",height:50};function ea({order:e,onSuccess:o,onError:t}){A();const[m,x]=u.useState(!1),[p,c]=u.useState(null),[y,s]=u.useState(!1),h=u.useRef(null);return u.useEffect(()=>{const i=document.createElement("script");return i.src=X(),i.async=!0,i.onload=()=>{s(!0)},i.onerror=()=>{c("Gagal memuat PayPal SDK")},document.body.appendChild(i),()=>{document.body.contains(i)&&document.body.removeChild(i),h.current&&(h.current.innerHTML="")}},[]),u.useEffect(()=>(y&&window.paypal&&h.current&&(h.current.innerHTML="",window.paypal.Buttons({style:aa,createOrder:async(i,f)=>{try{x(!0);const l=await D.createPayPalPayment({order_id:e.id});if(l.success)return l.data.paypal_order_id;throw new Error("Failed to create PayPal order")}catch(l){throw console.error("Error creating PayPal order:",l),c(l.response?.data?.error||"Gagal membuat order PayPal"),l}finally{x(!1)}},onApprove:async(i,f)=>{try{x(!0),c(null);const l=await D.capturePayPalPayment({paypal_order_id:i.orderID});if(l.success){const P={id:`paypal-payment-${Date.now()}`,order_id:e.id,payment_method:"paypal",amount:e.total_amount+e.shipping_cost,payment_status:"paid",payment_date:new Date().toISOString(),payment_reference:l.data.capture_id||i.orderID,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};o(P)}else throw new Error("Failed to capture payment")}catch(l){console.error("Error capturing PayPal payment:",l);const P=l.response?.data?.error||"Gagal menangkap pembayaran PayPal";c(P),t(P)}finally{x(!1)}},onError:i=>{console.error("PayPal error:",i);const f="Terjadi kesalahan saat memproses pembayaran PayPal";c(f),t(f)},onCancel:i=>{console.log("PayPal payment cancelled:",i),c("Pembayaran PayPal dibatalkan")}}).render(h.current)),()=>{h.current&&(h.current.innerHTML="")}),[y,e,o,t]),a.jsxs(d,{children:[p&&a.jsx(g,{severity:"error",sx:{mb:2},onClose:()=>c(null),children:p}),!y&&a.jsx(g,{severity:"info",sx:{mb:2},children:"Memuat PayPal SDK..."}),y?a.jsxs(a.Fragment,{children:[a.jsx(g,{severity:"success",sx:{mb:2},children:"PayPal Sandbox siap digunakan. Klik tombol di bawah untuk memulai pembayaran."}),a.jsxs(g,{severity:"info",sx:{mb:2},children:[a.jsx("strong",{children:"Mode Sandbox:"})," Gunakan akun PayPal sandbox untuk testing. Tidak ada uang sungguhan yang akan diproses."]}),a.jsx(d,{ref:h})]}):a.jsxs(d,{sx:{textAlign:"center",py:3},children:[a.jsx(U,{}),a.jsx(r,{variant:"body2",sx:{mt:2},children:"Memuat PayPal Payment Gateway..."})]}),!y&&a.jsx(W,{variant:"contained",size:"large",startIcon:a.jsx(O,{}),onClick:()=>{c("PayPal SDK belum dimuat. Silakan refresh halaman dan coba lagi.")},disabled:m,fullWidth:!0,sx:{py:2,borderRadius:2,fontWeight:600,fontSize:"1.1rem",backgroundColor:"#003087","&:hover":{backgroundColor:"#002366"},mt:2},children:m?"Memproses...":"PayPal SDK Belum Dimuat"})]})}function la(){A();const{orderId:e}=$(),o=G();H();const[t,m]=u.useState(!0),[x,p]=u.useState(!1),[c,y]=u.useState(null),[s,h]=u.useState(null),[i,f]=u.useState("paypal"),{setCurrentPaymentInfo:l,addPayment:P}=Z(),v=n=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n),B=n=>new Date(n).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),E=async()=>{if(e)try{m(!0),y(null);const n=await J.getOrderById(e);if(n.success){if(h(n.data),n.data.payment_status==="paid"){o(`/orders/${e}`,{state:{message:"Order sudah dibayar"}});return}if(n.data.status==="cancelled"){y("Order sudah dibatalkan dan tidak dapat dibayar");return}}else y("Order tidak ditemukan")}catch(n){console.error("Error fetching order:",n),y(n.response?.data?.error||"Gagal memuat order")}finally{m(!1)}};if(u.useEffect(()=>{e&&E()},[e]),t)return a.jsx(d,{sx:{minHeight:"100vh",py:4},children:a.jsx(k,{maxWidth:"xl",children:a.jsx(r,{children:"Loading..."})})});if(c||!s)return a.jsx(d,{sx:{minHeight:"100vh",py:4},children:a.jsx(k,{maxWidth:"xl",children:a.jsx(g,{severity:"error",sx:{maxWidth:600,mx:"auto"},children:c||"Order tidak ditemukan"})})});const L=s.total_amount+s.shipping_cost;return a.jsx(d,{sx:{minHeight:"100vh",py:4},children:a.jsxs(k,{maxWidth:"xl",children:[a.jsxs(Y,{sx:{mb:4},children:[a.jsxs(I,{component:"button",variant:"body2",onClick:()=>o("/"),sx:{display:"flex",alignItems:"center",textDecoration:"none",color:"text.secondary","&:hover":{color:"primary.main"}},children:[a.jsx(K,{sx:{mr:.5,fontSize:"1rem"}}),"Beranda"]}),a.jsxs(I,{component:"button",variant:"body2",onClick:()=>o("/orders"),sx:{display:"flex",alignItems:"center",textDecoration:"none",color:"text.secondary","&:hover":{color:"primary.main"}},children:[a.jsx(V,{sx:{mr:.5,fontSize:"1rem"}}),"Pesanan"]}),a.jsxs(I,{component:"button",variant:"body2",onClick:()=>o(`/orders/${s.id}`),sx:{display:"flex",alignItems:"center",textDecoration:"none",color:"text.secondary","&:hover":{color:"primary.main"}},children:["#",s.id.slice(-8).toUpperCase()]}),a.jsxs(r,{variant:"body2",color:"text.primary",sx:{display:"flex",alignItems:"center"},children:[a.jsx(z,{sx:{mr:.5,fontSize:"1rem"}}),"Pembayaran"]})]}),a.jsx(W,{startIcon:a.jsx(Q,{}),onClick:()=>o(`/orders/${s.id}`),sx:{mb:4},children:"Kembali ke Detail Order"}),c&&a.jsx(g,{severity:"error",sx:{mb:4},onClose:()=>y(null),children:c}),a.jsxs(d,{sx:{mb:4},children:[a.jsxs(r,{variant:"h4",fontWeight:700,sx:{mb:1},children:["Pembayaran Order #",s.id.slice(-8).toUpperCase()]}),a.jsx(r,{variant:"body1",color:"text.secondary",children:"Lakukan pembayaran menggunakan PayPal Payment Gateway"})]}),a.jsxs(w,{container:!0,spacing:4,children:[a.jsxs(w,{item:!0,xs:12,lg:8,children:[a.jsx(C,{sx:{mb:4},children:a.jsxs(_,{children:[a.jsx(r,{variant:"h6",fontWeight:600,sx:{mb:3},children:"Metode Pembayaran - PayPal"}),a.jsxs(d,{sx:{p:3,backgroundColor:"#f8f9fa",borderRadius:2,mb:3,border:"1px solid #e9ecef"},children:[a.jsxs(j,{direction:"row",alignItems:"center",spacing:2,sx:{mb:2},children:[a.jsx(O,{sx:{fontSize:"2rem",color:"#003087"}}),a.jsxs(d,{children:[a.jsx(r,{variant:"h6",fontWeight:600,color:"#003087",children:"PayPal Payment Gateway"}),a.jsx(r,{variant:"body2",color:"text.secondary",children:"Pembayaran aman dan terpercaya dengan PayPal"})]})]}),a.jsx(g,{severity:"success",sx:{mb:2},children:a.jsxs(r,{variant:"body2",children:[a.jsx("strong",{children:"Keunggulan PayPal:"}),a.jsx("br",{}),"• Pembayaran instan dan aman",a.jsx("br",{}),"• Dilindungi oleh PayPal Buyer Protection",a.jsx("br",{}),"• Tidak perlu berbagi informasi kartu kredit",a.jsx("br",{}),"• Mendukung berbagai mata uang"]})}),a.jsx(g,{severity:"warning",sx:{mb:2},children:a.jsxs(r,{variant:"body2",children:[a.jsx("strong",{children:"Mode Sandbox:"})," Ini adalah environment testing PayPal. Gunakan akun PayPal sandbox untuk testing. Tidak ada transaksi sungguhan."]})})]}),a.jsx(ea,{order:s,onSuccess:n=>{console.log("Payment success, navigating with order ID:",s.id),P(n),o(`/payment/success?order_id=${s.id}`,{state:{orderId:s.id}})},onError:n=>y(n)})]})}),a.jsx(C,{children:a.jsxs(_,{children:[a.jsx(r,{variant:"h6",fontWeight:600,sx:{mb:2},children:"Informasi PayPal"}),a.jsxs(j,{spacing:2,children:[a.jsx(r,{variant:"body1",children:a.jsx("strong",{children:"Cara Pembayaran PayPal:"})}),a.jsxs(r,{variant:"body2",color:"text.secondary",children:['1. Klik tombol "Bayar dengan PayPal" di atas',a.jsx("br",{}),"2. Anda akan diarahkan ke halaman PayPal",a.jsx("br",{}),"3. Login ke akun PayPal Anda",a.jsx("br",{}),"4. Konfirmasi pembayaran",a.jsx("br",{}),"5. Anda akan diarahkan kembali ke halaman sukses"]}),a.jsx(g,{severity:"info",children:a.jsxs(r,{variant:"body2",children:[a.jsx("strong",{children:"Catatan:"})," Jika Anda belum memiliki akun PayPal, Anda dapat membuat akun baru langsung di halaman PayPal."]})})]})]})})]}),a.jsx(w,{item:!0,xs:12,lg:4,children:a.jsx(C,{sx:{position:"sticky",top:24},children:a.jsxs(_,{children:[a.jsx(r,{variant:"h6",fontWeight:600,sx:{mb:3},children:"Ringkasan Pembayaran"}),a.jsxs(d,{sx:{mb:3},children:[a.jsx(r,{variant:"subtitle2",color:"text.secondary",sx:{mb:1},children:"Order ID"}),a.jsxs(r,{variant:"body1",fontWeight:600,children:["#",s.id.slice(-8).toUpperCase()]})]}),a.jsxs(d,{sx:{mb:3},children:[a.jsx(r,{variant:"subtitle2",color:"text.secondary",sx:{mb:1},children:"Tanggal Order"}),a.jsx(r,{variant:"body1",fontWeight:600,children:B(s.created_at)})]}),a.jsx(S,{sx:{my:3}}),a.jsxs(j,{spacing:2,children:[a.jsxs(d,{sx:{display:"flex",justifyContent:"space-between"},children:[a.jsx(r,{variant:"body1",children:"Subtotal"}),a.jsx(r,{variant:"body1",fontWeight:600,children:v(s.total_amount)})]}),a.jsxs(d,{sx:{display:"flex",justifyContent:"space-between"},children:[a.jsx(r,{variant:"body1",children:"Biaya Pengiriman"}),a.jsx(r,{variant:"body1",fontWeight:600,children:v(s.shipping_cost)})]}),a.jsx(S,{}),a.jsxs(d,{sx:{display:"flex",justifyContent:"space-between"},children:[a.jsx(r,{variant:"h6",fontWeight:700,children:"Total Pembayaran"}),a.jsx(r,{variant:"h6",fontWeight:700,color:"primary.main",children:v(L)})]})]}),a.jsx(S,{sx:{my:3}}),a.jsxs(r,{variant:"subtitle1",fontWeight:600,sx:{mb:2},children:["Item (",s.order_items.length,")"]}),a.jsxs(j,{spacing:1,children:[s.order_items.slice(0,3).map(n=>{const M=n.product_variant.product.product_images?.[0]?.image_name;return a.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:2,p:1,borderRadius:1,backgroundColor:"#f8f9fa"},children:[a.jsx(N,{src:M||`https://placehold.co/40x40/9682DB/FFFFFF/png?text=${encodeURIComponent(n.product_variant.product.name)}`,alt:n.product_variant.product.name,sx:{width:40,height:40,borderRadius:1,flexShrink:0},variant:"rounded"}),a.jsxs(d,{sx:{flex:1,minWidth:0},children:[a.jsx(r,{variant:"body2",fontWeight:600,noWrap:!0,children:n.product_variant.product.name}),a.jsxs(r,{variant:"caption",color:"text.secondary",children:["Qty: ",n.quantity]})]})]},n.id)}),s.order_items.length>3&&a.jsxs(r,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:1},children:["dan ",s.order_items.length-3," item lainnya"]})]})]})})})]})]})})}export{la as default};
