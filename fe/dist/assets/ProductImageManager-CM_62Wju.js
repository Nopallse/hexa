import{c as w,j as a,aB as z,r as i,B as o,T as B,t as D,ak as T,A as _,aC as L,I as p,E as A}from"./index-D0K_J5MH.js";import{p as l}from"./productApi-BJP6DUOH.js";import{a as R}from"./image-CeHRN-zl.js";import{C as x,a as E}from"./CardContent-7fkJvOwG.js";import{U as F}from"./CloudUpload-CBIjH9ln.js";import{A as b}from"./Alert-D2FNR8Ya.js";import{S as M}from"./Star-C5pBDb5e.js";import{T as u}from"./Tooltip-qpArd1Jc.js";import{E as W}from"./Edit-xqQzbt_u.js";import{D as N}from"./Delete-BY8eW1nK.js";import{D as H,a as J,b as q}from"./DialogTitle-BCSOKhKg.js";const K=w(a.jsx("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"}),"StarBorder");function ia({productId:g,productName:O}){const{showNotification:r}=z(),m=i.useRef(null),[d,y]=i.useState([]),[j,h]=i.useState(!1),[f,c]=i.useState(!1),[k,C]=i.useState(!1),[I,G]=i.useState(""),n=async()=>{try{h(!0);const e=await l.getProductImages(g);e.success&&y(e.data)}catch(e){r({type:"error",message:e.message||"Gagal memuat gambar produk"})}finally{h(!1)}};i.useEffect(()=>{n()},[g]);const S=async e=>{const s=e.target.files?.[0];if(s){if(!s.type.startsWith("image/")){r({type:"error",message:"File harus berupa gambar"});return}if(s.size>5*1024*1024){r({type:"error",message:"Ukuran file maksimal 5MB"});return}try{c(!0);const t=d.length===0;await l.createProductImage(g,{image_name:"",is_primary:t,_imageFile:s}),r({type:"success",message:"Gambar berhasil ditambahkan"}),n()}catch(t){r({type:"error",message:t.message||"Gagal mengunggah gambar"})}finally{c(!1),m.current&&(m.current.value="")}}},U=async(e,s)=>{try{c(!0),await l.updateProductImage(e,{image_name:"",_imageFile:s}),r({type:"success",message:"Gambar berhasil diganti"}),n()}catch(t){r({type:"error",message:t.message||"Gagal mengganti gambar"})}finally{c(!1)}},v=async e=>{try{await l.updateProductImage(e,{is_primary:!0}),r({type:"success",message:"Gambar utama berhasil diperbarui"}),n()}catch(s){r({type:"error",message:s.message||"Gagal mengatur gambar utama"})}},P=async e=>{if(window.confirm("Apakah Anda yakin ingin menghapus gambar ini?"))try{await l.deleteProductImage(e.id),r({type:"success",message:"Gambar berhasil dihapus"}),n()}catch(t){r({type:"error",message:t.message||"Gagal menghapus gambar"})}};return a.jsx(x,{children:a.jsxs(E,{children:[a.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[a.jsx(B,{variant:"h6",fontWeight:"bold",children:"Gambar Produk"}),a.jsxs(o,{sx:{display:"flex",gap:1},children:[a.jsx("input",{type:"file",ref:m,onChange:S,accept:"image/*",style:{display:"none"}}),a.jsx(D,{variant:"outlined",startIcon:a.jsx(F,{}),onClick:()=>m.current?.click(),disabled:f,children:f?a.jsx(T,{size:20}):"Upload"})]})]}),j?a.jsx(b,{severity:"info",children:"Memuat gambar produk..."}):d.length===0?a.jsx(b,{severity:"info",children:"Belum ada gambar produk. Tambahkan gambar untuk menarik perhatian pelanggan."}):a.jsx(o,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(3, 1fr)",md:"repeat(4, 1fr)"},gap:2},children:d.map(e=>a.jsx(o,{children:a.jsx(x,{variant:"outlined",children:a.jsxs(o,{sx:{position:"relative"},children:[a.jsx(_,{src:R(e.image_name),variant:"rounded",sx:{width:"100%",height:200}}),e.is_primary&&a.jsx(L,{badgeContent:a.jsx(M,{sx:{fontSize:16}}),color:"primary",sx:{position:"absolute",top:8,left:8,"& .MuiBadge-badge":{backgroundColor:"primary.main",color:"white"}}}),a.jsxs(o,{sx:{position:"absolute",top:8,right:8,display:"flex",flexDirection:"column",gap:.5},children:[!e.is_primary&&a.jsx(u,{title:"Jadikan Gambar Utama",children:a.jsx(p,{size:"small",onClick:()=>v(e.id),sx:{backgroundColor:"rgba(255,255,255,0.9)","&:hover":{backgroundColor:"rgba(255,255,255,1)"}},children:a.jsx(K,{fontSize:"small"})})}),a.jsx(u,{title:"Ganti Gambar",children:a.jsxs(p,{size:"small",component:"label",sx:{backgroundColor:"rgba(255,255,255,0.9)","&:hover":{backgroundColor:"rgba(255,255,255,1)"}},children:[a.jsx(W,{fontSize:"small"}),a.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:s=>{const t=s.target.files?.[0];t&&U(e.id,t)}})]})}),a.jsx(u,{title:"Hapus Gambar",children:a.jsx(p,{size:"small",onClick:()=>P(e),color:"error",sx:{backgroundColor:"rgba(255,255,255,0.9)","&:hover":{backgroundColor:"rgba(255,255,255,1)"}},children:a.jsx(N,{fontSize:"small"})})})]})]})})},e.id))}),a.jsxs(H,{open:k,onClose:()=>C(!1),maxWidth:"sm",fullWidth:!0,children:[a.jsx(J,{children:"Tambah Gambar dari URL"}),a.jsx(q,{children:a.jsx(A,{label:"URL Gambar",fullWidth:!0,margin:"normal",value:I,onChange:e=>G(e.target.value),placeholder:"https://example.com/image.jpg",helperText:"Pastikan URL mengarah langsung ke file gambar"})})]})]})})}export{ia as P};
