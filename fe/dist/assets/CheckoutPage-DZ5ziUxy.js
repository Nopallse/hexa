import{a as X,g as Y,r as s,u as de,_ as ee,ad as je,ae as _e,i as F,j as e,s as A,k as re,m as te,c as ue,Q as pe,af as Ce,l as Q,R as ke,d as Se,h as Re,b as we,p as Z,T as i,B as l,S as D,a9 as Ie,M as ne,v as N,t as T,ac as Fe,q as xe,a2 as he,E as $e,aa as H,a7 as M,H as Pe,ag as Me,a8 as We,C as J}from"./index-7B7oaQt6.js";import{u as ze}from"./cartStore-BAvFnbGg.js";import{u as Ee}from"./orderStore-BSCe3j71.js";import{o as oe}from"./orderApi-BUQiOPIP.js";import{u as ae}from"./useCurrencyConversion-NIiS0DJY.js";import{C as B,a as O}from"./CardContent-6W3rtoXv.js";import{A as Be}from"./Avatar-DZC-Ug_4.js";import{a as Oe}from"./addressApi-92MvJ3US.js";import{S as Ge}from"./Skeleton-DSF7tpeV.js";import{A as W}from"./Alert-Cx2n4D67.js";import{A as se}from"./Add-Df9lPO9U.js";import{S as De,F as me}from"./FormControlLabel-BxGeD_Ly.js";import{l as Le}from"./locationApi-3iQcHOzI.js";import{M as Ne}from"./AttachMoney-Ds-XlK9D.js";import{S as Te}from"./Schedule-C86DOaz7.js";import"./useSlot-BMQvfvuc.js";function Ae(r){return X("MuiFormGroup",r)}Y("MuiFormGroup",["root","row","error"]);const Ue=["className","row"],qe=r=>{const{classes:t,row:n,error:o}=r;return te({root:["root",n&&"row",o&&"error"]},Ae,t)},Ve=A("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(r,t)=>{const{ownerState:n}=r;return[t.root,n.row&&t.row]}})(({ownerState:r})=>F({display:"flex",flexDirection:"column",flexWrap:"wrap"},r.row&&{flexDirection:"row"})),Ke=s.forwardRef(function(t,n){const o=de({props:t,name:"MuiFormGroup"}),{className:d,row:f=!1}=o,b=ee(o,Ue),k=je(),p=_e({props:o,muiFormControl:k,states:["error"]}),g=F({},o,{row:f,error:p.error}),x=qe(g);return e.jsx(Ve,F({className:re(x.root,d),ownerState:g,ref:n},b))}),He=ue(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),Qe=ue(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),Ze=A("span",{name:"MuiRadioButtonIcon",shouldForwardProp:pe})({position:"relative",display:"flex"}),Je=A(He,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),Xe=A(Qe,{name:"MuiRadioButtonIcon"})(({theme:r,ownerState:t})=>F({left:0,position:"absolute",transform:"scale(0)",transition:r.transitions.create("transform",{easing:r.transitions.easing.easeIn,duration:r.transitions.duration.shortest})},t.checked&&{transform:"scale(1)",transition:r.transitions.create("transform",{easing:r.transitions.easing.easeOut,duration:r.transitions.duration.shortest})}));function ge(r){const{checked:t=!1,classes:n={},fontSize:o}=r,d=F({},r,{checked:t});return e.jsxs(Ze,{className:n.root,ownerState:d,children:[e.jsx(Je,{fontSize:o,className:n.background,ownerState:d}),e.jsx(Xe,{fontSize:o,className:n.dot,ownerState:d})]})}const fe=s.createContext(void 0);function Ye(){return s.useContext(fe)}function er(r){return X("MuiRadio",r)}const ie=Y("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),rr=["checked","checkedIcon","color","icon","name","onChange","size","className"],tr=r=>{const{classes:t,color:n,size:o}=r,d={root:["root",`color${Q(n)}`,o!=="medium"&&`size${Q(o)}`]};return F({},t,te(d,er,t))},ar=A(De,{shouldForwardProp:r=>pe(r)||r==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(r,t)=>{const{ownerState:n}=r;return[t.root,n.size!=="medium"&&t[`size${Q(n.size)}`],t[`color${Q(n.color)}`]]}})(({theme:r,ownerState:t})=>F({color:(r.vars||r).palette.text.secondary},!t.disableRipple&&{"&:hover":{backgroundColor:r.vars?`rgba(${t.color==="default"?r.vars.palette.action.activeChannel:r.vars.palette[t.color].mainChannel} / ${r.vars.palette.action.hoverOpacity})`:ke.alpha(t.color==="default"?r.palette.action.active:r.palette[t.color].main,r.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},t.color!=="default"&&{[`&.${ie.checked}`]:{color:(r.vars||r).palette[t.color].main}},{[`&.${ie.disabled}`]:{color:(r.vars||r).palette.action.disabled}}));function nr(r,t){return typeof t=="object"&&t!==null?r===t:String(r)===String(t)}const ce=e.jsx(ge,{checked:!0}),le=e.jsx(ge,{}),ye=s.forwardRef(function(t,n){var o,d;const f=de({props:t,name:"MuiRadio"}),{checked:b,checkedIcon:k=ce,color:p="primary",icon:g=le,name:x,onChange:y,size:c="medium",className:S}=f,u=ee(f,rr),v=F({},f,{color:p,size:c}),j=tr(v),C=Ye();let _=b;const $=Ce(y,C&&C.onChange);let R=x;return C&&(typeof _>"u"&&(_=nr(C.value,f.value)),typeof R>"u"&&(R=C.name)),e.jsx(ar,F({type:"radio",icon:s.cloneElement(g,{fontSize:(o=le.props.fontSize)!=null?o:c}),checkedIcon:s.cloneElement(k,{fontSize:(d=ce.props.fontSize)!=null?d:c}),ownerState:v,classes:j,name:R,checked:_,onChange:$,ref:n,className:re(j.root,S)},u))});function or(r){return X("MuiRadioGroup",r)}Y("MuiRadioGroup",["root","row","error"]);const sr=["actions","children","className","defaultValue","name","onChange","value"],ir=r=>{const{classes:t,row:n,error:o}=r;return te({root:["root",n&&"row",o&&"error"]},or,t)},ve=s.forwardRef(function(t,n){const{actions:o,children:d,className:f,defaultValue:b,name:k,onChange:p,value:g}=t,x=ee(t,sr),y=s.useRef(null),c=ir(t),[S,u]=Se({controlled:g,default:b,name:"RadioGroup"});s.useImperativeHandle(o,()=>({focus:()=>{let _=y.current.querySelector("input:not(:disabled):checked");_||(_=y.current.querySelector("input:not(:disabled)")),_&&_.focus()}}),[]);const v=Re(n,y),j=we(k),C=s.useMemo(()=>({name:j,onChange(_){u(_.target.value),p&&p(_,_.target.value)},value:S}),[j,p,u,S]);return e.jsx(fe.Provider,{value:C,children:e.jsx(Ke,F({role:"radiogroup",ref:v,className:re(c.root,f)},x,{children:d}))})});function cr({items:r,subtotal:t,shippingCost:n,total:o,onCreateOrder:d,creatingOrder:f,disabled:b,selectedPaymentMethod:k,selectedShippingMethod:p}){Z();const{formatPrice:g}=ae(),x=c=>{switch(c){case"biteship":return"ðŸšš Biteship";case"fedex":return"ðŸ“¦ FedEx";case"fedex-estimated":return"ðŸ“¦ FedEx (Est.)";case"indonesia-estimated":return"ðŸ‡®ðŸ‡© Indonesia (Est.)";default:return"ðŸ“¦ Shipping"}},y=c=>{switch(c){case"biteship":return"primary";case"fedex":return"error";case"fedex-estimated":return"warning";case"indonesia-estimated":return"info";default:return"default"}};return e.jsx(B,{sx:{position:"sticky",top:24,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:"none"},children:e.jsxs(O,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:3,color:"text.primary"},children:"Ringkasan Pesanan"}),e.jsxs(l,{sx:{mb:3},children:[e.jsxs(i,{variant:"subtitle1",fontWeight:600,sx:{mb:2},children:["Item (",r.length,")"]}),e.jsx(D,{spacing:2,children:r.map(c=>{const S=c.product_variant.product.product_images?.[0]?.image_name;return e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:2,p:2,borderRadius:2,backgroundColor:"grey.50"},children:[e.jsx(Be,{src:S||`https://placehold.co/50x50/9682DB/FFFFFF/png?text=${encodeURIComponent(c.product_variant.product.name.substring(0,10))}`,alt:c.product_variant.product.name,sx:{width:50,height:50,borderRadius:2,flexShrink:0,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},variant:"rounded",children:e.jsx(Ie,{})}),e.jsxs(l,{sx:{flex:1,minWidth:0},children:[e.jsx(i,{variant:"subtitle2",fontWeight:600,sx:{mb:.5,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:c.product_variant.product.name,children:c.product_variant.product.name}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:c.product_variant.variant_name}),e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:["Qty: ",c.quantity]})]}),e.jsx(i,{variant:"body2",fontWeight:600,color:"primary.main",sx:{fontSize:"0.9rem"},children:g(parseFloat(c.product_variant.price)*c.quantity)})]},c.id)})})]}),e.jsx(ne,{sx:{my:2}}),e.jsxs(D,{spacing:2,children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[e.jsx(i,{variant:"body1",fontWeight:500,children:"Subtotal"}),e.jsx(i,{variant:"body1",fontWeight:600,children:g(t)})]}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[e.jsxs(l,{children:[e.jsx(i,{variant:"body1",fontWeight:500,children:"Biaya Pengiriman"}),p&&e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsxs(i,{variant:"body2",color:"text.secondary",children:[p.courier_name," - ",p.courier_service_name]}),p.provider&&e.jsx(N,{label:x(p.provider),size:"small",color:y(p.provider),variant:"outlined"})]})]}),e.jsx(i,{variant:"body1",fontWeight:600,children:g(n)})]}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"primary.main",borderRadius:2,color:"white"},children:[e.jsx(i,{variant:"h6",fontWeight:600,children:"Total"}),e.jsx(i,{variant:"h6",fontWeight:700,children:g(o)})]})]}),e.jsx(ne,{sx:{my:3}}),e.jsx(T,{variant:"contained",size:"large",startIcon:e.jsx(Fe,{}),onClick:d,disabled:b||f,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:600,fontSize:"1rem",backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"},"&:disabled":{backgroundColor:"grey.300",color:"grey.500"}},children:f?"Membuat Order...":"Buat Order & Bayar"}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:2,textAlign:"center"},children:"Dengan melanjutkan, Anda menyetujui syarat dan ketentuan kami"})]})})}function lr({selectedAddress:r,onAddressSelect:t,onAddressesLoaded:n}){const o=Z(),d=xe(),[f,b]=s.useState([]),[k,p]=s.useState(!0),[g,x]=s.useState(null),y=s.useRef(t),c=s.useRef(n);s.useEffect(()=>{y.current=t,c.current=n},[t,n]),s.useEffect(()=>{(async()=>{try{p(!0),x(null);const v=await Oe.getAddresses();if(v.success){b(v.data),c.current?.(v.data);const j=v.data.find(C=>C.is_primary);j&&!r&&y.current(j.id)}else x("Gagal memuat alamat")}catch(v){console.error("Error fetching addresses:",v),x(v.response?.data?.error||"Gagal memuat alamat")}finally{p(!1)}})()},[]);const S=()=>{d("/addresses/add",{state:{returnTo:"/checkout"}})};return k?e.jsx(B,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(O,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:2,color:"text.primary"},children:"Alamat Pengiriman"}),e.jsx(D,{spacing:2,children:[...Array(2)].map((u,v)=>e.jsx(Ge,{variant:"rectangular",height:80,sx:{borderRadius:2}},v))})]})}):f.length===0?e.jsx(B,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(O,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:2,color:"text.primary"},children:"Alamat Pengiriman"}),e.jsx(W,{severity:"info",sx:{mb:2,borderRadius:2},children:"Anda belum memiliki alamat pengiriman. Silakan tambahkan alamat terlebih dahulu."}),e.jsx(T,{variant:"contained",startIcon:e.jsx(se,{}),onClick:S,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:600,backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:"Tambah Alamat"})]})}):e.jsx(B,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(O,{sx:{p:3},children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{color:"text.primary"},children:"Alamat Pengiriman"}),e.jsx(T,{variant:"outlined",size:"small",startIcon:e.jsx(se,{}),onClick:S,sx:{borderRadius:2,fontWeight:500,borderColor:"primary.main",color:"primary.main","&:hover":{backgroundColor:"primary.light",borderColor:"primary.dark"}},children:"Tambah Alamat"})]}),g&&e.jsx(W,{severity:"error",sx:{mb:2,borderRadius:2},onClose:()=>x(null),children:g}),e.jsx(he,{component:"fieldset",fullWidth:!0,children:e.jsx(ve,{value:r||"",onChange:u=>t(u.target.value),children:f.map(u=>e.jsx(me,{value:u.id,control:e.jsx(ye,{}),label:e.jsx(l,{sx:{p:2,border:r===u.id?`2px solid ${o.palette.primary.main}`:`1px solid ${o.palette.grey[200]}`,borderRadius:2,backgroundColor:r===u.id?o.palette.primary.light+"10":"grey.50",transition:"all 0.2s ease",width:"100%","&:hover":{backgroundColor:r===u.id?o.palette.primary.light+"15":"grey.100"}},children:e.jsxs(D,{direction:"row",spacing:2,alignItems:"flex-start",children:[e.jsx($e,{color:"primary",sx:{mt:.5,flexShrink:0}}),e.jsxs(l,{sx:{flex:1},children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,children:u.address_line}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[u.city,", ",u.province," ",u.postal_code]}),u.is_primary&&e.jsx(l,{sx:{display:"inline-block",backgroundColor:o.palette.primary.main,color:"white",px:1,py:.5,borderRadius:1,fontSize:"0.75rem",fontWeight:600,mt:1},children:"Utama"})]})]})}),sx:{width:"100%",margin:0,"& .MuiFormControlLabel-label":{width:"100%"}}},u.id))})})]})})}const dr={getShippingRates:async r=>{try{const t=await H.post("/shipping/rates",r);return{success:!0,data:t.data.data,provider:t.data.provider,origin_country:t.data.origin_country,destination_country:t.data.destination_country}}catch(t){return{success:!1,error:t.response?.data?.error||"Failed to fetch shipping rates"}}},getAreas:async(r={})=>{try{return{success:!0,data:(await H.get("/shipping/areas",{params:r})).data.data}}catch(t){return{success:!1,error:t.response?.data?.error||"Failed to fetch areas"}}},trackShipment:async(r,t)=>{try{const n=t?{courier:t}:{},o=await H.get(`/shipping/track/${r}`,{params:n});return{success:!0,data:o.data.data,provider:o.data.provider}}catch(n){return{success:!1,error:n.response?.data?.error||"Failed to track shipment"}}},trackFedExShipment:async r=>{try{const t=await H.get(`/shipping/track/fedex/${r}`);return{success:!0,data:t.data.data,provider:t.data.provider}}catch(t){return{success:!1,error:t.response?.data?.error||"Failed to track FedEx shipment"}}}};function ur(r,t){const[n,o]=s.useState(r);return s.useEffect(()=>{const d=setTimeout(()=>{o(r)},t);return()=>{clearTimeout(d)}},[r,t]),n}const pr=r=>{const n=r.trim().replace(/\s*days?\s*$/i,"").split(/\s*-\s*/),o=parseInt(n[0],10),d=n.length>1?parseInt(n[1],10):o;return{min_day:isNaN(o)?1:o,max_day:isNaN(d)?o||3:d}},xr=r=>{const t=pr(r.shipment_duration_range||r.duration||"1 - 3");let n="standard";return r.service_type==="overnight"?n="overnight":r.service_type==="express"?n="express":r.service_type==="economy"&&(n="economy"),{courier_name:r.courier_name||r.company||"",courier_code:r.courier_code||r.company||"",courier_service_name:r.courier_service_name||"",courier_service_code:r.courier_service_code||r.type||"",service_type:n,description:r.description||"",shipping_type:r.shipping_type||"parcel",ship_type:r.shipping_type||"parcel",service_name:r.courier_service_name||"",price:r.price||r.shipping_fee||0,currency:r.currency||"IDR",type:r.type||r.courier_service_code||"",min_day:t.min_day,max_day:t.max_day,provider:"biteship"}};function hr({selectedAddress:r,cartItems:t,selectedMethod:n,onMethodSelect:o}){const d=Z(),{formatPrice:f}=ae(),[b,k]=s.useState([]),[p,g]=s.useState(!1),[x,y]=s.useState(null),[c,S]=s.useState(null),[u,v]=s.useState(null),[j,C]=s.useState(""),[_,$]=s.useState(!1),R=M.useMemo(()=>t.map(a=>({name:a.product_variant.product.name,description:a.product_variant.product.description||"",length:a.product_variant.product.length||10,width:a.product_variant.product.width||10,height:a.product_variant.product.height||1,weight:a.product_variant.product.weight||a.product_variant.weight||1e3,quantity:a.quantity,value:a.product_variant.price*a.quantity})),[t]),E=M.useMemo(()=>r?`${r.id}_${r.country}_${r.postal_code}`:null,[r?.id,r?.country,r?.postal_code]),L=M.useMemo(()=>R.reduce((a,m)=>a+m.weight*m.quantity,0),[R]),G=M.useMemo(()=>!r||t.length===0?null:`${E}_${L}_${R.length}`,[E,L,R.length,t.length]),P=ur(G,500);s.useEffect(()=>{(async()=>{try{const m=await Le.getActiveOriginLocation();m.success&&m.data&&v(m.data)}catch(m){console.error("Failed to fetch active origin:",m)}})()},[]),s.useEffect(()=>{r&&t.length>0&&u&&P&&P!==c&&U()},[P,u]);const U=async()=>{if(!(!r||!P||!u)&&!p)try{g(!0),y(null),S(P);const a=await dr.getShippingRates({origin_postal_code:u.postal_code,destination_postal_code:r.postal_code,origin_country:"ID",destination_country:r.country,items:R});if(P===c||!c)if(a.success&&a.data){const I=(a.data.pricing||[]).map(h=>xr(h));k(I),C(a.provider||""),$(r.country!=="ID")}else y(a.error||"Failed to fetch shipping rates")}catch(a){(P===c||!c)&&y(a.message||"Failed to fetch shipping rates")}finally{g(!1)}};M.useEffect(()=>()=>{g(!1),y(null)},[]);const q=(a,m)=>a===m?`${a} hari`:`${a}-${m} hari`,V=a=>{switch(a){case"express":case"overnight":return"error";case"standard":return"primary";case"economy":return"success";default:return"default"}},z=a=>{switch(a){case"express":return"Express";case"standard":return"Standard";case"economy":return"Economy";case"overnight":return"Overnight";default:return a}},w=a=>{switch(a){case"biteship":return{name:"Biteship",color:"primary",icon:"ðŸšš"};case"fedex":return{name:"FedEx",color:"error",icon:"ðŸ“¦"};case"fedex-estimated":return{name:"FedEx (Estimated)",color:"warning",icon:"ðŸ“¦"};case"indonesia-estimated":return{name:"Indonesia (Estimated)",color:"info",icon:"ðŸ‡®ðŸ‡©"};default:return{name:"Shipping",color:"default",icon:"ðŸ“¦"}}};return r?e.jsx(B,{children:e.jsxs(O,{children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Pe,{sx:{fontSize:"1.5rem",mr:1,color:"primary.main"}}),e.jsx(i,{variant:"h6",fontWeight:600,children:"Pilih Metode Pengiriman"})]}),j&&e.jsx(N,{label:`${w(j).icon} ${w(j).name}`,color:w(j).color,size:"small",variant:"outlined"})]}),e.jsxs(l,{sx:{mb:3,p:2,backgroundColor:"grey.50",borderRadius:2},children:[e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Alamat Pengiriman:"}),e.jsx(i,{variant:"body1",fontWeight:500,children:r.recipient_name}),e.jsx(i,{variant:"body2",color:"text.secondary",children:r.address_line}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[r.city,", ",r.province," ",r.postal_code]}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[r.country==="ID"?"ðŸ‡®ðŸ‡© Indonesia":`ðŸŒ ${r.country}`,_&&e.jsx(N,{label:"Internasional",size:"small",color:"warning",variant:"outlined",sx:{ml:1,fontSize:"0.7rem"}})]})]}),p&&e.jsxs(l,{sx:{display:"flex",justifyContent:"center",py:3},children:[e.jsx(Me,{size:24}),e.jsx(i,{variant:"body2",sx:{ml:2},children:"Mencari opsi pengiriman..."})]}),x&&e.jsxs(W,{severity:"error",sx:{mb:3},children:[x,e.jsx(T,{size:"small",onClick:U,sx:{ml:2},children:"Coba Lagi"})]}),!p&&!x&&b.length>0&&e.jsxs(he,{component:"fieldset",fullWidth:!0,children:[e.jsx(We,{component:"legend",sx:{mb:2,fontWeight:600},children:"Pilih Metode Pengiriman"}),e.jsx(ve,{value:n||"",onChange:a=>{const m=b.find(I=>`${I.courier_code}_${I.courier_service_code}`===a.target.value);m&&o(m)},children:e.jsx(D,{spacing:2,children:b.map(a=>{const m=`${a.courier_code}_${a.courier_service_code}`,I=n===m;return e.jsx(B,{sx:{border:I?`2px solid ${d.palette.primary.main}`:"1px solid",borderColor:I?"primary.main":"grey.300",backgroundColor:I?"primary.light":"white",transition:"all 0.2s ease",cursor:"pointer","&:hover":{borderColor:"primary.main",backgroundColor:"primary.light"}},onClick:()=>{`${a.courier_code}${a.courier_service_code}`,o(a)},children:e.jsxs(O,{sx:{p:2},children:[e.jsx(me,{value:m,control:e.jsx(ye,{}),label:"",sx:{m:0}}),e.jsxs(l,{sx:{ml:4},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",mb:1,flexWrap:"wrap",gap:1},children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,children:a.courier_name}),e.jsx(N,{label:z(a.service_type),color:V(a.service_type),size:"small"}),a.provider&&a.provider!==j&&e.jsx(N,{label:`${w(a.provider).icon} ${w(a.provider).name}`,color:w(a.provider).color,size:"small",variant:"outlined"})]}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:2},children:a.description}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:3},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ne,{sx:{fontSize:"1rem",mr:.5,color:"success.main"}}),e.jsx(i,{variant:"h6",fontWeight:600,color:"success.main",children:f(a.price,a.currency||"IDR")})]}),e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Te,{sx:{fontSize:"1rem",mr:.5,color:"text.secondary"}}),e.jsx(i,{variant:"body2",color:"text.secondary",children:q(a.min_day,a.max_day)})]})]})]})]})},m)})})})]}),!p&&!x&&b.length===0&&e.jsx(W,{severity:"warning",children:"Tidak ada opsi pengiriman tersedia untuk alamat inii"})]})}):e.jsx(B,{children:e.jsx(O,{children:e.jsx(W,{severity:"info",children:"Pilih alamat pengiriman terlebih dahulu untuk melihat opsi pengiriman"})})})}function Pr(){Z();const r=xe(),{loading:t,error:n}=ae(),[o,d]=s.useState(!0),[f,b]=s.useState(!1),[k,p]=s.useState(!1),[g,x]=s.useState(null),[y,c]=s.useState(null),[S,u]=s.useState(null),[v,j]=s.useState([]),[C,_]=s.useState("midtrans"),[$,R]=s.useState(null),[E,L]=s.useState(15e3),{items:G,clearCart:P}=ze(),{addOrder:U,setPaymentMethods:q,paymentMethods:V}=Ee(),z=M.useMemo(()=>G.filter(h=>h.product_variant.product.deleted_at===null),[G]),w=M.useMemo(()=>z.reduce((h,K)=>h+parseFloat(K.product_variant.price)*K.quantity,0),[z]),a=M.useMemo(()=>w+E,[w,E]),m=M.useCallback(async()=>{try{const h=await oe.getPaymentMethods();h.success&&q(h.data)}catch(h){console.error("Error fetching payment methods:",h)}},[q]),I=async()=>{if(!y){x("Pilih alamat pengiriman terlebih dahulu");return}if(z.length===0){x("Tidak ada item yang tersedia untuk checkout");return}try{b(!0),x(null);const h=await oe.createOrder({address_id:y,shipping_cost:E});h.success&&(U(h.data),p(!0),P(),r(`/orders/${h.data.order_id}`,{state:{message:"Order berhasil dibuat! Silakan lakukan pembayaran.",selectedPaymentMethod:C}}))}catch(h){console.error("Error creating order:",h),x(h.response?.data?.error||"Gagal membuat order")}finally{b(!1)}};return s.useEffect(()=>{if(G.length===0&&!f&&!k){r("/cart");return}V.length===0&&m(),d(!1)},[G.length,r,f,k,m,V.length]),o?e.jsx(l,{sx:{minHeight:"100vh",py:4},children:e.jsx(J,{maxWidth:"xl",children:e.jsx(i,{children:"Loading..."})})}):z.length===0?e.jsx(l,{sx:{minHeight:"100vh",py:4},children:e.jsxs(J,{maxWidth:"xl",children:[e.jsx(W,{severity:"warning",sx:{mb:4},children:"Tidak ada item yang tersedia untuk checkout. Semua item di keranjang sudah tidak tersedia."}),e.jsx(T,{variant:"contained",onClick:()=>r("/cart"),children:"Kembali ke Keranjang"})]})}):e.jsx(l,{sx:{minHeight:"100vh",py:4},children:e.jsxs(J,{maxWidth:"xl",children:[e.jsxs(l,{sx:{mb:3},children:[e.jsx(i,{variant:"h4",fontWeight:600,sx:{mb:1,color:"text.primary"},children:"Checkout"}),e.jsx(i,{variant:"body1",color:"text.secondary",children:"Lengkapi informasi pengiriman dan pembayaran"})]}),g&&e.jsx(W,{severity:"error",sx:{mb:4},onClose:()=>x(null),children:g}),t&&e.jsx(W,{severity:"info",sx:{mb:2},children:"Loading exchange rates..."}),n&&e.jsx(W,{severity:"warning",sx:{mb:2},children:"Failed to load exchange rates. Prices will be displayed in default currency."}),e.jsxs(l,{sx:{display:"flex",flexDirection:{xs:"column",lg:"row"},gap:4,alignItems:"flex-start"},children:[e.jsx(l,{sx:{flex:1,minWidth:0,order:{xs:1,lg:1}},children:e.jsxs(D,{spacing:4,children:[e.jsx(lr,{selectedAddress:y,onAddressSelect:h=>{c(h);const K=v.find(be=>be.id===h);u(K),R(null),L(15e3)},onAddressesLoaded:j}),e.jsx(hr,{selectedAddress:S,cartItems:z,selectedMethod:$?`${$.courier_code}_${$.courier_service_code}`:null,onMethodSelect:h=>{R(h),L(h.price)}})]})}),e.jsx(l,{sx:{width:{xs:"100%",lg:"400px"},flexShrink:0,order:{xs:2,lg:2}},children:e.jsx(cr,{items:z,subtotal:w,shippingCost:E,total:a,onCreateOrder:I,creatingOrder:f,disabled:!y||!$,selectedPaymentMethod:C,selectedShippingMethod:$})})]})]})})}export{Pr as default};
