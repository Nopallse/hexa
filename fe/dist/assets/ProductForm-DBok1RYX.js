import{c as $,j as e,r as h,T as o,B as m,b as v,i as J,D as y,F as O,z as Q,E as X,M,h as k,P as Y,S as Z,I as L}from"./index-BNHkdQXN.js";import{u as ee,a as ae,o as V,s as c,l as W,n as B}from"./schemas-B-_fRkL-.js";import{P as re}from"./ProductVariantManager-BJ7JxAdk.js";import{P as te}from"./ProductImageManager-DTqaUGxC.js";import{C as b,a as ie}from"./CardContent-Xxy-Rqsq.js";import{A as S}from"./Alert-CGwzUP-j.js";import{U as se}from"./CloudUpload-salt8l8H.js";import{C as ne}from"./CardMedia-ZAZUzI8i.js";import{D as oe}from"./Delete-C5OGYaUx.js";import{F as le}from"./FormControlLabel-D-UURHDS.js";import{S as me}from"./Switch-ij0PE0FT.js";const de=$(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-6h2zm0-8h-2V7h2z"}),"Info"),ce=V({category_id:c().min(1,"Kategori wajib dipilih").uuid("ID kategori tidak valid"),name:c().min(1,"Nama produk wajib diisi").min(2,"Nama produk minimal 2 karakter").max(200,"Nama produk maksimal 200 karakter"),description:c().max(1e3,"Deskripsi maksimal 1000 karakter").optional().or(W("")),price:B().min(0,"Harga tidak boleh negatif").max(999999999,"Harga terlalu besar"),stock:B().int("Stok harus berupa bilangan bulat").min(0,"Stok tidak boleh negatif").max(99999,"Stok maksimal 99999")}),pe=V({category_id:c().min(1,"Kategori wajib dipilih").uuid("ID kategori tidak valid"),name:c().min(1,"Nama produk wajib diisi").min(2,"Nama produk minimal 2 karakter").max(200,"Nama produk maksimal 200 karakter"),description:c().max(1e3,"Deskripsi maksimal 1000 karakter").optional().or(W(""))});function _e({product:t,categories:D,isLoading:n=!1,error:P,onSubmit:T,onCancel:I,mode:s}){const x=t?.product_variants&&t.product_variants.length>0,[d,_]=h.useState(x||!1),[j,w]=h.useState([]),[C,F]=h.useState([]),[ue,he]=h.useState(!1),z=d?pe:ce,{register:p,handleSubmit:H,formState:{errors:i},reset:N,setValue:R,watch:U}=ee({resolver:ae(z),defaultValues:{category_id:"",name:"",description:"",price:0,stock:0}});h.useEffect(()=>{if(t&&s==="edit"){const a=!!(t.product_variants&&t.product_variants.length>0);_(a),N({category_id:t.category_id,name:t.name,description:t.description||"",price:typeof t.price=="string"?parseFloat(t.price):t.price||0,stock:t.stock||0})}},[t,s,N]);const E=a=>{const r=Array.from(a.target.files||[]);if(r.length===0)return;const g=r.filter(l=>l.type.startsWith("image/")?l.size>5*1024*1024?(alert(`${l.name} terlalu besar (max 5MB)`),!1):!0:(alert(`${l.name} bukan file gambar`),!1));if(g.length===0)return;const u=5-j.length,A=g.slice(0,u);w(l=>[...l,...A]),A.forEach(l=>{const f=new FileReader;f.onloadend=()=>{F(q=>[...q,f.result])},f.readAsDataURL(l)})},G=a=>{w(r=>r.filter((g,u)=>u!==a)),F(r=>r.filter((g,u)=>u!==a))},K=async a=>{const r={category_id:a.category_id,name:a.name,description:a.description||void 0,_imageFiles:j};d?(r.price=0,r.stock=0):(r.price=a.price,r.stock=a.stock),await T(r)};return e.jsxs(e.Fragment,{children:[s==="edit"&&t&&e.jsx(b,{sx:{mb:3},children:e.jsx(te,{productId:t.id,productName:t.name})}),e.jsx(b,{children:e.jsxs(ie,{children:[e.jsx(o,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:s==="create"?"Tambah Produk Baru":"Edit Produk"}),P&&e.jsx(S,{severity:"error",sx:{mb:3},children:P}),e.jsxs(m,{component:"form",onSubmit:H(K),sx:{mt:3,maxWidth:800,mx:"auto"},children:[s==="create"&&e.jsxs(m,{sx:{mb:3},children:[e.jsx(o,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Gambar Produk"}),e.jsxs(v,{component:"label",variant:"outlined",startIcon:e.jsx(se,{}),disabled:n||j.length>=5,sx:{mb:2},children:["Pilih Gambar (Max 5)",e.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:E})]}),e.jsx(o,{variant:"caption",display:"block",color:"text.secondary",sx:{mb:2},children:"Format: JPG, PNG, WebP (Max 5MB per file). Gambar pertama akan menjadi gambar utama."}),C.length>0&&e.jsx(m,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(3, 1fr)",md:"repeat(4, 1fr)"},gap:2},children:C.map((a,r)=>e.jsxs(b,{sx:{position:"relative"},children:[e.jsx(ne,{component:"img",height:"150",image:a,alt:`Preview ${r+1}`,sx:{objectFit:"cover"}}),e.jsx(J,{onClick:()=>G(r),disabled:n,sx:{position:"absolute",top:4,right:4,bgcolor:"background.paper","&:hover":{bgcolor:"error.light",color:"white"}},size:"small",children:e.jsx(oe,{fontSize:"small"})}),r===0&&e.jsx(m,{sx:{position:"absolute",bottom:0,left:0,right:0,bgcolor:"primary.main",color:"white",py:.5,px:1,textAlign:"center"},children:e.jsx(o,{variant:"caption",children:"Gambar Utama"})})]},r))}),e.jsx(y,{sx:{my:3}})]}),e.jsxs(O,{fullWidth:!0,margin:"normal",error:!!i.category_id,children:[e.jsx(Q,{children:"Kategori *"}),e.jsxs(X,{...p("category_id"),label:"Kategori *",disabled:n,value:U("category_id")||"",onChange:a=>R("category_id",a.target.value),children:[e.jsx(M,{value:"",children:e.jsx("em",{children:"Pilih Kategori"})}),D.map(a=>e.jsx(M,{value:a.id,children:a.name},a.id))]}),i.category_id&&e.jsx(o,{variant:"caption",color:"error",sx:{mt:.5,ml:1.75},children:String(i.category_id.message||"")})]}),e.jsx(k,{...p("name"),label:"Nama Produk",fullWidth:!0,margin:"normal",error:!!i.name,helperText:i.name?.message?String(i.name.message):"",disabled:n,placeholder:"Contoh: Boneka Rajutan Hello Kitty",required:!0}),e.jsx(k,{...p("description"),label:"Deskripsi Produk",fullWidth:!0,margin:"normal",multiline:!0,rows:4,error:!!i.description,helperText:i.description?.message?String(i.description.message):"",disabled:n,placeholder:"Deskripsi produk (opsional)"}),(s==="create"||s==="edit"&&!x)&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{sx:{p:2,my:3,bgcolor:"info.50",border:"1px solid",borderColor:"info.200"},children:e.jsxs(m,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(de,{color:"info",sx:{mt:.5}}),e.jsx(m,{sx:{flex:1},children:e.jsx(le,{control:e.jsx(me,{checked:d,onChange:a=>_(a.target.checked),disabled:n||s==="edit"&&x,color:"primary"}),label:e.jsxs(m,{children:[e.jsx(o,{variant:"subtitle2",fontWeight:"bold",children:"Produk ini memiliki varian"}),e.jsx(o,{variant:"caption",color:"text.secondary",display:"block",children:d?"✓ Harga dan stok akan diatur per varian (contoh: warna, ukuran)":"Produk sederhana dengan 1 harga dan stok"}),s==="edit"&&d&&!x&&e.jsx(S,{severity:"warning",sx:{mt:1},children:e.jsx(o,{variant:"caption",children:'Setelah mengaktifkan mode varian, klik "Update" kemudian tambahkan varian di bawah.'})})]}),sx:{m:0}})})]})}),e.jsx(y,{sx:{my:3}})]}),d?e.jsx(S,{severity:"info",sx:{my:3},children:e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"Mode Varian Aktif!"}),e.jsx("br",{}),"• Produk akan dibuat tanpa harga & stok default",e.jsx("br",{}),"• Setelah produk dibuat, tambahkan varian di halaman detail produk",e.jsx("br",{}),"• Contoh varian: ",e.jsx("em",{children:"Merah - S (Rp 100.000, stok: 10), Biru - M (Rp 120.000, stok: 15)"}),e.jsx("br",{}),"• Setiap varian bisa punya gambar sendiri (opsional untuk warna yang berbeda)"]})}):e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"h6",fontWeight:"bold",gutterBottom:!0,sx:{mt:2},children:"Harga & Stok"}),e.jsxs(Z,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsx(k,{...p("price",{valueAsNumber:!0,setValueAs:a=>{const r=parseFloat(a);return isNaN(r)?0:r}}),label:"Harga",fullWidth:!0,margin:"normal",type:"number",error:!!i.price,helperText:i.price?.message?String(i.price.message):"",disabled:n,placeholder:"0",required:!0,InputProps:{startAdornment:e.jsx(L,{position:"start",children:"Rp"}),inputProps:{min:0,step:"0.01",style:{textAlign:"right"}}}}),e.jsx(k,{...p("stock",{valueAsNumber:!0,setValueAs:a=>{const r=parseInt(a);return isNaN(r)?0:r}}),label:"Stok",fullWidth:!0,margin:"normal",type:"number",error:!!i.stock,helperText:i.stock?.message?String(i.stock.message):"",disabled:n,placeholder:"0",required:!0,InputProps:{inputProps:{min:0,step:1,style:{textAlign:"right"}}}})]}),e.jsx(y,{sx:{my:3}})]}),e.jsxs(m,{sx:{display:"flex",gap:2,mt:4},children:[e.jsx(v,{type:"submit",variant:"contained",size:"large",disabled:n,sx:{minWidth:120},children:n?s==="create"?"Menyimpan...":"Mengupdate...":s==="create"?"Simpan":"Update"}),I&&e.jsx(v,{variant:"outlined",size:"large",onClick:I,disabled:n,children:"Batal"})]})]})]})}),s==="edit"&&t&&e.jsx(b,{sx:{mt:3},children:e.jsx(re,{productId:t.id,productName:t.name})})]})}export{_e as P};
