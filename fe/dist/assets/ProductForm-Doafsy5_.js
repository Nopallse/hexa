import{c as Y,j as e,r as g,T as o,B as d,t as P,I as Z,F as j,Y as O,am as Q,Z as X,$ as W,D as u,x as L,S as B,E as H}from"./index-Idy1NCQZ.js";import{u as ee,a as re,o as T,n as x,s as c,l as D}from"./schemas-CLfi1VVg.js";import{P as ae}from"./ProductVariantManager-DY-fodgk.js";import{P as te}from"./ProductImageManager-CuQqnBRX.js";import{C as f,a as ie}from"./CardContent-5_xtjPDw.js";import{A as S}from"./Alert-Cw7awSGM.js";import{U as se}from"./CloudUpload-CFMTfkGj.js";import{C as ne}from"./CardMedia-BkJhGEcB.js";import{D as oe}from"./Delete-W7umIrU5.js";import{F as le}from"./FormControlLabel-BVsvLRvY.js";import{S as me}from"./Switch-KooZQEt_.js";const de=Y(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-6h2zm0-8h-2V7h2z"}),"Info"),ue=T({category_id:c().min(1,"Kategori wajib dipilih").uuid("ID kategori tidak valid"),name:c().min(1,"Nama produk wajib diisi").min(2,"Nama produk minimal 2 karakter").max(200,"Nama produk maksimal 200 karakter"),description:c().max(1e3,"Deskripsi maksimal 1000 karakter").optional().or(D("")),price:x().min(0,"Harga tidak boleh negatif").max(999999999,"Harga terlalu besar"),stock:x().int("Stok harus berupa bilangan bulat").min(0,"Stok tidak boleh negatif").max(99999,"Stok maksimal 99999"),pre_order:x().int("Pre-order harus berupa bilangan bulat").min(0,"Pre-order tidak boleh negatif").max(365,"Pre-order maksimal 365 hari")}),pe=T({category_id:c().min(1,"Kategori wajib dipilih").uuid("ID kategori tidak valid"),name:c().min(1,"Nama produk wajib diisi").min(2,"Nama produk minimal 2 karakter").max(200,"Nama produk maksimal 200 karakter"),description:c().max(1e3,"Deskripsi maksimal 1000 karakter").optional().or(D("")),price:x().min(0,"Harga tidak boleh negatif").max(999999999,"Harga terlalu besar"),pre_order:x().int("Pre-order harus berupa bilangan bulat").min(0,"Pre-order tidak boleh negatif").max(365,"Pre-order maksimal 365 hari")});function Ie({product:i,categories:M,isLoading:s=!1,error:_,onSubmit:R,onCancel:I,mode:n}){const b=i?.product_variants&&i.product_variants.length>0,[p,A]=g.useState(b||!1),[v,N]=g.useState([]),[w,F]=g.useState([]),[ce,he]=g.useState(!1),z=p?pe:ue,{register:l,handleSubmit:U,formState:{errors:t},reset:V,setValue:q,watch:E}=ee({resolver:re(z),defaultValues:{category_id:"",name:"",description:"",price:0,stock:0,pre_order:0}});g.useEffect(()=>{if(i&&n==="edit"){const r=!!(i.product_variants&&i.product_variants.length>0);A(r),V({category_id:i.category_id,name:i.name,description:i.description||"",price:typeof i.price=="string"?parseFloat(i.price):i.price||0,stock:i.stock||0,pre_order:i.pre_order||0})}},[i,n,V]);const G=r=>{const a=Array.from(r.target.files||[]);if(a.length===0)return;const k=a.filter(m=>m.type.startsWith("image/")?m.size>5*1024*1024?(alert(`${m.name} terlalu besar (max 5MB)`),!1):!0:(alert(`${m.name} bukan file gambar`),!1));if(k.length===0)return;const h=5-v.length,C=k.slice(0,h);N(m=>[...m,...C]),C.forEach(m=>{const y=new FileReader;y.onloadend=()=>{F(J=>[...J,y.result])},y.readAsDataURL(m)})},K=r=>{N(a=>a.filter((k,h)=>h!==r)),F(a=>a.filter((k,h)=>h!==r))},$=async r=>{const a={category_id:r.category_id,name:r.name,description:r.description||void 0,_imageFiles:v};p?(a.price=r.price,a.stock=0,a.pre_order=r.pre_order):(a.price=r.price,a.stock=r.stock,a.pre_order=r.pre_order),await R(a)};return e.jsxs(e.Fragment,{children:[n==="edit"&&i&&e.jsx(f,{sx:{mb:3},children:e.jsx(te,{productId:i.id,productName:i.name})}),e.jsx(f,{children:e.jsxs(ie,{children:[e.jsx(o,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:n==="create"?"Tambah Produk Baru":"Edit Produk"}),_&&e.jsx(S,{severity:"error",sx:{mb:3},children:_}),e.jsxs(d,{component:"form",onSubmit:U($),sx:{mt:3,maxWidth:800,mx:"auto"},children:[n==="create"&&e.jsxs(d,{sx:{mb:3},children:[e.jsx(o,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Gambar Produk"}),e.jsxs(P,{component:"label",variant:"outlined",startIcon:e.jsx(se,{}),disabled:s||v.length>=5,sx:{mb:2},children:["Pilih Gambar (Max 5)",e.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:G})]}),e.jsx(o,{variant:"caption",display:"block",color:"text.secondary",sx:{mb:2},children:"Format: JPG, PNG, WebP (Max 5MB per file). Gambar pertama akan menjadi gambar utama."}),w.length>0&&e.jsx(d,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(3, 1fr)",md:"repeat(4, 1fr)"},gap:2},children:w.map((r,a)=>e.jsxs(f,{sx:{position:"relative"},children:[e.jsx(ne,{component:"img",height:"150",image:r,alt:`Preview ${a+1}`,sx:{objectFit:"cover"}}),e.jsx(Z,{onClick:()=>K(a),disabled:s,sx:{position:"absolute",top:4,right:4,bgcolor:"background.paper","&:hover":{bgcolor:"error.light",color:"white"}},size:"small",children:e.jsx(oe,{fontSize:"small"})}),a===0&&e.jsx(d,{sx:{position:"absolute",bottom:0,left:0,right:0,bgcolor:"primary.main",color:"white",py:.5,px:1,textAlign:"center"},children:e.jsx(o,{variant:"caption",children:"Gambar Utama"})})]},a))}),e.jsx(j,{sx:{my:3}})]}),e.jsxs(O,{fullWidth:!0,margin:"normal",error:!!t.category_id,children:[e.jsx(Q,{children:"Kategori *"}),e.jsxs(X,{...l("category_id"),label:"Kategori *",disabled:s,value:E("category_id")||"",onChange:r=>q("category_id",r.target.value),children:[e.jsx(W,{value:"",children:e.jsx("em",{children:"Pilih Kategori"})}),M.map(r=>e.jsx(W,{value:r.id,children:r.name},r.id))]}),t.category_id&&e.jsx(o,{variant:"caption",color:"error",sx:{mt:.5,ml:1.75},children:String(t.category_id.message||"")})]}),e.jsx(u,{...l("name"),label:"Nama Produk",fullWidth:!0,margin:"normal",error:!!t.name,helperText:t.name?.message?String(t.name.message):"",disabled:s,placeholder:"Contoh: Boneka Rajutan Hello Kitty",required:!0}),e.jsx(u,{...l("description"),label:"Deskripsi Produk",fullWidth:!0,margin:"normal",multiline:!0,rows:4,error:!!t.description,helperText:t.description?.message?String(t.description.message):"",disabled:s,placeholder:"Deskripsi produk (opsional)"}),(n==="create"||n==="edit"&&!b)&&e.jsxs(e.Fragment,{children:[e.jsx(L,{sx:{p:2,my:3,bgcolor:"info.50",border:"1px solid",borderColor:"info.200"},children:e.jsxs(d,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(de,{color:"info",sx:{mt:.5}}),e.jsx(d,{sx:{flex:1},children:e.jsx(le,{control:e.jsx(me,{checked:p,onChange:r=>A(r.target.checked),disabled:s||n==="edit"&&b,color:"primary"}),label:e.jsxs(d,{children:[e.jsx(o,{variant:"subtitle2",fontWeight:"bold",children:"Produk ini memiliki varian"}),e.jsx(o,{variant:"caption",color:"text.secondary",display:"block",children:p?"✓ Harga dan stok akan diatur per varian (contoh: warna, ukuran)":"Produk sederhana dengan 1 harga dan stok"}),n==="edit"&&p&&!b&&e.jsx(S,{severity:"warning",sx:{mt:1},children:e.jsx(o,{variant:"caption",children:'Setelah mengaktifkan mode varian, klik "Update" kemudian tambahkan varian di bawah.'})})]}),sx:{m:0}})})]})}),e.jsx(j,{sx:{my:3}})]}),p?e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"h6",fontWeight:"bold",gutterBottom:!0,sx:{mt:2},children:"Informasi Produk & Harga Default"}),e.jsxs(B,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsx(u,{...l("price",{valueAsNumber:!0,setValueAs:r=>{const a=parseFloat(r);return isNaN(a)?0:a}}),label:"Harga Default",fullWidth:!0,margin:"normal",type:"number",error:!!t.price,helperText:t.price?.message?String(t.price.message):"Harga default untuk generate varian baru",disabled:s,placeholder:"0",required:!0,InputProps:{startAdornment:e.jsx(H,{position:"start",children:"Rp"}),inputProps:{min:0,step:"0.01",style:{textAlign:"right"}}}}),e.jsx(u,{label:"Total Stok Varian",fullWidth:!0,margin:"normal",type:"number",disabled:!0,value:i?.product_variants?i.product_variants.reduce((r,a)=>r+(a.stock||0),0):0,helperText:"Total stok dari semua varian (read-only)",InputProps:{inputProps:{style:{textAlign:"right"}}}}),e.jsx(u,{...l("pre_order",{valueAsNumber:!0,setValueAs:r=>{const a=parseInt(r);return isNaN(a)?0:a}}),label:"Pre-order (Hari)",fullWidth:!0,margin:"normal",type:"number",error:!!t.pre_order,helperText:t.pre_order?.message?String(t.pre_order.message):"Berapa hari produk dibuat setelah order",disabled:s,placeholder:"0",required:!0,InputProps:{inputProps:{min:0,step:1,style:{textAlign:"right"}}}})]}),e.jsx(S,{severity:"info",sx:{my:3},children:e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"Mode Varian Aktif!"}),e.jsx("br",{}),"• Harga default akan digunakan saat membuat varian baru",e.jsx("br",{}),"• Stok ditampilkan dari total semua varian",e.jsx("br",{}),"• Setelah produk dibuat, tambahkan varian di halaman detail produk",e.jsx("br",{}),"• Contoh varian: ",e.jsx("em",{children:"Merah - S (Rp 100.000, stok: 10), Biru - M (Rp 120.000, stok: 15)"}),e.jsx("br",{}),"• Setiap varian bisa punya gambar sendiri (opsional untuk warna yang berbeda)"]})}),e.jsx(j,{sx:{my:3}})]}):e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"h6",fontWeight:"bold",gutterBottom:!0,sx:{mt:2},children:"Harga & Stok"}),e.jsxs(B,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsx(u,{...l("price",{valueAsNumber:!0,setValueAs:r=>{const a=parseFloat(r);return isNaN(a)?0:a}}),label:"Harga",fullWidth:!0,margin:"normal",type:"number",error:!!t.price,helperText:t.price?.message?String(t.price.message):"",disabled:s,placeholder:"0",required:!0,InputProps:{startAdornment:e.jsx(H,{position:"start",children:"Rp"}),inputProps:{min:0,step:"0.01",style:{textAlign:"right"}}}}),e.jsx(u,{...l("stock",{valueAsNumber:!0,setValueAs:r=>{const a=parseInt(r);return isNaN(a)?0:a}}),label:"Stok",fullWidth:!0,margin:"normal",type:"number",error:!!t.stock,helperText:t.stock?.message?String(t.stock.message):"",disabled:s,placeholder:"0",required:!0,InputProps:{inputProps:{min:0,step:1,style:{textAlign:"right"}}}}),e.jsx(u,{...l("pre_order",{valueAsNumber:!0,setValueAs:r=>{const a=parseInt(r);return isNaN(a)?0:a}}),label:"Pre-order (Hari)",fullWidth:!0,margin:"normal",type:"number",error:!!t.pre_order,helperText:t.pre_order?.message?String(t.pre_order.message):"Berapa hari produk dibuat setelah order",disabled:s,placeholder:"0",required:!0,InputProps:{inputProps:{min:0,step:1,style:{textAlign:"right"}}}})]}),e.jsx(j,{sx:{my:3}})]}),e.jsxs(d,{sx:{display:"flex",gap:2,mt:4},children:[e.jsx(P,{type:"submit",variant:"contained",size:"large",disabled:s,sx:{minWidth:120},children:s?n==="create"?"Menyimpan...":"Mengupdate...":n==="create"?"Simpan":"Update"}),I&&e.jsx(P,{variant:"outlined",size:"large",onClick:I,disabled:s,children:"Batal"})]})]})]})}),n==="edit"&&i&&e.jsx(f,{sx:{mt:3},children:e.jsx(ae,{productId:i.id,productName:i.name})})]})}export{Ie as P};
