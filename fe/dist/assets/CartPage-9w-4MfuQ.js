import{c as P,j as r,p as _,r as m,a9 as T,B as s,A as K,ac as B,T as n,S as j,w as q,I as z,ad as I,ae as w,q as E,t as S,ag as $,C as L}from"./index-CjRkbdsW.js";import{u as W}from"./useCurrencyConversion-CFRmtJpc.js";import{a as D}from"./image-CeHRN-zl.js";import{C as M,a as F}from"./CardContent-bGHhza-V.js";import{A as f}from"./Alert-CYapFDnR.js";import{D as H}from"./Delete-B09AsXFo.js";import{A as O}from"./Add-C5Ti7t2X.js";import{u as U}from"./cartStore-Xl7qhDn7.js";import{S as G}from"./Skeleton-t2nt6Xc3.js";import{O as J}from"./ShoppingBag-Bq975En1.js";const N=P(r.jsx("path",{d:"M5 13h14v-2H5zm-2 4h14v-2H3zM7 7v2h14V7z"}),"ClearAll"),V=P(r.jsx("path",{d:"M19 13H5v-2h14z"}),"Remove");function A({item:a,onUpdate:c,onRemove:b}){const d=_(),[o,x]=m.useState(a.quantity),[l,p]=m.useState(null),{formatPrice:v}=W(),{updateQuantity:k,removeItem:C}=T();m.useEffect(()=>{x(a.quantity)},[a.quantity]);const i=a.product_variant.product.deleted_at!==null,g=e=>{const t=typeof e=="string"?parseFloat(e):e;return v(t)},y=async e=>{if(!(e<1||e>a.product_variant.stock))try{p(null),await k(a.id,e),x(e),await c(),I.success("Jumlah item berhasil diupdate",{duration:2e3,position:"bottom-right"})}catch(t){console.error("Error updating cart item:",t);const R=t.response?.data?.error||"Gagal mengupdate quantity";p(R),I.error(R,{duration:3e3,position:"bottom-right"})}},h=async()=>{try{p(null),await C(a.id),await b(),I.success("Item berhasil dihapus dari keranjang",{duration:2e3,position:"bottom-right"})}catch(e){console.error("Error removing cart item:",e);const t=e.response?.data?.error||"Gagal menghapus item";p(t),I.error(t,{duration:3e3,position:"bottom-right"})}},u=a.product_variant.display_image||a.product_variant.image||a.product_variant.product.product_images?.find(e=>e.is_primary)?.image_name||a.product_variant.product.product_images?.[0]?.image_name;return r.jsx(M,{sx:{mb:2,border:i?`1px solid ${d.palette.error.main}`:"none",opacity:i?.6:1,borderRadius:2,boxShadow:i?`0 2px 8px ${d.palette.error.main}20`:"0 1px 3px rgba(0,0,0,0.1)",transition:"all 0.2s ease","&:hover":{boxShadow:i?`0 4px 12px ${d.palette.error.main}30`:"0 2px 8px rgba(0,0,0,0.15)"}},children:r.jsxs(F,{sx:{p:3},children:[i&&r.jsx(f,{severity:"error",sx:{mb:3,borderRadius:3,"& .MuiAlert-message":{fontWeight:600}},children:"Produk ini sudah tidak tersedia"}),l&&r.jsx(f,{severity:"error",sx:{mb:3,borderRadius:3,"& .MuiAlert-message":{fontWeight:600}},onClose:()=>p(null),children:l}),r.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:3},children:[r.jsx(s,{sx:{flexShrink:0},children:r.jsx(K,{src:D(u),alt:a.product_variant.product.name,sx:{width:80,height:80,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},variant:"rounded",children:r.jsx(B,{sx:{fontSize:32}})})}),r.jsxs(s,{sx:{flex:1,minWidth:0},children:[r.jsx(n,{variant:"h6",fontWeight:600,sx:{mb:1,color:"text.primary",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.3,fontSize:"1rem"},title:a.product_variant.product.name,children:a.product_variant.product.name}),a.product_variant.variant_options&&a.product_variant.variant_options.length>0&&r.jsx(j,{direction:"row",spacing:.5,sx:{mb:1,flexWrap:"wrap"},children:a.product_variant.variant_options.map((e,t)=>r.jsx(q,{label:`${e.option_value}`,size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:20,borderColor:"primary.main",color:"primary.main","& .MuiChip-label":{px:1}}},t))}),r.jsxs(n,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:["Stok: ",i?"Tidak tersedia":`${a.product_variant.stock} unit`]})]}),r.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2,flexShrink:0},children:[r.jsxs(s,{sx:{textAlign:"right",minWidth:100},children:[r.jsx(n,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:g(parseFloat(a.product_variant.price))}),r.jsx(n,{variant:"h6",color:"primary.main",fontWeight:700,sx:{fontSize:"1rem"},children:g(parseFloat(a.product_variant.price)*o)})]}),r.jsxs(s,{sx:{display:"flex",alignItems:"center",backgroundColor:"grey.50",borderRadius:2,p:.5,gap:.5},children:[r.jsx(z,{onClick:o===1?h:()=>y(o-1),disabled:i,size:"small",sx:{width:28,height:28,borderRadius:1,backgroundColor:o===1?"error.main":"white",color:o===1?"white":"text.primary",boxShadow:"0 1px 2px rgba(0,0,0,0.1)","&:hover":{backgroundColor:o===1?"error.dark":"primary.light",color:o===1?"white":"primary.main"},"&:disabled":{opacity:.5,backgroundColor:"grey.200"}},children:o===1?r.jsx(H,{sx:{fontSize:14}}):r.jsx(V,{sx:{fontSize:14}})}),r.jsx(n,{variant:"body2",fontWeight:600,sx:{minWidth:24,textAlign:"center",fontSize:"0.9rem"},children:o}),r.jsx(z,{onClick:()=>y(o+1),disabled:o>=a.product_variant.stock||i,size:"small",sx:{width:28,height:28,borderRadius:1,backgroundColor:"white",color:"text.primary",boxShadow:"0 1px 2px rgba(0,0,0,0.1)","&:hover":{backgroundColor:"primary.light",color:"primary.main"},"&:disabled":{opacity:.5,backgroundColor:"grey.200"}},children:r.jsx(O,{sx:{fontSize:14}})})]})]})]})]})})}const Q={getCart:async()=>(await w.get("/cart")).data,addToCart:async a=>(await w.post("/cart",a)).data,updateCartItem:async(a,c)=>(await w.put(`/cart/${a}`,c)).data,removeFromCart:async a=>(await w.delete(`/cart/${a}`)).data,clearCart:async()=>(await w.delete("/cart")).data};function X({items:a,onCartCleared:c}){_();const b=E(),[d,o]=m.useState(!1),{formatPrice:x}=W(),{clearCart:l,getTotalItems:p,getTotalPrice:v}=U(),k=e=>{const t=typeof e=="string"?parseFloat(e):e;return x(t)},C=async()=>{if(window.confirm("Apakah Anda yakin ingin mengosongkan keranjang?"))try{o(!0),(await Q.clearCart()).success&&(l(),c())}catch(e){console.error("Error clearing cart:",e),alert(e.response?.data?.error||"Gagal mengosongkan keranjang")}finally{o(!1)}},i=()=>{b("/checkout")},g=a.filter(e=>e.product_variant.product.deleted_at===null),y=a.filter(e=>e.product_variant.product.deleted_at!==null),h=g.reduce((e,t)=>e+t.quantity,0),u=g.reduce((e,t)=>e+parseFloat(t.product_variant.price)*t.quantity,0);return r.jsx(M,{sx:{position:"sticky",top:24,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:"none"},children:r.jsxs(F,{sx:{p:3},children:[r.jsx(n,{variant:"h6",fontWeight:600,sx:{mb:3,color:"text.primary"},children:"Ringkasan Belanja"}),r.jsxs(j,{spacing:2,children:[r.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsxs(n,{variant:"body1",fontWeight:500,children:["Total Item (",h,")"]}),r.jsx(n,{variant:"h6",fontWeight:600,color:"primary.main",children:u>0?k(u):"Rp 0"})]}),y.length>0&&r.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:1.5,px:2,backgroundColor:"error.light",borderRadius:2},children:[r.jsxs(n,{variant:"body2",color:"error.dark",fontWeight:500,children:["Item tidak tersedia (",y.length,")"]}),r.jsx(n,{variant:"body2",color:"error.dark",fontWeight:500,children:"Tidak dihitung"})]}),r.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,px:2,backgroundColor:"primary.main",borderRadius:2,color:"white"},children:[r.jsx(n,{variant:"h6",fontWeight:600,children:"Total Belanja"}),r.jsx(n,{variant:"h5",fontWeight:700,children:x(u)})]}),r.jsxs(j,{spacing:1.5,children:[r.jsx(S,{variant:"contained",size:"large",startIcon:r.jsx($,{}),onClick:i,disabled:h===0,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:600,fontSize:"1rem",backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"},"&:disabled":{backgroundColor:"grey.300",color:"grey.500"}},children:h===0?"Keranjang Kosong":"Lanjut ke Checkout"}),a.length>0&&r.jsx(S,{variant:"outlined",size:"large",startIcon:r.jsx(N,{}),onClick:C,disabled:d,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:500,fontSize:"0.9rem",borderColor:"error.main",color:"error.main","&:hover":{backgroundColor:"error.light",borderColor:"error.dark"}},children:d?"Mengosongkan...":"Kosongkan Keranjang"})]})]})]})})}function dr(){_();const a=E(),{loading:c,error:b}=W(),{items:d,isLoading:o,error:x,syncWithServer:l}=T(),[p,v]=m.useState(null),[k,C]=m.useState(!0);m.useEffect(()=>{(async()=>{await l(),C(!1)})()},[l]),m.useEffect(()=>{x&&v(x)},[x]);const i=async()=>{await l()},g=async()=>{await l()},y=async()=>{await l()},h=d.filter(e=>e.product_variant.product.deleted_at===null),u=d.filter(e=>e.product_variant.product.deleted_at!==null);return r.jsx(s,{sx:{minHeight:"100vh",py:4},children:r.jsxs(L,{maxWidth:"xl",children:[r.jsxs(s,{sx:{mb:3},children:[r.jsx(n,{variant:"h4",fontWeight:600,sx:{mb:1,color:"text.primary"},children:"Keranjang Belanja"}),r.jsx(n,{variant:"body1",color:"text.secondary",children:"Kelola item di keranjang belanja Anda"})]}),c&&r.jsx(f,{severity:"info",sx:{mb:2},children:"Loading exchange rates..."}),b&&r.jsx(f,{severity:"warning",sx:{mb:2},children:"Failed to load exchange rates. Prices will be displayed in default currency."}),p&&r.jsx(f,{severity:"error",sx:{mb:4},onClose:()=>v(null),children:p}),r.jsxs(s,{sx:{display:"flex",flexDirection:{xs:"column",lg:"row"},gap:4,alignItems:"flex-start"},children:[r.jsx(s,{sx:{flex:1,minWidth:0,order:{xs:1,lg:1}},children:k?r.jsx(j,{spacing:2,children:[...Array(3)].map((e,t)=>r.jsx(G,{variant:"rectangular",height:120,sx:{borderRadius:2}},t))}):d.length===0?r.jsxs(s,{sx:{textAlign:"center",py:8,px:4,borderRadius:2,backgroundColor:"grey.50"},children:[r.jsx(B,{sx:{fontSize:64,color:"text.secondary",mb:2}}),r.jsx(n,{variant:"h5",fontWeight:600,sx:{mb:1,color:"text.primary"},children:"Keranjang Anda Kosong"}),r.jsx(n,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Belum ada item di keranjang belanja Anda"}),r.jsxs(j,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"center",children:[r.jsx(S,{variant:"contained",size:"large",startIcon:r.jsx(J,{}),onClick:()=>a("/products"),sx:{px:3,py:1.5,borderRadius:2,fontWeight:600},children:"Mulai Berbelanja"}),r.jsx(S,{variant:"outlined",size:"large",onClick:()=>a("/"),sx:{px:3,py:1.5,borderRadius:2,fontWeight:500},children:"Kembali ke Beranda"})]})]}):r.jsxs(j,{spacing:2,children:[h.length>0&&r.jsxs(r.Fragment,{children:[r.jsxs(n,{variant:"h6",fontWeight:600,sx:{mb:2,color:"text.primary"},children:["Item Tersedia (",h.length,")"]}),h.map(e=>r.jsx(A,{item:e,onUpdate:i,onRemove:g},e.id))]}),u.length>0&&r.jsxs(r.Fragment,{children:[r.jsxs(n,{variant:"h6",fontWeight:600,sx:{mb:2,color:"error.main"},children:["Item Tidak Tersedia (",u.length,")"]}),r.jsx(f,{severity:"warning",sx:{mb:2,borderRadius:2},children:"Beberapa item di keranjang Anda sudah tidak tersedia. Item ini akan diabaikan saat checkout."}),u.map(e=>r.jsx(A,{item:e,onUpdate:i,onRemove:g},e.id))]})]})}),d.length>0&&r.jsx(s,{sx:{width:{xs:"100%",lg:"400px"},flexShrink:0,order:{xs:2,lg:2}},children:r.jsx(X,{items:d,onCartCleared:y})})]})]})})}export{dr as default};
