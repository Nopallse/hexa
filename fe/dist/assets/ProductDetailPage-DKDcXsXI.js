import{c as se,j as e,u as ie,Q as ne,a as oe,r as c,g as le,B as a,C as S,b as C,T as s,R as W,e as u,D as f,U as ce,V as de,h as me,S as $,W as he,i as K}from"./index-DVLSGWYZ.js";import{p as xe}from"./productApi-DfUkZ6hb.js";import{c as ue}from"./cartApi-DFvn6HYO.js";import{u as pe}from"./cartStore-DsEuM1fv.js";import{g as Q}from"./image-CL12PwSa.js";import{S as x}from"./Skeleton-KFRaNZZc.js";import{A as I}from"./Alert-DeMLxQ5q.js";import{A as ge}from"./ArrowBack-BbA3cZTo.js";import{C as w,a as A}from"./CardContent-DCJIVk1m.js";import{F as je}from"./Favorite-BL_7i2XK.js";const be=se(e.jsx("path",{d:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92"}),"Share");function Be(){const m=ie(),{id:y}=ne(),T=oe(),[t,q]=c.useState(null),[J,P]=c.useState(!0),[B,v]=c.useState(null),[p,h]=c.useState(null),[fe,ye]=c.useState(0),[E,V]=c.useState(1),[i,z]=c.useState(null),[R,D]=c.useState({}),[F,G]=c.useState(!1),{addItem:N,setLoading:ve,setError:g,error:H}=pe(),{user:X}=le(),Y=async()=>{if(y)try{P(!0),v(null);const r=await xe.getProductById(y);r.success?q(r.data):v("Produk tidak ditemukan")}catch(r){console.error("Error fetching product:",r),v("Gagal memuat produk")}finally{P(!1)}},Z=async()=>{if(!t||!X){T("/login");return}if(d&&!i){g("Pilih varian terlebih dahulu");return}try{G(!0),g(null);const r=d?i.id:t.id,o=await ue.addToCart({product_variant_id:r,quantity:E});o.success&&(N(o.data),console.log("Item added to cart successfully"),V(1))}catch(r){console.error("Error adding to cart:",r),g(r.response?.data?.error||"Gagal menambahkan ke keranjang")}finally{G(!1)}},ee=()=>{t&&console.log("Add to wishlist:",t)},re=()=>{t&&console.log("Share:",t)};c.useEffect(()=>{if(t){const r=k(t);h(r?r.image_name:null),z(null),D({})}},[t]);const L=r=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(r),te=()=>{if(!t?.product_variants)return{};const r={};return t.product_variants.forEach(o=>{o.variant_options?.forEach(n=>{r[n.option_name]||(r[n.option_name]=[]),r[n.option_name].includes(n.option_value)||r[n.option_name].push(n.option_value)})}),r},ae=(r,o)=>{const n={...R,[r]:o};D(n);const l=t?.product_variants?.find(b=>b.variant_options?.every(U=>n[U.option_name]===U.option_value));if(l){if(z(l),l.image)h(l.image);else if(l.display_image)h(l.display_image);else if(t){const b=k(t);h(b?b.image_name:null)}}},k=r=>r.product_images&&r.product_images.length>0?r.product_images.find(n=>n.is_primary)||r.product_images[0]:null;if(c.useEffect(()=>{Y()},[y]),J)return e.jsx(a,{sx:{minHeight:"100vh",py:4},children:e.jsxs(S,{maxWidth:!1,children:[e.jsx(x,{variant:"rectangular",height:400,sx:{mb:4,borderRadius:3}}),e.jsxs(a,{sx:{display:"flex",gap:4},children:[e.jsxs(a,{sx:{flex:1},children:[e.jsx(x,{variant:"text",height:48,sx:{mb:2}}),e.jsx(x,{variant:"text",height:24,sx:{mb:2}}),e.jsx(x,{variant:"text",height:32,sx:{mb:4}}),e.jsx(x,{variant:"rectangular",height:200})]}),e.jsx(a,{sx:{width:300},children:e.jsx(x,{variant:"rectangular",height:300,sx:{borderRadius:3}})})]})]})});if(B||!t)return e.jsx(a,{sx:{minHeight:"100vh",py:4},children:e.jsx(S,{maxWidth:!1,children:e.jsx(I,{severity:"error",sx:{maxWidth:600,mx:"auto"},children:B||"Produk tidak ditemukan"})})});const d=t.product_variants&&t.product_variants.length>0,j=k(t),M=p||(j?j.image_name:null),O=te(),_=d?t.product_variants.reduce((r,o)=>r+o.stock,0):t.stock;return e.jsx(a,{sx:{minHeight:"100vh",py:4},children:e.jsxs(S,{maxWidth:"xl",children:[e.jsx(C,{startIcon:e.jsx(ge,{}),onClick:()=>T(-1),sx:{mb:4},children:"Kembali"}),e.jsxs(a,{sx:{display:"flex",gap:3,flexWrap:"wrap"},children:[e.jsx(a,{sx:{flex:"1 1 300px",minWidth:300},children:e.jsx(w,{children:e.jsxs(A,{children:[e.jsx(s,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Galeri Gambar"}),M?e.jsx(a,{sx:{textAlign:"center",mb:2},children:e.jsx(W,{src:Q(M),variant:"rounded",sx:{width:"100%",height:300,transition:"all 0.3s ease",boxShadow:2}})}):e.jsx(a,{sx:{textAlign:"center",mb:2},children:e.jsx(W,{variant:"rounded",sx:{width:"100%",height:300},children:t.name.charAt(0).toUpperCase()})}),t.product_images&&t.product_images.length>0?e.jsxs(a,{children:[e.jsxs(s,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:["Semua Gambar (",t.product_images.length,")"]}),e.jsx(a,{sx:{display:"flex",gap:1,flexWrap:"wrap",justifyContent:"center"},children:t.product_images.sort((r,o)=>(o.is_primary?1:0)-(r.is_primary?1:0)).map(r=>e.jsxs(a,{sx:{position:"relative"},onMouseEnter:()=>h(r.image_name),onMouseLeave:()=>h(j?j.image_name:null),children:[e.jsx(W,{src:Q(r.image_name),variant:"rounded",sx:{width:70,height:70,cursor:"pointer",border:p===r.image_name?3:2,borderColor:p===r.image_name?"primary.main":"divider",transition:"all 0.2s ease",opacity:p===r.image_name?1:.7,"&:hover":{opacity:1,transform:"scale(1.05)",borderColor:"primary.main"}}}),r.is_primary&&e.jsx(u,{label:"Utama",size:"small",color:"primary",sx:{position:"absolute",bottom:-8,left:"50%",transform:"translateX(-50%)",fontSize:"0.65rem",height:16,"& .MuiChip-label":{px:.5}}})]},r.id))})]}):e.jsx(I,{severity:"info",sx:{mt:2},children:"Belum ada gambar produk"})]})})}),e.jsx(a,{sx:{flex:"2 1 500px",minWidth:500},children:e.jsx(w,{children:e.jsxs(A,{children:[e.jsxs(a,{sx:{mb:3},children:[e.jsx(s,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:t.name}),t.product_variants&&t.product_variants.length>0?e.jsxs(a,{children:[e.jsx(s,{variant:"h4",color:"primary",fontWeight:"bold",children:t.price_range?.display||"Harga bervariasi"}),e.jsxs(s,{variant:"body2",color:"textSecondary",children:["Total Stok: ",t.total_stock||0," unit"]})]}):e.jsx(s,{variant:"h4",color:"primary",fontWeight:"bold",children:L(Number(t.price))})]}),e.jsx(f,{sx:{mb:3}}),e.jsxs(a,{sx:{mb:3},children:[e.jsx(s,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Deskripsi"}),e.jsx(s,{variant:"body1",color:"textSecondary",children:t.description||"Tidak ada deskripsi"})]}),e.jsx(f,{sx:{mb:3}}),e.jsxs(a,{sx:{mb:3},children:[e.jsx(s,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Kategori"}),t.category?e.jsxs(a,{children:[e.jsx(u,{label:t.category.name,color:"primary",variant:"outlined",sx:{mb:1}}),t.category.description&&e.jsx(s,{variant:"body2",color:"textSecondary",children:t.category.description})]}):e.jsx(s,{variant:"body2",color:"textSecondary",children:"Tidak ada kategori"})]}),d&&Object.keys(O).length>0&&e.jsxs(ce.Fragment,{children:[e.jsx(f,{sx:{mb:3}}),e.jsxs(a,{sx:{mb:3},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(s,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Pilih Varian"}),t.product_variants&&t.product_variants.length>0?e.jsx(u,{label:`${t.product_variants.length} Varian`,color:"primary",size:"small",variant:"filled",sx:{fontWeight:"bold",bgcolor:"primary.main",color:"white",border:"1px solid",borderColor:"primary.dark",letterSpacing:.5}}):e.jsx(u,{label:`Stok: ${t.stock||0}`,color:(t.stock||0)>0?"success":"error",size:"small",variant:(t.stock||0)>0?"filled":"outlined"})]}),Object.entries(O).map(([r,o])=>e.jsxs(a,{sx:{mb:2},children:[e.jsx(s,{variant:"subtitle2",fontWeight:"bold",gutterBottom:!0,children:r}),e.jsx(a,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:o.map(n=>{const l=R[r]===n;return e.jsxs(C,{variant:l?"contained":"outlined",onClick:()=>ae(r,n),size:"large",sx:{minWidth:80,borderWidth:2,borderColor:l?"primary.main":"divider",position:"relative",textTransform:"none","&:hover":{borderWidth:2,borderColor:"primary.main"}},children:[e.jsx(s,{variant:"body2",fontWeight:l?"bold":"medium",children:n}),l&&e.jsx(a,{sx:{position:"absolute",top:4,right:4,width:16,height:16,bgcolor:"white",color:"primary.main",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold"},children:"âœ“"})]},n)})})]},r)),i&&e.jsx(w,{variant:"outlined",sx:{mb:3,bgcolor:"primary.50",borderColor:"primary.main"},children:e.jsx(A,{children:e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[e.jsxs(a,{children:[e.jsx(s,{variant:"caption",color:"text.secondary",display:"block",children:"Varian Terpilih"}),e.jsx(s,{variant:"h6",fontWeight:"bold",children:i.variant_name}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:["SKU: ",i.sku]})]}),e.jsxs(a,{sx:{textAlign:"right"},children:[e.jsx(s,{variant:"h4",color:"primary.main",fontWeight:"bold",children:L(Number(i.price))}),e.jsx(u,{label:`Stok: ${i.stock} unit`,size:"small",color:i.stock>0?"success":"error",sx:{mt:.5}})]})]})})}),e.jsx(f,{sx:{mb:3}})]})]}),e.jsxs(a,{sx:{mb:4},children:[e.jsx(de,{component:"legend",sx:{mb:1,fontWeight:600},children:"Jumlah:"}),e.jsx(me,{type:"number",value:E,onChange:r=>V(Math.max(1,parseInt(r.target.value)||1)),inputProps:{min:1,max:d&&i?i.stock||1:_},sx:{width:120},size:"small"})]}),H&&e.jsx(I,{severity:"error",sx:{mb:2},onClose:()=>g(null),children:H}),e.jsxs($,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:4},children:[e.jsx(C,{variant:"contained",size:"large",startIcon:e.jsx(he,{}),onClick:Z,disabled:(_||0)===0||F||d&&!i||d&&i&&i.stock===0,sx:{px:4,py:1.5,borderRadius:2,fontWeight:600,fontSize:"1rem",minHeight:48,flex:{xs:1,sm:"none"}},children:F?"Menambahkan...":(_||0)===0?"Stok Habis":d&&!i?"Pilih Varian":d&&i&&i.stock===0?"Stok Habis":"Tambah ke Keranjang"}),e.jsxs($,{direction:"row",spacing:1,sx:{justifyContent:{xs:"center",sm:"flex-start"}},children:[e.jsx(K,{onClick:ee,sx:{border:`1px solid ${m.palette.grey[300]}`,color:m.palette.primary.main,width:48,height:48,"&:hover":{backgroundColor:m.palette.primary.light+"20",borderColor:m.palette.primary.main}},children:e.jsx(je,{})}),e.jsx(K,{onClick:re,sx:{border:`1px solid ${m.palette.grey[300]}`,color:m.palette.primary.main,width:48,height:48,"&:hover":{backgroundColor:m.palette.primary.light+"20",borderColor:m.palette.primary.main}},children:e.jsx(be,{})})]})]})]})})})]})]})})}export{Be as default};
