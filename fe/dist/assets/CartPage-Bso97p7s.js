import{c as B,j as r,p as W,r as u,B as s,H as P,T as t,S as C,v as M,I as A,q as T,t as _,ac as q,C as $}from"./index-CZFAEO2y.js";import{c as w}from"./cartApi-DoI-LLmo.js";import{u as R}from"./cartStore-CZthKorE.js";import{u as z}from"./useCurrencyConversion-BCvfb8ro.js";import{C as E,a as K}from"./CardContent-CEZafFSD.js";import{A as k}from"./Alert-Dhgb7HXh.js";import{A as H}from"./Avatar-BK2nAYkE.js";import{D as L}from"./Delete-Bud-UaoM.js";import{A as D}from"./Add-CHzkKGzA.js";import{S as G}from"./Skeleton-CfZ67nOg.js";import{S as U}from"./ShoppingBag-CwGVTerh.js";import"./useSlot-CExgq9at.js";const O=B(r.jsx("path",{d:"M5 13h14v-2H5zm-2 4h14v-2H3zM7 7v2h14V7z"}),"ClearAll"),N=B(r.jsx("path",{d:"M19 13H5v-2h14z"}),"Remove");function F({item:a,onUpdate:I,onRemove:S}){const g=W(),[n,m]=u.useState(a.quantity),[h,l]=u.useState(!1),[j,p]=u.useState(null),{formatPrice:f}=z(),{updateItem:v,removeItem:b}=R(),i=a.product_variant.product.deleted_at!==null,c=o=>{const y=typeof o=="string"?parseFloat(o):o;return f(y)},x=async o=>{if(!(o<1||o>a.product_variant.stock))try{l(!0),p(null),(await w.updateCartItem(a.id,{quantity:o})).success&&(m(o),v(a.id,o),I())}catch(y){console.error("Error updating cart item:",y),p(y.response?.data?.error||"Gagal mengupdate quantity")}finally{l(!1)}},e=async()=>{try{l(!0),p(null),(await w.removeFromCart(a.id)).success&&(b(a.id),S())}catch(o){console.error("Error removing cart item:",o),p(o.response?.data?.error||"Gagal menghapus item")}finally{l(!1)}},d=a.product_variant.product.product_images?.[0]?.image_name;return r.jsx(E,{sx:{mb:2,border:i?`1px solid ${g.palette.error.main}`:"none",opacity:i?.6:1,borderRadius:2,boxShadow:i?`0 2px 8px ${g.palette.error.main}20`:"0 1px 3px rgba(0,0,0,0.1)",transition:"all 0.2s ease","&:hover":{boxShadow:i?`0 4px 12px ${g.palette.error.main}30`:"0 2px 8px rgba(0,0,0,0.15)"}},children:r.jsxs(K,{sx:{p:3},children:[i&&r.jsx(k,{severity:"error",sx:{mb:3,borderRadius:3,"& .MuiAlert-message":{fontWeight:600}},children:"Produk ini sudah tidak tersedia"}),j&&r.jsx(k,{severity:"error",sx:{mb:3,borderRadius:3,"& .MuiAlert-message":{fontWeight:600}},onClose:()=>p(null),children:j}),r.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:3},children:[r.jsx(s,{sx:{flexShrink:0},children:r.jsx(H,{src:d?`/uploads/${d}`:`https://placehold.co/80x80/9682DB/FFFFFF/png?text=${encodeURIComponent(a.product_variant.product.name.substring(0,10))}`,alt:a.product_variant.product.name,sx:{width:80,height:80,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},variant:"rounded",children:r.jsx(P,{sx:{fontSize:32}})})}),r.jsxs(s,{sx:{flex:1,minWidth:0},children:[r.jsx(t,{variant:"h6",fontWeight:600,sx:{mb:1,color:"text.primary",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.3,fontSize:"1rem"},title:a.product_variant.product.name,children:a.product_variant.product.name}),a.product_variant.variant_options&&a.product_variant.variant_options.length>0&&r.jsx(C,{direction:"row",spacing:.5,sx:{mb:1,flexWrap:"wrap"},children:a.product_variant.variant_options.map((o,y)=>r.jsx(M,{label:`${o.option_value}`,size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:20,borderColor:"primary.main",color:"primary.main","& .MuiChip-label":{px:1}}},y))}),r.jsxs(t,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:["Stok: ",i?"Tidak tersedia":`${a.product_variant.stock} unit`]})]}),r.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2,flexShrink:0},children:[r.jsxs(s,{sx:{textAlign:"right",minWidth:100},children:[r.jsx(t,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:c(parseFloat(a.product_variant.price))}),r.jsx(t,{variant:"h6",color:"primary.main",fontWeight:700,sx:{fontSize:"1rem"},children:c(parseFloat(a.product_variant.price)*n)})]}),r.jsxs(s,{sx:{display:"flex",alignItems:"center",backgroundColor:"grey.50",borderRadius:2,p:.5,gap:.5},children:[r.jsx(A,{onClick:n===1?e:()=>x(n-1),disabled:h||i,size:"small",sx:{width:28,height:28,borderRadius:1,backgroundColor:n===1?"error.main":"white",color:n===1?"white":"text.primary",boxShadow:"0 1px 2px rgba(0,0,0,0.1)","&:hover":{backgroundColor:n===1?"error.dark":"primary.light",color:n===1?"white":"primary.main"},"&:disabled":{opacity:.5,backgroundColor:"grey.200"}},children:n===1?r.jsx(L,{sx:{fontSize:14}}):r.jsx(N,{sx:{fontSize:14}})}),r.jsx(t,{variant:"body2",fontWeight:600,sx:{minWidth:24,textAlign:"center",fontSize:"0.9rem"},children:n}),r.jsx(A,{onClick:()=>x(n+1),disabled:h||n>=a.product_variant.stock||i,size:"small",sx:{width:28,height:28,borderRadius:1,backgroundColor:"white",color:"text.primary",boxShadow:"0 1px 2px rgba(0,0,0,0.1)","&:hover":{backgroundColor:"primary.light",color:"primary.main"},"&:disabled":{opacity:.5,backgroundColor:"grey.200"}},children:r.jsx(D,{sx:{fontSize:14}})})]})]})]})]})})}function V({items:a,onCartCleared:I}){W();const S=T(),[g,n]=u.useState(!1),{formatPrice:m}=z(),{clearCart:h,getTotalItems:l,getTotalPrice:j}=R(),p=e=>{const d=typeof e=="string"?parseFloat(e):e;return m(d)},f=async()=>{if(window.confirm("Apakah Anda yakin ingin mengosongkan keranjang?"))try{n(!0),(await w.clearCart()).success&&(h(),I())}catch(e){console.error("Error clearing cart:",e),alert(e.response?.data?.error||"Gagal mengosongkan keranjang")}finally{n(!1)}},v=()=>{S("/checkout")},b=a.filter(e=>e.product_variant.product.deleted_at===null),i=a.filter(e=>e.product_variant.product.deleted_at!==null),c=b.reduce((e,d)=>e+d.quantity,0),x=b.reduce((e,d)=>e+parseFloat(d.product_variant.price)*d.quantity,0);return r.jsx(E,{sx:{position:"sticky",top:24,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:"none"},children:r.jsxs(K,{sx:{p:3},children:[r.jsx(t,{variant:"h6",fontWeight:600,sx:{mb:3,color:"text.primary"},children:"Ringkasan Belanja"}),r.jsxs(C,{spacing:2,children:[r.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsxs(t,{variant:"body1",fontWeight:500,children:["Total Item (",c,")"]}),r.jsx(t,{variant:"h6",fontWeight:600,color:"primary.main",children:x>0?p(x):"Rp 0"})]}),i.length>0&&r.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:1.5,px:2,backgroundColor:"error.light",borderRadius:2},children:[r.jsxs(t,{variant:"body2",color:"error.dark",fontWeight:500,children:["Item tidak tersedia (",i.length,")"]}),r.jsx(t,{variant:"body2",color:"error.dark",fontWeight:500,children:"Tidak dihitung"})]}),r.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,px:2,backgroundColor:"primary.main",borderRadius:2,color:"white"},children:[r.jsx(t,{variant:"h6",fontWeight:600,children:"Total Belanja"}),r.jsx(t,{variant:"h5",fontWeight:700,children:m(x)})]}),r.jsxs(C,{spacing:1.5,children:[r.jsx(_,{variant:"contained",size:"large",startIcon:r.jsx(q,{}),onClick:v,disabled:c===0,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:600,fontSize:"1rem",backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"},"&:disabled":{backgroundColor:"grey.300",color:"grey.500"}},children:c===0?"Keranjang Kosong":"Lanjut ke Checkout"}),a.length>0&&r.jsx(_,{variant:"outlined",size:"large",startIcon:r.jsx(O,{}),onClick:f,disabled:g,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:500,fontSize:"0.9rem",borderColor:"error.main",color:"error.main","&:hover":{backgroundColor:"error.light",borderColor:"error.dark"}},children:g?"Mengosongkan...":"Kosongkan Keranjang"})]})]})]})})}function ir(){W();const a=T(),{loading:I,error:S}=z(),[g,n]=u.useState(!0),[m,h]=u.useState(null),[l,j]=u.useState([]),{setItems:p}=R(),f=async()=>{try{n(!0),h(null);const e=await w.getCart();e.success?(j(e.data),p(e.data)):h("Gagal memuat keranjang")}catch(e){console.error("Error fetching cart:",e),h(e.response?.data?.error||"Gagal memuat keranjang")}finally{n(!1)}},v=()=>{f()},b=()=>{f()},i=()=>{j([])};u.useEffect(()=>{f()},[]);const c=l.filter(e=>e.product_variant.product.deleted_at===null),x=l.filter(e=>e.product_variant.product.deleted_at!==null);return r.jsx(s,{sx:{minHeight:"100vh",py:4},children:r.jsxs($,{maxWidth:"xl",children:[r.jsxs(s,{sx:{mb:3},children:[r.jsx(t,{variant:"h4",fontWeight:600,sx:{mb:1,color:"text.primary"},children:"Keranjang Belanja"}),r.jsx(t,{variant:"body1",color:"text.secondary",children:"Kelola item di keranjang belanja Anda"})]}),I&&r.jsx(k,{severity:"info",sx:{mb:2},children:"Loading exchange rates..."}),S&&r.jsx(k,{severity:"warning",sx:{mb:2},children:"Failed to load exchange rates. Prices will be displayed in default currency."}),m&&r.jsx(k,{severity:"error",sx:{mb:4},onClose:()=>h(null),children:m}),r.jsxs(s,{sx:{display:"flex",flexDirection:{xs:"column",lg:"row"},gap:4,alignItems:"flex-start"},children:[r.jsx(s,{sx:{flex:1,minWidth:0,order:{xs:1,lg:1}},children:g?r.jsx(C,{spacing:2,children:[...Array(3)].map((e,d)=>r.jsx(G,{variant:"rectangular",height:120,sx:{borderRadius:2}},d))}):l.length===0?r.jsxs(s,{sx:{textAlign:"center",py:8,px:4,borderRadius:2,backgroundColor:"grey.50"},children:[r.jsx(P,{sx:{fontSize:64,color:"text.secondary",mb:2}}),r.jsx(t,{variant:"h5",fontWeight:600,sx:{mb:1,color:"text.primary"},children:"Keranjang Anda Kosong"}),r.jsx(t,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Belum ada item di keranjang belanja Anda"}),r.jsxs(C,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"center",children:[r.jsx(_,{variant:"contained",size:"large",startIcon:r.jsx(U,{}),onClick:()=>a("/products"),sx:{px:3,py:1.5,borderRadius:2,fontWeight:600},children:"Mulai Berbelanja"}),r.jsx(_,{variant:"outlined",size:"large",onClick:()=>a("/"),sx:{px:3,py:1.5,borderRadius:2,fontWeight:500},children:"Kembali ke Beranda"})]})]}):r.jsxs(C,{spacing:2,children:[c.length>0&&r.jsxs(r.Fragment,{children:[r.jsxs(t,{variant:"h6",fontWeight:600,sx:{mb:2,color:"text.primary"},children:["Item Tersedia (",c.length,")"]}),c.map(e=>r.jsx(F,{item:e,onUpdate:v,onRemove:b},e.id))]}),x.length>0&&r.jsxs(r.Fragment,{children:[r.jsxs(t,{variant:"h6",fontWeight:600,sx:{mb:2,color:"error.main"},children:["Item Tidak Tersedia (",x.length,")"]}),r.jsx(k,{severity:"warning",sx:{mb:2,borderRadius:2},children:"Beberapa item di keranjang Anda sudah tidak tersedia. Item ini akan diabaikan saat checkout."}),x.map(e=>r.jsx(F,{item:e,onUpdate:v,onRemove:b},e.id))]})]})}),l.length>0&&r.jsx(s,{sx:{width:{xs:"100%",lg:"400px"},flexShrink:0,order:{xs:2,lg:2}},children:r.jsx(V,{items:l,onCartCleared:i})})]})]})})}export{ir as default};
