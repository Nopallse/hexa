import{a as G,g as $,r as c,u as Q,_ as E,a8 as ie,a9 as ce,i as j,j as e,s as F,k as O,m as N,c as Y,J as Z,aa as le,l as M,K as de,d as ue,h as xe,b as he,p as U,T as i,B as x,S as P,a4 as pe,F as T,t as z,a7 as me,q as X,Y as fe,ab as ge,C as B}from"./index-Idy1NCQZ.js";import{u as ye}from"./cartStore-Bc-LrXv6.js";import{u as be}from"./orderStore-DOU1qiJY.js";import{o as q}from"./orderApi-Cky_adNE.js";import{u as ee}from"./useCurrencyConversion-CyZkluwP.js";import{C as I,a as W}from"./CardContent-5_xtjPDw.js";import{A as je}from"./Avatar-BJbDu4KS.js";import{a as ve}from"./addressApi-CFRSAVlm.js";import{S as Ce}from"./Skeleton-DVt8M0jh.js";import{A as R}from"./Alert-Cw7awSGM.js";import{A as V}from"./Add-CFf7PY0f.js";import{S as ke,F as Re}from"./FormControlLabel-BVsvLRvY.js";function Se(r){return G("MuiFormGroup",r)}$("MuiFormGroup",["root","row","error"]);const we=["className","row"],Ie=r=>{const{classes:a,row:o,error:n}=r;return N({root:["root",o&&"row",n&&"error"]},Se,a)},We=F("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(r,a)=>{const{ownerState:o}=r;return[a.root,o.row&&a.row]}})(({ownerState:r})=>j({display:"flex",flexDirection:"column",flexWrap:"wrap"},r.row&&{flexDirection:"row"})),Pe=c.forwardRef(function(a,o){const n=Q({props:a,name:"MuiFormGroup"}),{className:l,row:p=!1}=n,f=E(n,we),y=ie(),u=ce({props:n,muiFormControl:y,states:["error"]}),s=j({},n,{row:p,error:u.error}),g=Ie(s);return e.jsx(We,j({className:O(g.root,l),ownerState:s,ref:o},f))}),Fe=Y(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),_e=Y(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),Me=F("span",{name:"MuiRadioButtonIcon",shouldForwardProp:Z})({position:"relative",display:"flex"}),ze=F(Fe,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),Ae=F(_e,{name:"MuiRadioButtonIcon"})(({theme:r,ownerState:a})=>j({left:0,position:"absolute",transform:"scale(0)",transition:r.transitions.create("transform",{easing:r.transitions.easing.easeIn,duration:r.transitions.duration.shortest})},a.checked&&{transform:"scale(1)",transition:r.transitions.create("transform",{easing:r.transitions.easing.easeOut,duration:r.transitions.duration.shortest})}));function re(r){const{checked:a=!1,classes:o={},fontSize:n}=r,l=j({},r,{checked:a});return e.jsxs(Me,{className:o.root,ownerState:l,children:[e.jsx(ze,{fontSize:n,className:o.background,ownerState:l}),e.jsx(Ae,{fontSize:n,className:o.dot,ownerState:l})]})}const ae=c.createContext(void 0);function Be(){return c.useContext(ae)}function Ge(r){return G("MuiRadio",r)}const H=$("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),$e=["checked","checkedIcon","color","icon","name","onChange","size","className"],Ee=r=>{const{classes:a,color:o,size:n}=r,l={root:["root",`color${M(o)}`,n!=="medium"&&`size${M(n)}`]};return j({},a,N(l,Ge,a))},Oe=F(ke,{shouldForwardProp:r=>Z(r)||r==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(r,a)=>{const{ownerState:o}=r;return[a.root,o.size!=="medium"&&a[`size${M(o.size)}`],a[`color${M(o.color)}`]]}})(({theme:r,ownerState:a})=>j({color:(r.vars||r).palette.text.secondary},!a.disableRipple&&{"&:hover":{backgroundColor:r.vars?`rgba(${a.color==="default"?r.vars.palette.action.activeChannel:r.vars.palette[a.color].mainChannel} / ${r.vars.palette.action.hoverOpacity})`:de.alpha(a.color==="default"?r.palette.action.active:r.palette[a.color].main,r.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},a.color!=="default"&&{[`&.${H.checked}`]:{color:(r.vars||r).palette[a.color].main}},{[`&.${H.disabled}`]:{color:(r.vars||r).palette.action.disabled}}));function Ne(r,a){return typeof a=="object"&&a!==null?r===a:String(r)===String(a)}const K=e.jsx(re,{checked:!0}),J=e.jsx(re,{}),Ue=c.forwardRef(function(a,o){var n,l;const p=Q({props:a,name:"MuiRadio"}),{checked:f,checkedIcon:y=K,color:u="primary",icon:s=J,name:g,onChange:t,size:d="medium",className:v}=p,C=E(p,$e),S=j({},p,{color:u,size:d}),b=Ee(S),k=Be();let h=f;const A=le(t,k&&k.onChange);let w=g;return k&&(typeof h>"u"&&(h=Ne(k.value,p.value)),typeof w>"u"&&(w=k.name)),e.jsx(Oe,j({type:"radio",icon:c.cloneElement(s,{fontSize:(n=J.props.fontSize)!=null?n:d}),checkedIcon:c.cloneElement(y,{fontSize:(l=K.props.fontSize)!=null?l:d}),ownerState:S,classes:b,name:w,checked:h,onChange:A,ref:o,className:O(b.root,v)},C))});function Le(r){return G("MuiRadioGroup",r)}$("MuiRadioGroup",["root","row","error"]);const De=["actions","children","className","defaultValue","name","onChange","value"],Te=r=>{const{classes:a,row:o,error:n}=r;return N({root:["root",o&&"row",n&&"error"]},Le,a)},qe=c.forwardRef(function(a,o){const{actions:n,children:l,className:p,defaultValue:f,name:y,onChange:u,value:s}=a,g=E(a,De),t=c.useRef(null),d=Te(a),[v,C]=ue({controlled:s,default:f,name:"RadioGroup"});c.useImperativeHandle(n,()=>({focus:()=>{let h=t.current.querySelector("input:not(:disabled):checked");h||(h=t.current.querySelector("input:not(:disabled)")),h&&h.focus()}}),[]);const S=xe(o,t),b=he(y),k=c.useMemo(()=>({name:b,onChange(h){C(h.target.value),u&&u(h,h.target.value)},value:v}),[b,u,C,v]);return e.jsx(ae.Provider,{value:k,children:e.jsx(Pe,j({role:"radiogroup",ref:S,className:O(d.root,p)},g,{children:l}))})});function Ve({items:r,subtotal:a,shippingCost:o,total:n,onCreateOrder:l,creatingOrder:p,disabled:f,selectedPaymentMethod:y}){U();const{formatPrice:u}=ee();return e.jsx(I,{sx:{position:"sticky",top:24,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:"none"},children:e.jsxs(W,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:3,color:"text.primary"},children:"Ringkasan Pesanan"}),e.jsxs(x,{sx:{mb:3},children:[e.jsxs(i,{variant:"subtitle1",fontWeight:600,sx:{mb:2},children:["Item (",r.length,")"]}),e.jsx(P,{spacing:2,children:r.map(s=>{const g=s.product_variant.product.product_images?.[0]?.image_name;return e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,p:2,borderRadius:2,backgroundColor:"grey.50"},children:[e.jsx(je,{src:g||`https://placehold.co/50x50/9682DB/FFFFFF/png?text=${encodeURIComponent(s.product_variant.product.name.substring(0,10))}`,alt:s.product_variant.product.name,sx:{width:50,height:50,borderRadius:2,flexShrink:0,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},variant:"rounded",children:e.jsx(pe,{})}),e.jsxs(x,{sx:{flex:1,minWidth:0},children:[e.jsx(i,{variant:"subtitle2",fontWeight:600,sx:{mb:.5,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:s.product_variant.product.name,children:s.product_variant.product.name}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:s.product_variant.variant_name}),e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:["Qty: ",s.quantity]})]}),e.jsx(i,{variant:"body2",fontWeight:600,color:"primary.main",sx:{fontSize:"0.9rem"},children:u(parseFloat(s.product_variant.price)*s.quantity)})]},s.id)})})]}),e.jsx(T,{sx:{my:2}}),e.jsxs(P,{spacing:2,children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[e.jsx(i,{variant:"body1",fontWeight:500,children:"Subtotal"}),e.jsx(i,{variant:"body1",fontWeight:600,children:u(a)})]}),e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[e.jsx(i,{variant:"body1",fontWeight:500,children:"Biaya Pengiriman"}),e.jsx(i,{variant:"body1",fontWeight:600,children:u(o)})]}),e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"primary.main",borderRadius:2,color:"white"},children:[e.jsx(i,{variant:"h6",fontWeight:600,children:"Total"}),e.jsx(i,{variant:"h6",fontWeight:700,children:u(n)})]})]}),e.jsx(T,{sx:{my:3}}),e.jsx(z,{variant:"contained",size:"large",startIcon:e.jsx(me,{}),onClick:l,disabled:f||p,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:600,fontSize:"1rem",backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"},"&:disabled":{backgroundColor:"grey.300",color:"grey.500"}},children:p?"Membuat Order...":"Buat Order & Bayar"}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:2,textAlign:"center"},children:"Dengan melanjutkan, Anda menyetujui syarat dan ketentuan kami"})]})})}function He({selectedAddress:r,onAddressSelect:a}){const o=U(),n=X(),[l,p]=c.useState([]),[f,y]=c.useState(!0),[u,s]=c.useState(null);c.useEffect(()=>{(async()=>{try{y(!0),s(null);const d=await ve.getAddresses();if(d.success){p(d.data);const v=d.data.find(C=>C.is_primary);v&&a(v.id)}else s("Gagal memuat alamat")}catch(d){console.error("Error fetching addresses:",d),s(d.response?.data?.error||"Gagal memuat alamat")}finally{y(!1)}})()},[a]);const g=()=>{n("/addresses/add",{state:{returnTo:"/checkout"}})};return f?e.jsx(I,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(W,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:2,color:"text.primary"},children:"Alamat Pengiriman"}),e.jsx(P,{spacing:2,children:[...Array(2)].map((t,d)=>e.jsx(Ce,{variant:"rectangular",height:80,sx:{borderRadius:2}},d))})]})}):l.length===0?e.jsx(I,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(W,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:2,color:"text.primary"},children:"Alamat Pengiriman"}),e.jsx(R,{severity:"info",sx:{mb:2,borderRadius:2},children:"Anda belum memiliki alamat pengiriman. Silakan tambahkan alamat terlebih dahulu."}),e.jsx(z,{variant:"contained",startIcon:e.jsx(V,{}),onClick:g,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:600,backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:"Tambah Alamat"})]})}):e.jsx(I,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(W,{sx:{p:3},children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{color:"text.primary"},children:"Alamat Pengiriman"}),e.jsx(z,{variant:"outlined",size:"small",startIcon:e.jsx(V,{}),onClick:g,sx:{borderRadius:2,fontWeight:500,borderColor:"primary.main",color:"primary.main","&:hover":{backgroundColor:"primary.light",borderColor:"primary.dark"}},children:"Tambah Alamat"})]}),u&&e.jsx(R,{severity:"error",sx:{mb:2,borderRadius:2},onClose:()=>s(null),children:u}),e.jsx(fe,{component:"fieldset",fullWidth:!0,children:e.jsx(qe,{value:r||"",onChange:t=>a(t.target.value),children:l.map(t=>e.jsx(Re,{value:t.id,control:e.jsx(Ue,{}),label:e.jsx(x,{sx:{p:2,border:r===t.id?`2px solid ${o.palette.primary.main}`:`1px solid ${o.palette.grey[200]}`,borderRadius:2,backgroundColor:r===t.id?o.palette.primary.light+"10":"grey.50",transition:"all 0.2s ease",width:"100%","&:hover":{backgroundColor:r===t.id?o.palette.primary.light+"15":"grey.100"}},children:e.jsxs(P,{direction:"row",spacing:2,alignItems:"flex-start",children:[e.jsx(ge,{color:"primary",sx:{mt:.5,flexShrink:0}}),e.jsxs(x,{sx:{flex:1},children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,children:t.address_line}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[t.city,", ",t.province," ",t.postal_code]}),t.is_primary&&e.jsx(x,{sx:{display:"inline-block",backgroundColor:o.palette.primary.main,color:"white",px:1,py:.5,borderRadius:1,fontSize:"0.75rem",fontWeight:600,mt:1},children:"Utama"})]})]})}),sx:{width:"100%",margin:0,"& .MuiFormControlLabel-label":{width:"100%"}}},t.id))})})]})})}function ir(){U();const r=X(),{formatPrice:a,loading:o,error:n}=ee(),[l,p]=c.useState(!0),[f,y]=c.useState(!1),[u,s]=c.useState(!1),[g,t]=c.useState(null),[d,v]=c.useState(null),[C,S]=c.useState("midtrans"),[b,k]=c.useState(15e3),{items:h,clearCart:A}=ye(),{addOrder:w,setPaymentMethods:oe,paymentMethods:Ke}=be(),_=h.filter(m=>m.product_variant.product.deleted_at===null),L=_.reduce((m,D)=>m+parseFloat(D.product_variant.price)*D.quantity,0),te=L+b,ne=async()=>{try{const m=await q.getPaymentMethods();m.success&&oe(m.data)}catch(m){console.error("Error fetching payment methods:",m)}},se=async()=>{if(!d){t("Pilih alamat pengiriman terlebih dahulu");return}if(_.length===0){t("Tidak ada item yang tersedia untuk checkout");return}try{y(!0),t(null);const m=await q.createOrder({address_id:d,shipping_cost:b});m.success&&(w(m.data),s(!0),A(),r(`/orders/${m.data.order_id}`,{state:{message:"Order berhasil dibuat! Silakan lakukan pembayaran.",selectedPaymentMethod:C}}))}catch(m){console.error("Error creating order:",m),t(m.response?.data?.error||"Gagal membuat order")}finally{y(!1)}};return c.useEffect(()=>{if(h.length===0&&!f&&!u){r("/cart");return}ne(),p(!1)},[h.length,r,f,u]),l?e.jsx(x,{sx:{minHeight:"100vh",py:4},children:e.jsx(B,{maxWidth:"xl",children:e.jsx(i,{children:"Loading..."})})}):_.length===0?e.jsx(x,{sx:{minHeight:"100vh",py:4},children:e.jsxs(B,{maxWidth:"xl",children:[e.jsx(R,{severity:"warning",sx:{mb:4},children:"Tidak ada item yang tersedia untuk checkout. Semua item di keranjang sudah tidak tersedia."}),e.jsx(z,{variant:"contained",onClick:()=>r("/cart"),children:"Kembali ke Keranjang"})]})}):e.jsx(x,{sx:{minHeight:"100vh",py:4},children:e.jsxs(B,{maxWidth:"xl",children:[e.jsxs(x,{sx:{mb:3},children:[e.jsx(i,{variant:"h4",fontWeight:600,sx:{mb:1,color:"text.primary"},children:"Checkout"}),e.jsx(i,{variant:"body1",color:"text.secondary",children:"Lengkapi informasi pengiriman dan pembayaran"})]}),g&&e.jsx(R,{severity:"error",sx:{mb:4},onClose:()=>t(null),children:g}),o&&e.jsx(R,{severity:"info",sx:{mb:2},children:"Loading exchange rates..."}),n&&e.jsx(R,{severity:"warning",sx:{mb:2},children:"Failed to load exchange rates. Prices will be displayed in default currency."}),e.jsxs(x,{sx:{display:"flex",flexDirection:{xs:"column",lg:"row"},gap:4,alignItems:"flex-start"},children:[e.jsx(x,{sx:{flex:1,minWidth:0,order:{xs:1,lg:1}},children:e.jsxs(P,{spacing:4,children:[e.jsx(He,{selectedAddress:d,onAddressSelect:v}),e.jsx(I,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(W,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:2},children:"Biaya Pengiriman"}),e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[e.jsx(i,{variant:"body1",fontWeight:500,children:"Standard Delivery (2-3 hari kerja)"}),e.jsx(i,{variant:"h6",color:"primary.main",fontWeight:700,children:a(b)})]})]})})]})}),e.jsx(x,{sx:{width:{xs:"100%",lg:"400px"},flexShrink:0,order:{xs:2,lg:2}},children:e.jsx(Ve,{items:_,subtotal:L,shippingCost:b,total:te,onCreateOrder:se,creatingOrder:f,disabled:!d,selectedPaymentMethod:C})})]})]})})}export{ir as default};
