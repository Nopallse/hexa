import{c as ge,j as e,r as n,B as b,E as ae,T as s,S as q,D as k,t as D,O as be,p as te,x as g,a4 as G,al as J,a5 as U,a6 as u,X as fe,q as ve,aB as ye,ag as ke,C as Se,w as H,b5 as Ce,I as Te}from"./index-CLjvjqZT.js";import{l as $}from"./locationApi-w2u0ht2W.js";import{s as X}from"./shippingApi-C_vWEjNV.js";import{u as Ie,a as Pe,o as De,s as P,n as Ae,l as we}from"./schemas-DLfv8dIB.js";import{C as _e,a as We}from"./CardContent-Dqpv-NXF.js";import{A as B}from"./Alert-Cs6zeJMp.js";import{G as d}from"./Grid-Yhwe_G7n.js";import{E as ze}from"./Edit-CV4_xl7Z.js";import{R as Fe}from"./Refresh-DQUm0Bly.js";import{S as K}from"./Schedule-CIX9P0lB.js";import{C as se}from"./CheckCircle-Dgb9bYPy.js";import{T as Q,a as Y,b as Z,c as w,d as t,e as ee}from"./TableRow-5-DPG7g8.js";import{S as y}from"./Skeleton-BN8PhGVI.js";import{T as Ne}from"./Tooltip-BrgySCds.js";import{V as Re}from"./Visibility-Cu8UOJov.js";import{T as Ee}from"./TablePagination-ByuaW9VP.js";import"./useSlot-CDkgSjON.js";import"./Popper-Bu6D8dQx.js";import"./KeyboardArrowRight-BMzCiM98.js";import"./LastPage-DTDVOSKy.js";const re=ge(e.jsx("path",{d:"M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5zm-.5 1.5 1.96 2.5H17V9.5zM6 18c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m2.22-3c-.55-.61-1.33-1-2.22-1s-1.67.39-2.22 1H3V6h12v9zM18 18c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1"}),"LocalShippingOutlined"),Le=De({name:P().min(1,"Nama lokasi wajib diisi").min(2,"Nama lokasi minimal 2 karakter").max(100,"Nama lokasi maksimal 100 karakter"),contact_name:P().min(1,"Nama kontak wajib diisi").min(2,"Nama kontak minimal 2 karakter").max(100,"Nama kontak maksimal 100 karakter"),contact_phone:P().min(1,"Nomor telepon wajib diisi").min(10,"Nomor telepon minimal 10 digit").max(15,"Nomor telepon maksimal 15 digit").regex(/^[0-9+\-\s()]+$/,"Nomor telepon hanya boleh berisi angka dan simbol +, -, (, ), spasi"),address:P().min(1,"Alamat wajib diisi").min(10,"Alamat minimal 10 karakter").max(500,"Alamat maksimal 500 karakter"),postal_code:Ae().int("Kode pos harus berupa bilangan bulat").min(1e4,"Kode pos minimal 10000").max(99999,"Kode pos maksimal 99999"),note:P().max(200,"Catatan maksimal 200 karakter").optional().or(we(""))});function Oe({mode:p,location:r,isLoading:o=!1,error:m,onSubmit:h,onCancel:j}){const{register:x,handleSubmit:S,formState:{errors:c},reset:i}=Ie({resolver:Pe(Le),defaultValues:{name:"",contact_name:"",contact_phone:"",address:"",postal_code:0,note:""}});n.useEffect(()=>{r&&i({name:r.name,contact_name:r.contact_name,contact_phone:r.contact_phone,address:r.address,postal_code:r.postal_code,note:r.note||""})},[r,i]);const T=async f=>{await h(f)};return e.jsx(_e,{children:e.jsxs(We,{children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(ae,{sx:{fontSize:"1.5rem",mr:1,color:"primary.main"}}),e.jsx(s,{variant:"h6",fontWeight:600,children:"Edit Lokasi Origin"})]}),m&&e.jsx(B,{severity:"error",sx:{mb:3},children:m}),e.jsx(b,{component:"form",onSubmit:S(T),sx:{mt:3},children:e.jsxs(q,{spacing:3,children:[e.jsx(s,{variant:"h6",fontWeight:"bold",children:"Informasi Dasar"}),e.jsx(k,{...x("name"),label:"Nama Lokasi",fullWidth:!0,error:!!c.name,helperText:c.name?.message,disabled:o,placeholder:"Contoh: Toko Utama Jakarta",required:!0}),e.jsx(k,{...x("contact_name"),label:"Nama Kontak",fullWidth:!0,error:!!c.contact_name,helperText:c.contact_name?.message,disabled:o,placeholder:"Contoh: Ahmad",required:!0}),e.jsx(k,{...x("contact_phone"),label:"Nomor Telepon",fullWidth:!0,error:!!c.contact_phone,helperText:c.contact_phone?.message,disabled:o,placeholder:"Contoh: 08123456789",required:!0}),e.jsx(s,{variant:"h6",fontWeight:"bold",sx:{mt:2},children:"Informasi Alamat"}),e.jsx(k,{...x("address"),label:"Alamat Lengkap",fullWidth:!0,multiline:!0,rows:3,error:!!c.address,helperText:c.address?.message,disabled:o,placeholder:"Contoh: Jl. Gambir Selatan no 5. Blok F 92. Jakarta Pusat.",required:!0}),e.jsx(k,{...x("postal_code",{valueAsNumber:!0,setValueAs:f=>{const I=parseInt(f);return isNaN(I)?0:I}}),label:"Kode Pos",fullWidth:!0,type:"number",error:!!c.postal_code,helperText:c.postal_code?.message,disabled:o,placeholder:"10110",required:!0,InputProps:{inputProps:{min:1e4,max:99999,style:{textAlign:"right"}}}}),e.jsx(k,{...x("note"),label:"Catatan (Opsional)",fullWidth:!0,multiline:!0,rows:2,error:!!c.note,helperText:c.note?.message||"Catatan tambahan untuk lokasi ini",disabled:o,placeholder:"Contoh: Dekat tulisan warung Bu Indah"}),e.jsxs(q,{direction:"row",spacing:2,sx:{mt:4},children:[e.jsx(D,{type:"submit",variant:"contained",disabled:o,startIcon:o?e.jsx(be,{size:20}):void 0,sx:{minWidth:120},children:o?"Menyimpan...":"Simpan Perubahan"}),e.jsx(D,{variant:"outlined",onClick:j,disabled:o,sx:{minWidth:120},children:"Batal"})]})]})})]})})}function $e({onFilterChange:p,loading:r=!1,initialFilters:o}){const m=te(),[h,j]=n.useState({status:"",courier:"",startDate:"",endDate:"",...o});n.useEffect(()=>{o&&j(i=>({...i,...o}))},[o]);const x=(i,T)=>{const f={...h,[i]:T};j(f),p(f)},S=()=>{const i={status:"",courier:"",startDate:"",endDate:""};j(i),p(i)},c=h.status||h.courier||h.startDate||h.endDate;return e.jsx(g,{elevation:0,sx:{p:2,mb:3,borderRadius:2,border:`1px solid ${m.palette.grey[200]}`},children:e.jsxs(d,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(d,{item:!0,xs:12,md:3,children:e.jsxs(G,{fullWidth:!0,size:"small",children:[e.jsx(J,{children:"Status"}),e.jsxs(U,{value:h.status||"",onChange:i=>x("status",i.target.value),label:"Status",disabled:r,children:[e.jsx(u,{value:"",children:"Semua Status"}),e.jsx(u,{value:"pending",children:"Menunggu Pengiriman"}),e.jsx(u,{value:"confirmed",children:"Dikonfirmasi"}),e.jsx(u,{value:"shipped",children:"Terkirim"}),e.jsx(u,{value:"in_transit",children:"Dalam Perjalanan"}),e.jsx(u,{value:"delivered",children:"Terkirim"})]})]})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsxs(G,{fullWidth:!0,size:"small",children:[e.jsx(J,{children:"Kurir"}),e.jsxs(U,{value:h.courier||"",onChange:i=>x("courier",i.target.value),label:"Kurir",disabled:r,children:[e.jsx(u,{value:"",children:"Semua Kurir"}),e.jsx(u,{value:"jne",children:"JNE"}),e.jsx(u,{value:"jnt",children:"J&T"}),e.jsx(u,{value:"sicepat",children:"SiCepat"}),e.jsx(u,{value:"pos",children:"POS Indonesia"}),e.jsx(u,{value:"anteraja",children:"AnterAja"}),e.jsx(u,{value:"tiki",children:"TIKI"})]})]})}),e.jsx(d,{item:!0,xs:12,md:2,children:e.jsx(k,{fullWidth:!0,size:"small",label:"Tanggal Mulai",type:"date",value:h.startDate||"",onChange:i=>x("startDate",i.target.value),InputLabelProps:{shrink:!0},disabled:r})}),e.jsx(d,{item:!0,xs:12,md:2,children:e.jsx(k,{fullWidth:!0,size:"small",label:"Tanggal Akhir",type:"date",value:h.endDate||"",onChange:i=>x("endDate",i.target.value),InputLabelProps:{shrink:!0},disabled:r})}),e.jsx(d,{item:!0,xs:12,md:2,children:e.jsx(D,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(fe,{}),onClick:S,disabled:r||!c,sx:{height:40},children:"Reset"})})]})})}const Be=p=>{switch(p?.toLowerCase()){case"delivered":return"success";case"in_transit":case"confirmed":return"info";case"pending":case"shipped":return"warning";default:return"default"}},Ke=p=>{switch(p?.toLowerCase()){case"delivered":return e.jsx(se,{});case"in_transit":case"confirmed":return e.jsx(re,{});case"pending":case"shipped":return e.jsx(K,{});default:return e.jsx(K,{})}},Me=p=>{switch(p?.toLowerCase()){case"delivered":return"Terkirim";case"in_transit":return"Dalam Perjalanan";case"confirmed":return"Dikonfirmasi";case"pending":return"Menunggu Pengiriman";case"shipped":return"Terkirim";default:return p||"Unknown"}};function da(){const p=ve(),r=te(),{showNotification:o}=ye(),[m,h]=n.useState(null),[j,x]=n.useState(null),[S,c]=n.useState([]),[i,T]=n.useState(!0),[f,I]=n.useState(!1),[_,C]=n.useState(null),[A,W]=n.useState(null),[z,M]=n.useState(null),[F,ie]=n.useState({status:"",courier:"",startDate:"",endDate:"",page:1,limit:10}),[N,R]=n.useState(0),[E,ne]=n.useState(10),[V,oe]=n.useState(0),L=async()=>{try{T(!0),C(null);const a=await $.getActiveOriginLocation();if(a.success)h(a.data);else throw new Error("Failed to fetch active origin")}catch(a){C(a.message||"Gagal memuat data lokasi origin")}finally{T(!1)}},le=async()=>{try{const a=await X.getShippingStats();a.success&&a.data&&x(a.data)}catch(a){console.error("Failed to fetch shipping stats:",a)}},ce=async a=>{try{const l=a||F,v=await X.getShippingData({page:(N||0)+1,limit:E,status:l.status||void 0,courier:l.courier||void 0,startDate:l.startDate||void 0,endDate:l.endDate||void 0});v.success&&v.data&&(c(v.data),v.pagination&&oe(v.pagination.total_items||0))}catch(l){console.error("Failed to fetch shipping data:",l),C(l.message||"Gagal memuat data pengiriman")}},O=n.useMemo(()=>F,[F]),de=a=>{ie(a),R(0)},me=(a,l)=>{R(l)},he=a=>{ne(parseInt(a.target.value,10)),R(0)},xe=async()=>{try{const a=await $.checkConfigStatus();a.success&&a.data&&M({biteshipConfigured:a.data.biteshipConfigured,message:a.data.message})}catch(a){console.error("Failed to fetch API config status:",a)}};n.useEffect(()=>{(async()=>{await Promise.all([L(),le(),xe()])})()},[]),n.useEffect(()=>{ce(O)},[N,E,O]);const ue=async a=>{if(A)try{if(I(!0),C(null),(await $.updateLocation(A.id,a)).success)o({type:"success",message:"Lokasi origin berhasil diperbarui"}),W(null),await L();else throw new Error("Failed to update location")}catch(l){C(l.message||"Gagal memperbarui lokasi")}finally{I(!1)}},pe=()=>{m&&W(m)},je=()=>{W(null),C(null)};return i&&!m?e.jsx(ke,{message:"Memuat data lokasi origin..."}):e.jsxs(Se,{maxWidth:!1,children:[e.jsxs(b,{sx:{mb:4},children:[e.jsx(s,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Manajemen Pengiriman"}),e.jsx(s,{variant:"body1",color:"textSecondary",children:"Kelola lokasi origin, statistik pengiriman, dan tracking order"})]}),_&&e.jsx(B,{severity:"error",sx:{mb:3},onClose:()=>C(null),children:_}),z&&!z.biteshipConfigured&&e.jsxs(B,{severity:"warning",sx:{mb:3},onClose:()=>M(null),children:[e.jsx(s,{variant:"body2",fontWeight:600,sx:{mb:.5},children:"⚠️ Biteship API Tidak Dikonfigurasi"}),e.jsx(s,{variant:"body2",children:z.message})]}),A?e.jsx(g,{elevation:0,sx:{mb:3,borderRadius:2,border:`1px solid ${r.palette.grey[200]}`},children:e.jsx(b,{sx:{p:3},children:e.jsx(Oe,{mode:"edit",location:A,isLoading:f,error:_,onSubmit:ue,onCancel:je})})}):e.jsxs(b,{children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(g,{elevation:0,sx:{p:3,borderRadius:2,border:`1px solid ${r.palette.grey[200]}`},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:2},children:[e.jsx(ae,{sx:{fontSize:"1.5rem",color:"primary.main"}}),e.jsx(s,{variant:"h6",fontWeight:600,color:"text.primary",children:"Lokasi Origin"})]}),m?e.jsxs(b,{children:[e.jsx(s,{variant:"body1",fontWeight:600,color:"text.primary",sx:{mb:.5},children:m.name}),e.jsx(s,{variant:"body2",color:"textSecondary",sx:{mb:1},children:m.address}),e.jsxs(s,{variant:"body2",color:"textSecondary",sx:{mb:2},children:[m.postal_code," | ",m.contact_phone]}),e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(H,{label:"Aktif",size:"small",color:"success",sx:{fontWeight:600}}),e.jsx(D,{variant:"outlined",size:"small",startIcon:e.jsx(ze,{}),onClick:pe,sx:{textTransform:"none"},children:"Edit"})]})]}):e.jsxs(b,{sx:{textAlign:"center",py:2},children:[e.jsx(s,{variant:"body2",color:"textSecondary",children:"Belum ada lokasi origin"}),e.jsx(D,{variant:"outlined",size:"small",startIcon:e.jsx(Fe,{}),onClick:L,sx:{mt:1,textTransform:"none"},children:"Refresh"})]})]})}),e.jsx(d,{item:!0,xs:12,md:8,children:e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:6,md:3,children:e.jsxs(g,{elevation:0,sx:{p:2,textAlign:"center",borderRadius:2,border:`1px solid ${r.palette.grey[200]}`},children:[e.jsx(Ce,{sx:{fontSize:"2rem",color:"primary.main",mb:1}}),e.jsx(s,{variant:"h6",fontWeight:700,color:"text.primary",children:j?.totalOrders||0}),e.jsx(s,{variant:"body2",color:"textSecondary",children:"Total Order"})]})}),e.jsx(d,{item:!0,xs:6,md:3,children:e.jsxs(g,{elevation:0,sx:{p:2,textAlign:"center",borderRadius:2,border:`1px solid ${r.palette.grey[200]}`},children:[e.jsx(K,{sx:{fontSize:"2rem",color:"warning.main",mb:1}}),e.jsx(s,{variant:"h6",fontWeight:700,color:"text.primary",children:j?.pendingShipment||0}),e.jsx(s,{variant:"body2",color:"textSecondary",children:"Menunggu Kirim"})]})}),e.jsx(d,{item:!0,xs:6,md:3,children:e.jsxs(g,{elevation:0,sx:{p:2,textAlign:"center",borderRadius:2,border:`1px solid ${r.palette.grey[200]}`},children:[e.jsx(re,{sx:{fontSize:"2rem",color:"info.main",mb:1}}),e.jsx(s,{variant:"h6",fontWeight:700,color:"text.primary",children:j?.inTransit||0}),e.jsx(s,{variant:"body2",color:"textSecondary",children:"Dalam Perjalanan"})]})}),e.jsx(d,{item:!0,xs:6,md:3,children:e.jsxs(g,{elevation:0,sx:{p:2,textAlign:"center",borderRadius:2,border:`1px solid ${r.palette.grey[200]}`},children:[e.jsx(se,{sx:{fontSize:"2rem",color:"success.main",mb:1}}),e.jsx(s,{variant:"h6",fontWeight:700,color:"text.primary",children:j?.delivered||0}),e.jsx(s,{variant:"body2",color:"textSecondary",children:"Terkirim"})]})})]})})]}),e.jsx($e,{onFilterChange:de,loading:i,initialFilters:O}),i&&S.length===0?e.jsx(Q,{component:g,elevation:0,sx:{borderRadius:2,border:`1px solid ${r.palette.grey[200]}`},children:e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(w,{children:[e.jsx(t,{children:"ID Pengiriman"}),e.jsx(t,{children:"Order ID"}),e.jsx(t,{children:"Penerima"}),e.jsx(t,{children:"Tujuan"}),e.jsx(t,{children:"Kurir"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Tracking"}),e.jsx(t,{align:"right",children:"Aksi"})]})}),e.jsx(ee,{children:[...Array(5)].map((a,l)=>e.jsxs(w,{children:[e.jsx(t,{children:e.jsx(y,{})}),e.jsx(t,{children:e.jsx(y,{})}),e.jsx(t,{children:e.jsx(y,{})}),e.jsx(t,{children:e.jsx(y,{})}),e.jsx(t,{children:e.jsx(y,{})}),e.jsx(t,{children:e.jsx(y,{})}),e.jsx(t,{children:e.jsx(y,{})}),e.jsx(t,{align:"right",children:e.jsx(y,{})})]},l))})]})}):S.length===0?e.jsx(g,{elevation:0,sx:{p:4,textAlign:"center",borderRadius:2,border:`1px solid ${r.palette.grey[200]}`},children:e.jsx(s,{variant:"body1",color:"textSecondary",children:"Tidak ada data pengiriman ditemukan"})}):e.jsx(Q,{component:g,elevation:0,sx:{borderRadius:2,border:`1px solid ${r.palette.grey[200]}`},children:e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(w,{children:[e.jsx(t,{children:"ID Pengiriman"}),e.jsx(t,{children:"Order ID"}),e.jsx(t,{children:"Penerima"}),e.jsx(t,{children:"Tujuan"}),e.jsx(t,{children:"Kurir"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Tracking"}),e.jsx(t,{align:"right",children:"Aksi"})]})}),e.jsx(ee,{children:S.map(a=>e.jsxs(w,{hover:!0,children:[e.jsx(t,{children:e.jsx(s,{variant:"body2",fontWeight:500,children:a.id})}),e.jsx(t,{children:e.jsx(s,{variant:"body2",children:a.orderId})}),e.jsx(t,{children:e.jsx(s,{variant:"body2",children:a.recipient})}),e.jsx(t,{children:e.jsx(s,{variant:"body2",color:"textSecondary",children:a.destination})}),e.jsx(t,{children:e.jsx(s,{variant:"body2",children:a.courier})}),e.jsx(t,{children:e.jsx(H,{icon:Ke(a.status),label:Me(a.status),size:"small",color:Be(a.status),variant:"outlined",sx:{fontSize:"0.75rem",height:24,fontWeight:500}})}),e.jsx(t,{children:a.trackingNumber?e.jsx(s,{variant:"body2",sx:{fontFamily:"monospace"},children:a.trackingNumber}):e.jsx(s,{variant:"body2",color:"textSecondary",children:"-"})}),e.jsx(t,{align:"right",children:e.jsx(Ne,{title:"Lihat Detail",children:e.jsx(Te,{size:"small",onClick:()=>p(`/admin/shipping/${a.id}`),sx:{color:"primary.main"},children:e.jsx(Re,{fontSize:"small"})})})})]},a.id))})]})}),V>0&&e.jsx(Ee,{rowsPerPageOptions:[5,10,25,50],component:"div",count:V,rowsPerPage:E,page:N,onPageChange:me,onRowsPerPageChange:he,labelRowsPerPage:"Baris per halaman:",labelDisplayedRows:({from:a,to:l,count:v})=>`${a}-${l} dari ${v!==-1?v:`lebih dari ${l}`}`})]})]})}export{da as default};
