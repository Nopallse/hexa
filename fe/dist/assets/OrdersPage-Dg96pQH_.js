import{p as w,r as m,j as e,B as n,A as B,ac as z,T as i,w as T,t as k,Y as I,q as W,C as R,x as S,ak as P}from"./index-D0K_J5MH.js";import{u as $}from"./orderStore-DhFXQ6lx.js";import{o as O}from"./orderApi-v6xAOF7v.js";import{u as M}from"./useCurrencyConversion-Bs2vyWZT.js";import{C as F,a as N}from"./CardContent-7fkJvOwG.js";import{V as E}from"./Visibility-CQ4KNQ-1.js";import{C as G}from"./Cancel-7bhXRLZy.js";import{A as L}from"./AccountSidebar-BlWC-6ly.js";import{G as v}from"./Grid-DME9EBTC.js";import{T as U,a as q}from"./Tabs-Wh_Fzeq5.js";import{A as H}from"./Alert-D2FNR8Ya.js";import{O as V}from"./Receipt-5ZTErOr_.js";import"./ShoppingBag-t9lGAFBE.js";import"./KeyboardArrowRight-BjeXrdmN.js";function K({order:a,onView:p}){w();const[u,x]=m.useState(!1),{formatPrice:f}=M(),y=r=>new Date(r).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}),t=r=>{switch(r){case"belum_bayar":return"warning";case"dikemas":return"primary";case"dikirim":return"info";case"diterima":return"success";case"dibatalkan":return"error";default:return"default"}},h=r=>{switch(r){case"belum_bayar":return"Belum Bayar";case"dikemas":return"Dikemas";case"dikirim":return"Dikirim";case"diterima":return"Diterima";case"dibatalkan":return"Dibatalkan";default:return r}},c=async()=>{if(!a?.id){console.error("Order ID is missing");return}if(window.confirm("Apakah Anda yakin ingin membatalkan pesanan ini?"))try{x(!0),(await O.cancelOrder(a.id)).success&&window.location.reload()}catch(r){console.error("Error cancelling order:",r),alert(r.response?.data?.error||"Gagal membatalkan pesanan")}finally{x(!1)}},j=a?.status==="belum_bayar",b=a?.order_items&&a.order_items.length>0?a.order_items[0]:null,o=b?.product_variant?.product?.product_images,g=o&&o.length>0?o[0]?.image_name:null;return e.jsx(F,{sx:{mb:2,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"none",transition:"all 0.2s ease","&:hover":{boxShadow:"0 2px 8px rgba(0,0,0,0.15)"}},children:e.jsx(N,{sx:{p:3},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:3},children:[e.jsx(n,{sx:{flexShrink:0},children:e.jsx(B,{src:g?`/uploads/${g}`:`https://placehold.co/80x80/9682DB/FFFFFF/png?text=${encodeURIComponent(b?.product_variant?.product?.name?.substring(0,10)||"Order")}`,alt:"Order items",sx:{width:80,height:80,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},variant:"rounded",children:e.jsx(z,{sx:{fontSize:32}})})}),e.jsxs(n,{sx:{flex:1,minWidth:0},children:[e.jsxs(i,{variant:"h6",fontWeight:600,sx:{mb:1,color:"text.primary",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.3,fontSize:"1rem"},title:`Order #${a.id?a.id.slice(-8).toUpperCase():"N/A"}`,children:["Order #",a.id?a.id.slice(-8).toUpperCase():"N/A"]}),e.jsx(n,{sx:{mb:1},children:e.jsx(T,{label:h(a?.status||""),size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:20,borderColor:t(a?.status||"")==="warning"?"warning.main":t(a?.status||"")==="success"?"success.main":t(a?.status||"")==="error"?"error.main":t(a?.status||"")==="info"?"info.main":"primary.main",color:t(a?.status||"")==="warning"?"warning.main":t(a?.status||"")==="success"?"success.main":t(a?.status||"")==="error"?"error.main":t(a?.status||"")==="info"?"info.main":"primary.main","& .MuiChip-label":{px:1}}})}),e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:["Dibuat: ",a?.created_at?y(a.created_at):"N/A"]}),e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:[a?.order_items?.length||0," item",(a?.order_items?.length||0)>1?"s":""]}),e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:[a?.address?.city||"",", ",a?.address?.province||""]})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,flexShrink:0},children:[e.jsxs(n,{sx:{textAlign:"right",minWidth:100},children:[e.jsx(i,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Total"}),e.jsx(i,{variant:"h6",color:"primary.main",fontWeight:700,sx:{fontSize:"1rem"},children:f((Number(a?.total_amount)||0)+(Number(a?.shipping_cost)||0))})]}),e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(k,{variant:"contained",size:"small",startIcon:e.jsx(E,{}),onClick:()=>p(a),sx:{borderRadius:2,fontWeight:600,fontSize:"0.75rem",py:.5,px:1.5,backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:"Detail"}),j&&e.jsx(k,{variant:"outlined",size:"small",startIcon:e.jsx(G,{}),onClick:c,disabled:u,color:"error",sx:{borderRadius:2,fontWeight:600,fontSize:"0.75rem",py:.5,px:1.5,borderColor:"error.main",color:"error.main","&:hover":{backgroundColor:"error.light",borderColor:"error.dark"}},children:u?"Batal...":"Batal"})]})]})]})})})}function Q(a){return{id:`orders-tab-${a}`,"aria-controls":`orders-tabpanel-${a}`}}function de(){const a=w(),p=I(a.breakpoints.down("md")),u=W(),{orders:x,setOrders:f}=$(),[y,t]=m.useState(!1),[h,c]=m.useState(null),[j,b]=m.useState(0),[o,g]=m.useState({page:1,limit:10,total:0,pages:0}),r=[{label:"Semua",value:""},{label:"Belum Bayar",value:"belum_bayar"},{label:"Dikemas",value:"dikemas"},{label:"Dikirim",value:"dikirim"},{label:"Diterima",value:"diterima"},{label:"Dibatalkan",value:"dibatalkan"}],C=async(s={})=>{try{t(!0),c(null);const l={page:o.page,limit:o.limit,...s},d=await O.getUserOrders(l);d.success?(f(d.data),g(_=>({..._,total:d.pagination?.total||0,pages:d.pagination?.pages||0}))):c("Gagal memuat pesanan")}catch(l){c(l.message||"Gagal memuat pesanan")}finally{t(!1)}};m.useEffect(()=>{C()},[o.page,o.limit]);const A=(s,l)=>{b(l);const d=r[l].value;C({status:d})},D=s=>{u(`/orders/${s.id}`)};return e.jsx(R,{maxWidth:"xl",sx:{py:4},children:e.jsxs(v,{container:!0,spacing:4,children:[e.jsx(v,{item:!0,xs:12,md:3,children:e.jsx(L,{})}),e.jsxs(v,{item:!0,xs:12,md:9,children:[e.jsxs(n,{sx:{mb:4},children:[e.jsx(i,{variant:"h4",component:"h1",sx:{fontWeight:600,color:"text.primary",mb:1},children:"Pesanan Saya"}),e.jsx(i,{variant:"body1",color:"text.secondary",children:"Kelola dan lacak pesanan Anda"})]}),e.jsx(S,{elevation:0,sx:{mb:3,borderRadius:2,border:`1px solid ${a.palette.grey[200]}`,overflow:"hidden"},children:e.jsx(U,{value:j,onChange:A,variant:p?"scrollable":"standard",scrollButtons:p?"auto":!1,allowScrollButtonsMobile:!0,sx:{borderBottom:`1px solid ${a.palette.grey[200]}`,"& .MuiTab-root":{textTransform:"none",fontWeight:500,fontSize:"1rem",py:2,px:3,minHeight:"auto","&.Mui-selected":{fontWeight:600,color:"primary.main"}},"& .MuiTabs-indicator":{height:3,borderRadius:"3px 3px 0 0"}},children:r.map((s,l)=>e.jsx(q,{label:s.label,...Q(l)},s.value))})}),h&&e.jsx(H,{severity:"error",sx:{mb:3,borderRadius:2},onClose:()=>c(null),children:h}),y?e.jsx(n,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(P,{})}):x.length===0?e.jsxs(S,{elevation:0,sx:{borderRadius:2,border:`1px solid ${a.palette.grey[200]}`,p:4,textAlign:"center"},children:[e.jsx(V,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(i,{variant:"h6",sx:{fontWeight:600,color:"text.primary",mb:1},children:"Belum Ada Pesanan"}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Pesanan Anda akan muncul di sini setelah melakukan pembelian"}),e.jsx(k,{variant:"contained",onClick:()=>u("/products"),sx:{borderRadius:2,textTransform:"none",fontWeight:500,backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:"Mulai Belanja"})]}):e.jsx(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:x.map(s=>e.jsx(K,{order:s,onView:D},s.id))})]})]})})}export{de as default};
