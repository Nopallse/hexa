import{a as X,g as Y,r as o,u as le,_ as ee,ad as je,ae as Ce,i as F,j as e,s as N,k as re,m as te,c as de,R as ue,af as ke,l as H,U as Se,d as _e,h as Re,b as we,p as J,T as i,B as c,S as O,H as Ie,N as ae,v as D,t as L,ac as Fe,q as pe,a3 as he,E as $e,aa as K,a8 as P,J as Pe,ag as Me,a9 as We,C as Z}from"./index-CZFAEO2y.js";import{u as ze}from"./cartStore-CZthKorE.js";import{u as Ee}from"./orderStore-C_2rb-4t.js";import{o as oe}from"./orderApi-BZ9ScYhU.js";import{u as xe}from"./useCurrencyConversion-BCvfb8ro.js";import{C as B,a as G}from"./CardContent-CEZafFSD.js";import{A as Be}from"./Avatar-BK2nAYkE.js";import{a as Ge}from"./addressApi-BQDLaqEK.js";import{S as Oe}from"./Skeleton-CfZ67nOg.js";import{A as M}from"./Alert-Dhgb7HXh.js";import{A as ne}from"./Add-CHzkKGzA.js";import{S as De,F as me}from"./FormControlLabel-JCOJYzOL.js";import{l as Le}from"./locationApi--r_1V-dd.js";import{M as Ne}from"./AttachMoney-CFKqt2v3.js";import{S as Ae}from"./Schedule-CN0diGSq.js";import"./useSlot-CExgq9at.js";function Te(r){return X("MuiFormGroup",r)}Y("MuiFormGroup",["root","row","error"]);const Ue=["className","row"],qe=r=>{const{classes:t,row:n,error:s}=r;return te({root:["root",n&&"row",s&&"error"]},Te,t)},Ve=N("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(r,t)=>{const{ownerState:n}=r;return[t.root,n.row&&t.row]}})(({ownerState:r})=>F({display:"flex",flexDirection:"column",flexWrap:"wrap"},r.row&&{flexDirection:"row"})),Ke=o.forwardRef(function(t,n){const s=le({props:t,name:"MuiFormGroup"}),{className:d,row:u=!1}=s,k=ee(s,Ue),b=je(),p=Ce({props:s,muiFormControl:b,states:["error"]}),m=F({},s,{row:u,error:p.error}),h=qe(m);return e.jsx(Ve,F({className:re(h.root,d),ownerState:m,ref:n},k))}),He=de(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),Je=de(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),Qe=N("span",{name:"MuiRadioButtonIcon",shouldForwardProp:ue})({position:"relative",display:"flex"}),Ze=N(He,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),Xe=N(Je,{name:"MuiRadioButtonIcon"})(({theme:r,ownerState:t})=>F({left:0,position:"absolute",transform:"scale(0)",transition:r.transitions.create("transform",{easing:r.transitions.easing.easeIn,duration:r.transitions.duration.shortest})},t.checked&&{transform:"scale(1)",transition:r.transitions.create("transform",{easing:r.transitions.easing.easeOut,duration:r.transitions.duration.shortest})}));function fe(r){const{checked:t=!1,classes:n={},fontSize:s}=r,d=F({},r,{checked:t});return e.jsxs(Qe,{className:n.root,ownerState:d,children:[e.jsx(Ze,{fontSize:s,className:n.background,ownerState:d}),e.jsx(Xe,{fontSize:s,className:n.dot,ownerState:d})]})}const ge=o.createContext(void 0);function Ye(){return o.useContext(ge)}function er(r){return X("MuiRadio",r)}const se=Y("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),rr=["checked","checkedIcon","color","icon","name","onChange","size","className"],tr=r=>{const{classes:t,color:n,size:s}=r,d={root:["root",`color${H(n)}`,s!=="medium"&&`size${H(s)}`]};return F({},t,te(d,er,t))},ar=N(De,{shouldForwardProp:r=>ue(r)||r==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(r,t)=>{const{ownerState:n}=r;return[t.root,n.size!=="medium"&&t[`size${H(n.size)}`],t[`color${H(n.color)}`]]}})(({theme:r,ownerState:t})=>F({color:(r.vars||r).palette.text.secondary},!t.disableRipple&&{"&:hover":{backgroundColor:r.vars?`rgba(${t.color==="default"?r.vars.palette.action.activeChannel:r.vars.palette[t.color].mainChannel} / ${r.vars.palette.action.hoverOpacity})`:Se.alpha(t.color==="default"?r.palette.action.active:r.palette[t.color].main,r.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},t.color!=="default"&&{[`&.${se.checked}`]:{color:(r.vars||r).palette[t.color].main}},{[`&.${se.disabled}`]:{color:(r.vars||r).palette.action.disabled}}));function or(r,t){return typeof t=="object"&&t!==null?r===t:String(r)===String(t)}const ie=e.jsx(fe,{checked:!0}),ce=e.jsx(fe,{}),ye=o.forwardRef(function(t,n){var s,d;const u=le({props:t,name:"MuiRadio"}),{checked:k,checkedIcon:b=ie,color:p="primary",icon:m=ce,name:h,onChange:g,size:l="medium",className:j}=u,x=ee(u,rr),f=F({},u,{color:p,size:l}),R=tr(f),S=Ye();let C=k;const _=ke(g,S&&S.onChange);let $=h;return S&&(typeof C>"u"&&(C=or(S.value,u.value)),typeof $>"u"&&($=S.name)),e.jsx(ar,F({type:"radio",icon:o.cloneElement(m,{fontSize:(s=ce.props.fontSize)!=null?s:l}),checkedIcon:o.cloneElement(b,{fontSize:(d=ie.props.fontSize)!=null?d:l}),ownerState:f,classes:R,name:$,checked:C,onChange:_,ref:n,className:re(R.root,j)},x))});function nr(r){return X("MuiRadioGroup",r)}Y("MuiRadioGroup",["root","row","error"]);const sr=["actions","children","className","defaultValue","name","onChange","value"],ir=r=>{const{classes:t,row:n,error:s}=r;return te({root:["root",n&&"row",s&&"error"]},nr,t)},ve=o.forwardRef(function(t,n){const{actions:s,children:d,className:u,defaultValue:k,name:b,onChange:p,value:m}=t,h=ee(t,sr),g=o.useRef(null),l=ir(t),[j,x]=_e({controlled:m,default:k,name:"RadioGroup"});o.useImperativeHandle(s,()=>({focus:()=>{let C=g.current.querySelector("input:not(:disabled):checked");C||(C=g.current.querySelector("input:not(:disabled)")),C&&C.focus()}}),[]);const f=Re(n,g),R=we(b),S=o.useMemo(()=>({name:R,onChange(C){x(C.target.value),p&&p(C,C.target.value)},value:j}),[R,p,x,j]);return e.jsx(ge.Provider,{value:S,children:e.jsx(Ke,F({role:"radiogroup",ref:f,className:re(l.root,u)},h,{children:d}))})});function cr({items:r,subtotal:t,shippingCost:n,total:s,onCreateOrder:d,creatingOrder:u,disabled:k,selectedPaymentMethod:b,selectedShippingMethod:p}){J();const{formatPrice:m}=xe(),h=l=>{switch(l){case"biteship":return"ðŸšš Biteship";case"fedex":return"ðŸ“¦ FedEx";case"fedex-estimated":return"ðŸ“¦ FedEx (Est.)";case"indonesia-estimated":return"ðŸ‡®ðŸ‡© Indonesia (Est.)";default:return"ðŸ“¦ Shipping"}},g=l=>{switch(l){case"biteship":return"primary";case"fedex":return"error";case"fedex-estimated":return"warning";case"indonesia-estimated":return"info";default:return"default"}};return e.jsx(B,{sx:{position:"sticky",top:24,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:"none"},children:e.jsxs(G,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:3,color:"text.primary"},children:"Ringkasan Pesanan"}),e.jsxs(c,{sx:{mb:3},children:[e.jsxs(i,{variant:"subtitle1",fontWeight:600,sx:{mb:2},children:["Item (",r.length,")"]}),e.jsx(O,{spacing:2,children:r.map(l=>{const j=l.product_variant.product.product_images?.[0]?.image_name;return e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2,p:2,borderRadius:2,backgroundColor:"grey.50"},children:[e.jsx(Be,{src:j||`https://placehold.co/50x50/9682DB/FFFFFF/png?text=${encodeURIComponent(l.product_variant.product.name.substring(0,10))}`,alt:l.product_variant.product.name,sx:{width:50,height:50,borderRadius:2,flexShrink:0,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},variant:"rounded",children:e.jsx(Ie,{})}),e.jsxs(c,{sx:{flex:1,minWidth:0},children:[e.jsx(i,{variant:"subtitle2",fontWeight:600,sx:{mb:.5,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:l.product_variant.product.name,children:l.product_variant.product.name}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:l.product_variant.variant_name}),e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:["Qty: ",l.quantity]})]}),e.jsx(i,{variant:"body2",fontWeight:600,color:"primary.main",sx:{fontSize:"0.9rem"},children:m(parseFloat(l.product_variant.price)*l.quantity)})]},l.id)})})]}),e.jsx(ae,{sx:{my:2}}),e.jsxs(O,{spacing:2,children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[e.jsx(i,{variant:"body1",fontWeight:500,children:"Subtotal"}),e.jsx(i,{variant:"body1",fontWeight:600,children:m(t)})]}),e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[e.jsxs(c,{children:[e.jsx(i,{variant:"body1",fontWeight:500,children:"Biaya Pengiriman"}),p&&e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsxs(i,{variant:"body2",color:"text.secondary",children:[p.courier_name," - ",p.courier_service_name]}),p.provider&&e.jsx(D,{label:h(p.provider),size:"small",color:g(p.provider),variant:"outlined"})]})]}),e.jsx(i,{variant:"body1",fontWeight:600,children:m(n)})]}),e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"primary.main",borderRadius:2,color:"white"},children:[e.jsx(i,{variant:"h6",fontWeight:600,children:"Total"}),e.jsx(i,{variant:"h6",fontWeight:700,children:m(s)})]})]}),e.jsx(ae,{sx:{my:3}}),e.jsx(L,{variant:"contained",size:"large",startIcon:e.jsx(Fe,{}),onClick:d,disabled:k||u,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:600,fontSize:"1rem",backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"},"&:disabled":{backgroundColor:"grey.300",color:"grey.500"}},children:u?"Membuat Order...":"Buat Order & Bayar"}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:2,textAlign:"center"},children:"Dengan melanjutkan, Anda menyetujui syarat dan ketentuan kami"})]})})}function lr({selectedAddress:r,onAddressSelect:t,onAddressesLoaded:n}){const s=J(),d=pe(),[u,k]=o.useState([]),[b,p]=o.useState(!0),[m,h]=o.useState(null),g=o.useRef(t),l=o.useRef(n);o.useEffect(()=>{g.current=t,l.current=n},[t,n]),o.useEffect(()=>{(async()=>{try{p(!0),h(null);const f=await Ge.getAddresses();if(f.success){k(f.data),l.current?.(f.data);const R=f.data.find(S=>S.is_primary);R&&!r&&g.current(R.id)}else h("Gagal memuat alamat")}catch(f){console.error("Error fetching addresses:",f),h(f.response?.data?.error||"Gagal memuat alamat")}finally{p(!1)}})()},[]);const j=()=>{d("/addresses/add",{state:{returnTo:"/checkout"}})};return b?e.jsx(B,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(G,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:2,color:"text.primary"},children:"Alamat Pengiriman"}),e.jsx(O,{spacing:2,children:[...Array(2)].map((x,f)=>e.jsx(Oe,{variant:"rectangular",height:80,sx:{borderRadius:2}},f))})]})}):u.length===0?e.jsx(B,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(G,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:2,color:"text.primary"},children:"Alamat Pengiriman"}),e.jsx(M,{severity:"info",sx:{mb:2,borderRadius:2},children:"Anda belum memiliki alamat pengiriman. Silakan tambahkan alamat terlebih dahulu."}),e.jsx(L,{variant:"contained",startIcon:e.jsx(ne,{}),onClick:j,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:600,backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:"Tambah Alamat"})]})}):e.jsx(B,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(G,{sx:{p:3},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{color:"text.primary"},children:"Alamat Pengiriman"}),e.jsx(L,{variant:"outlined",size:"small",startIcon:e.jsx(ne,{}),onClick:j,sx:{borderRadius:2,fontWeight:500,borderColor:"primary.main",color:"primary.main","&:hover":{backgroundColor:"primary.light",borderColor:"primary.dark"}},children:"Tambah Alamat"})]}),m&&e.jsx(M,{severity:"error",sx:{mb:2,borderRadius:2},onClose:()=>h(null),children:m}),e.jsx(he,{component:"fieldset",fullWidth:!0,children:e.jsx(ve,{value:r||"",onChange:x=>t(x.target.value),children:u.map(x=>e.jsx(me,{value:x.id,control:e.jsx(ye,{}),label:e.jsx(c,{sx:{p:2,border:r===x.id?`2px solid ${s.palette.primary.main}`:`1px solid ${s.palette.grey[200]}`,borderRadius:2,backgroundColor:r===x.id?s.palette.primary.light+"10":"grey.50",transition:"all 0.2s ease",width:"100%","&:hover":{backgroundColor:r===x.id?s.palette.primary.light+"15":"grey.100"}},children:e.jsxs(O,{direction:"row",spacing:2,alignItems:"flex-start",children:[e.jsx($e,{color:"primary",sx:{mt:.5,flexShrink:0}}),e.jsxs(c,{sx:{flex:1},children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,children:x.address_line}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[x.city,", ",x.province," ",x.postal_code]}),x.is_primary&&e.jsx(c,{sx:{display:"inline-block",backgroundColor:s.palette.primary.main,color:"white",px:1,py:.5,borderRadius:1,fontSize:"0.75rem",fontWeight:600,mt:1},children:"Utama"})]})]})}),sx:{width:"100%",margin:0,"& .MuiFormControlLabel-label":{width:"100%"}}},x.id))})})]})})}const dr={getShippingRates:async r=>{try{const t=await K.post("/shipping/rates",r);return{success:!0,data:t.data.data,provider:t.data.provider,origin_country:t.data.origin_country,destination_country:t.data.destination_country}}catch(t){return{success:!1,error:t.response?.data?.error||"Failed to fetch shipping rates"}}},getAreas:async(r={})=>{try{return{success:!0,data:(await K.get("/shipping/areas",{params:r})).data.data}}catch(t){return{success:!1,error:t.response?.data?.error||"Failed to fetch areas"}}},trackShipment:async(r,t)=>{try{const n=t?{courier:t}:{},s=await K.get(`/shipping/track/${r}`,{params:n});return{success:!0,data:s.data.data,provider:s.data.provider}}catch(n){return{success:!1,error:n.response?.data?.error||"Failed to track shipment"}}},trackFedExShipment:async r=>{try{const t=await K.get(`/shipping/track/fedex/${r}`);return{success:!0,data:t.data.data,provider:t.data.provider}}catch(t){return{success:!1,error:t.response?.data?.error||"Failed to track FedEx shipment"}}}};function ur(r,t){const[n,s]=o.useState(r);return o.useEffect(()=>{const d=setTimeout(()=>{s(r)},t);return()=>{clearTimeout(d)}},[r,t]),n}function pr({selectedAddress:r,cartItems:t,selectedMethod:n,onMethodSelect:s}){const d=J(),[u,k]=o.useState([]),[b,p]=o.useState(!1),[m,h]=o.useState(null),[g,l]=o.useState(null),[j,x]=o.useState(null),[f,R]=o.useState(""),[S,C]=o.useState(!1),_=P.useMemo(()=>t.map(a=>({name:a.product_variant.product.name,description:a.product_variant.product.description||"",length:a.product_variant.product.length||10,width:a.product_variant.product.width||10,height:a.product_variant.product.height||1,weight:a.product_variant.product.weight||a.product_variant.weight||1e3,quantity:a.quantity,value:a.product_variant.price*a.quantity})),[t]),$=P.useMemo(()=>r?`${r.id}_${r.country}_${r.postal_code}`:null,[r?.id,r?.country,r?.postal_code]),E=P.useMemo(()=>_.reduce((a,y)=>a+y.weight*y.quantity,0),[_]),A=P.useMemo(()=>!r||t.length===0?null:`${$}_${E}_${_.length}`,[$,E,_.length,t.length]),w=ur(A,500);o.useEffect(()=>{(async()=>{try{const y=await Le.getActiveOriginLocation();y.success&&y.data&&x(y.data)}catch(y){console.error("Failed to fetch active origin:",y)}})()},[]),o.useEffect(()=>{r&&t.length>0&&j&&w&&w!==g&&T()},[w,j]);const T=async()=>{if(!(!r||!w||!j)&&!b)try{p(!0),h(null),l(w);const a=await dr.getShippingRates({origin_postal_code:j.postal_code,destination_postal_code:r.postal_code,origin_country:"ID",destination_country:r.country,items:_});(w===g||!g)&&(a.success&&a.data?(k(a.data.pricing||[]),R(a.provider||""),C(r.country!=="ID")):h(a.error||"Failed to fetch shipping rates"))}catch(a){(w===g||!g)&&h(a.message||"Failed to fetch shipping rates")}finally{p(!1)}};P.useEffect(()=>()=>{p(!1),h(null)},[]);const Q=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a),U=(a,y)=>a===y?`${a} hari`:`${a}-${y} hari`,q=a=>{switch(a){case"express":return"error";case"standard":return"primary";case"economy":return"success";default:return"default"}},W=a=>{switch(a){case"express":return"Express";case"standard":return"Standard";case"economy":return"Economy";default:return a}},I=a=>{switch(a){case"biteship":return{name:"Biteship",color:"primary",icon:"ðŸšš"};case"fedex":return{name:"FedEx",color:"error",icon:"ðŸ“¦"};case"fedex-estimated":return{name:"FedEx (Estimated)",color:"warning",icon:"ðŸ“¦"};case"indonesia-estimated":return{name:"Indonesia (Estimated)",color:"info",icon:"ðŸ‡®ðŸ‡©"};default:return{name:"Shipping",color:"default",icon:"ðŸ“¦"}}};return r?e.jsx(B,{children:e.jsxs(G,{children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Pe,{sx:{fontSize:"1.5rem",mr:1,color:"primary.main"}}),e.jsx(i,{variant:"h6",fontWeight:600,children:"Pilih Metode Pengiriman"})]}),f&&e.jsx(D,{label:`${I(f).icon} ${I(f).name}`,color:I(f).color,size:"small",variant:"outlined"})]}),e.jsxs(c,{sx:{mb:3,p:2,backgroundColor:"grey.50",borderRadius:2},children:[e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Alamat Pengiriman:"}),e.jsx(i,{variant:"body1",fontWeight:500,children:r.recipient_name}),e.jsx(i,{variant:"body2",color:"text.secondary",children:r.address_line}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[r.city,", ",r.province," ",r.postal_code]}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[r.country==="ID"?"ðŸ‡®ðŸ‡© Indonesia":`ðŸŒ ${r.country}`,S&&e.jsx(D,{label:"Internasional",size:"small",color:"warning",variant:"outlined",sx:{ml:1,fontSize:"0.7rem"}})]})]}),b&&e.jsxs(c,{sx:{display:"flex",justifyContent:"center",py:3},children:[e.jsx(Me,{size:24}),e.jsx(i,{variant:"body2",sx:{ml:2},children:"Mencari opsi pengiriman..."})]}),m&&e.jsxs(M,{severity:"error",sx:{mb:3},children:[m,e.jsx(L,{size:"small",onClick:T,sx:{ml:2},children:"Coba Lagi"})]}),!b&&!m&&u.length>0&&e.jsxs(he,{component:"fieldset",fullWidth:!0,children:[e.jsx(We,{component:"legend",sx:{mb:2,fontWeight:600},children:"Pilih Metode Pengiriman"}),e.jsx(ve,{value:n||"",onChange:a=>{const y=u.find(z=>`${z.courier_code}_${z.courier_service_code}`===a.target.value);y&&s(y)},children:e.jsx(O,{spacing:2,children:u.map(a=>{const y=`${a.courier_code}_${a.courier_service_code}`,z=n===y;return e.jsx(B,{sx:{border:z?`2px solid ${d.palette.primary.main}`:"1px solid",borderColor:z?"primary.main":"grey.300",backgroundColor:z?"primary.light":"white",transition:"all 0.2s ease",cursor:"pointer","&:hover":{borderColor:"primary.main",backgroundColor:"primary.light"}},onClick:()=>{`${a.courier_code}${a.courier_service_code}`,s(a)},children:e.jsxs(G,{sx:{p:2},children:[e.jsx(me,{value:y,control:e.jsx(ye,{}),label:"",sx:{m:0}}),e.jsxs(c,{sx:{ml:4},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",mb:1,flexWrap:"wrap",gap:1},children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,children:a.courier_name}),e.jsx(D,{label:W(a.service_type),color:q(a.service_type),size:"small"}),a.provider&&a.provider!==f&&e.jsx(D,{label:`${I(a.provider).icon} ${I(a.provider).name}`,color:I(a.provider).color,size:"small",variant:"outlined"})]}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:2},children:a.description}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:3},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ne,{sx:{fontSize:"1rem",mr:.5,color:"success.main"}}),e.jsx(i,{variant:"h6",fontWeight:600,color:"success.main",children:Q(a.price)})]}),e.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ae,{sx:{fontSize:"1rem",mr:.5,color:"text.secondary"}}),e.jsx(i,{variant:"body2",color:"text.secondary",children:U(a.min_day,a.max_day)})]})]})]})]})},y)})})})]}),!b&&!m&&u.length===0&&e.jsx(M,{severity:"warning",children:"Tidak ada opsi pengiriman tersedia untuk alamat ini"})]})}):e.jsx(B,{children:e.jsx(G,{children:e.jsx(M,{severity:"info",children:"Pilih alamat pengiriman terlebih dahulu untuk melihat opsi pengiriman"})})})}function Fr(){J();const r=pe(),{loading:t,error:n}=xe(),[s,d]=o.useState(!0),[u,k]=o.useState(!1),[b,p]=o.useState(!1),[m,h]=o.useState(null),[g,l]=o.useState(null),[j,x]=o.useState(null),[f,R]=o.useState([]),[S,C]=o.useState("midtrans"),[_,$]=o.useState(null),[E,A]=o.useState(15e3),{items:w,clearCart:T}=ze(),{addOrder:Q,setPaymentMethods:U,paymentMethods:q}=Ee(),W=P.useMemo(()=>w.filter(v=>v.product_variant.product.deleted_at===null),[w]),I=P.useMemo(()=>W.reduce((v,V)=>v+parseFloat(V.product_variant.price)*V.quantity,0),[W]),a=P.useMemo(()=>I+E,[I,E]),y=P.useCallback(async()=>{try{const v=await oe.getPaymentMethods();v.success&&U(v.data)}catch(v){console.error("Error fetching payment methods:",v)}},[U]),z=async()=>{if(!g){h("Pilih alamat pengiriman terlebih dahulu");return}if(W.length===0){h("Tidak ada item yang tersedia untuk checkout");return}try{k(!0),h(null);const v=await oe.createOrder({address_id:g,shipping_cost:E});v.success&&(Q(v.data),p(!0),T(),r(`/orders/${v.data.order_id}`,{state:{message:"Order berhasil dibuat! Silakan lakukan pembayaran.",selectedPaymentMethod:S}}))}catch(v){console.error("Error creating order:",v),h(v.response?.data?.error||"Gagal membuat order")}finally{k(!1)}};return o.useEffect(()=>{if(w.length===0&&!u&&!b){r("/cart");return}q.length===0&&y(),d(!1)},[w.length,r,u,b,y,q.length]),s?e.jsx(c,{sx:{minHeight:"100vh",py:4},children:e.jsx(Z,{maxWidth:"xl",children:e.jsx(i,{children:"Loading..."})})}):W.length===0?e.jsx(c,{sx:{minHeight:"100vh",py:4},children:e.jsxs(Z,{maxWidth:"xl",children:[e.jsx(M,{severity:"warning",sx:{mb:4},children:"Tidak ada item yang tersedia untuk checkout. Semua item di keranjang sudah tidak tersedia."}),e.jsx(L,{variant:"contained",onClick:()=>r("/cart"),children:"Kembali ke Keranjang"})]})}):e.jsx(c,{sx:{minHeight:"100vh",py:4},children:e.jsxs(Z,{maxWidth:"xl",children:[e.jsxs(c,{sx:{mb:3},children:[e.jsx(i,{variant:"h4",fontWeight:600,sx:{mb:1,color:"text.primary"},children:"Checkout"}),e.jsx(i,{variant:"body1",color:"text.secondary",children:"Lengkapi informasi pengiriman dan pembayaran"})]}),m&&e.jsx(M,{severity:"error",sx:{mb:4},onClose:()=>h(null),children:m}),t&&e.jsx(M,{severity:"info",sx:{mb:2},children:"Loading exchange rates..."}),n&&e.jsx(M,{severity:"warning",sx:{mb:2},children:"Failed to load exchange rates. Prices will be displayed in default currency."}),e.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",lg:"row"},gap:4,alignItems:"flex-start"},children:[e.jsx(c,{sx:{flex:1,minWidth:0,order:{xs:1,lg:1}},children:e.jsxs(O,{spacing:4,children:[e.jsx(lr,{selectedAddress:g,onAddressSelect:v=>{l(v);const V=f.find(be=>be.id===v);x(V),$(null),A(15e3)},onAddressesLoaded:R}),e.jsx(pr,{selectedAddress:j,cartItems:W,selectedMethod:_?`${_.courier_code}_${_.courier_service_code}`:null,onMethodSelect:v=>{$(v),A(v.price)}})]})}),e.jsx(c,{sx:{width:{xs:"100%",lg:"400px"},flexShrink:0,order:{xs:2,lg:2}},children:e.jsx(cr,{items:W,subtotal:I,shippingCost:E,total:a,onCreateOrder:z,creatingOrder:u,disabled:!g||!_,selectedPaymentMethod:S,selectedShippingMethod:_})})]})]})})}export{Fr as default};
