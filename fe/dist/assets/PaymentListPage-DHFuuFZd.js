import{p as N,r as m,j as e,x as _,a4 as W,al as R,a5 as z,a6 as d,D as A,t as w,X as J,T as t,B as o,w as $,I as q,q as K,aB as X,ag as Q,C as Y,an as Z,ah as ee,b5 as ae}from"./index-CLjvjqZT.js";import{a as F}from"./paymentApi-C7iOXclS.js";import{G as c}from"./Grid-Yhwe_G7n.js";import{u as G}from"./useCurrencyConversion-DcYLh6Vv.js";import{T as L,a as M,b as B,c as I,d as r,e as E}from"./TableRow-5-DPG7g8.js";import{T as re}from"./Tooltip-BrgySCds.js";import{V as te}from"./Visibility-Cu8UOJov.js";import{B as se}from"./Breadcrumbs-CIb5IDov.js";import{H as ne}from"./Home-BS3p-bFf.js";import{R as ie}from"./Refresh-DQUm0Bly.js";import{A as oe}from"./Alert-Cs6zeJMp.js";import{C,a as P}from"./CardContent-Dqpv-NXF.js";import{C as le}from"./CheckCircle-Dgb9bYPy.js";import{S as de}from"./Schedule-CIX9P0lB.js";import{E as ce}from"./Error-CviQ74bM.js";import{A as xe}from"./AttachMoney-DmqEmfqx.js";import"./Popper-Bu6D8dQx.js";import"./useSlot-CDkgSjON.js";function me({onFilterChange:i,loading:h=!1,initialFilters:u}){const b=N(),[l,a]=m.useState({payment_status:"",payment_method:"",startDate:"",endDate:"",...u});m.useEffect(()=>{u&&a(n=>({...n,...u}))},[u]);const p=(n,f)=>{const x={...l,[n]:f};a(x),i(x)},y=()=>{const n={payment_status:"",payment_method:"",startDate:"",endDate:""};a(n),i(n)},D=l.payment_status||l.payment_method||l.startDate||l.endDate;return e.jsx(_,{elevation:0,sx:{p:2,mb:3,borderRadius:2,border:`1px solid ${b.palette.grey[200]}`},children:e.jsxs(c,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(c,{item:!0,xs:12,md:3,children:e.jsxs(W,{fullWidth:!0,size:"small",children:[e.jsx(R,{children:"Status Pembayaran"}),e.jsxs(z,{value:l.payment_status||"",onChange:n=>p("payment_status",n.target.value),label:"Status Pembayaran",disabled:h,children:[e.jsx(d,{value:"",children:"Semua Status"}),e.jsx(d,{value:"pending",children:"Pending"}),e.jsx(d,{value:"paid",children:"Paid"}),e.jsx(d,{value:"failed",children:"Failed"}),e.jsx(d,{value:"refunded",children:"Refunded"}),e.jsx(d,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx(c,{item:!0,xs:12,md:3,children:e.jsxs(W,{fullWidth:!0,size:"small",children:[e.jsx(R,{children:"Metode Pembayaran"}),e.jsxs(z,{value:l.payment_method||"",onChange:n=>p("payment_method",n.target.value),label:"Metode Pembayaran",disabled:h,children:[e.jsx(d,{value:"",children:"Semua Metode"}),e.jsx(d,{value:"midtrans",children:"Midtrans"}),e.jsx(d,{value:"paypal",children:"PayPal"}),e.jsx(d,{value:"transfer",children:"Transfer"}),e.jsx(d,{value:"e-wallet",children:"E-Wallet"}),e.jsx(d,{value:"COD",children:"COD"})]})]})}),e.jsx(c,{item:!0,xs:12,md:2,children:e.jsx(A,{fullWidth:!0,size:"small",label:"Tanggal Mulai",type:"date",value:l.startDate||"",onChange:n=>p("startDate",n.target.value),InputLabelProps:{shrink:!0},disabled:h})}),e.jsx(c,{item:!0,xs:12,md:2,children:e.jsx(A,{fullWidth:!0,size:"small",label:"Tanggal Akhir",type:"date",value:l.endDate||"",onChange:n=>p("endDate",n.target.value),InputLabelProps:{shrink:!0},disabled:h})}),e.jsx(c,{item:!0,xs:12,md:2,children:e.jsx(w,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(J,{}),onClick:y,disabled:h||!D,sx:{height:40},children:"Reset"})})]})})}const he=i=>{switch(i?.toLowerCase()){case"paid":return"success";case"pending":return"warning";case"failed":case"cancelled":return"error";case"refunded":return"info";default:return"default"}},ue=i=>{switch(i?.toLowerCase()){case"paid":return"Lunas";case"pending":return"Pending";case"failed":return"Gagal";case"refunded":return"Dikembalikan";case"cancelled":return"Dibatalkan";default:return i||"Unknown"}},pe=i=>{switch(i?.toLowerCase()){case"midtrans":return"Midtrans";case"paypal":return"PayPal";case"transfer":return"Transfer";case"e-wallet":return"E-Wallet";case"cod":return"COD";default:return i||"Unknown"}};function je({payments:i,isLoading:h,onView:u}){const{formatPrice:b}=G(),l=a=>a?new Date(a).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-";return h?e.jsx(L,{component:_,children:e.jsxs(M,{children:[e.jsx(B,{children:e.jsxs(I,{children:[e.jsx(r,{children:"ID Pembayaran"}),e.jsx(r,{children:"Order ID"}),e.jsx(r,{children:"Customer"}),e.jsx(r,{children:"Metode"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Jumlah"}),e.jsx(r,{children:"Tanggal"}),e.jsx(r,{children:"Aksi"})]})}),e.jsx(E,{children:[...Array(5)].map((a,p)=>e.jsx(I,{children:e.jsx(r,{colSpan:8,children:e.jsx(t,{variant:"body2",color:"text.secondary",children:"Memuat..."})})},p))})]})}):i.length===0?e.jsx(_,{sx:{p:4,textAlign:"center"},children:e.jsx(t,{variant:"body1",color:"text.secondary",children:"Tidak ada data pembayaran"})}):e.jsx(L,{component:_,sx:{borderRadius:2},children:e.jsxs(M,{children:[e.jsx(B,{children:e.jsxs(I,{sx:{backgroundColor:"rgba(150, 130, 219, 0.05)"},children:[e.jsx(r,{sx:{fontWeight:600,color:"text.primary"},children:"ID Pembayaran"}),e.jsx(r,{sx:{fontWeight:600,color:"text.primary"},children:"Order ID"}),e.jsx(r,{sx:{fontWeight:600,color:"text.primary"},children:"Customer"}),e.jsx(r,{sx:{fontWeight:600,color:"text.primary"},children:"Metode"}),e.jsx(r,{sx:{fontWeight:600,color:"text.primary"},children:"Status"}),e.jsx(r,{sx:{fontWeight:600,color:"text.primary"},children:"Jumlah"}),e.jsx(r,{sx:{fontWeight:600,color:"text.primary"},children:"Tanggal"}),e.jsx(r,{sx:{fontWeight:600,color:"text.primary"},children:"Aksi"})]})}),e.jsx(E,{children:i.map(a=>e.jsxs(I,{hover:!0,children:[e.jsxs(r,{sx:{fontFamily:"monospace",fontSize:"0.875rem"},children:[a.id.slice(0,8),"..."]}),e.jsxs(r,{sx:{fontFamily:"monospace",fontSize:"0.875rem"},children:[a.orderId.slice(0,8),"..."]}),e.jsx(r,{children:e.jsxs(o,{children:[e.jsx(t,{variant:"body2",fontWeight:500,children:a.customer?.full_name||"N/A"}),e.jsx(t,{variant:"caption",color:"text.secondary",children:a.customer?.email||"N/A"})]})}),e.jsx(r,{children:e.jsx(t,{variant:"body2",children:pe(a.paymentMethod)})}),e.jsx(r,{children:e.jsx($,{label:ue(a.paymentStatus),color:he(a.paymentStatus),size:"small",sx:{fontWeight:500}})}),e.jsx(r,{children:e.jsx(t,{variant:"body2",fontWeight:500,children:b(parseFloat(String(a.amount)))})}),e.jsx(r,{children:e.jsx(t,{variant:"body2",color:"text.secondary",children:l(a.paymentDate)})}),e.jsx(r,{children:e.jsx(re,{title:"Lihat Detail",children:e.jsx(q,{size:"small",color:"primary",onClick:()=>u(a),children:e.jsx(te,{fontSize:"small"})})})})]},a.id))})]})})}function Fe(){const i=K(),{showNotification:h}=X(),{formatPrice:u}=G();N();const[b,l]=m.useState([]),[a,p]=m.useState(null),[y,D]=m.useState(!0),[n,f]=m.useState(null),[x,k]=m.useState({payment_status:"",payment_method:"",startDate:"",endDate:"",page:1,limit:10}),[j,O]=m.useState({current_page:1,total_pages:1,total_items:0,items_per_page:10,has_next_page:!1,has_prev_page:!1}),S=async s=>{try{D(!0),f(null);const g=s||x,v=await F.getAllPayments({page:g.page||1,limit:g.limit||10,payment_status:g.payment_status||void 0,payment_method:g.payment_method||void 0,startDate:g.startDate||void 0,endDate:g.endDate||void 0});v.success&&v.data?(l(v.data),v.pagination&&O(v.pagination)):f(v.error||"Gagal memuat data pembayaran")}catch(g){f(g.response?.data?.error||"Gagal memuat data pembayaran")}finally{D(!1)}},T=async()=>{try{const s=await F.getPaymentStats();s.success&&s.data&&p(s.data)}catch(s){console.error("Failed to fetch payment stats:",s)}},H=s=>{k(s),S(s)},U=s=>{i(`/admin/payments/${s.id}`)},V=async()=>{await Promise.all([S(x),T()])};return m.useEffect(()=>{(async()=>{await Promise.all([S(x),T()])})()},[]),y&&b.length===0?e.jsx(Q,{message:"Memuat data pembayaran..."}):e.jsxs(Y,{maxWidth:"xl",sx:{py:4},children:[e.jsxs(se,{sx:{mb:4},children:[e.jsxs(Z,{component:"button",variant:"body2",onClick:()=>i("/admin"),sx:{display:"flex",alignItems:"center",gap:.5,color:"text.secondary",textDecoration:"none","&:hover":{color:"primary.main",textDecoration:"underline"}},children:[e.jsx(ne,{fontSize:"small"}),"Dashboard"]}),e.jsx(t,{variant:"body2",color:"textPrimary",sx:{fontWeight:500},children:"Pembayaran"})]}),e.jsxs(o,{sx:{mb:4},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(ee,{sx:{fontSize:"2rem",color:"primary.main"}}),e.jsx(t,{variant:"h4",fontWeight:700,color:"text.primary",className:"craft-heading",children:"Manajemen Pembayaran"})]}),e.jsx(w,{variant:"outlined",startIcon:e.jsx(ie,{}),onClick:V,sx:{borderRadius:2,px:3,py:1,fontWeight:500,textTransform:"none",borderColor:"primary.main",color:"primary.main","&:hover":{backgroundColor:"rgba(150, 130, 219, 0.05)",borderColor:"primary.dark"}},children:"Refresh Data"})]}),e.jsx(t,{variant:"body1",color:"text.secondary",className:"craft-body",children:"Kelola dan monitor semua transaksi pembayaran"})]}),n&&e.jsx(oe,{severity:"error",sx:{mb:3,borderRadius:2,backgroundColor:"error.light",color:"error.dark",border:"1px solid",borderColor:"error.main"},onClose:()=>f(null),children:n}),e.jsxs(c,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(c,{item:!0,xs:6,md:3,children:e.jsx(C,{sx:{borderRadius:3,boxShadow:"0 4px 16px rgba(150, 130, 219, 0.12)",border:"1px solid rgba(150, 130, 219, 0.08)",height:"100%"},children:e.jsxs(P,{sx:{p:2,textAlign:"center"},children:[e.jsx(o,{sx:{p:1.5,borderRadius:"50%",backgroundColor:"rgba(150, 130, 219, 0.1)",display:"inline-flex",alignItems:"center",justifyContent:"center",mb:1},children:e.jsx(ae,{sx:{fontSize:"1.5rem",color:"primary.main"}})}),e.jsx(t,{variant:"h6",fontWeight:700,color:"text.primary",children:a?.totalPayments||0}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Total Pembayaran"})]})})}),e.jsx(c,{item:!0,xs:6,md:3,children:e.jsx(C,{sx:{borderRadius:3,boxShadow:"0 4px 16px rgba(150, 130, 219, 0.12)",border:"1px solid rgba(150, 130, 219, 0.08)",height:"100%"},children:e.jsxs(P,{sx:{p:2,textAlign:"center"},children:[e.jsx(o,{sx:{p:1.5,borderRadius:"50%",backgroundColor:"rgba(39, 174, 96, 0.1)",display:"inline-flex",alignItems:"center",justifyContent:"center",mb:1},children:e.jsx(le,{sx:{fontSize:"1.5rem",color:"success.main"}})}),e.jsx(t,{variant:"h6",fontWeight:700,color:"text.primary",children:a?.paidPayments||0}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Lunas"})]})})}),e.jsx(c,{item:!0,xs:6,md:3,children:e.jsx(C,{sx:{borderRadius:3,boxShadow:"0 4px 16px rgba(150, 130, 219, 0.12)",border:"1px solid rgba(150, 130, 219, 0.08)",height:"100%"},children:e.jsxs(P,{sx:{p:2,textAlign:"center"},children:[e.jsx(o,{sx:{p:1.5,borderRadius:"50%",backgroundColor:"rgba(243, 156, 18, 0.1)",display:"inline-flex",alignItems:"center",justifyContent:"center",mb:1},children:e.jsx(de,{sx:{fontSize:"1.5rem",color:"warning.main"}})}),e.jsx(t,{variant:"h6",fontWeight:700,color:"text.primary",children:a?.pendingPayments||0}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Pending"})]})})}),e.jsx(c,{item:!0,xs:6,md:3,children:e.jsx(C,{sx:{borderRadius:3,boxShadow:"0 4px 16px rgba(150, 130, 219, 0.12)",border:"1px solid rgba(150, 130, 219, 0.08)",height:"100%"},children:e.jsxs(P,{sx:{p:2,textAlign:"center"},children:[e.jsx(o,{sx:{p:1.5,borderRadius:"50%",backgroundColor:"rgba(231, 76, 60, 0.1)",display:"inline-flex",alignItems:"center",justifyContent:"center",mb:1},children:e.jsx(ce,{sx:{fontSize:"1.5rem",color:"error.main"}})}),e.jsx(t,{variant:"h6",fontWeight:700,color:"text.primary",children:a?.failedPayments||0}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Gagal"})]})})})]}),a&&e.jsx(C,{sx:{mb:4,borderRadius:3,boxShadow:"0 4px 16px rgba(150, 130, 219, 0.12)",border:"1px solid rgba(150, 130, 219, 0.08)",background:"linear-gradient(135deg, rgba(150, 130, 219, 0.1) 0%, rgba(150, 130, 219, 0.05) 100%)"},children:e.jsx(P,{sx:{p:3},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(o,{sx:{p:2,borderRadius:"50%",backgroundColor:"primary.main",color:"white",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(xe,{sx:{fontSize:"2rem"}})}),e.jsxs(o,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Total Revenue"}),e.jsx(t,{variant:"h4",fontWeight:700,color:"text.primary",children:u(a.totalRevenue)})]})]})})}),e.jsx(me,{onFilterChange:H,loading:y,initialFilters:x}),e.jsx(C,{sx:{borderRadius:3,boxShadow:"0 4px 16px rgba(150, 130, 219, 0.12)",border:"1px solid rgba(150, 130, 219, 0.08)"},children:e.jsxs(P,{sx:{p:0},children:[e.jsx(o,{sx:{p:3,borderBottom:"1px solid rgba(150, 130, 219, 0.1)"},children:e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(o,{children:[e.jsx(t,{variant:"h6",fontWeight:600,color:"text.primary",className:"craft-heading",children:"Data Pembayaran"}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:"Daftar semua transaksi pembayaran"})]}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:["Total: ",j.total_items," pembayaran"]})]})}),e.jsx(o,{sx:{p:2},children:e.jsx(je,{payments:b,isLoading:y,onView:U})}),j.total_pages>1&&e.jsxs(o,{sx:{p:2,display:"flex",justifyContent:"center",gap:2,alignItems:"center"},children:[e.jsx(w,{variant:"outlined",onClick:()=>{const s={...x,page:j.current_page-1};k(s),S(s)},disabled:!j.has_prev_page||y,size:"small",children:"Sebelumnya"}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:["Halaman ",j.current_page," dari ",j.total_pages]}),e.jsx(w,{variant:"outlined",onClick:()=>{const s={...x,page:j.current_page+1};k(s),S(s)},disabled:!j.has_next_page||y,size:"small",children:"Selanjutnya"})]})]})})]})}export{Fe as default};
