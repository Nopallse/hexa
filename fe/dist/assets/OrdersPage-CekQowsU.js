import{p as O,r as m,j as e,B as l,H as W,T as o,S as B,v as k,t as j,X as P,q as A,C as I,x as w,ag as R}from"./index-CZFAEO2y.js";import{u as M}from"./orderStore-C_2rb-4t.js";import{o as S}from"./orderApi-BZ9ScYhU.js";import{u as $}from"./useCurrencyConversion-BCvfb8ro.js";import{C as F,a as G}from"./CardContent-CEZafFSD.js";import{A as E}from"./Avatar-BK2nAYkE.js";import{V as L}from"./Visibility-DkVS5znf.js";import{C as U}from"./Cancel-63tQ3qzr.js";import{T as H,a as N}from"./Tabs-BxBghwpt.js";import{A as q}from"./Alert-Dhgb7HXh.js";import{O as K}from"./Receipt-D4oLEU22.js";import"./useSlot-CExgq9at.js";import"./KeyboardArrowRight-CSDvhN5_.js";function Q({order:a,onView:x}){O();const[u,p]=m.useState(!1),{formatPrice:b}=$(),f=r=>new Date(r).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}),i=r=>{switch(r){case"pending":return"warning";case"processing":return"primary";case"shipped":return"primary";case"delivered":return"success";case"cancelled":return"error";default:return"default"}},g=r=>{switch(r){case"pending":return"Menunggu Konfirmasi";case"processing":return"Sedang Diproses";case"shipped":return"Dikirim";case"delivered":return"Selesai";case"cancelled":return"Dibatalkan";default:return r}},s=r=>{switch(r){case"unpaid":return"error";case"paid":return"success";case"failed":return"error";case"refunded":return"warning";default:return"default"}},y=r=>{switch(r){case"unpaid":return"Belum Dibayar";case"paid":return"Sudah Dibayar";case"failed":return"Gagal Bayar";case"refunded":return"Dikembalikan";default:return r}},v=async()=>{if(window.confirm("Apakah Anda yakin ingin membatalkan pesanan ini?"))try{p(!0),(await S.cancelOrder(a.id)).success&&window.location.reload()}catch(r){console.error("Error cancelling order:",r),alert(r.response?.data?.error||"Gagal membatalkan pesanan")}finally{p(!1)}},d=a.status==="pending",h=a.order_items[0]?.product_variant?.product?.product_images?.[0]?.image_name;return e.jsx(F,{sx:{mb:2,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"none",transition:"all 0.2s ease","&:hover":{boxShadow:"0 2px 8px rgba(0,0,0,0.15)"}},children:e.jsx(G,{sx:{p:3},children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:3},children:[e.jsx(l,{sx:{flexShrink:0},children:e.jsx(E,{src:h?`/uploads/${h}`:`https://placehold.co/80x80/9682DB/FFFFFF/png?text=${encodeURIComponent(a.order_items[0]?.product_variant?.product?.name?.substring(0,10)||"Order")}`,alt:"Order items",sx:{width:80,height:80,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},variant:"rounded",children:e.jsx(W,{sx:{fontSize:32}})})}),e.jsxs(l,{sx:{flex:1,minWidth:0},children:[e.jsxs(o,{variant:"h6",fontWeight:600,sx:{mb:1,color:"text.primary",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.3,fontSize:"1rem"},title:`Order #${a.id.slice(-8).toUpperCase()}`,children:["Order #",a.id.slice(-8).toUpperCase()]}),e.jsxs(B,{direction:"row",spacing:.5,sx:{mb:1,flexWrap:"wrap"},children:[e.jsx(k,{label:g(a.status),size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:20,borderColor:i(a.status)==="warning"?"warning.main":i(a.status)==="success"?"success.main":i(a.status)==="error"?"error.main":"primary.main",color:i(a.status)==="warning"?"warning.main":i(a.status)==="success"?"success.main":i(a.status)==="error"?"error.main":"primary.main","& .MuiChip-label":{px:1}}}),e.jsx(k,{label:y(a.payment_status),size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:20,borderColor:s(a.payment_status)==="warning"?"warning.main":s(a.payment_status)==="success"?"success.main":s(a.payment_status)==="error"?"error.main":"primary.main",color:s(a.payment_status)==="warning"?"warning.main":s(a.payment_status)==="success"?"success.main":s(a.payment_status)==="error"?"error.main":"primary.main","& .MuiChip-label":{px:1}}})]}),e.jsxs(o,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:["Dibuat: ",f(a.created_at)]}),e.jsxs(o,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:[a.order_items.length," item",a.order_items.length>1?"s":""]}),e.jsxs(o,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:[a.address.city,", ",a.address.province]})]}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:2,flexShrink:0},children:[e.jsxs(l,{sx:{textAlign:"right",minWidth:100},children:[e.jsx(o,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Total"}),e.jsx(o,{variant:"h6",color:"primary.main",fontWeight:700,sx:{fontSize:"1rem"},children:b(Number(a.total_amount)+Number(a.shipping_cost))})]}),e.jsxs(l,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(j,{variant:"contained",size:"small",startIcon:e.jsx(L,{}),onClick:()=>x(a),sx:{borderRadius:2,fontWeight:600,fontSize:"0.75rem",py:.5,px:1.5,backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:"Detail"}),d&&e.jsx(j,{variant:"outlined",size:"small",startIcon:e.jsx(U,{}),onClick:v,disabled:u,color:"error",sx:{borderRadius:2,fontWeight:600,fontSize:"0.75rem",py:.5,px:1.5,borderColor:"error.main",color:"error.main","&:hover":{backgroundColor:"error.light",borderColor:"error.dark"}},children:u?"Batal...":"Batal"})]})]})]})})})}function V(a){return{id:`orders-tab-${a}`,"aria-controls":`orders-tabpanel-${a}`}}function ce(){const a=O(),x=P(a.breakpoints.down("md")),u=A(),{orders:p,setOrders:b}=M(),[f,i]=m.useState(!1),[g,s]=m.useState(null),[y,v]=m.useState(0),[d,h]=m.useState({page:1,limit:10,total:0,pages:0}),r=[{label:"Semua",value:""},{label:"Pending",value:"pending"},{label:"Processing",value:"processing"},{label:"Shipped",value:"shipped"},{label:"Delivered",value:"delivered"},{label:"Cancelled",value:"cancelled"}],C=async(t={})=>{try{i(!0),s(null);const n={page:d.page,limit:d.limit,...t},c=await S.getUserOrders(n);c.success?(b(c.data),h(T=>({...T,total:c.total||0,pages:c.pages||0}))):s(c.error||"Gagal memuat pesanan")}catch(n){s(n.message||"Gagal memuat pesanan")}finally{i(!1)}};m.useEffect(()=>{C()},[d.page,d.limit]);const _=(t,n)=>{v(n);const c=r[n].value;C({status:c})},z=t=>{u(`/orders/${t}`)},D=async t=>{try{i(!0);const n=await S.cancelOrder(t);n.success?C():s(n.error||"Gagal membatalkan pesanan")}catch(n){s(n.message||"Gagal membatalkan pesanan")}finally{i(!1)}};return e.jsxs(I,{maxWidth:"xl",sx:{py:4},children:[e.jsxs(l,{sx:{mb:4},children:[e.jsx(o,{variant:"h4",component:"h1",sx:{fontWeight:600,color:"text.primary",mb:1},children:"Pesanan Saya"}),e.jsx(o,{variant:"body1",color:"text.secondary",children:"Kelola dan lacak pesanan Anda"})]}),e.jsx(w,{elevation:0,sx:{mb:3,borderRadius:2,border:`1px solid ${a.palette.grey[200]}`,overflow:"hidden"},children:e.jsx(H,{value:y,onChange:_,variant:x?"scrollable":"standard",scrollButtons:x?"auto":!1,allowScrollButtonsMobile:!0,sx:{borderBottom:`1px solid ${a.palette.grey[200]}`,"& .MuiTab-root":{textTransform:"none",fontWeight:500,fontSize:"1rem",py:2,px:3,minHeight:"auto","&.Mui-selected":{fontWeight:600,color:"primary.main"}},"& .MuiTabs-indicator":{height:3,borderRadius:"3px 3px 0 0"}},children:r.map((t,n)=>e.jsx(N,{label:t.label,...V(n)},t.value))})}),g&&e.jsx(q,{severity:"error",sx:{mb:3,borderRadius:2},onClose:()=>s(null),children:g}),f?e.jsx(l,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(R,{})}):p.length===0?e.jsxs(w,{elevation:0,sx:{borderRadius:2,border:`1px solid ${a.palette.grey[200]}`,p:4,textAlign:"center"},children:[e.jsx(K,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(o,{variant:"h6",sx:{fontWeight:600,color:"text.primary",mb:1},children:"Belum Ada Pesanan"}),e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Pesanan Anda akan muncul di sini setelah melakukan pembelian"}),e.jsx(j,{variant:"contained",onClick:()=>u("/products"),sx:{borderRadius:2,textTransform:"none",fontWeight:500,backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:"Mulai Belanja"})]}):e.jsx(l,{sx:{display:"flex",flexDirection:"column",gap:2},children:p.map(t=>e.jsx(Q,{order:t,onOrderClick:z,onCancelOrder:D},t.id))})]})}export{ce as default};
