import{a8 as G,q as U,aB as M,r as d,j as e,af as H,C as I,t as y,ao as w,T as r,B as o,I as q,ag as k,w as W,x as $,$ as J,a0 as f,a2 as v,a4 as K,ay as Q,a5 as V,a6 as m,E as X,ak as Y}from"./index-CjRkbdsW.js";import{a as T}from"./paymentApi-BfIv1PZC.js";import{u as Z}from"./useCurrencyConversion-CFRmtJpc.js";import{b as ee}from"./image-CeHRN-zl.js";import{A}from"./Alert-CYapFDnR.js";import{A as N}from"./ArrowBack-Bm9waFzN.js";import{B as ae}from"./Breadcrumbs-j1g_dcXs.js";import{H as re}from"./Home-C_Jl3ZFE.js";import{E as te}from"./Edit-DgeNQqTy.js";import{G as n}from"./Grid-Cqp2UiQA.js";import{C as j,a as b}from"./CardContent-bGHhza-V.js";import{O as se}from"./Receipt-0CGW_age.js";import{T as ne,a as ie,b as oe,c as B,d as i,e as de}from"./TableRow-c-pgpRY6.js";import{D as le,a as ce,b as xe}from"./DialogTitle-DHTnyTUE.js";import{D as me}from"./DialogActions-Y5bn1Vt0.js";const ue=s=>{switch(s?.toLowerCase()){case"paid":return"success";case"pending":return"warning";case"failed":case"cancelled":return"error";case"refunded":return"info";default:return"default"}},he=s=>{switch(s?.toLowerCase()){case"paid":return"Lunas";case"pending":return"Pending";case"failed":return"Gagal";case"refunded":return"Dikembalikan";case"cancelled":return"Dibatalkan";default:return s||"Unknown"}},pe=s=>{switch(s?.toLowerCase()){case"midtrans":return"Midtrans";case"paypal":return"PayPal";case"transfer":return"Transfer";case"e-wallet":return"E-Wallet";case"cod":return"COD";default:return s||"Unknown"}},ye=s=>{switch(s){case"belum_bayar":return"warning";case"dikemas":return"primary";case"dikirim":return"info";case"diterima":return"success";case"dibatalkan":return"error";default:return"default"}},je=s=>{switch(s){case"belum_bayar":return"Belum Bayar";case"dikemas":return"Dikemas";case"dikirim":return"Dikirim";case"diterima":return"Diterima";case"dibatalkan":return"Dibatalkan";default:return s}};function Ne(){const{id:s}=G(),u=U(),{showNotification:E}=M(),{formatPrice:x}=Z(),[t,L]=d.useState(null),[O,_]=d.useState(!0),[h,l]=d.useState(null),[F,p]=d.useState(!1),[P,C]=d.useState(!1),[c,g]=d.useState({payment_status:"",payment_date:""}),R=a=>a?new Date(a).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",D=async()=>{if(s)try{_(!0),l(null);const a=await T.getPaymentById(s);a.success&&a.data?(L(a.data),g({payment_status:a.data.payment_status||"",payment_date:a.data.payment_date?new Date(a.data.payment_date).toISOString().split("T")[0]:""})):l(a.error||"Gagal memuat data pembayaran")}catch(a){l(a.response?.data?.error||"Gagal memuat data pembayaran")}finally{_(!1)}},z=async()=>{if(s)try{C(!0),l(null);const a=await T.verifyPayment(s,{payment_status:c.payment_status,payment_date:c.payment_date||void 0});a.success?(E({type:"success",message:"Status pembayaran berhasil diperbarui"}),p(!1),await D()):l(a.error||"Gagal memperbarui status pembayaran")}catch(a){l(a.response?.data?.error||"Gagal memperbarui status pembayaran")}finally{C(!1)}};return d.useEffect(()=>{D()},[s]),O?e.jsx(H,{message:"Memuat data pembayaran..."}):h&&!t?e.jsxs(I,{maxWidth:"xl",sx:{py:4},children:[e.jsx(A,{severity:"error",sx:{mb:3},children:h}),e.jsx(y,{startIcon:e.jsx(N,{}),onClick:()=>u("/admin/payments"),children:"Kembali ke Daftar Pembayaran"})]}):t?e.jsxs(I,{maxWidth:"xl",sx:{py:4},children:[e.jsxs(ae,{sx:{mb:4},children:[e.jsxs(w,{component:"button",variant:"body2",onClick:()=>u("/admin"),sx:{display:"flex",alignItems:"center",gap:.5,color:"text.secondary",textDecoration:"none","&:hover":{color:"primary.main",textDecoration:"underline"}},children:[e.jsx(re,{fontSize:"small"}),"Dashboard"]}),e.jsx(w,{component:"button",variant:"body2",onClick:()=>u("/admin/payments"),sx:{color:"text.secondary",textDecoration:"none","&:hover":{color:"primary.main",textDecoration:"underline"}},children:"Pembayaran"}),e.jsx(r,{variant:"body2",color:"textPrimary",sx:{fontWeight:500},children:"Detail Pembayaran"})]}),e.jsxs(o,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(q,{onClick:()=>u("/admin/payments"),sx:{mr:1},children:e.jsx(N,{})}),e.jsx(k,{sx:{fontSize:"2rem",color:"primary.main"}}),e.jsxs(o,{children:[e.jsx(r,{variant:"h4",fontWeight:700,color:"text.primary",children:"Detail Pembayaran"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["ID: ",t.id]})]})]}),e.jsx(y,{variant:"contained",startIcon:e.jsx(te,{}),onClick:()=>p(!0),sx:{borderRadius:2,px:3,py:1},children:"Edit Status"})]}),h&&e.jsx(A,{severity:"error",sx:{mb:3},children:h}),e.jsxs(n,{container:!0,spacing:3,children:[e.jsxs(n,{item:!0,xs:12,md:8,children:[e.jsx(j,{sx:{mb:3,borderRadius:3,boxShadow:"0 4px 16px rgba(150, 130, 219, 0.12)"},children:e.jsxs(b,{sx:{p:3},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:3},children:[e.jsx(k,{sx:{fontSize:"1.5rem",color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:600,children:"Informasi Pembayaran"})]}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Status"}),e.jsx(W,{label:he(t.payment_status),color:ue(t.payment_status),sx:{fontWeight:600}})]}),e.jsxs(n,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Metode Pembayaran"}),e.jsx(r,{variant:"body1",fontWeight:500,children:pe(t.payment_method)})]}),e.jsxs(n,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Jumlah"}),e.jsx(r,{variant:"h6",fontWeight:700,color:"primary.main",children:x(parseFloat(t.amount||0))})]}),e.jsxs(n,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Currency"}),e.jsx(r,{variant:"body1",fontWeight:500,children:t.currency_code||"IDR"})]}),e.jsxs(n,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Payment Reference"}),e.jsx(r,{variant:"body1",sx:{fontFamily:"monospace"},children:t.payment_reference||"N/A"})]}),e.jsxs(n,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Tanggal Pembayaran"}),e.jsx(r,{variant:"body1",children:R(t.payment_date)})]})]})]})}),t.order&&e.jsx(j,{sx:{borderRadius:3,boxShadow:"0 4px 16px rgba(150, 130, 219, 0.12)"},children:e.jsxs(b,{sx:{p:3},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:3},children:[e.jsx(se,{sx:{fontSize:"1.5rem",color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:600,children:"Informasi Order"})]}),e.jsxs(n,{container:!0,spacing:2,sx:{mb:3},children:[e.jsxs(n,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Order ID"}),e.jsx(r,{variant:"body1",fontWeight:500,sx:{fontFamily:"monospace"},children:t.order.id})]}),e.jsxs(n,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Status Order"}),e.jsx(W,{label:je(t.order.status),color:ye(t.order.status),size:"small"})]}),e.jsxs(n,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Total Amount"}),e.jsx(r,{variant:"body1",fontWeight:500,children:x(parseFloat(t.order.total_amount||0))})]}),e.jsxs(n,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Shipping Cost"}),e.jsx(r,{variant:"body1",fontWeight:500,children:x(parseFloat(t.order.shipping_cost||0))})]})]}),t.order.order_items&&t.order.order_items.length>0&&e.jsxs(o,{children:[e.jsx(r,{variant:"subtitle1",fontWeight:600,sx:{mb:2},children:"Order Items"}),e.jsx(ne,{component:$,variant:"outlined",children:e.jsxs(ie,{size:"small",children:[e.jsx(oe,{children:e.jsxs(B,{children:[e.jsx(i,{children:"Produk"}),e.jsx(i,{children:"Varian"}),e.jsx(i,{align:"right",children:"Quantity"}),e.jsx(i,{align:"right",children:"Harga"}),e.jsx(i,{align:"right",children:"Subtotal"})]})}),e.jsx(de,{children:t.order.order_items.map(a=>e.jsxs(B,{children:[e.jsx(i,{children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.product_variant?.product?.product_images?.[0]?.image_name&&e.jsx(o,{component:"img",src:ee(a.product_variant.product.product_images[0].image_name),alt:a.product_variant.product.name,sx:{width:40,height:40,objectFit:"cover",borderRadius:1}}),e.jsx(r,{variant:"body2",children:a.product_variant?.product?.name||"N/A"})]})}),e.jsxs(i,{children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:a.product_variant?.variant_name||"N/A"}),a.product_variant?.variant_options&&a.product_variant.variant_options.length>0&&e.jsx(r,{variant:"caption",color:"text.secondary",children:a.product_variant.variant_options.map(S=>`${S.option_name}: ${S.option_value}`).join(", ")})]}),e.jsx(i,{align:"right",children:e.jsx(r,{variant:"body2",children:a.quantity})}),e.jsx(i,{align:"right",children:e.jsx(r,{variant:"body2",children:x(parseFloat(a.price||0))})}),e.jsx(i,{align:"right",children:e.jsx(r,{variant:"body2",fontWeight:500,children:x(parseFloat(a.price||0)*a.quantity)})})]},a.id))})]})})]})]})})]}),e.jsxs(n,{item:!0,xs:12,md:4,children:[t.order?.user&&e.jsx(j,{sx:{mb:3,borderRadius:3,boxShadow:"0 4px 16px rgba(150, 130, 219, 0.12)"},children:e.jsxs(b,{sx:{p:3},children:[e.jsx(r,{variant:"h6",fontWeight:600,sx:{mb:2},children:"Informasi Customer"}),e.jsxs(J,{children:[e.jsx(f,{children:e.jsx(v,{primary:"Nama",secondary:t.order.user.full_name||"N/A"})}),e.jsx(f,{children:e.jsx(v,{primary:"Email",secondary:t.order.user.email||"N/A"})}),e.jsx(f,{children:e.jsx(v,{primary:"Telepon",secondary:t.order.user.phone||"N/A"})})]})]})}),t.order?.address&&e.jsx(j,{sx:{borderRadius:3,boxShadow:"0 4px 16px rgba(150, 130, 219, 0.12)"},children:e.jsxs(b,{sx:{p:3},children:[e.jsx(r,{variant:"h6",fontWeight:600,sx:{mb:2},children:"Alamat Pengiriman"}),e.jsx(r,{variant:"body2",sx:{mb:1},children:e.jsx("strong",{children:t.order.address.recipient_name||"N/A"})}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t.order.address.address_line||"N/A"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:[t.order.address.city||"N/A",", ",t.order.address.province||"N/A"," ",t.order.address.postal_code||"N/A"]})]})})]})]}),e.jsxs(le,{open:F,onClose:()=>p(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ce,{children:"Edit Status Pembayaran"}),e.jsx(xe,{children:e.jsxs(o,{sx:{pt:2},children:[e.jsxs(K,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Q,{children:"Status Pembayaran"}),e.jsxs(V,{value:c.payment_status,onChange:a=>g({...c,payment_status:a.target.value}),label:"Status Pembayaran",children:[e.jsx(m,{value:"pending",children:"Pending"}),e.jsx(m,{value:"paid",children:"Paid"}),e.jsx(m,{value:"failed",children:"Failed"}),e.jsx(m,{value:"refunded",children:"Refunded"}),e.jsx(m,{value:"cancelled",children:"Cancelled"})]})]}),e.jsx(X,{fullWidth:!0,label:"Tanggal Pembayaran",type:"date",value:c.payment_date,onChange:a=>g({...c,payment_date:a.target.value}),InputLabelProps:{shrink:!0}})]})}),e.jsxs(me,{children:[e.jsx(y,{onClick:()=>p(!1),children:"Batal"}),e.jsx(y,{onClick:z,variant:"contained",disabled:P,children:P?e.jsx(Y,{size:20}):"Simpan"})]})]})]}):null}export{Ne as default};
