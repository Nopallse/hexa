import{a as X,g as Y,r as s,u as ue,_ as ee,ah as Ce,ai as _e,i as z,j as e,s as V,k as re,m as te,c as pe,U as he,aj as ke,l as J,V as Se,d as we,h as Re,b as Ie,p as Q,T as i,B as l,S as U,A as Fe,ac as Pe,N as ne,w as L,t as O,ag as $e,q as xe,F as oe,a4 as me,ae as H,aa as D,J as We,ak as Me,ab as ze,C as Z}from"./index-D0K_J5MH.js";import{u as Ee}from"./cartStore-BOTe1BmZ.js";import{u as De}from"./orderStore-DhFXQ6lx.js";import{o as se}from"./orderApi-v6xAOF7v.js";import{u as ae}from"./useCurrencyConversion-Bs2vyWZT.js";import{C as G,a as N}from"./CardContent-7fkJvOwG.js";import{a as Be}from"./addressApi-BDajA6Ex.js";import{S as Ae}from"./Skeleton-CGzPDSDm.js";import{A as M}from"./Alert-D2FNR8Ya.js";import{A as ie}from"./Add-DtNoIuQN.js";import{E as Oe}from"./Edit-xqQzbt_u.js";import{D as Ge,a as Ne,b as Te}from"./DialogTitle-BCSOKhKg.js";import{S as Le,F as ge}from"./FormControlLabel-SDb0xOiw.js";import{D as Ue}from"./DialogActions-DjBbw8WJ.js";import{l as qe}from"./locationApi-BIj1wA3Q.js";import{A as Ve}from"./AttachMoney-CEKXqbf4.js";import{S as Ke}from"./Schedule-2MrTr-N0.js";function He(r){return X("MuiFormGroup",r)}Y("MuiFormGroup",["root","row","error"]);const Je=["className","row"],Qe=r=>{const{classes:t,row:n,error:o}=r;return te({root:["root",n&&"row",o&&"error"]},He,t)},Ze=V("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(r,t)=>{const{ownerState:n}=r;return[t.root,n.row&&t.row]}})(({ownerState:r})=>z({display:"flex",flexDirection:"column",flexWrap:"wrap"},r.row&&{flexDirection:"row"})),Xe=s.forwardRef(function(t,n){const o=ue({props:t,name:"MuiFormGroup"}),{className:d,row:h=!1}=o,j=ee(o,Je),C=Ce(),p=_e({props:o,muiFormControl:C,states:["error"]}),y=z({},o,{row:h,error:p.error}),f=Qe(y);return e.jsx(Ze,z({className:re(f.root,d),ownerState:y,ref:n},j))}),Ye=pe(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),er=pe(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),rr=V("span",{name:"MuiRadioButtonIcon",shouldForwardProp:he})({position:"relative",display:"flex"}),tr=V(Ye,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),ar=V(er,{name:"MuiRadioButtonIcon"})(({theme:r,ownerState:t})=>z({left:0,position:"absolute",transform:"scale(0)",transition:r.transitions.create("transform",{easing:r.transitions.easing.easeIn,duration:r.transitions.duration.shortest})},t.checked&&{transform:"scale(1)",transition:r.transitions.create("transform",{easing:r.transitions.easing.easeOut,duration:r.transitions.duration.shortest})}));function fe(r){const{checked:t=!1,classes:n={},fontSize:o}=r,d=z({},r,{checked:t});return e.jsxs(rr,{className:n.root,ownerState:d,children:[e.jsx(tr,{fontSize:o,className:n.background,ownerState:d}),e.jsx(ar,{fontSize:o,className:n.dot,ownerState:d})]})}const ye=s.createContext(void 0);function nr(){return s.useContext(ye)}function or(r){return X("MuiRadio",r)}const ce=Y("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),sr=["checked","checkedIcon","color","icon","name","onChange","size","className"],ir=r=>{const{classes:t,color:n,size:o}=r,d={root:["root",`color${J(n)}`,o!=="medium"&&`size${J(o)}`]};return z({},t,te(d,or,t))},cr=V(Le,{shouldForwardProp:r=>he(r)||r==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(r,t)=>{const{ownerState:n}=r;return[t.root,n.size!=="medium"&&t[`size${J(n.size)}`],t[`color${J(n.color)}`]]}})(({theme:r,ownerState:t})=>z({color:(r.vars||r).palette.text.secondary},!t.disableRipple&&{"&:hover":{backgroundColor:r.vars?`rgba(${t.color==="default"?r.vars.palette.action.activeChannel:r.vars.palette[t.color].mainChannel} / ${r.vars.palette.action.hoverOpacity})`:Se.alpha(t.color==="default"?r.palette.action.active:r.palette[t.color].main,r.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},t.color!=="default"&&{[`&.${ce.checked}`]:{color:(r.vars||r).palette[t.color].main}},{[`&.${ce.disabled}`]:{color:(r.vars||r).palette.action.disabled}}));function lr(r,t){return typeof t=="object"&&t!==null?r===t:String(r)===String(t)}const le=e.jsx(fe,{checked:!0}),de=e.jsx(fe,{}),ve=s.forwardRef(function(t,n){var o,d;const h=ue({props:t,name:"MuiRadio"}),{checked:j,checkedIcon:C=le,color:p="primary",icon:y=de,name:f,onChange:v,size:c="medium",className:I}=h,w=ee(h,sr),_=z({},h,{color:p,size:c}),k=ir(_),S=nr();let b=j;const F=ke(v,S&&S.onChange);let R=f;return S&&(typeof b>"u"&&(b=lr(S.value,h.value)),typeof R>"u"&&(R=S.name)),e.jsx(cr,z({type:"radio",icon:s.cloneElement(y,{fontSize:(o=de.props.fontSize)!=null?o:c}),checkedIcon:s.cloneElement(C,{fontSize:(d=le.props.fontSize)!=null?d:c}),ownerState:_,classes:k,name:R,checked:b,onChange:F,ref:n,className:re(k.root,I)},w))});function dr(r){return X("MuiRadioGroup",r)}Y("MuiRadioGroup",["root","row","error"]);const ur=["actions","children","className","defaultValue","name","onChange","value"],pr=r=>{const{classes:t,row:n,error:o}=r;return te({root:["root",n&&"row",o&&"error"]},dr,t)},be=s.forwardRef(function(t,n){const{actions:o,children:d,className:h,defaultValue:j,name:C,onChange:p,value:y}=t,f=ee(t,ur),v=s.useRef(null),c=pr(t),[I,w]=we({controlled:y,default:j,name:"RadioGroup"});s.useImperativeHandle(o,()=>({focus:()=>{let b=v.current.querySelector("input:not(:disabled):checked");b||(b=v.current.querySelector("input:not(:disabled)")),b&&b.focus()}}),[]);const _=Re(n,v),k=Ie(C),S=s.useMemo(()=>({name:k,onChange(b){w(b.target.value),p&&p(b,b.target.value)},value:I}),[k,p,w,I]);return e.jsx(ye.Provider,{value:S,children:e.jsx(Xe,z({role:"radiogroup",ref:_,className:re(c.root,h)},f,{children:d}))})});function hr({items:r,subtotal:t,shippingCost:n,total:o,onCreateOrder:d,creatingOrder:h,disabled:j,selectedPaymentMethod:C,selectedShippingMethod:p}){Q();const{formatPrice:y}=ae(),f=c=>{switch(c){case"biteship":return"ðŸšš Biteship";case"fedex":return"ðŸ“¦ FedEx";case"fedex-estimated":return"ðŸ“¦ FedEx (Est.)";case"indonesia-estimated":return"ðŸ‡®ðŸ‡© Indonesia (Est.)";default:return"ðŸ“¦ Shipping"}},v=c=>{switch(c){case"biteship":return"primary";case"fedex":return"error";case"fedex-estimated":return"warning";case"indonesia-estimated":return"info";default:return"default"}};return e.jsx(G,{sx:{position:"sticky",top:24,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:"none"},children:e.jsxs(N,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:3,color:"text.primary"},children:"Ringkasan Pesanan"}),e.jsxs(l,{sx:{mb:3},children:[e.jsxs(i,{variant:"subtitle1",fontWeight:600,sx:{mb:2},children:["Item (",r.length,")"]}),e.jsx(U,{spacing:2,children:r.map(c=>{const I=c.product_variant.product.product_images?.[0]?.image_name;return e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:2,p:2,borderRadius:2,backgroundColor:"grey.50"},children:[e.jsx(Fe,{src:I||`https://placehold.co/50x50/9682DB/FFFFFF/png?text=${encodeURIComponent(c.product_variant.product.name.substring(0,10))}`,alt:c.product_variant.product.name,sx:{width:50,height:50,borderRadius:2,flexShrink:0,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},variant:"rounded",children:e.jsx(Pe,{})}),e.jsxs(l,{sx:{flex:1,minWidth:0},children:[e.jsx(i,{variant:"subtitle2",fontWeight:600,sx:{mb:.5,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:c.product_variant.product.name,children:c.product_variant.product.name}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:c.product_variant.variant_name}),e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:["Qty: ",c.quantity]})]}),e.jsx(i,{variant:"body2",fontWeight:600,color:"primary.main",sx:{fontSize:"0.9rem"},children:y(parseFloat(c.product_variant.price)*c.quantity)})]},c.id)})})]}),e.jsx(ne,{sx:{my:2}}),e.jsxs(U,{spacing:2,children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[e.jsx(i,{variant:"body1",fontWeight:500,children:"Subtotal"}),e.jsx(i,{variant:"body1",fontWeight:600,children:y(t)})]}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[e.jsxs(l,{children:[e.jsx(i,{variant:"body1",fontWeight:500,children:"Biaya Pengiriman"}),p&&e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsxs(i,{variant:"body2",color:"text.secondary",children:[p.courier_name," - ",p.courier_service_name]}),p.provider&&e.jsx(L,{label:f(p.provider),size:"small",color:v(p.provider),variant:"outlined"})]})]}),e.jsx(i,{variant:"body1",fontWeight:600,children:y(n)})]}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"primary.main",borderRadius:2,color:"white"},children:[e.jsx(i,{variant:"h6",fontWeight:600,children:"Total"}),e.jsx(i,{variant:"h6",fontWeight:700,children:y(o)})]})]}),e.jsx(ne,{sx:{my:3}}),e.jsx(O,{variant:"contained",size:"large",startIcon:e.jsx($e,{}),onClick:d,disabled:j||h,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:600,fontSize:"1rem",backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"},"&:disabled":{backgroundColor:"grey.300",color:"grey.500"}},children:h?"Membuat Order...":"Buat Order & Bayar"}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:2,textAlign:"center"},children:"Dengan melanjutkan, Anda menyetujui syarat dan ketentuan kami"})]})})}function xr({selectedAddress:r,onAddressSelect:t,onAddressesLoaded:n}){const o=Q(),d=xe(),[h,j]=s.useState([]),[C,p]=s.useState(null),[y,f]=s.useState(!0),[v,c]=s.useState(null),[I,w]=s.useState(!1),[_,k]=s.useState(null),S=s.useRef(t),b=s.useRef(n);s.useEffect(()=>{S.current=t,b.current=n},[t,n]),s.useEffect(()=>{(async()=>{try{f(!0),c(null);const x=await Be.getAddresses();if(x.success){j(x.data),b.current?.(x.data);const B=x.data.find(E=>E.is_primary);if(B)if(p(B),!r)S.current(B.id);else{const E=x.data.find(q=>q.id===r);E&&p(E)}}else c("Gagal memuat alamat")}catch(x){console.error("Error fetching addresses:",x),c(x.response?.data?.error||"Gagal memuat alamat")}finally{f(!1)}})()},[]),s.useEffect(()=>{if(r&&h.length>0){const u=h.find(x=>x.id===r);u&&p(u)}},[r,h]);const F=()=>{d("/addresses/add",{state:{returnTo:"/checkout"}})},R=()=>{k(r),w(!0)},P=()=>{w(!1),k(null)},T=()=>{if(_){const u=h.find(x=>x.id===_);u&&(p(u),t(_))}P()};return y?e.jsx(G,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(N,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:2,color:"text.primary"},children:"Alamat Pengiriman"}),e.jsx(U,{spacing:2,children:[...Array(2)].map((u,x)=>e.jsx(Ae,{variant:"rectangular",height:80,sx:{borderRadius:2}},x))})]})}):h.length===0?e.jsx(G,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(N,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:2,color:"text.primary"},children:"Alamat Pengiriman"}),e.jsx(M,{severity:"info",sx:{mb:2,borderRadius:2},children:"Anda belum memiliki alamat pengiriman. Silakan tambahkan alamat terlebih dahulu."}),e.jsx(O,{variant:"contained",startIcon:e.jsx(ie,{}),onClick:F,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:600,backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:"Tambah Alamat"})]})}):C?e.jsxs(e.Fragment,{children:[e.jsx(G,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(N,{sx:{p:3},children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{color:"text.primary"},children:"Alamat Pengiriman"}),e.jsx(O,{variant:"outlined",size:"small",startIcon:e.jsx(Oe,{}),onClick:R,sx:{borderRadius:2,fontWeight:500,borderColor:"primary.main",color:"primary.main","&:hover":{backgroundColor:"primary.light",borderColor:"primary.dark"}},children:"Ganti Alamat"})]}),v&&e.jsx(M,{severity:"error",sx:{mb:2,borderRadius:2},onClose:()=>c(null),children:v}),e.jsx(l,{sx:{p:2,border:`2px solid ${o.palette.primary.main}`,borderRadius:2,backgroundColor:o.palette.primary.light+"10",transition:"all 0.2s ease"},children:e.jsxs(U,{direction:"row",spacing:2,alignItems:"flex-start",children:[e.jsx(oe,{color:"primary",sx:{mt:.5,flexShrink:0}}),e.jsxs(l,{sx:{flex:1},children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,children:C.address_line}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[C.city,", ",C.province," ",C.postal_code]}),e.jsx(L,{label:"Utama",size:"small",sx:{mt:1,backgroundColor:o.palette.primary.main,color:"white",fontSize:"0.75rem",fontWeight:600,height:24}})]})]})})]})}),e.jsxs(Ge,{open:I,onClose:P,maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ne,{children:e.jsx(i,{variant:"h6",fontWeight:600,children:"Pilih Alamat Pengiriman"})}),e.jsx(Te,{children:e.jsx(me,{component:"fieldset",fullWidth:!0,children:e.jsx(be,{value:_||"",onChange:u=>k(u.target.value),children:h.map(u=>e.jsx(ge,{value:u.id,control:e.jsx(ve,{}),label:e.jsx(l,{sx:{p:2,border:_===u.id?`2px solid ${o.palette.primary.main}`:`1px solid ${o.palette.grey[200]}`,borderRadius:2,backgroundColor:_===u.id?o.palette.primary.light+"10":"grey.50",transition:"all 0.2s ease",width:"100%","&:hover":{backgroundColor:_===u.id?o.palette.primary.light+"15":"grey.100"}},children:e.jsxs(U,{direction:"row",spacing:2,alignItems:"flex-start",children:[e.jsx(oe,{color:"primary",sx:{mt:.5,flexShrink:0}}),e.jsxs(l,{sx:{flex:1},children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,children:u.address_line}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[u.city,", ",u.province," ",u.postal_code]}),u.is_primary&&e.jsx(L,{label:"Utama",size:"small",sx:{mt:1,backgroundColor:o.palette.primary.main,color:"white",fontSize:"0.75rem",fontWeight:600,height:24}})]})]})}),sx:{width:"100%",margin:0,mb:2,"& .MuiFormControlLabel-label":{width:"100%"}}},u.id))})})}),e.jsxs(Ue,{sx:{p:2},children:[e.jsx(O,{onClick:P,variant:"outlined",children:"Batal"}),e.jsx(O,{onClick:T,variant:"contained",disabled:!_,children:"Pilih"})]})]})]}):e.jsx(G,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(N,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:2,color:"text.primary"},children:"Alamat Pengiriman"}),e.jsx(M,{severity:"warning",sx:{mb:2,borderRadius:2},children:"Tidak ada alamat utama. Silakan set alamat utama terlebih dahulu."}),e.jsx(O,{variant:"contained",startIcon:e.jsx(ie,{}),onClick:F,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:600,backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:"Tambah Alamat"})]})})}const mr={getShippingRates:async r=>{try{const t=await H.post("/shipping/rates",r);return{success:!0,data:t.data.data,provider:t.data.provider,origin_country:t.data.origin_country,destination_country:t.data.destination_country}}catch(t){return{success:!1,error:t.response?.data?.error||"Failed to fetch shipping rates"}}},getAreas:async(r={})=>{try{return{success:!0,data:(await H.get("/shipping/areas",{params:r})).data.data}}catch(t){return{success:!1,error:t.response?.data?.error||"Failed to fetch areas"}}},trackShipment:async(r,t)=>{try{const n=t?{courier:t}:{},o=await H.get(`/shipping/track/${r}`,{params:n});return{success:!0,data:o.data.data,provider:o.data.provider}}catch(n){return{success:!1,error:n.response?.data?.error||"Failed to track shipment"}}},trackFedExShipment:async r=>{try{const t=await H.get(`/shipping/track/fedex/${r}`);return{success:!0,data:t.data.data,provider:t.data.provider}}catch(t){return{success:!1,error:t.response?.data?.error||"Failed to track FedEx shipment"}}}};function gr(r,t){const[n,o]=s.useState(r);return s.useEffect(()=>{const d=setTimeout(()=>{o(r)},t);return()=>{clearTimeout(d)}},[r,t]),n}const fr=r=>{const n=r.trim().replace(/\s*days?\s*$/i,"").split(/\s*-\s*/),o=parseInt(n[0],10),d=n.length>1?parseInt(n[1],10):o;return{min_day:isNaN(o)?1:o,max_day:isNaN(d)?o||3:d}},yr=r=>{const t=fr(r.shipment_duration_range||r.duration||"1 - 3");let n="standard";return r.service_type==="overnight"?n="overnight":r.service_type==="express"?n="express":r.service_type==="economy"&&(n="economy"),{courier_name:r.courier_name||r.company||"",courier_code:r.courier_code||r.company||"",courier_service_name:r.courier_service_name||"",courier_service_code:r.courier_service_code||r.type||"",service_type:n,description:r.description||"",shipping_type:r.shipping_type||"parcel",ship_type:r.shipping_type||"parcel",service_name:r.courier_service_name||"",price:r.price||r.shipping_fee||0,currency:r.currency||"IDR",type:r.type||r.courier_service_code||"",min_day:t.min_day,max_day:t.max_day,provider:"biteship"}};function vr({selectedAddress:r,cartItems:t,selectedMethod:n,onMethodSelect:o}){const d=Q(),{formatPrice:h}=ae(),[j,C]=s.useState([]),[p,y]=s.useState(!1),[f,v]=s.useState(null),[c,I]=s.useState(null),[w,_]=s.useState(null),[k,S]=s.useState(""),[b,F]=s.useState(!1),R=D.useMemo(()=>t.map(a=>({name:a.product_variant.product.name,description:a.product_variant.product.description||"",length:a.product_variant.product.length||10,width:a.product_variant.product.width||10,height:a.product_variant.product.height||1,weight:a.product_variant.product.weight||a.product_variant.weight||1e3,quantity:a.quantity,value:a.product_variant.price*a.quantity})),[t]),P=D.useMemo(()=>r?`${r.id}_${r.country}_${r.postal_code}`:null,[r?.id,r?.country,r?.postal_code]),T=D.useMemo(()=>R.reduce((a,g)=>a+g.weight*g.quantity,0),[R]),u=D.useMemo(()=>!r||t.length===0?null:`${P}_${T}_${R.length}`,[P,T,R.length,t.length]),x=gr(u,500);s.useEffect(()=>{(async()=>{try{const g=await qe.getActiveOriginLocation();g.success&&g.data&&_(g.data)}catch(g){console.error("Failed to fetch active origin:",g)}})()},[]),s.useEffect(()=>{r&&t.length>0&&w&&x&&x!==c&&B()},[x,w]);const B=async()=>{if(!(!r||!x||!w)&&!p)try{y(!0),v(null),I(x);const a=await mr.getShippingRates({origin_postal_code:w.postal_code,destination_postal_code:r.postal_code,origin_country:"ID",destination_country:r.country,items:R});if(x===c||!c)if(a.success&&a.data){const W=(a.data.pricing||[]).map(m=>yr(m));C(W),S(a.provider||""),F(r.country!=="ID")}else v(a.error||"Failed to fetch shipping rates")}catch(a){(x===c||!c)&&v(a.message||"Failed to fetch shipping rates")}finally{y(!1)}};D.useEffect(()=>()=>{y(!1),v(null)},[]);const E=(a,g)=>a===g?`${a} hari`:`${a}-${g} hari`,q=a=>{switch(a){case"express":case"overnight":return"error";case"standard":return"primary";case"economy":return"success";default:return"default"}},A=a=>{switch(a){case"express":return"Express";case"standard":return"Standard";case"economy":return"Economy";case"overnight":return"Overnight";default:return a}},$=a=>{switch(a){case"biteship":return{name:"Biteship",color:"primary",icon:"ðŸšš"};case"fedex":return{name:"FedEx",color:"error",icon:"ðŸ“¦"};case"fedex-estimated":return{name:"FedEx (Estimated)",color:"warning",icon:"ðŸ“¦"};case"indonesia-estimated":return{name:"Indonesia (Estimated)",color:"info",icon:"ðŸ‡®ðŸ‡©"};default:return{name:"Shipping",color:"default",icon:"ðŸ“¦"}}};return r?e.jsx(G,{children:e.jsxs(N,{children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(We,{sx:{fontSize:"1.5rem",mr:1,color:"primary.main"}}),e.jsx(i,{variant:"h6",fontWeight:600,children:"Pilih Metode Pengiriman"})]}),k&&e.jsx(L,{label:`${$(k).icon} ${$(k).name}`,color:$(k).color,size:"small",variant:"outlined"})]}),e.jsxs(l,{sx:{mb:3,p:2,backgroundColor:"grey.50",borderRadius:2},children:[e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Alamat Pengiriman:"}),e.jsx(i,{variant:"body1",fontWeight:500,children:r.recipient_name}),e.jsx(i,{variant:"body2",color:"text.secondary",children:r.address_line}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[r.city,", ",r.province," ",r.postal_code]}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[r.country==="ID"?"ðŸ‡®ðŸ‡© Indonesia":`ðŸŒ ${r.country}`,b&&e.jsx(L,{label:"Internasional",size:"small",color:"warning",variant:"outlined",sx:{ml:1,fontSize:"0.7rem"}})]})]}),p&&e.jsxs(l,{sx:{display:"flex",justifyContent:"center",py:3},children:[e.jsx(Me,{size:24}),e.jsx(i,{variant:"body2",sx:{ml:2},children:"Mencari opsi pengiriman..."})]}),f&&e.jsxs(M,{severity:"error",sx:{mb:3},children:[f,e.jsx(O,{size:"small",onClick:B,sx:{ml:2},children:"Coba Lagi"})]}),!p&&!f&&j.length>0&&e.jsxs(me,{component:"fieldset",fullWidth:!0,children:[e.jsx(ze,{component:"legend",sx:{mb:2,fontWeight:600},children:"Pilih Metode Pengiriman"}),e.jsx(be,{value:n||"",onChange:a=>{const g=j.find(W=>`${W.courier_code}_${W.courier_service_code}`===a.target.value);g&&o(g)},children:e.jsx(U,{spacing:2,children:j.map(a=>{const g=`${a.courier_code}_${a.courier_service_code}`,W=n===g;return e.jsx(G,{sx:{border:W?`2px solid ${d.palette.primary.main}`:"1px solid",borderColor:W?"primary.main":"grey.300",backgroundColor:W?"primary.light":"white",transition:"all 0.2s ease",cursor:"pointer","&:hover":{borderColor:"primary.main",backgroundColor:"primary.light"}},onClick:()=>{`${a.courier_code}${a.courier_service_code}`,o(a)},children:e.jsxs(N,{sx:{p:2},children:[e.jsx(ge,{value:g,control:e.jsx(ve,{}),label:"",sx:{m:0}}),e.jsxs(l,{sx:{ml:4},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",mb:1,flexWrap:"wrap",gap:1},children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,children:a.courier_name}),e.jsx(L,{label:A(a.service_type),color:q(a.service_type),size:"small"}),a.provider&&a.provider!==k&&e.jsx(L,{label:`${$(a.provider).icon} ${$(a.provider).name}`,color:$(a.provider).color,size:"small",variant:"outlined"})]}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:2},children:a.description}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:3},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{fontSize:"1rem",mr:.5,color:"success.main"}}),e.jsx(i,{variant:"h6",fontWeight:600,color:"success.main",children:h(a.price,a.currency||"IDR")})]}),e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ke,{sx:{fontSize:"1rem",mr:.5,color:"text.secondary"}}),e.jsx(i,{variant:"body2",color:"text.secondary",children:E(a.min_day,a.max_day)})]})]})]})]})},g)})})})]}),!p&&!f&&j.length===0&&e.jsx(M,{severity:"warning",children:"Tidak ada opsi pengiriman tersedia untuk alamat inii"})]})}):e.jsx(G,{children:e.jsx(N,{children:e.jsx(M,{severity:"info",children:"Pilih alamat pengiriman terlebih dahulu untuk melihat opsi pengiriman"})})})}function Br(){Q();const r=xe(),{loading:t,error:n}=ae(),[o,d]=s.useState(!0),[h,j]=s.useState(!1),[C,p]=s.useState(!1),[y,f]=s.useState(null),[v,c]=s.useState(null),[I,w]=s.useState(null),[_,k]=s.useState([]),[S,b]=s.useState("midtrans"),[F,R]=s.useState(null),[P,T]=s.useState(15e3),{items:u,clearCart:x}=Ee(),{addOrder:B,setPaymentMethods:E,paymentMethods:q}=De(),A=D.useMemo(()=>u.filter(m=>m.product_variant.product.deleted_at===null),[u]),$=D.useMemo(()=>A.reduce((m,K)=>m+parseFloat(K.product_variant.price)*K.quantity,0),[A]),a=D.useMemo(()=>$+P,[$,P]),g=D.useCallback(async()=>{try{const m=await se.getPaymentMethods();m.success&&E(m.data)}catch(m){console.error("Error fetching payment methods:",m)}},[E]),W=async()=>{if(!v){f("Pilih alamat pengiriman terlebih dahulu");return}if(A.length===0){f("Tidak ada item yang tersedia untuk checkout");return}try{j(!0),f(null);const m=await se.createOrder({address_id:v,shipping_cost:P});m.success&&(B(m.data),p(!0),x(),r(`/orders/${m.data.order_id}`,{state:{message:"Order berhasil dibuat! Silakan lakukan pembayaran.",selectedPaymentMethod:S}}))}catch(m){console.error("Error creating order:",m),f(m.response?.data?.error||"Gagal membuat order")}finally{j(!1)}};return s.useEffect(()=>{if(u.length===0&&!h&&!C){r("/cart");return}q.length===0&&g(),d(!1)},[u.length,r,h,C,g,q.length]),o?e.jsx(l,{sx:{minHeight:"100vh",py:4},children:e.jsx(Z,{maxWidth:"xl",children:e.jsx(i,{children:"Loading..."})})}):A.length===0?e.jsx(l,{sx:{minHeight:"100vh",py:4},children:e.jsxs(Z,{maxWidth:"xl",children:[e.jsx(M,{severity:"warning",sx:{mb:4},children:"Tidak ada item yang tersedia untuk checkout. Semua item di keranjang sudah tidak tersedia."}),e.jsx(O,{variant:"contained",onClick:()=>r("/cart"),children:"Kembali ke Keranjang"})]})}):e.jsx(l,{sx:{minHeight:"100vh",py:4},children:e.jsxs(Z,{maxWidth:"xl",children:[e.jsxs(l,{sx:{mb:3},children:[e.jsx(i,{variant:"h4",fontWeight:600,sx:{mb:1,color:"text.primary"},children:"Checkout"}),e.jsx(i,{variant:"body1",color:"text.secondary",children:"Lengkapi informasi pengiriman dan pembayaran"})]}),y&&e.jsx(M,{severity:"error",sx:{mb:4},onClose:()=>f(null),children:y}),t&&e.jsx(M,{severity:"info",sx:{mb:2},children:"Loading exchange rates..."}),n&&e.jsx(M,{severity:"warning",sx:{mb:2},children:"Failed to load exchange rates. Prices will be displayed in default currency."}),e.jsxs(l,{sx:{display:"flex",flexDirection:{xs:"column",lg:"row"},gap:4,alignItems:"flex-start"},children:[e.jsx(l,{sx:{flex:1,minWidth:0,order:{xs:1,lg:1}},children:e.jsxs(U,{spacing:4,children:[e.jsx(xr,{selectedAddress:v,onAddressSelect:m=>{c(m);const K=_.find(je=>je.id===m);w(K),R(null),T(15e3)},onAddressesLoaded:k}),e.jsx(vr,{selectedAddress:I,cartItems:A,selectedMethod:F?`${F.courier_code}_${F.courier_service_code}`:null,onMethodSelect:m=>{R(m),T(m.price)}})]})}),e.jsx(l,{sx:{width:{xs:"100%",lg:"400px"},flexShrink:0,order:{xs:2,lg:2}},children:e.jsx(hr,{items:A,subtotal:$,shippingCost:P,total:a,onCreateOrder:W,creatingOrder:h,disabled:!v||!F,selectedPaymentMethod:S,selectedShippingMethod:F})})]})]})})}export{Br as default};
