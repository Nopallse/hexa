import{a as Y,g as ee,r as s,u as pe,_ as re,ah as _e,ai as ke,i as M,j as e,s as V,k as te,m as ae,c as he,U as xe,aj as Se,l as J,V as we,d as Re,h as Ie,b as Fe,p as Q,T as i,B as l,S as L,A as Pe,ac as We,N as oe,w as T,t as A,ag as $e,q as me,F as se,a4 as ge,ae as H,aa as D,J as ze,ak as Me,ab as Ee,a9 as De,C as X}from"./index-aASFK1tJ.js";import{u as Be}from"./orderStore-BmnpHtMU.js";import{o as ie}from"./orderApi-B2e8lr3n.js";import{u as ne}from"./useCurrencyConversion-DlJ_RGo8.js";import{C as O,a as G}from"./CardContent-CZ8AkO-X.js";import{a as Ae}from"./addressApi-D6-ZGNYH.js";import{S as Oe}from"./Skeleton-UyT1_vOM.js";import{A as z}from"./Alert-CgLHgHYO.js";import{A as ce}from"./Add-rwwkErMU.js";import{E as Ge}from"./Edit-C8FYPv4Q.js";import{D as Ne,a as Te,b as Le}from"./DialogTitle-fhJ-s9NB.js";import{S as Ue,F as fe}from"./FormControlLabel-Cyv6D_YA.js";import{D as qe}from"./DialogActions-DXpXqY53.js";import{l as Ve}from"./locationApi-BG8G-oPg.js";import{A as Ke}from"./AttachMoney-BljHPsvA.js";import{S as He}from"./Schedule-C36tfeia.js";function Je(r){return Y("MuiFormGroup",r)}ee("MuiFormGroup",["root","row","error"]);const Qe=["className","row"],Ze=r=>{const{classes:t,row:o,error:n}=r;return ae({root:["root",o&&"row",n&&"error"]},Je,t)},Xe=V("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(r,t)=>{const{ownerState:o}=r;return[t.root,o.row&&t.row]}})(({ownerState:r})=>M({display:"flex",flexDirection:"column",flexWrap:"wrap"},r.row&&{flexDirection:"row"})),Ye=s.forwardRef(function(t,o){const n=pe({props:t,name:"MuiFormGroup"}),{className:d,row:h=!1}=n,j=re(n,Qe),C=_e(),p=ke({props:n,muiFormControl:C,states:["error"]}),y=M({},n,{row:h,error:p.error}),g=Ze(y);return e.jsx(Xe,M({className:te(g.root,d),ownerState:y,ref:o},j))}),er=he(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),rr=he(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),tr=V("span",{name:"MuiRadioButtonIcon",shouldForwardProp:xe})({position:"relative",display:"flex"}),ar=V(er,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),nr=V(rr,{name:"MuiRadioButtonIcon"})(({theme:r,ownerState:t})=>M({left:0,position:"absolute",transform:"scale(0)",transition:r.transitions.create("transform",{easing:r.transitions.easing.easeIn,duration:r.transitions.duration.shortest})},t.checked&&{transform:"scale(1)",transition:r.transitions.create("transform",{easing:r.transitions.easing.easeOut,duration:r.transitions.duration.shortest})}));function ye(r){const{checked:t=!1,classes:o={},fontSize:n}=r,d=M({},r,{checked:t});return e.jsxs(tr,{className:o.root,ownerState:d,children:[e.jsx(ar,{fontSize:n,className:o.background,ownerState:d}),e.jsx(nr,{fontSize:n,className:o.dot,ownerState:d})]})}const ve=s.createContext(void 0);function or(){return s.useContext(ve)}function sr(r){return Y("MuiRadio",r)}const le=ee("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),ir=["checked","checkedIcon","color","icon","name","onChange","size","className"],cr=r=>{const{classes:t,color:o,size:n}=r,d={root:["root",`color${J(o)}`,n!=="medium"&&`size${J(n)}`]};return M({},t,ae(d,sr,t))},lr=V(Ue,{shouldForwardProp:r=>xe(r)||r==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(r,t)=>{const{ownerState:o}=r;return[t.root,o.size!=="medium"&&t[`size${J(o.size)}`],t[`color${J(o.color)}`]]}})(({theme:r,ownerState:t})=>M({color:(r.vars||r).palette.text.secondary},!t.disableRipple&&{"&:hover":{backgroundColor:r.vars?`rgba(${t.color==="default"?r.vars.palette.action.activeChannel:r.vars.palette[t.color].mainChannel} / ${r.vars.palette.action.hoverOpacity})`:we.alpha(t.color==="default"?r.palette.action.active:r.palette[t.color].main,r.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},t.color!=="default"&&{[`&.${le.checked}`]:{color:(r.vars||r).palette[t.color].main}},{[`&.${le.disabled}`]:{color:(r.vars||r).palette.action.disabled}}));function dr(r,t){return typeof t=="object"&&t!==null?r===t:String(r)===String(t)}const de=e.jsx(ye,{checked:!0}),ue=e.jsx(ye,{}),be=s.forwardRef(function(t,o){var n,d;const h=pe({props:t,name:"MuiRadio"}),{checked:j,checkedIcon:C=de,color:p="primary",icon:y=ue,name:g,onChange:v,size:c="medium",className:F}=h,w=re(h,ir),_=M({},h,{color:p,size:c}),k=cr(_),S=or();let b=j;const P=Se(v,S&&S.onChange);let R=g;return S&&(typeof b>"u"&&(b=dr(S.value,h.value)),typeof R>"u"&&(R=S.name)),e.jsx(lr,M({type:"radio",icon:s.cloneElement(y,{fontSize:(n=ue.props.fontSize)!=null?n:c}),checkedIcon:s.cloneElement(C,{fontSize:(d=de.props.fontSize)!=null?d:c}),ownerState:_,classes:k,name:R,checked:b,onChange:P,ref:o,className:te(k.root,F)},w))});function ur(r){return Y("MuiRadioGroup",r)}ee("MuiRadioGroup",["root","row","error"]);const pr=["actions","children","className","defaultValue","name","onChange","value"],hr=r=>{const{classes:t,row:o,error:n}=r;return ae({root:["root",o&&"row",n&&"error"]},ur,t)},je=s.forwardRef(function(t,o){const{actions:n,children:d,className:h,defaultValue:j,name:C,onChange:p,value:y}=t,g=re(t,pr),v=s.useRef(null),c=hr(t),[F,w]=Re({controlled:y,default:j,name:"RadioGroup"});s.useImperativeHandle(n,()=>({focus:()=>{let b=v.current.querySelector("input:not(:disabled):checked");b||(b=v.current.querySelector("input:not(:disabled)")),b&&b.focus()}}),[]);const _=Ie(o,v),k=Fe(C),S=s.useMemo(()=>({name:k,onChange(b){w(b.target.value),p&&p(b,b.target.value)},value:F}),[k,p,w,F]);return e.jsx(ve.Provider,{value:S,children:e.jsx(Ye,M({role:"radiogroup",ref:_,className:te(c.root,h)},g,{children:d}))})});function xr({items:r,subtotal:t,shippingCost:o,total:n,onCreateOrder:d,creatingOrder:h,disabled:j,selectedPaymentMethod:C,selectedShippingMethod:p}){Q();const{formatPrice:y}=ne(),g=c=>{switch(c){case"biteship":return"ðŸšš Biteship";case"fedex":return"ðŸ“¦ FedEx";case"fedex-estimated":return"ðŸ“¦ FedEx (Est.)";case"indonesia-estimated":return"ðŸ‡®ðŸ‡© Indonesia (Est.)";default:return"ðŸ“¦ Shipping"}},v=c=>{switch(c){case"biteship":return"primary";case"fedex":return"error";case"fedex-estimated":return"warning";case"indonesia-estimated":return"info";default:return"default"}};return e.jsx(O,{sx:{position:"sticky",top:24,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:"none"},children:e.jsxs(G,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:3,color:"text.primary"},children:"Ringkasan Pesanan"}),e.jsxs(l,{sx:{mb:3},children:[e.jsxs(i,{variant:"subtitle1",fontWeight:600,sx:{mb:2},children:["Item (",r.length,")"]}),e.jsx(L,{spacing:2,children:r.map(c=>{const F=c.product_variant.product.product_images?.[0]?.image_name;return e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:2,p:2,borderRadius:2,backgroundColor:"grey.50"},children:[e.jsx(Pe,{src:F||`https://placehold.co/50x50/9682DB/FFFFFF/png?text=${encodeURIComponent(c.product_variant.product.name.substring(0,10))}`,alt:c.product_variant.product.name,sx:{width:50,height:50,borderRadius:2,flexShrink:0,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},variant:"rounded",children:e.jsx(We,{})}),e.jsxs(l,{sx:{flex:1,minWidth:0},children:[e.jsx(i,{variant:"subtitle2",fontWeight:600,sx:{mb:.5,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:c.product_variant.product.name,children:c.product_variant.product.name}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:c.product_variant.variant_name}),e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:["Qty: ",c.quantity]})]}),e.jsx(i,{variant:"body2",fontWeight:600,color:"primary.main",sx:{fontSize:"0.9rem"},children:y(parseFloat(c.product_variant.price)*c.quantity)})]},c.id)})})]}),e.jsx(oe,{sx:{my:2}}),e.jsxs(L,{spacing:2,children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[e.jsx(i,{variant:"body1",fontWeight:500,children:"Subtotal"}),e.jsx(i,{variant:"body1",fontWeight:600,children:y(t)})]}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[e.jsxs(l,{children:[e.jsx(i,{variant:"body1",fontWeight:500,children:"Biaya Pengiriman"}),p&&e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsxs(i,{variant:"body2",color:"text.secondary",children:[p.courier_name," - ",p.courier_service_name]}),p.provider&&e.jsx(T,{label:g(p.provider),size:"small",color:v(p.provider),variant:"outlined"})]})]}),e.jsx(i,{variant:"body1",fontWeight:600,children:y(o)})]}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"primary.main",borderRadius:2,color:"white"},children:[e.jsx(i,{variant:"h6",fontWeight:600,children:"Total"}),e.jsx(i,{variant:"h6",fontWeight:700,children:y(n)})]})]}),e.jsx(oe,{sx:{my:3}}),e.jsx(A,{variant:"contained",size:"large",startIcon:e.jsx($e,{}),onClick:d,disabled:j||h,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:600,fontSize:"1rem",backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"},"&:disabled":{backgroundColor:"grey.300",color:"grey.500"}},children:h?"Membuat Order...":"Buat Order & Bayar"}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:2,textAlign:"center"},children:"Dengan melanjutkan, Anda menyetujui syarat dan ketentuan kami"})]})})}function mr({selectedAddress:r,onAddressSelect:t,onAddressesLoaded:o}){const n=Q(),d=me(),[h,j]=s.useState([]),[C,p]=s.useState(null),[y,g]=s.useState(!0),[v,c]=s.useState(null),[F,w]=s.useState(!1),[_,k]=s.useState(null),S=s.useRef(t),b=s.useRef(o);s.useEffect(()=>{S.current=t,b.current=o},[t,o]),s.useEffect(()=>{(async()=>{try{g(!0),c(null);const x=await Ae.getAddresses();if(x.success){j(x.data),b.current?.(x.data);const E=x.data.find(B=>B.is_primary);if(E)if(p(E),!r)S.current(E.id);else{const B=x.data.find(U=>U.id===r);B&&p(B)}}else c("Gagal memuat alamat")}catch(x){console.error("Error fetching addresses:",x),c(x.response?.data?.error||"Gagal memuat alamat")}finally{g(!1)}})()},[]),s.useEffect(()=>{if(r&&h.length>0){const u=h.find(x=>x.id===r);u&&p(u)}},[r,h]);const P=()=>{d("/addresses/add",{state:{returnTo:"/checkout"}})},R=()=>{k(r),w(!0)},W=()=>{w(!1),k(null)},N=()=>{if(_){const u=h.find(x=>x.id===_);u&&(p(u),t(_))}W()};return y?e.jsx(O,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(G,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:2,color:"text.primary"},children:"Alamat Pengiriman"}),e.jsx(L,{spacing:2,children:[...Array(2)].map((u,x)=>e.jsx(Oe,{variant:"rectangular",height:80,sx:{borderRadius:2}},x))})]})}):h.length===0?e.jsx(O,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(G,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:2,color:"text.primary"},children:"Alamat Pengiriman"}),e.jsx(z,{severity:"info",sx:{mb:2,borderRadius:2},children:"Anda belum memiliki alamat pengiriman. Silakan tambahkan alamat terlebih dahulu."}),e.jsx(A,{variant:"contained",startIcon:e.jsx(ce,{}),onClick:P,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:600,backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:"Tambah Alamat"})]})}):C?e.jsxs(e.Fragment,{children:[e.jsx(O,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(G,{sx:{p:3},children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{color:"text.primary"},children:"Alamat Pengiriman"}),e.jsx(A,{variant:"outlined",size:"small",startIcon:e.jsx(Ge,{}),onClick:R,sx:{borderRadius:2,fontWeight:500,borderColor:"primary.main",color:"primary.main","&:hover":{backgroundColor:"primary.light",borderColor:"primary.dark"}},children:"Ganti Alamat"})]}),v&&e.jsx(z,{severity:"error",sx:{mb:2,borderRadius:2},onClose:()=>c(null),children:v}),e.jsx(l,{sx:{p:2,border:`2px solid ${n.palette.primary.main}`,borderRadius:2,backgroundColor:n.palette.primary.light+"10",transition:"all 0.2s ease"},children:e.jsxs(L,{direction:"row",spacing:2,alignItems:"flex-start",children:[e.jsx(se,{color:"primary",sx:{mt:.5,flexShrink:0}}),e.jsxs(l,{sx:{flex:1},children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,children:C.address_line}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[C.city,", ",C.province," ",C.postal_code]}),e.jsx(T,{label:"Utama",size:"small",sx:{mt:1,backgroundColor:n.palette.primary.main,color:"white",fontSize:"0.75rem",fontWeight:600,height:24}})]})]})})]})}),e.jsxs(Ne,{open:F,onClose:W,maxWidth:"sm",fullWidth:!0,children:[e.jsx(Te,{children:e.jsx(i,{variant:"h6",fontWeight:600,children:"Pilih Alamat Pengiriman"})}),e.jsx(Le,{children:e.jsx(ge,{component:"fieldset",fullWidth:!0,children:e.jsx(je,{value:_||"",onChange:u=>k(u.target.value),children:h.map(u=>e.jsx(fe,{value:u.id,control:e.jsx(be,{}),label:e.jsx(l,{sx:{p:2,border:_===u.id?`2px solid ${n.palette.primary.main}`:`1px solid ${n.palette.grey[200]}`,borderRadius:2,backgroundColor:_===u.id?n.palette.primary.light+"10":"grey.50",transition:"all 0.2s ease",width:"100%","&:hover":{backgroundColor:_===u.id?n.palette.primary.light+"15":"grey.100"}},children:e.jsxs(L,{direction:"row",spacing:2,alignItems:"flex-start",children:[e.jsx(se,{color:"primary",sx:{mt:.5,flexShrink:0}}),e.jsxs(l,{sx:{flex:1},children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,children:u.address_line}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[u.city,", ",u.province," ",u.postal_code]}),u.is_primary&&e.jsx(T,{label:"Utama",size:"small",sx:{mt:1,backgroundColor:n.palette.primary.main,color:"white",fontSize:"0.75rem",fontWeight:600,height:24}})]})]})}),sx:{width:"100%",margin:0,mb:2,"& .MuiFormControlLabel-label":{width:"100%"}}},u.id))})})}),e.jsxs(qe,{sx:{p:2},children:[e.jsx(A,{onClick:W,variant:"outlined",children:"Batal"}),e.jsx(A,{onClick:N,variant:"contained",disabled:!_,children:"Pilih"})]})]})]}):e.jsx(O,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(G,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:2,color:"text.primary"},children:"Alamat Pengiriman"}),e.jsx(z,{severity:"warning",sx:{mb:2,borderRadius:2},children:"Tidak ada alamat utama. Silakan set alamat utama terlebih dahulu."}),e.jsx(A,{variant:"contained",startIcon:e.jsx(ce,{}),onClick:P,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:600,backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:"Tambah Alamat"})]})})}const gr={getShippingRates:async r=>{try{const t=await H.post("/shipping/rates",r);return{success:!0,data:t.data.data,provider:t.data.provider,origin_country:t.data.origin_country,destination_country:t.data.destination_country}}catch(t){return{success:!1,error:t.response?.data?.error||"Failed to fetch shipping rates"}}},getAreas:async(r={})=>{try{return{success:!0,data:(await H.get("/shipping/areas",{params:r})).data.data}}catch(t){return{success:!1,error:t.response?.data?.error||"Failed to fetch areas"}}},trackShipment:async(r,t)=>{try{const o=t?{courier:t}:{},n=await H.get(`/shipping/track/${r}`,{params:o});return{success:!0,data:n.data.data,provider:n.data.provider}}catch(o){return{success:!1,error:o.response?.data?.error||"Failed to track shipment"}}},trackFedExShipment:async r=>{try{const t=await H.get(`/shipping/track/fedex/${r}`);return{success:!0,data:t.data.data,provider:t.data.provider}}catch(t){return{success:!1,error:t.response?.data?.error||"Failed to track FedEx shipment"}}}};function fr(r,t){const[o,n]=s.useState(r);return s.useEffect(()=>{const d=setTimeout(()=>{n(r)},t);return()=>{clearTimeout(d)}},[r,t]),o}const yr=r=>{const o=r.trim().replace(/\s*days?\s*$/i,"").split(/\s*-\s*/),n=parseInt(o[0],10),d=o.length>1?parseInt(o[1],10):n;return{min_day:isNaN(n)?1:n,max_day:isNaN(d)?n||3:d}},vr=r=>{const t=yr(r.shipment_duration_range||r.duration||"1 - 3");let o="standard";return r.service_type==="overnight"?o="overnight":r.service_type==="express"?o="express":r.service_type==="economy"&&(o="economy"),{courier_name:r.courier_name||r.company||"",courier_code:r.courier_code||r.company||"",courier_service_name:r.courier_service_name||"",courier_service_code:r.courier_service_code||r.type||"",service_type:o,description:r.description||"",shipping_type:r.shipping_type||"parcel",ship_type:r.shipping_type||"parcel",service_name:r.courier_service_name||"",price:r.price||r.shipping_fee||0,currency:r.currency||"IDR",type:r.type||r.courier_service_code||"",min_day:t.min_day,max_day:t.max_day,provider:"biteship"}};function br({selectedAddress:r,cartItems:t,selectedMethod:o,onMethodSelect:n}){const d=Q(),{formatPrice:h}=ne(),[j,C]=s.useState([]),[p,y]=s.useState(!1),[g,v]=s.useState(null),[c,F]=s.useState(null),[w,_]=s.useState(null),[k,S]=s.useState(""),[b,P]=s.useState(!1),R=D.useMemo(()=>t.map(a=>({name:a.product_variant.product.name,description:a.product_variant.product.description||"",length:a.product_variant.product.length||10,width:a.product_variant.product.width||10,height:a.product_variant.product.height||1,weight:a.product_variant.product.weight||a.product_variant.weight||1e3,quantity:a.quantity,value:a.product_variant.price*a.quantity})),[t]),W=D.useMemo(()=>r?`${r.id}_${r.country}_${r.postal_code}`:null,[r?.id,r?.country,r?.postal_code]),N=D.useMemo(()=>R.reduce((a,f)=>a+f.weight*f.quantity,0),[R]),u=D.useMemo(()=>!r||t.length===0?null:`${W}_${N}_${R.length}`,[W,N,R.length,t.length]),x=fr(u,500);s.useEffect(()=>{(async()=>{try{const f=await Ve.getActiveOriginLocation();f.success&&f.data&&_(f.data)}catch(f){console.error("Failed to fetch active origin:",f)}})()},[]),s.useEffect(()=>{r&&t.length>0&&w&&x&&x!==c&&E()},[x,w]);const E=async()=>{if(!(!r||!x||!w)&&!p)try{y(!0),v(null),F(x);const a=await gr.getShippingRates({origin_postal_code:w.postal_code,destination_postal_code:r.postal_code,origin_country:"ID",destination_country:r.country,items:R});if(x===c||!c)if(a.success&&a.data){const $=(a.data.pricing||[]).map(Z=>vr(Z));C($),S(a.provider||""),P(r.country!=="ID")}else v(a.error||"Failed to fetch shipping rates")}catch(a){(x===c||!c)&&v(a.message||"Failed to fetch shipping rates")}finally{y(!1)}};D.useEffect(()=>()=>{y(!1),v(null)},[]);const B=(a,f)=>a===f?`${a} hari`:`${a}-${f} hari`,U=a=>{switch(a){case"express":case"overnight":return"error";case"standard":return"primary";case"economy":return"success";default:return"default"}},K=a=>{switch(a){case"express":return"Express";case"standard":return"Standard";case"economy":return"Economy";case"overnight":return"Overnight";default:return a}},I=a=>{switch(a){case"biteship":return{name:"Biteship",color:"primary",icon:"ðŸšš"};case"fedex":return{name:"FedEx",color:"error",icon:"ðŸ“¦"};case"fedex-estimated":return{name:"FedEx (Estimated)",color:"warning",icon:"ðŸ“¦"};case"indonesia-estimated":return{name:"Indonesia (Estimated)",color:"info",icon:"ðŸ‡®ðŸ‡©"};default:return{name:"Shipping",color:"default",icon:"ðŸ“¦"}}};return r?e.jsx(O,{children:e.jsxs(G,{children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ze,{sx:{fontSize:"1.5rem",mr:1,color:"primary.main"}}),e.jsx(i,{variant:"h6",fontWeight:600,children:"Pilih Metode Pengiriman"})]}),k&&e.jsx(T,{label:`${I(k).icon} ${I(k).name}`,color:I(k).color,size:"small",variant:"outlined"})]}),e.jsxs(l,{sx:{mb:3,p:2,backgroundColor:"grey.50",borderRadius:2},children:[e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Alamat Pengiriman:"}),e.jsx(i,{variant:"body1",fontWeight:500,children:r.recipient_name}),e.jsx(i,{variant:"body2",color:"text.secondary",children:r.address_line}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[r.city,", ",r.province," ",r.postal_code]}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[r.country==="ID"?"ðŸ‡®ðŸ‡© Indonesia":`ðŸŒ ${r.country}`,b&&e.jsx(T,{label:"Internasional",size:"small",color:"warning",variant:"outlined",sx:{ml:1,fontSize:"0.7rem"}})]})]}),p&&e.jsxs(l,{sx:{display:"flex",justifyContent:"center",py:3},children:[e.jsx(Me,{size:24}),e.jsx(i,{variant:"body2",sx:{ml:2},children:"Mencari opsi pengiriman..."})]}),g&&e.jsxs(z,{severity:"error",sx:{mb:3},children:[g,e.jsx(A,{size:"small",onClick:E,sx:{ml:2},children:"Coba Lagi"})]}),!p&&!g&&j.length>0&&e.jsxs(ge,{component:"fieldset",fullWidth:!0,children:[e.jsx(Ee,{component:"legend",sx:{mb:2,fontWeight:600},children:"Pilih Metode Pengiriman"}),e.jsx(je,{value:o||"",onChange:a=>{const f=j.find($=>`${$.courier_code}_${$.courier_service_code}`===a.target.value);f&&n(f)},children:e.jsx(L,{spacing:2,children:j.map(a=>{const f=`${a.courier_code}_${a.courier_service_code}`,$=o===f;return e.jsx(O,{sx:{border:$?`2px solid ${d.palette.primary.main}`:"1px solid",borderColor:$?"primary.main":"grey.300",backgroundColor:$?"primary.light":"white",transition:"all 0.2s ease",cursor:"pointer","&:hover":{borderColor:"primary.main",backgroundColor:"primary.light"}},onClick:()=>{`${a.courier_code}${a.courier_service_code}`,n(a)},children:e.jsxs(G,{sx:{p:2},children:[e.jsx(fe,{value:f,control:e.jsx(be,{}),label:"",sx:{m:0}}),e.jsxs(l,{sx:{ml:4},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",mb:1,flexWrap:"wrap",gap:1},children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,children:a.courier_name}),e.jsx(T,{label:K(a.service_type),color:U(a.service_type),size:"small"}),a.provider&&a.provider!==k&&e.jsx(T,{label:`${I(a.provider).icon} ${I(a.provider).name}`,color:I(a.provider).color,size:"small",variant:"outlined"})]}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:2},children:a.description}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:3},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ke,{sx:{fontSize:"1rem",mr:.5,color:"success.main"}}),e.jsx(i,{variant:"h6",fontWeight:600,color:"success.main",children:h(a.price,a.currency||"IDR")})]}),e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(He,{sx:{fontSize:"1rem",mr:.5,color:"text.secondary"}}),e.jsx(i,{variant:"body2",color:"text.secondary",children:B(a.min_day,a.max_day)})]})]})]})]})},f)})})})]}),!p&&!g&&j.length===0&&e.jsx(z,{severity:"warning",children:"Tidak ada opsi pengiriman tersedia untuk alamat inii"})]})}):e.jsx(O,{children:e.jsx(G,{children:e.jsx(z,{severity:"info",children:"Pilih alamat pengiriman terlebih dahulu untuk melihat opsi pengiriman"})})})}function Br(){Q();const r=me(),{loading:t,error:o}=ne(),[n,d]=s.useState(!0),[h,j]=s.useState(!1),[C,p]=s.useState(!1),[y,g]=s.useState(null),[v,c]=s.useState(null),[F,w]=s.useState(null),[_,k]=s.useState([]),[S,b]=s.useState("midtrans"),[P,R]=s.useState(null),[W,N]=s.useState(15e3),{items:u,clearCart:x,syncWithServer:E}=De(),{addOrder:B,setPaymentMethods:U,paymentMethods:K}=Be(),I=D.useMemo(()=>u.filter(m=>m.product_variant.product.deleted_at===null),[u]),a=D.useMemo(()=>I.reduce((m,q)=>m+parseFloat(q.product_variant.price)*q.quantity,0),[I]),f=D.useMemo(()=>a+W,[a,W]),$=D.useCallback(async()=>{try{const m=await ie.getPaymentMethods();m.success&&U(m.data)}catch(m){console.error("Error fetching payment methods:",m)}},[U]),Z=async()=>{if(!v){g("Pilih alamat pengiriman terlebih dahulu");return}if(I.length===0){g("Tidak ada item yang tersedia untuk checkout");return}try{j(!0),g(null);const m=await ie.createOrder({address_id:v,shipping_cost:W});m.success&&(B(m.data),p(!0),x(),r(`/orders/${m.data.order_id}`,{state:{message:"Order berhasil dibuat! Silakan lakukan pembayaran.",selectedPaymentMethod:S}}))}catch(m){console.error("Error creating order:",m),g(m.response?.data?.error||"Gagal membuat order")}finally{j(!1)}};return s.useEffect(()=>{(async()=>{try{await E()}catch(q){console.error("Error syncing cart:",q)}})()},[E]),s.useEffect(()=>{if(u.length===0&&!h&&!C&&!n){r("/cart");return}K.length===0&&$(),n&&d(!1)},[u.length,r,h,C,$,K.length,n]),n?e.jsx(l,{sx:{minHeight:"100vh",py:4},children:e.jsx(X,{maxWidth:"xl",children:e.jsx(i,{children:"Loading..."})})}):I.length===0?e.jsx(l,{sx:{minHeight:"100vh",py:4},children:e.jsxs(X,{maxWidth:"xl",children:[e.jsx(z,{severity:"warning",sx:{mb:4},children:"Tidak ada item yang tersedia untuk checkout. Semua item di keranjang sudah tidak tersedia."}),e.jsx(A,{variant:"contained",onClick:()=>r("/cart"),children:"Kembali ke Keranjang"})]})}):e.jsx(l,{sx:{minHeight:"100vh",py:4},children:e.jsxs(X,{maxWidth:"xl",children:[e.jsxs(l,{sx:{mb:3},children:[e.jsx(i,{variant:"h4",fontWeight:600,sx:{mb:1,color:"text.primary"},children:"Checkout"}),e.jsx(i,{variant:"body1",color:"text.secondary",children:"Lengkapi informasi pengiriman dan pembayaran"})]}),y&&e.jsx(z,{severity:"error",sx:{mb:4},onClose:()=>g(null),children:y}),t&&e.jsx(z,{severity:"info",sx:{mb:2},children:"Loading exchange rates..."}),o&&e.jsx(z,{severity:"warning",sx:{mb:2},children:"Failed to load exchange rates. Prices will be displayed in default currency."}),e.jsxs(l,{sx:{display:"flex",flexDirection:{xs:"column",lg:"row"},gap:4,alignItems:"flex-start"},children:[e.jsx(l,{sx:{flex:1,minWidth:0,order:{xs:1,lg:1}},children:e.jsxs(L,{spacing:4,children:[e.jsx(mr,{selectedAddress:v,onAddressSelect:m=>{c(m);const q=_.find(Ce=>Ce.id===m);w(q),R(null),N(15e3)},onAddressesLoaded:k}),e.jsx(br,{selectedAddress:F,cartItems:I,selectedMethod:P?`${P.courier_code}_${P.courier_service_code}`:null,onMethodSelect:m=>{R(m),N(m.price)}})]})}),e.jsx(l,{sx:{width:{xs:"100%",lg:"400px"},flexShrink:0,order:{xs:2,lg:2}},children:e.jsx(xr,{items:I,subtotal:a,shippingCost:W,total:f,onCreateOrder:Z,creatingOrder:h,disabled:!v||!P,selectedPaymentMethod:S,selectedShippingMethod:P})})]})]})})}export{Br as default};
