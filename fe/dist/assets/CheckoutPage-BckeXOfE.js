import{a as X,g as Y,r as s,u as pe,_ as ee,ah as Ce,ai as ke,i as E,j as e,s as q,k as re,m as te,c as he,U as xe,aj as Se,l as H,V as we,d as Re,h as Ie,b as $e,p as J,T as i,B as u,S as U,A as Fe,ac as Pe,N as oe,w as L,t as G,ag as We,q as me,F as se,a4 as ge,ae as K,aa as B,J as ze,ak as Me,ab as Ee,a9 as De,C as Z}from"./index-sTH-7xwR.js";import{u as Be}from"./orderStore-FsTl8gX_.js";import{o as ie}from"./orderApi-D9XMIWOv.js";import{u as ae}from"./useCurrencyConversion-CYsls9be.js";import{C as N,a as T}from"./CardContent-CbD_XzoO.js";import{a as Oe}from"./addressApi-CSeB-2BR.js";import{S as Ae}from"./Skeleton-Bbwws2TW.js";import{A as M}from"./Alert-B0PlZ22k.js";import{A as ce}from"./Add-DVSzZFqo.js";import{E as Ge}from"./Edit-DZXLPxIL.js";import{D as Ne,a as Te,b as Le}from"./DialogTitle-DZV4uxxi.js";import{S as Ue,F as fe}from"./FormControlLabel-DYiTaYb8.js";import{D as qe}from"./DialogActions-D90oLR6G.js";import{l as Ve}from"./locationApi-JCISdFAH.js";import{A as Ke}from"./AttachMoney-UuV8YAlH.js";import{S as He}from"./Schedule-FJCplslI.js";function Je(r){return X("MuiFormGroup",r)}Y("MuiFormGroup",["root","row","error"]);const Qe=["className","row"],Ze=r=>{const{classes:t,row:o,error:n}=r;return te({root:["root",o&&"row",n&&"error"]},Je,t)},Xe=q("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(r,t)=>{const{ownerState:o}=r;return[t.root,o.row&&t.row]}})(({ownerState:r})=>E({display:"flex",flexDirection:"column",flexWrap:"wrap"},r.row&&{flexDirection:"row"})),Ye=s.forwardRef(function(t,o){const n=pe({props:t,name:"MuiFormGroup"}),{className:p,row:g=!1}=n,k=ee(n,Qe),v=Ce(),m=ke({props:n,muiFormControl:v,states:["error"]}),b=E({},n,{row:g,error:m.error}),y=Ze(b);return e.jsx(Xe,E({className:re(y.root,p),ownerState:b,ref:o},k))}),er=he(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),rr=he(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),tr=q("span",{name:"MuiRadioButtonIcon",shouldForwardProp:xe})({position:"relative",display:"flex"}),ar=q(er,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),nr=q(rr,{name:"MuiRadioButtonIcon"})(({theme:r,ownerState:t})=>E({left:0,position:"absolute",transform:"scale(0)",transition:r.transitions.create("transform",{easing:r.transitions.easing.easeIn,duration:r.transitions.duration.shortest})},t.checked&&{transform:"scale(1)",transition:r.transitions.create("transform",{easing:r.transitions.easing.easeOut,duration:r.transitions.duration.shortest})}));function ye(r){const{checked:t=!1,classes:o={},fontSize:n}=r,p=E({},r,{checked:t});return e.jsxs(tr,{className:o.root,ownerState:p,children:[e.jsx(ar,{fontSize:n,className:o.background,ownerState:p}),e.jsx(nr,{fontSize:n,className:o.dot,ownerState:p})]})}const ve=s.createContext(void 0);function or(){return s.useContext(ve)}function sr(r){return X("MuiRadio",r)}const le=Y("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),ir=["checked","checkedIcon","color","icon","name","onChange","size","className"],cr=r=>{const{classes:t,color:o,size:n}=r,p={root:["root",`color${H(o)}`,n!=="medium"&&`size${H(n)}`]};return E({},t,te(p,sr,t))},lr=q(Ue,{shouldForwardProp:r=>xe(r)||r==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(r,t)=>{const{ownerState:o}=r;return[t.root,o.size!=="medium"&&t[`size${H(o.size)}`],t[`color${H(o.color)}`]]}})(({theme:r,ownerState:t})=>E({color:(r.vars||r).palette.text.secondary},!t.disableRipple&&{"&:hover":{backgroundColor:r.vars?`rgba(${t.color==="default"?r.vars.palette.action.activeChannel:r.vars.palette[t.color].mainChannel} / ${r.vars.palette.action.hoverOpacity})`:we.alpha(t.color==="default"?r.palette.action.active:r.palette[t.color].main,r.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},t.color!=="default"&&{[`&.${le.checked}`]:{color:(r.vars||r).palette[t.color].main}},{[`&.${le.disabled}`]:{color:(r.vars||r).palette.action.disabled}}));function dr(r,t){return typeof t=="object"&&t!==null?r===t:String(r)===String(t)}const de=e.jsx(ye,{checked:!0}),ue=e.jsx(ye,{}),be=s.forwardRef(function(t,o){var n,p;const g=pe({props:t,name:"MuiRadio"}),{checked:k,checkedIcon:v=de,color:m="primary",icon:b=ue,name:y,onChange:x,size:c="medium",className:S}=g,I=ee(g,ir),f=E({},g,{color:m,size:c}),w=cr(f),$=or();let j=k;const F=Se(x,$&&$.onChange);let R=y;return $&&(typeof j>"u"&&(j=dr($.value,g.value)),typeof R>"u"&&(R=$.name)),e.jsx(lr,E({type:"radio",icon:s.cloneElement(b,{fontSize:(n=ue.props.fontSize)!=null?n:c}),checkedIcon:s.cloneElement(v,{fontSize:(p=de.props.fontSize)!=null?p:c}),ownerState:f,classes:w,name:R,checked:j,onChange:F,ref:o,className:re(w.root,S)},I))});function ur(r){return X("MuiRadioGroup",r)}Y("MuiRadioGroup",["root","row","error"]);const pr=["actions","children","className","defaultValue","name","onChange","value"],hr=r=>{const{classes:t,row:o,error:n}=r;return te({root:["root",o&&"row",n&&"error"]},ur,t)},je=s.forwardRef(function(t,o){const{actions:n,children:p,className:g,defaultValue:k,name:v,onChange:m,value:b}=t,y=ee(t,pr),x=s.useRef(null),c=hr(t),[S,I]=Re({controlled:b,default:k,name:"RadioGroup"});s.useImperativeHandle(n,()=>({focus:()=>{let j=x.current.querySelector("input:not(:disabled):checked");j||(j=x.current.querySelector("input:not(:disabled)")),j&&j.focus()}}),[]);const f=Ie(o,x),w=$e(v),$=s.useMemo(()=>({name:w,onChange(j){I(j.target.value),m&&m(j,j.target.value)},value:S}),[w,m,I,S]);return e.jsx(ve.Provider,{value:$,children:e.jsx(Ye,E({role:"radiogroup",ref:f,className:re(c.root,g)},y,{children:p}))})});function xr({items:r,subtotal:t,shippingCost:o,total:n,onCreateOrder:p,creatingOrder:g,disabled:k,selectedPaymentMethod:v,selectedShippingMethod:m}){J();const{formatPrice:b}=ae(),y=c=>{switch(c){case"biteship":return"ðŸšš Biteship";case"fedex":return"ðŸ“¦ FedEx";case"fedex-estimated":return"ðŸ“¦ FedEx (Est.)";case"indonesia-estimated":return"ðŸ‡®ðŸ‡© Indonesia (Est.)";default:return"ðŸ“¦ Shipping"}},x=c=>{switch(c){case"biteship":return"primary";case"fedex":return"error";case"fedex-estimated":return"warning";case"indonesia-estimated":return"info";default:return"default"}};return e.jsx(N,{sx:{position:"sticky",top:24,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:"none"},children:e.jsxs(T,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:3,color:"text.primary"},children:"Ringkasan Pesanan"}),e.jsxs(u,{sx:{mb:3},children:[e.jsxs(i,{variant:"subtitle1",fontWeight:600,sx:{mb:2},children:["Item (",r.length,")"]}),e.jsx(U,{spacing:2,children:r.map(c=>{const S=c.product_variant.product.product_images?.[0]?.image_name;return e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:2,p:2,borderRadius:2,backgroundColor:"grey.50"},children:[e.jsx(Fe,{src:S||`https://placehold.co/50x50/9682DB/FFFFFF/png?text=${encodeURIComponent(c.product_variant.product.name.substring(0,10))}`,alt:c.product_variant.product.name,sx:{width:50,height:50,borderRadius:2,flexShrink:0,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},variant:"rounded",children:e.jsx(Pe,{})}),e.jsxs(u,{sx:{flex:1,minWidth:0},children:[e.jsx(i,{variant:"subtitle2",fontWeight:600,sx:{mb:.5,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:c.product_variant.product.name,children:c.product_variant.product.name}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:c.product_variant.variant_name}),e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:["Qty: ",c.quantity]})]}),e.jsx(i,{variant:"body2",fontWeight:600,color:"primary.main",sx:{fontSize:"0.9rem"},children:b(parseFloat(c.product_variant.price)*c.quantity)})]},c.id)})})]}),e.jsx(oe,{sx:{my:2}}),e.jsxs(U,{spacing:2,children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[e.jsx(i,{variant:"body1",fontWeight:500,children:"Subtotal"}),e.jsx(i,{variant:"body1",fontWeight:600,children:b(t)})]}),e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[e.jsxs(u,{children:[e.jsx(i,{variant:"body1",fontWeight:500,children:"Biaya Pengiriman"}),m&&e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsxs(i,{variant:"body2",color:"text.secondary",children:[m.courier_name," - ",m.courier_service_name]}),m.provider&&e.jsx(L,{label:y(m.provider),size:"small",color:x(m.provider),variant:"outlined"})]})]}),e.jsx(i,{variant:"body1",fontWeight:600,children:b(o)})]}),e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"primary.main",borderRadius:2,color:"white"},children:[e.jsx(i,{variant:"h6",fontWeight:600,children:"Total"}),e.jsx(i,{variant:"h6",fontWeight:700,children:b(n)})]})]}),e.jsx(oe,{sx:{my:3}}),e.jsx(G,{variant:"contained",size:"large",startIcon:e.jsx(We,{}),onClick:p,disabled:k||g,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:600,fontSize:"1rem",backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"},"&:disabled":{backgroundColor:"grey.300",color:"grey.500"}},children:g?"Membuat Order...":"Buat Order & Bayar"}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:2,textAlign:"center"},children:"Dengan melanjutkan, Anda menyetujui syarat dan ketentuan kami"})]})})}function mr({selectedAddress:r,onAddressSelect:t,onAddressesLoaded:o}){const n=J(),p=me(),[g,k]=s.useState([]),[v,m]=s.useState(null),[b,y]=s.useState(!0),[x,c]=s.useState(null),[S,I]=s.useState(!1),[f,w]=s.useState(null),$=s.useRef(t),j=s.useRef(o);s.useEffect(()=>{$.current=t,j.current=o},[t,o]),s.useEffect(()=>{(async()=>{try{y(!0),c(null);const _=await Oe.getAddresses();if(_.success){k(_.data),j.current?.(_.data);const O=_.data.find(A=>A.is_primary);if(O)if(m(O),!r)$.current(O.id);else{const A=_.data.find(W=>W.id===r);A&&m(A)}}else c("Gagal memuat alamat")}catch(_){console.error("Error fetching addresses:",_),c(_.response?.data?.error||"Gagal memuat alamat")}finally{y(!1)}})()},[]),s.useEffect(()=>{if(r&&g.length>0){const h=g.find(_=>_.id===r);h&&m(h)}},[r,g]);const F=()=>{p("/addresses/add",{state:{returnTo:"/checkout"}})},R=()=>{w(r),I(!0)},P=()=>{I(!1),w(null)},D=()=>{if(f){const h=g.find(_=>_.id===f);h&&(m(h),t(f))}P()};return b?e.jsx(N,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(T,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:2,color:"text.primary"},children:"Alamat Pengiriman"}),e.jsx(U,{spacing:2,children:[...Array(2)].map((h,_)=>e.jsx(Ae,{variant:"rectangular",height:80,sx:{borderRadius:2}},_))})]})}):g.length===0?e.jsx(N,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(T,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:2,color:"text.primary"},children:"Alamat Pengiriman"}),e.jsx(M,{severity:"info",sx:{mb:2,borderRadius:2},children:"Anda belum memiliki alamat pengiriman. Silakan tambahkan alamat terlebih dahulu."}),e.jsx(G,{variant:"contained",startIcon:e.jsx(ce,{}),onClick:F,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:600,backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:"Tambah Alamat"})]})}):v?e.jsxs(e.Fragment,{children:[e.jsx(N,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(T,{sx:{p:3},children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{color:"text.primary"},children:"Alamat Pengiriman"}),e.jsx(G,{variant:"outlined",size:"small",startIcon:e.jsx(Ge,{}),onClick:R,sx:{borderRadius:2,fontWeight:500,borderColor:"primary.main",color:"primary.main","&:hover":{backgroundColor:"primary.light",borderColor:"primary.dark"}},children:"Ganti Alamat"})]}),x&&e.jsx(M,{severity:"error",sx:{mb:2,borderRadius:2},onClose:()=>c(null),children:x}),e.jsx(u,{sx:{p:2,border:`2px solid ${n.palette.primary.main}`,borderRadius:2,backgroundColor:n.palette.primary.light+"10",transition:"all 0.2s ease"},children:e.jsxs(U,{direction:"row",spacing:2,alignItems:"flex-start",children:[e.jsx(se,{color:"primary",sx:{mt:.5,flexShrink:0}}),e.jsxs(u,{sx:{flex:1},children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,children:v.address_line}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[v.city,", ",v.province," ",v.postal_code]}),e.jsx(L,{label:"Utama",size:"small",sx:{mt:1,backgroundColor:n.palette.primary.main,color:"white",fontSize:"0.75rem",fontWeight:600,height:24}})]})]})})]})}),e.jsxs(Ne,{open:S,onClose:P,maxWidth:"sm",fullWidth:!0,children:[e.jsx(Te,{children:e.jsx(i,{variant:"h6",fontWeight:600,children:"Pilih Alamat Pengiriman"})}),e.jsx(Le,{children:e.jsx(ge,{component:"fieldset",fullWidth:!0,children:e.jsx(je,{value:f||"",onChange:h=>w(h.target.value),children:g.map(h=>e.jsx(fe,{value:h.id,control:e.jsx(be,{}),label:e.jsx(u,{sx:{p:2,border:f===h.id?`2px solid ${n.palette.primary.main}`:`1px solid ${n.palette.grey[200]}`,borderRadius:2,backgroundColor:f===h.id?n.palette.primary.light+"10":"grey.50",transition:"all 0.2s ease",width:"100%","&:hover":{backgroundColor:f===h.id?n.palette.primary.light+"15":"grey.100"}},children:e.jsxs(U,{direction:"row",spacing:2,alignItems:"flex-start",children:[e.jsx(se,{color:"primary",sx:{mt:.5,flexShrink:0}}),e.jsxs(u,{sx:{flex:1},children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,children:h.address_line}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[h.city,", ",h.province," ",h.postal_code]}),h.is_primary&&e.jsx(L,{label:"Utama",size:"small",sx:{mt:1,backgroundColor:n.palette.primary.main,color:"white",fontSize:"0.75rem",fontWeight:600,height:24}})]})]})}),sx:{width:"100%",margin:0,mb:2,"& .MuiFormControlLabel-label":{width:"100%"}}},h.id))})})}),e.jsxs(qe,{sx:{p:2},children:[e.jsx(G,{onClick:P,variant:"outlined",children:"Batal"}),e.jsx(G,{onClick:D,variant:"contained",disabled:!f,children:"Pilih"})]})]})]}):e.jsx(N,{sx:{borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsxs(T,{sx:{p:3},children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:2,color:"text.primary"},children:"Alamat Pengiriman"}),e.jsx(M,{severity:"warning",sx:{mb:2,borderRadius:2},children:"Tidak ada alamat utama. Silakan set alamat utama terlebih dahulu."}),e.jsx(G,{variant:"contained",startIcon:e.jsx(ce,{}),onClick:F,fullWidth:!0,sx:{py:1.5,borderRadius:2,fontWeight:600,backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:"Tambah Alamat"})]})})}const gr={getShippingRates:async r=>{try{const t=await K.post("/shipping/rates",r);return{success:!0,data:t.data.data,provider:t.data.provider,origin_country:t.data.origin_country,destination_country:t.data.destination_country}}catch(t){return{success:!1,error:t.response?.data?.error||"Failed to fetch shipping rates"}}},getAreas:async(r={})=>{try{return{success:!0,data:(await K.get("/shipping/areas",{params:r})).data.data}}catch(t){return{success:!1,error:t.response?.data?.error||"Failed to fetch areas"}}},trackShipment:async(r,t)=>{try{const o=t?{courier:t}:{},n=await K.get(`/shipping/track/${r}`,{params:o});return{success:!0,data:n.data.data,provider:n.data.provider}}catch(o){return{success:!1,error:o.response?.data?.error||"Failed to track shipment"}}},trackFedExShipment:async r=>{try{const t=await K.get(`/shipping/track/fedex/${r}`);return{success:!0,data:t.data.data,provider:t.data.provider}}catch(t){return{success:!1,error:t.response?.data?.error||"Failed to track FedEx shipment"}}}};function fr(r,t){const[o,n]=s.useState(r);return s.useEffect(()=>{const p=setTimeout(()=>{n(r)},t);return()=>{clearTimeout(p)}},[r,t]),o}const yr=r=>{const o=r.trim().replace(/\s*days?\s*$/i,"").split(/\s*-\s*/),n=parseInt(o[0],10),p=o.length>1?parseInt(o[1],10):n;return{min_day:isNaN(n)?1:n,max_day:isNaN(p)?n||3:p}},vr=r=>{const t=yr(r.shipment_duration_range||r.duration||"1 - 3");let o="standard";return r.service_type==="overnight"?o="overnight":r.service_type==="express"?o="express":r.service_type==="economy"&&(o="economy"),{courier_name:r.courier_name||r.company||"",courier_code:r.courier_code||r.company||"",courier_service_name:r.courier_service_name||"",courier_service_code:r.courier_service_code||r.type||"",service_type:o,description:r.description||"",shipping_type:r.shipping_type||"parcel",ship_type:r.shipping_type||"parcel",service_name:r.courier_service_name||"",price:r.price||r.shipping_fee||0,currency:r.currency||"IDR",type:r.type||r.courier_service_code||"",min_day:t.min_day,max_day:t.max_day,provider:"biteship"}};function br({selectedAddress:r,cartItems:t,selectedMethod:o,onMethodSelect:n}){const p=J(),{formatPrice:g}=ae(),[k,v]=s.useState([]),[m,b]=s.useState(!1),[y,x]=s.useState(null),[c,S]=s.useState(null),[I,f]=s.useState(null),[w,$]=s.useState(""),[j,F]=s.useState(!1),R=B.useMemo(()=>t.map(a=>({name:a.product_variant.product.name,description:a.product_variant.product.description||"",length:a.product_variant.product.length||10,width:a.product_variant.product.width||10,height:a.product_variant.product.height||1,weight:a.product_variant.product.weight||a.product_variant.weight||1e3,quantity:a.quantity,value:a.product_variant.price*a.quantity})),[t]),P=B.useMemo(()=>r?`${r.id}_${r.country}_${r.postal_code}`:null,[r?.id,r?.country,r?.postal_code]),D=B.useMemo(()=>R.reduce((a,d)=>a+d.weight*d.quantity,0),[R]),h=B.useMemo(()=>!r||t.length===0?null:`${P}_${D}_${R.length}`,[P,D,R.length,t.length]);fr(h,500),s.useEffect(()=>{(async()=>{try{const d=await Ve.getActiveOriginLocation();d.success&&d.data&&f(d.data)}catch(d){console.error("Failed to fetch active origin:",d)}})()},[]),s.useEffect(()=>{(async()=>{if(!r||!I||t.length===0){v([]),x(null);return}const d=`${r.id}_${r.postal_code}_${D}_${R.length}`;if(d!==c)try{b(!0),x(null),S(d);const C=await gr.getShippingRates({origin_postal_code:I.postal_code,destination_postal_code:r.postal_code,origin_country:"ID",destination_country:r.country,items:R});if(d===c||!c)if(C.success&&C.data){const V=(C.data.pricing||[]).map(Q=>vr(Q));v(V),$(C.provider||""),F(r.country!=="ID")}else x(C.error||"Failed to fetch shipping rates"),v([])}catch(C){(d===c||!c)&&(x(C.message||"Failed to fetch shipping rates"),v([]))}finally{b(!1)}})()},[r,I,t.length,D,R.length]),B.useEffect(()=>()=>{b(!1),x(null)},[]);const _=(a,d)=>a===d?`${a} hari`:`${a}-${d} hari`,O=a=>{switch(a){case"express":case"overnight":return"error";case"standard":return"primary";case"economy":return"success";default:return"default"}},A=a=>{switch(a){case"express":return"Express";case"standard":return"Standard";case"economy":return"Economy";case"overnight":return"Overnight";default:return a}},W=a=>{switch(a){case"biteship":return{name:"Biteship",color:"primary",icon:"ðŸšš"};case"fedex":return{name:"FedEx",color:"error",icon:"ðŸ“¦"};case"fedex-estimated":return{name:"FedEx (Estimated)",color:"warning",icon:"ðŸ“¦"};case"indonesia-estimated":return{name:"Indonesia (Estimated)",color:"info",icon:"ðŸ‡®ðŸ‡©"};default:return{name:"Shipping",color:"default",icon:"ðŸ“¦"}}};return r?e.jsx(N,{children:e.jsxs(T,{children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ze,{sx:{fontSize:"1.5rem",mr:1,color:"primary.main"}}),e.jsx(i,{variant:"h6",fontWeight:600,children:"Pilih Metode Pengiriman"})]}),w&&e.jsx(L,{label:`${W(w).icon} ${W(w).name}`,color:W(w).color,size:"small",variant:"outlined"})]}),e.jsxs(u,{sx:{mb:3,p:2,backgroundColor:"grey.50",borderRadius:2},children:[e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Alamat Pengiriman:"}),e.jsx(i,{variant:"body1",fontWeight:500,children:r.recipient_name}),e.jsx(i,{variant:"body2",color:"text.secondary",children:r.address_line}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[r.city,", ",r.province," ",r.postal_code]}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[r.country==="ID"?"ðŸ‡®ðŸ‡© Indonesia":`ðŸŒ ${r.country}`,j&&e.jsx(L,{label:"Internasional",size:"small",color:"warning",variant:"outlined",sx:{ml:1,fontSize:"0.7rem"}})]})]}),m&&e.jsxs(u,{sx:{display:"flex",justifyContent:"center",py:3},children:[e.jsx(Me,{size:24}),e.jsx(i,{variant:"body2",sx:{ml:2},children:"Mencari opsi pengiriman..."})]}),y&&e.jsxs(M,{severity:"error",sx:{mb:3},children:[y,e.jsx(G,{size:"small",onClick:()=>{S(null),x(null)},sx:{ml:2},children:"Coba Lagi"})]}),!m&&!y&&k.length>0&&e.jsxs(ge,{component:"fieldset",fullWidth:!0,children:[e.jsx(Ee,{component:"legend",sx:{mb:2,fontWeight:600},children:"Pilih Metode Pengiriman"}),e.jsx(je,{value:o||"",onChange:a=>{const d=k.find(C=>`${C.courier_code}_${C.courier_service_code}`===a.target.value);d&&n(d)},children:e.jsx(U,{spacing:2,children:k.map(a=>{const d=`${a.courier_code}_${a.courier_service_code}`,C=o===d;return e.jsx(N,{sx:{border:C?`2px solid ${p.palette.primary.main}`:"1px solid",borderColor:C?"primary.main":"grey.300",backgroundColor:C?"primary.light":"white",transition:"all 0.2s ease",cursor:"pointer","&:hover":{borderColor:"primary.main",backgroundColor:"primary.light"}},onClick:()=>{`${a.courier_code}${a.courier_service_code}`,n(a)},children:e.jsxs(T,{sx:{p:2},children:[e.jsx(fe,{value:d,control:e.jsx(be,{}),label:"",sx:{m:0}}),e.jsxs(u,{sx:{ml:4},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:1,flexWrap:"wrap",gap:1},children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,children:a.courier_name}),e.jsx(L,{label:A(a.service_type),color:O(a.service_type),size:"small"}),a.provider&&a.provider!==w&&e.jsx(L,{label:`${W(a.provider).icon} ${W(a.provider).name}`,color:W(a.provider).color,size:"small",variant:"outlined"})]}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:2},children:a.description}),e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:3},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ke,{sx:{fontSize:"1rem",mr:.5,color:"success.main"}}),e.jsx(i,{variant:"h6",fontWeight:600,color:"success.main",children:g(a.price,a.currency||"IDR")})]}),e.jsxs(u,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(He,{sx:{fontSize:"1rem",mr:.5,color:"text.secondary"}}),e.jsx(i,{variant:"body2",color:"text.secondary",children:_(a.min_day,a.max_day)})]})]})]})]})},d)})})})]}),!m&&!y&&k.length===0&&e.jsx(M,{severity:"warning",children:"Tidak ada opsi pengiriman tersedia untuk alamat inii"})]})}):e.jsx(N,{children:e.jsx(T,{children:e.jsx(M,{severity:"info",children:"Pilih alamat pengiriman terlebih dahulu untuk melihat opsi pengiriman"})})})}function Br(){J();const r=me(),{loading:t,error:o}=ae(),[n,p]=s.useState(!0),[g,k]=s.useState(!1),[v,m]=s.useState(!1),[b,y]=s.useState(null),[x,c]=s.useState(null),[S,I]=s.useState(null),[f,w]=s.useState([]),[$,j]=s.useState("midtrans"),[F,R]=s.useState(null),[P,D]=s.useState(15e3),{items:h,clearCart:_,syncWithServer:O}=De(),{addOrder:A,setPaymentMethods:W,paymentMethods:a}=Be(),d=B.useMemo(()=>h.filter(l=>l.product_variant.product.deleted_at===null),[h]),C=B.useMemo(()=>d.reduce((l,z)=>l+parseFloat(z.product_variant.price)*z.quantity,0),[d]),ne=B.useMemo(()=>C+P,[C,P]),V=B.useCallback(async()=>{try{const l=await ie.getPaymentMethods();l.success&&W(l.data)}catch(l){console.error("Error fetching payment methods:",l)}},[W]),Q=async()=>{if(!x){y("Pilih alamat pengiriman terlebih dahulu");return}if(d.length===0){y("Tidak ada item yang tersedia untuk checkout");return}try{k(!0),y(null);const l=await ie.createOrder({address_id:x,shipping_cost:P});l.success&&(A(l.data),m(!0),_(),r(`/orders/${l.data.order_id}`,{state:{message:"Order berhasil dibuat! Silakan lakukan pembayaran.",selectedPaymentMethod:$}}))}catch(l){console.error("Error creating order:",l),y(l.response?.data?.error||"Gagal membuat order")}finally{k(!1)}};return s.useEffect(()=>{(async()=>{try{await O()}catch(z){console.error("Error syncing cart:",z)}})()},[O]),s.useEffect(()=>{if(h.length===0&&!g&&!v&&!n){r("/cart");return}a.length===0&&V(),n&&p(!1)},[h.length,r,g,v,V,a.length,n]),s.useEffect(()=>{if(x&&f.length>0){const l=f.find(z=>z.id===x);l&&(!S||S.id!==l.id)&&I(l)}else if(!x&&f.length>0&&!S){const l=f.find(z=>z.is_primary)||f[0];l&&(c(l.id),I(l))}},[x,f,S]),n?e.jsx(u,{sx:{minHeight:"100vh",py:4},children:e.jsx(Z,{maxWidth:"xl",children:e.jsx(i,{children:"Loading..."})})}):d.length===0?e.jsx(u,{sx:{minHeight:"100vh",py:4},children:e.jsxs(Z,{maxWidth:"xl",children:[e.jsx(M,{severity:"warning",sx:{mb:4},children:"Tidak ada item yang tersedia untuk checkout. Semua item di keranjang sudah tidak tersedia."}),e.jsx(G,{variant:"contained",onClick:()=>r("/cart"),children:"Kembali ke Keranjang"})]})}):e.jsx(u,{sx:{minHeight:"100vh",py:4},children:e.jsxs(Z,{maxWidth:"xl",children:[e.jsxs(u,{sx:{mb:3},children:[e.jsx(i,{variant:"h4",fontWeight:600,sx:{mb:1,color:"text.primary"},children:"Checkout"}),e.jsx(i,{variant:"body1",color:"text.secondary",children:"Lengkapi informasi pengiriman dan pembayaran"})]}),b&&e.jsx(M,{severity:"error",sx:{mb:4},onClose:()=>y(null),children:b}),t&&e.jsx(M,{severity:"info",sx:{mb:2},children:"Loading exchange rates..."}),o&&e.jsx(M,{severity:"warning",sx:{mb:2},children:"Failed to load exchange rates. Prices will be displayed in default currency."}),e.jsxs(u,{sx:{display:"flex",flexDirection:{xs:"column",lg:"row"},gap:4,alignItems:"flex-start"},children:[e.jsx(u,{sx:{flex:1,minWidth:0,order:{xs:1,lg:1}},children:e.jsxs(U,{spacing:4,children:[e.jsx(mr,{selectedAddress:x,onAddressSelect:l=>{c(l);const z=f.find(_e=>_e.id===l);z&&I(z),R(null),D(15e3)},onAddressesLoaded:l=>{w(l)}}),e.jsx(br,{selectedAddress:S,cartItems:d,selectedMethod:F?`${F.courier_code}_${F.courier_service_code}`:null,onMethodSelect:l=>{R(l),D(l.price)}})]})}),e.jsx(u,{sx:{width:{xs:"100%",lg:"400px"},flexShrink:0,order:{xs:2,lg:2}},children:e.jsx(xr,{items:d,subtotal:C,shippingCost:P,total:ne,onCreateOrder:Q,creatingOrder:g,disabled:!x||!F,selectedPaymentMethod:$,selectedShippingMethod:F})})]})]})})}export{Br as default};
