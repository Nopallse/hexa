import{r as l,j as e,P as R,T as h,B as t,b as w,R as Y,aq as J,e as P,i as F,h as D,y as Q,F as S,z as T,E as W,M as k,x as X,a as ee,ar as ae,Y as re,C as te}from"./index-BNHkdQXN.js";import{p as B}from"./productApi-DD1g0Rr2.js";import{c as se}from"./categoryApi-BM3YVwSW.js";import{g as ie}from"./image-CL12PwSa.js";import{D as ne}from"./RestoreFromTrash-DyrBZHsy.js";import{T as le,a as oe,b as ce,c as M,d as c,e as de}from"./TableRow-B4eIPwcd.js";import{T as A}from"./Tooltip-B_Lp-BkP.js";import{V as he}from"./Visibility-pX7bN8d5.js";import{E as ue}from"./Edit-jAiCsqyQ.js";import{D as xe}from"./Delete-C5OGYaUx.js";import{D as me,a as ge,b as pe}from"./DialogTitle-CzRdnrxR.js";import{A as H}from"./Alert-CGwzUP-j.js";import{D as je}from"./DialogActions-Bz3wEnKU.js";import{F as fe}from"./FilterList-BlCgivxD.js";import{A as ve}from"./Add-AYyC_BLZ.js";import{T as be}from"./TablePagination-Db_fT23d.js";import"./KeyboardArrowRight-CkSo5XDM.js";import"./LastPage-DHkSoxah.js";function ye({products:x,isLoading:C=!1,onEdit:d,onDelete:I,onView:s,onViewDeleted:j}){const[o,m]=l.useState({open:!1,product:null,loading:!1}),g=a=>{m({open:!0,product:a,loading:!1})},y=async()=>{if(o.product){m(a=>({...a,loading:!0}));try{await I(o.product.id),m({open:!1,product:null,loading:!1})}catch{m(u=>({...u,loading:!1}))}}},f=()=>{m({open:!1,product:null,loading:!1})},v=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a),p=a=>a.product_images&&a.product_images.length>0?a.product_images.find(i=>i.is_primary)||a.product_images[0]:null;return x.length===0&&!C?e.jsxs(R,{sx:{p:4,textAlign:"center"},children:[e.jsx(h,{variant:"h6",color:"textSecondary",children:"Belum ada produk"}),e.jsx(h,{variant:"body2",color:"textSecondary",children:"Tambah produk pertama untuk mulai menjual"})]}):e.jsxs(e.Fragment,{children:[j&&e.jsx(t,{sx:{mb:2,display:"flex",justifyContent:"flex-end"},children:e.jsx(w,{variant:"outlined",startIcon:e.jsx(ne,{}),onClick:j,color:"secondary",children:"Lihat Produk Dihapus"})}),e.jsx(le,{component:R,children:e.jsxs(oe,{children:[e.jsx(ce,{children:e.jsxs(M,{children:[e.jsx(c,{children:"Gambar"}),e.jsx(c,{children:"Nama Produk"}),e.jsx(c,{children:"Kategori"}),e.jsx(c,{align:"right",children:"Harga"}),e.jsx(c,{align:"center",children:"Stok"}),e.jsx(c,{align:"center",children:"Info Varian"}),e.jsx(c,{align:"center",children:"Aksi"})]})}),e.jsx(de,{children:x.map(a=>{const u=p(a);return e.jsxs(M,{hover:!0,children:[e.jsx(c,{children:e.jsx(Y,{src:ie(u?.image_name),variant:"rounded",sx:{width:56,height:56},children:e.jsx(J,{})})}),e.jsx(c,{children:e.jsxs(t,{children:[e.jsx(h,{variant:"subtitle2",fontWeight:"medium",gutterBottom:!0,children:a.name}),e.jsx(h,{variant:"body2",color:"textSecondary",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a.description||"-"})]})}),e.jsx(c,{children:e.jsx(P,{label:a.category?.name||"Tidak ada kategori",size:"small",color:"primary",variant:"outlined"})}),e.jsx(c,{align:"right",children:a.product_variants&&a.product_variants.length>0?e.jsx(t,{sx:{textAlign:"right"},children:e.jsxs(h,{variant:"body1",fontWeight:"medium",color:"primary",children:[v(Math.min(...a.product_variants.map(i=>parseFloat(i.price))))," - ",v(Math.max(...a.product_variants.map(i=>parseFloat(i.price))))]})}):e.jsx(h,{variant:"body1",fontWeight:"medium",children:v(parseFloat(a.price||"0"))})}),e.jsx(c,{align:"center",children:a.product_variants&&a.product_variants.length>0?e.jsx(t,{sx:{display:"flex",flexDirection:"column",gap:.5,alignItems:"center"},children:e.jsx(P,{label:`Total: ${a.product_variants.reduce((i,b)=>i+(b.stock||0),0)}`,size:"small",color:a.product_variants.reduce((i,b)=>i+(b.stock||0),0)>0?"success":"error",variant:a.product_variants.reduce((i,b)=>i+(b.stock||0),0)>0?"filled":"outlined"})}):e.jsx(P,{label:a.stock||0,size:"small",color:(a.stock||0)>0?"success":"error",variant:(a.stock||0)>0?"filled":"outlined"})}),e.jsx(c,{align:"center",children:a.product_variants&&a.product_variants.length>0?e.jsx(t,{sx:{display:"flex",flexDirection:"column",gap:.5,alignItems:"center"},children:e.jsx(P,{label:`${a.product_variants.length} Varian`,size:"small",color:"primary",variant:"filled",sx:{fontWeight:"bold"}})}):e.jsx(P,{label:"Tidak Ada Varian",size:"small",color:"default",variant:"outlined",sx:{fontSize:"0.7rem"}})}),e.jsx(c,{align:"center",children:e.jsxs(t,{sx:{display:"flex",justifyContent:"center",gap:.5},children:[e.jsx(A,{title:"Lihat Detail",children:e.jsx(F,{size:"small",onClick:()=>s(a),color:"info",children:e.jsx(he,{fontSize:"small"})})}),e.jsx(A,{title:"Edit Produk",children:e.jsx(F,{size:"small",onClick:()=>d(a),color:"primary",children:e.jsx(ue,{fontSize:"small"})})}),e.jsx(A,{title:"Hapus Produk",children:e.jsx(F,{size:"small",onClick:()=>g(a),color:"error",children:e.jsx(xe,{fontSize:"small"})})})]})})]},a.id)})})]})}),e.jsxs(me,{open:o.open,onClose:f,maxWidth:"sm",fullWidth:!0,children:[e.jsx(ge,{children:"Hapus Produk"}),e.jsxs(pe,{children:[e.jsx(H,{severity:"warning",sx:{mb:2},children:e.jsxs(h,{variant:"body2",children:["Anda yakin ingin menghapus produk ",e.jsx("strong",{children:o.product?.name}),"?"]})}),e.jsx(h,{variant:"body2",sx:{mt:2},children:"Produk akan dihapus secara soft delete dan dapat dipulihkan nanti."})]}),e.jsxs(je,{children:[e.jsx(w,{onClick:f,disabled:o.loading,children:"Batal"}),e.jsx(w,{onClick:y,color:"error",variant:"contained",disabled:o.loading,children:o.loading?"Menghapus...":"Hapus"})]})]})]})}function ke({onFilterChange:x,categories:C=[],loading:d=!1,initialFilters:I}){const[s,j]=l.useState({search:"",category:"",min_price:void 0,max_price:void 0,sort:"created_at",sortOrder:"desc",...I}),[o,m]=l.useState(!1),g=(a,u)=>{const i={...s,[a]:u};j(i),a!=="search"&&x(i)},y=a=>{const u={...s,search:a};j(u);const i=setTimeout(()=>{x(u)},500);return()=>clearTimeout(i)},f=()=>{const a={search:"",category:"",min_price:void 0,max_price:void 0,sort:"created_at",sortOrder:"desc"};j(a),x(a)},p=(()=>{let a=0;return s.search&&a++,s.category&&a++,s.min_price&&a++,s.max_price&&a++,s.sort!=="created_at"&&a++,s.sortOrder!=="desc"&&a++,a})();return e.jsxs(t,{sx:{mb:3},children:[e.jsxs(t,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[e.jsx(t,{sx:{flex:"1 1 300px",minWidth:200},children:e.jsx(D,{fullWidth:!0,placeholder:"Cari produk...",value:s.search||"",onChange:a=>y(a.target.value),InputProps:{startAdornment:e.jsx(Q,{sx:{mr:1,color:"text.secondary"}})},disabled:d})}),e.jsx(t,{sx:{flex:"1 1 200px",minWidth:150},children:e.jsxs(S,{fullWidth:!0,disabled:d,children:[e.jsx(T,{children:"Kategori"}),e.jsxs(W,{value:s.category||"",onChange:a=>g("category",a.target.value),label:"Kategori",children:[e.jsx(k,{value:"",children:"Semua Kategori"}),C.map(a=>e.jsx(k,{value:a.id,children:a.name},a.id))]})]})}),e.jsx(t,{sx:{flex:"1 1 150px",minWidth:120},children:e.jsxs(S,{fullWidth:!0,disabled:d,children:[e.jsx(T,{children:"Urutkan"}),e.jsxs(W,{value:s.sort||"created_at",onChange:a=>g("sort",a.target.value),label:"Urutkan",children:[e.jsx(k,{value:"name",children:"Nama"}),e.jsx(k,{value:"price",children:"Harga"}),e.jsx(k,{value:"created_at",children:"Tanggal Dibuat"})]})]})}),e.jsx(t,{sx:{flex:"1 1 150px",minWidth:120},children:e.jsxs(S,{fullWidth:!0,disabled:d,children:[e.jsx(T,{children:"Urutan"}),e.jsxs(W,{value:s.sortOrder||"desc",onChange:a=>g("sortOrder",a.target.value),label:"Urutan",children:[e.jsx(k,{value:"asc",children:"A-Z / Terendah"}),e.jsx(k,{value:"desc",children:"Z-A / Tertinggi"})]})]})}),e.jsxs(t,{sx:{display:"flex",gap:1,flexShrink:0},children:[e.jsxs(w,{variant:"outlined",startIcon:e.jsx(fe,{}),onClick:()=>m(!o),disabled:d,children:["Filter",p>0&&e.jsx(P,{label:p,size:"small",color:"primary",sx:{ml:1,minWidth:20,height:20}})]}),p>0&&e.jsx(w,{variant:"outlined",startIcon:e.jsx(X,{}),onClick:f,disabled:d,color:"error",children:"Clear"})]})]}),o&&e.jsxs(t,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:[e.jsx(h,{variant:"subtitle2",gutterBottom:!0,children:"Filter Lanjutan"}),e.jsxs(t,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(t,{sx:{flex:"1 1 200px",minWidth:150},children:e.jsx(D,{fullWidth:!0,label:"Harga Minimum",type:"number",value:s.min_price||"",onChange:a=>g("min_price",a.target.value?Number(a.target.value):void 0),disabled:d,InputProps:{startAdornment:e.jsx(h,{sx:{mr:1},children:"Rp"})}})}),e.jsx(t,{sx:{flex:"1 1 200px",minWidth:150},children:e.jsx(D,{fullWidth:!0,label:"Harga Maksimum",type:"number",value:s.max_price||"",onChange:a=>g("max_price",a.target.value?Number(a.target.value):void 0),disabled:d,InputProps:{startAdornment:e.jsx(h,{sx:{mr:1},children:"Rp"})}})})]})]})]})}function Ne(){const x=ee(),{showNotification:C}=ae(),[d,I]=l.useState([]),[s,j]=l.useState([]),[o,m]=l.useState(!0),[g,y]=l.useState(null),[f,v]=l.useState(0),[p,a]=l.useState(10),[u,i]=l.useState(0),[b,L]=l.useState({}),_=l.useMemo(()=>b,[b]),z=async r=>{try{m(!0),y(null);const n=await B.getProducts({page:(f||0)+1,limit:p,...r});if(n.success)I(n.data),i(n.pagination?.total||0);else throw new Error("Failed to fetch products")}catch(n){y(n.message||"Gagal memuat data produk")}finally{m(!1)}},N=async()=>{try{const r=await se.getCategories();r.success&&j(r.data)}catch(r){console.error("Failed to fetch categories:",r)}};l.useEffect(()=>{z(_)},[f,p,_]),l.useEffect(()=>{N()},[]);const V=r=>{x(`/admin/products/${r.id}/edit`)},$=r=>{x(`/admin/products/${r.id}`)},O=async r=>{try{const n=await B.deleteProduct(r);if(n.success)C({type:"success",message:"Produk berhasil dihapus"}),await z(_);else throw new Error(n.message||"Failed to delete product")}catch(n){throw C({type:"error",message:n.message||"Gagal menghapus produk"}),n}},K=()=>{x("/admin/products/create")},U=()=>{x("/admin/products/deleted")},G=l.useCallback(r=>{L(r),v(0)},[]),Z=(r,n)=>{v(n)},q=r=>{a(parseInt(r.target.value,10)),v(0)};return o&&d.length===0?e.jsx(re,{message:"Memuat data produk..."}):e.jsxs(te,{maxWidth:!1,children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(t,{children:[e.jsx(h,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Kelola Produk"}),e.jsx(h,{variant:"body1",color:"textSecondary",children:"Kelola produk dan inventori toko Anda"})]}),e.jsx(w,{variant:"contained",startIcon:e.jsx(ve,{}),onClick:K,size:"large",children:"Tambah Produk"})]}),g&&e.jsx(H,{severity:"error",sx:{mb:3},onClose:()=>y(null),children:g}),e.jsx(ke,{onFilterChange:G,categories:s,loading:o,initialFilters:_}),e.jsx(ye,{products:d,isLoading:o,onEdit:V,onDelete:O,onView:$,onViewDeleted:U}),u>0&&e.jsx(be,{rowsPerPageOptions:[5,10,25,50],component:"div",count:u,rowsPerPage:p,page:f,onPageChange:Z,onRowsPerPageChange:q,labelRowsPerPage:"Baris per halaman:",labelDisplayedRows:({from:r,to:n,count:E})=>`${r}-${n} dari ${E!==-1?E:`lebih dari ${n}`}`})]})}export{Ne as default};
