import{c as ir,j as r,p as or,a1 as nr,q as lr,r as c,A as cr,B as a,C as S,t as C,T as s,v as x,F as p,a2 as dr,a3 as xr,D as mr,S as K,a4 as hr,I as U}from"./index-Idy1NCQZ.js";import{p as ur}from"./productApi-BW-ND5FK.js";import{c as pr}from"./cartApi-BK2buQ58.js";import{u as gr}from"./cartStore-Bc-LrXv6.js";import{a as q}from"./image-DX-k4_re.js";import{u as jr}from"./useCurrencyConversion-CyZkluwP.js";import{S as u}from"./Skeleton-DVt8M0jh.js";import{A as W}from"./Alert-Cw7awSGM.js";import{A as br}from"./ArrowBack-D5qFF9m1.js";import{C as I,a as w}from"./CardContent-5_xtjPDw.js";import{A as P}from"./Avatar-BJbDu4KS.js";import{F as fr}from"./Favorite-DmZDfXSp.js";const yr=ir(r.jsx("path",{d:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92"}),"Share");function $r(){const m=or(),{id:y}=nr(),A=lr(),{formatPrice:T,formatPriceRange:J}=jr(),[e,Q]=c.useState(null),[X,B]=c.useState(!0),[E,v]=c.useState(null),[g,h]=c.useState(null),[vr,kr]=c.useState(0),[V,z]=c.useState(1),[i,$]=c.useState(null),[L,G]=c.useState({}),[R,F]=c.useState(!1),{addItem:N,setLoading:_r,setError:j,error:H}=gr(),{user:Y}=cr(),Z=async()=>{if(y)try{B(!0),v(null);const t=await ur.getProductById(y);t.success?Q(t.data):v("Produk tidak ditemukan")}catch(t){console.error("Error fetching product:",t),v("Gagal memuat produk")}finally{B(!1)}},rr=async()=>{if(!e||!Y){A("/login");return}if(d&&!i){j("Pilih varian terlebih dahulu");return}try{F(!0),j(null);const t=d?i.id:e.id,n=await pr.addToCart({product_variant_id:t,quantity:V});n.success&&(N(n.data),console.log("Item added to cart successfully"),z(1))}catch(t){console.error("Error adding to cart:",t),j(t.response?.data?.error||"Gagal menambahkan ke keranjang")}finally{F(!1)}},er=()=>{e&&console.log("Add to wishlist:",e)},tr=()=>{e&&console.log("Share:",e)};c.useEffect(()=>{if(e){const t=k(e);h(t?t.image_name:null),$(null),G({})}},[e]);const ar=()=>{if(!e?.product_variants)return{};const t={};return e.product_variants.forEach(n=>{n.variant_options?.forEach(o=>{t[o.option_name]||(t[o.option_name]=[]),t[o.option_name].includes(o.option_value)||t[o.option_name].push(o.option_value)})}),t},sr=(t,n)=>{const o={...L,[t]:n};G(o);const l=e?.product_variants?.find(f=>f.variant_options?.every(D=>o[D.option_name]===D.option_value));if(l){if($(l),l.image)h(l.image);else if(l.display_image)h(l.display_image);else if(e){const f=k(e);h(f?f.image_name:null)}}},k=t=>t.product_images&&t.product_images.length>0?t.product_images.find(o=>o.is_primary)||t.product_images[0]:null;if(c.useEffect(()=>{Z()},[y]),X)return r.jsx(a,{sx:{minHeight:"100vh",py:4},children:r.jsxs(S,{maxWidth:!1,children:[r.jsx(u,{variant:"rectangular",height:400,sx:{mb:4,borderRadius:3}}),r.jsxs(a,{sx:{display:"flex",gap:4},children:[r.jsxs(a,{sx:{flex:1},children:[r.jsx(u,{variant:"text",height:48,sx:{mb:2}}),r.jsx(u,{variant:"text",height:24,sx:{mb:2}}),r.jsx(u,{variant:"text",height:32,sx:{mb:4}}),r.jsx(u,{variant:"rectangular",height:200})]}),r.jsx(a,{sx:{width:300},children:r.jsx(u,{variant:"rectangular",height:300,sx:{borderRadius:3}})})]})]})});if(E||!e)return r.jsx(a,{sx:{minHeight:"100vh",py:4},children:r.jsx(S,{maxWidth:!1,children:r.jsx(W,{severity:"error",sx:{maxWidth:600,mx:"auto"},children:E||"Produk tidak ditemukan"})})});const d=e.product_variants&&e.product_variants.length>0,b=k(e),M=g||(b?b.image_name:null),O=ar(),_=d?e.product_variants.reduce((t,n)=>t+n.stock,0):e.stock;return r.jsx(a,{sx:{minHeight:"100vh",py:4},children:r.jsxs(S,{maxWidth:"xl",children:[r.jsx(C,{startIcon:r.jsx(br,{}),onClick:()=>A(-1),sx:{mb:4},children:"Kembali"}),r.jsxs(a,{sx:{display:"flex",gap:3,flexWrap:"wrap"},children:[r.jsx(a,{sx:{flex:"1 1 300px",minWidth:300},children:r.jsx(I,{children:r.jsxs(w,{children:[r.jsx(s,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Galeri Gambar"}),M?r.jsx(a,{sx:{textAlign:"center",mb:2},children:r.jsx(P,{src:q(M),variant:"rounded",sx:{width:"100%",height:300,transition:"all 0.3s ease",boxShadow:2}})}):r.jsx(a,{sx:{textAlign:"center",mb:2},children:r.jsx(P,{variant:"rounded",sx:{width:"100%",height:300},children:e.name.charAt(0).toUpperCase()})}),e.product_images&&e.product_images.length>0?r.jsxs(a,{children:[r.jsxs(s,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:["Semua Gambar (",e.product_images.length,")"]}),r.jsx(a,{sx:{display:"flex",gap:1,flexWrap:"wrap",justifyContent:"center"},children:e.product_images.sort((t,n)=>(n.is_primary?1:0)-(t.is_primary?1:0)).map(t=>r.jsxs(a,{sx:{position:"relative"},onMouseEnter:()=>h(t.image_name),onMouseLeave:()=>h(b?b.image_name:null),children:[r.jsx(P,{src:q(t.image_name),variant:"rounded",sx:{width:70,height:70,cursor:"pointer",border:g===t.image_name?3:2,borderColor:g===t.image_name?"primary.main":"divider",transition:"all 0.2s ease",opacity:g===t.image_name?1:.7,"&:hover":{opacity:1,transform:"scale(1.05)",borderColor:"primary.main"}}}),t.is_primary&&r.jsx(x,{label:"Utama",size:"small",color:"primary",sx:{position:"absolute",bottom:-8,left:"50%",transform:"translateX(-50%)",fontSize:"0.65rem",height:16,"& .MuiChip-label":{px:.5}}})]},t.id))})]}):r.jsx(W,{severity:"info",sx:{mt:2},children:"Belum ada gambar produk"})]})})}),r.jsx(a,{sx:{flex:"2 1 500px",minWidth:500},children:r.jsx(I,{children:r.jsxs(w,{children:[r.jsxs(a,{sx:{mb:3},children:[r.jsx(s,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:e.name}),e.product_variants&&e.product_variants.length>0?r.jsxs(a,{children:[r.jsx(s,{variant:"h4",color:"primary",fontWeight:"bold",children:J(e.product_variants)}),r.jsxs(s,{variant:"body2",color:"textSecondary",children:["Total Stok: ",e.total_stock||0," unit"]})]}):r.jsx(s,{variant:"h4",color:"primary",fontWeight:"bold",children:T(Number(e.price))})]}),r.jsx(p,{sx:{mb:3}}),r.jsxs(a,{sx:{mb:3},children:[r.jsx(s,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Deskripsi"}),r.jsx(s,{variant:"body1",color:"textSecondary",children:e.description||"Tidak ada deskripsi"})]}),r.jsx(p,{sx:{mb:3}}),r.jsxs(a,{sx:{mb:3},children:[r.jsx(s,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Kategori"}),e.category?r.jsxs(a,{children:[r.jsx(x,{label:e.category.name,color:"primary",variant:"outlined",sx:{mb:1}}),e.category.description&&r.jsx(s,{variant:"body2",color:"textSecondary",children:e.category.description})]}):r.jsx(s,{variant:"body2",color:"textSecondary",children:"Tidak ada kategori"})]}),r.jsx(p,{sx:{mb:3}}),r.jsxs(a,{sx:{mb:3},children:[r.jsx(s,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Informasi Produksi"}),r.jsxs(a,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[e.pre_order&&e.pre_order>0?r.jsx(x,{label:`Pre-order ${e.pre_order} hari`,color:"warning",variant:"filled",sx:{fontWeight:"bold"}}):r.jsx(x,{label:"Tersedia Langsung",color:"success",variant:"filled",sx:{fontWeight:"bold"}}),e.product_variants&&e.product_variants.length>0?r.jsx(x,{label:`Total Stok: ${e.total_stock||0} unit`,color:(e.total_stock||0)>0?"success":"error",variant:(e.total_stock||0)>0?"filled":"outlined"}):r.jsx(x,{label:`Stok: ${e.stock||0} unit`,color:(e.stock||0)>0?"success":"error",variant:(e.stock||0)>0?"filled":"outlined"})]}),r.jsx(s,{variant:"body2",color:"textSecondary",sx:{mt:1},children:e.pre_order&&e.pre_order>0?`Produk ini membutuhkan ${e.pre_order} hari untuk dibuat setelah order`:"Produk tersedia langsung dan siap dikirim"})]}),d&&Object.keys(O).length>0&&r.jsxs(dr.Fragment,{children:[r.jsx(p,{sx:{mb:3}}),r.jsxs(a,{sx:{mb:3},children:[r.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[r.jsx(s,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Pilih Varian"}),e.product_variants&&e.product_variants.length>0?r.jsx(x,{label:`${e.product_variants.length} Varian`,color:"primary",size:"small",variant:"filled",sx:{fontWeight:"bold",bgcolor:"primary.main",color:"white",border:"1px solid",borderColor:"primary.dark",letterSpacing:.5}}):r.jsx(x,{label:`Stok: ${e.stock||0}`,color:(e.stock||0)>0?"success":"error",size:"small",variant:(e.stock||0)>0?"filled":"outlined"})]}),Object.entries(O).map(([t,n])=>r.jsxs(a,{sx:{mb:2},children:[r.jsx(s,{variant:"subtitle2",fontWeight:"bold",gutterBottom:!0,children:t}),r.jsx(a,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:n.map(o=>{const l=L[t]===o;return r.jsxs(C,{variant:l?"contained":"outlined",onClick:()=>sr(t,o),size:"large",sx:{minWidth:80,borderWidth:2,borderColor:l?"primary.main":"divider",position:"relative",textTransform:"none","&:hover":{borderWidth:2,borderColor:"primary.main"}},children:[r.jsx(s,{variant:"body2",fontWeight:l?"bold":"medium",children:o}),l&&r.jsx(a,{sx:{position:"absolute",top:4,right:4,width:16,height:16,bgcolor:"white",color:"primary.main",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold"},children:"âœ“"})]},o)})})]},t)),i&&r.jsx(I,{variant:"outlined",sx:{mb:3,bgcolor:"primary.50",borderColor:"primary.main"},children:r.jsx(w,{children:r.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[r.jsxs(a,{children:[r.jsx(s,{variant:"caption",color:"text.secondary",display:"block",children:"Varian Terpilih"}),r.jsx(s,{variant:"h6",fontWeight:"bold",children:i.variant_name}),r.jsxs(s,{variant:"caption",color:"text.secondary",children:["SKU: ",i.sku]})]}),r.jsxs(a,{sx:{textAlign:"right"},children:[r.jsx(s,{variant:"h4",color:"primary.main",fontWeight:"bold",children:T(Number(i.price))}),r.jsx(x,{label:`Stok: ${i.stock} unit`,size:"small",color:i.stock>0?"success":"error",sx:{mt:.5}})]})]})})}),r.jsx(p,{sx:{mb:3}})]})]}),r.jsxs(a,{sx:{mb:4},children:[r.jsx(xr,{component:"legend",sx:{mb:1,fontWeight:600},children:"Jumlah:"}),r.jsx(mr,{type:"number",value:V,onChange:t=>z(Math.max(1,parseInt(t.target.value)||1)),inputProps:{min:1,max:d&&i?i.stock||1:_},sx:{width:120},size:"small"})]}),H&&r.jsx(W,{severity:"error",sx:{mb:2},onClose:()=>j(null),children:H}),r.jsxs(K,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:4},children:[r.jsx(C,{variant:"contained",size:"large",startIcon:r.jsx(hr,{}),onClick:rr,disabled:(_||0)===0||R||d&&!i||d&&i&&i.stock===0,sx:{px:4,py:1.5,borderRadius:2,fontWeight:600,fontSize:"1rem",minHeight:48,flex:{xs:1,sm:"none"}},children:R?"Menambahkan...":(_||0)===0?"Stok Habis":d&&!i?"Pilih Varian":d&&i&&i.stock===0?"Stok Habis":"Tambah ke Keranjang"}),r.jsxs(K,{direction:"row",spacing:1,sx:{justifyContent:{xs:"center",sm:"flex-start"}},children:[r.jsx(U,{onClick:er,sx:{border:`1px solid ${m.palette.grey[300]}`,color:m.palette.primary.main,width:48,height:48,"&:hover":{backgroundColor:m.palette.primary.light+"20",borderColor:m.palette.primary.main}},children:r.jsx(fr,{})}),r.jsx(U,{onClick:tr,sx:{border:`1px solid ${m.palette.grey[300]}`,color:m.palette.primary.main,width:48,height:48,"&:hover":{backgroundColor:m.palette.primary.light+"20",borderColor:m.palette.primary.main}},children:r.jsx(yr,{})})]})]})]})})})]})]})})}export{$r as default};
