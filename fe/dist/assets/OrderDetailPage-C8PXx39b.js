import{p as ir,a8 as nr,q as tr,al as sr,r as o,j as r,B as t,C as _,am as N,T as a,t as S,S as c,w as h,A as or,J as cr,I as U,ak as dr,N as F}from"./index-sTH-7xwR.js";import{A as lr}from"./AccountSidebar-BBx8Kg-L.js";import{o as R}from"./orderApi-D9XMIWOv.js";import{u as xr}from"./orderStore-FsTl8gX_.js";import{u as ur}from"./useCurrencyConversion-CYsls9be.js";import{M as mr}from"./MidtransPaymentButton-DzvGhyxS.js";import{S as pr}from"./Skeleton-Bbwws2TW.js";import{A as d}from"./Alert-B0PlZ22k.js";import{G as s}from"./Grid-CNdzohqz.js";import{B as hr}from"./Breadcrumbs-DpcRvJ3O.js";import{H as gr}from"./Home-BBPE8n5d.js";import{O as br}from"./Receipt-DhYTCTd0.js";import{A as yr}from"./ArrowBack-CXOXat9S.js";import{C as g,a as b}from"./CardContent-CbD_XzoO.js";import{C as jr}from"./Cancel-BCQ9B1e-.js";import{T as G}from"./Tooltip-BMDYRwfD.js";import{O as fr}from"./OpenInNew-CfpoLYZF.js";import{R as kr}from"./Refresh-Dan401uz.js";import"./ShoppingBag-DUUkMz7N.js";import"./Popper-BdUOu1lY.js";function Gr(){ir();const{id:y}=nr(),j=tr();sr();const{formatPrice:x,loading:H,error:M}=ur(),[K,W]=o.useState(!0),[P,u]=o.useState(null),[i,q]=o.useState(null),[I,z]=o.useState(!1),[D,B]=o.useState(null),[T,f]=o.useState(null),[m,A]=o.useState(!1),[n,$]=o.useState(null),[L,p]=o.useState(null),{setCurrentOrder:J}=xr(),k=e=>new Date(e).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),Q=e=>{switch(e){case"belum_bayar":return"warning";case"dikemas":return"primary";case"dikirim":return"info";case"diterima":return"success";case"dibatalkan":return"error";default:return"default"}},V=e=>{switch(e){case"belum_bayar":return"Belum Bayar";case"dikemas":return"Dikemas";case"dikirim":return"Dikirim";case"diterima":return"Diterima";case"dibatalkan":return"Dibatalkan";default:return e}},X=e=>{switch(e){case"unpaid":return"error";case"pending":return"warning";case"paid":return"success";case"failed":return"error";case"refunded":return"warning";default:return"default"}},Y=e=>{switch(e){case"unpaid":return"Belum Dibayar";case"pending":return"Menunggu Pembayaran";case"paid":return"Sudah Dibayar";case"failed":return"Gagal Bayar";case"refunded":return"Dikembalikan";default:return e}},v=o.useCallback(async()=>{if(i?.shipping?.tracking_number){A(!0),p(null);try{const e=await R.trackShipment(i.shipping.tracking_number,i.shipping.courier?.toLowerCase());e.success?$(e):p(e.error||"Gagal mendapatkan informasi tracking")}catch(e){p(e.response?.data?.error||"Gagal mendapatkan informasi tracking")}finally{A(!1)}}},[i?.shipping?.tracking_number,i?.shipping?.courier]),E=(e,l)=>{const C=e.toLowerCase();return{jne:"https://www.jne.co.id/id/tracking/tariff-and-service",jnt:"https://www.jet.co.id/track",sicepat:"https://www.sicepat.com/check-resi",pos:"https://www.posindonesia.co.id/tracking",anteraja:"https://anteraja.id/tracking",ninja:"https://www.ninjaxpress.co.id/tracking",lion:"https://lionparcel.com/tracking",ide:"https://idexpress.com/tracking"}[C]||null},w=async()=>{if(y)try{W(!0),u(null);const e=await R.getOrderById(y);e.success?(q(e.data),J(e.data)):u("Pesanan tidak ditemukan")}catch(e){console.error("Error fetching order:",e),u(e.response?.data?.error||"Gagal memuat pesanan")}finally{W(!1)}},Z=e=>{console.log("Payment successful:",e),B("Pembayaran berhasil! Status pesanan akan diperbarui."),f(null),w()},rr=e=>{console.error("Payment error:",e),f(e),B(null)},er=async()=>{if(!(!i||!window.confirm("Apakah Anda yakin ingin membatalkan pesanan ini?")))try{z(!0),(await R.cancelOrder(i.id)).success&&await w()}catch(e){console.error("Error cancelling order:",e),u(e.response?.data?.error||"Gagal membatalkan pesanan")}finally{z(!1)}};if(o.useEffect(()=>{w()},[y]),o.useEffect(()=>{i?.shipping?.tracking_number&&!n&&!m&&v()},[i?.shipping?.tracking_number,n,m,v]),K)return r.jsx(t,{sx:{minHeight:"100vh",py:4},children:r.jsx(_,{maxWidth:"xl",children:r.jsx(pr,{variant:"rectangular",height:400,sx:{borderRadius:3}})})});if(P||!i)return r.jsx(t,{sx:{minHeight:"100vh",py:4},children:r.jsx(_,{maxWidth:"xl",children:r.jsx(d,{severity:"error",sx:{maxWidth:600,mx:"auto"},children:P||"Pesanan tidak ditemukan"})})});const ar=i.status==="belum_bayar";return r.jsx(t,{sx:{minHeight:"100vh",py:4},children:r.jsx(_,{maxWidth:"xl",children:r.jsxs(s,{container:!0,spacing:4,children:[r.jsx(s,{item:!0,xs:12,md:3,children:r.jsx(lr,{})}),r.jsxs(s,{item:!0,xs:12,md:9,children:[r.jsxs(hr,{sx:{mb:3},children:[r.jsxs(N,{component:"button",variant:"body2",onClick:()=>j("/"),sx:{display:"flex",alignItems:"center",textDecoration:"none",color:"text.secondary","&:hover":{color:"primary.main"}},children:[r.jsx(gr,{sx:{mr:.5,fontSize:"1rem"}}),"Beranda"]}),r.jsxs(N,{component:"button",variant:"body2",onClick:()=>j("/orders"),sx:{display:"flex",alignItems:"center",textDecoration:"none",color:"text.secondary","&:hover":{color:"primary.main"}},children:[r.jsx(br,{sx:{mr:.5,fontSize:"1rem"}}),"Pesanan"]}),r.jsxs(a,{variant:"body2",color:"text.primary",children:["#",i.id.slice(-8).toUpperCase()]})]}),r.jsx(S,{startIcon:r.jsx(yr,{}),onClick:()=>j("/orders"),sx:{mb:3,borderRadius:2,fontWeight:500,color:"text.secondary","&:hover":{color:"primary.main",backgroundColor:"primary.light"}},children:"Kembali ke Daftar Pesanan"}),D&&r.jsx(d,{severity:"success",sx:{mb:3,borderRadius:2},children:D}),T&&r.jsx(d,{severity:"error",sx:{mb:3,borderRadius:2},onClose:()=>f(null),children:T}),H&&r.jsx(d,{severity:"info",sx:{mb:2,borderRadius:2},children:"Loading exchange rates..."}),M&&r.jsx(d,{severity:"warning",sx:{mb:2,borderRadius:2},children:"Failed to load exchange rates. Prices will be displayed in default currency."}),r.jsx(g,{sx:{mb:4,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:r.jsx(b,{sx:{p:3},children:r.jsxs(c,{direction:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:"flex-start",spacing:2,children:[r.jsxs(t,{children:[r.jsxs(a,{variant:"h4",fontWeight:600,sx:{mb:1,color:"text.primary"},children:["Order #",i.id.slice(-8).toUpperCase()]}),r.jsxs(a,{variant:"body1",color:"text.secondary",sx:{mb:2},children:["Dibuat pada ",k(i.created_at)]}),r.jsxs(c,{direction:"row",spacing:1,children:[r.jsx(h,{label:V(i.status),color:Q(i.status),variant:"outlined",sx:{borderRadius:2}}),r.jsx(h,{label:Y(i.payment_status),color:X(i.payment_status),variant:"outlined",sx:{borderRadius:2}})]})]}),ar&&r.jsx(S,{variant:"outlined",startIcon:r.jsx(jr,{}),onClick:er,disabled:I,color:"error",sx:{borderRadius:2,fontWeight:500,"&:hover":{backgroundColor:"error.light"}},children:I?"Membatalkan...":"Batalkan Pesanan"})]})})}),r.jsxs(s,{container:!0,spacing:4,children:[r.jsxs(s,{item:!0,xs:12,lg:8,children:[r.jsx(g,{sx:{mb:4,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:r.jsxs(b,{sx:{p:3},children:[r.jsxs(a,{variant:"h6",fontWeight:600,sx:{mb:3,color:"text.primary"},children:["Item Pesanan (",i.order_items.length,")"]}),r.jsx(c,{spacing:2,children:i.order_items.map(e=>{const l=e.product_variant.product.product_images?.[0]?.image_name;return r.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:3,p:3,borderRadius:2,backgroundColor:"grey.50",border:"none",transition:"all 0.2s ease","&:hover":{backgroundColor:"grey.100"}},children:[r.jsx(t,{sx:{flexShrink:0},children:r.jsx(or,{src:l?`/uploads/${l}`:`https://placehold.co/80x80/9682DB/FFFFFF/png?text=${encodeURIComponent(e.product_variant.product.name.substring(0,10))}`,alt:e.product_variant.product.name,sx:{width:80,height:80,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},variant:"rounded"})}),r.jsxs(t,{sx:{flex:1,minWidth:0},children:[r.jsx(a,{variant:"h6",fontWeight:600,sx:{mb:1,color:"text.primary",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.3,fontSize:"1rem"},title:e.product_variant.product.name,children:e.product_variant.product.name}),e.product_variant.variant_options&&e.product_variant.variant_options.length>0&&r.jsx(c,{direction:"row",spacing:.5,sx:{mb:1,flexWrap:"wrap"},children:e.product_variant.variant_options.map((C,O)=>r.jsx(h,{label:`${C.option_value}`,size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:20,borderColor:"primary.main",color:"primary.main","& .MuiChip-label":{px:1}}},O))}),r.jsxs(a,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:["Qty: ",e.quantity," Ã— ",x(Number(e.price))]})]}),r.jsxs(t,{sx:{textAlign:"right",minWidth:100},children:[r.jsx(a,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Total"}),r.jsx(a,{variant:"h6",color:"primary.main",fontWeight:700,sx:{fontSize:"1rem"},children:x(Number(e.price)*Number(e.quantity))})]})]},e.id)})})]})}),i.shipping&&r.jsx(g,{sx:{mb:4,borderRadius:2,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:r.jsxs(b,{sx:{p:3},children:[r.jsxs(c,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:3},children:[r.jsxs(a,{variant:"h6",fontWeight:600,sx:{color:"text.primary",display:"flex",alignItems:"center",gap:1},children:[r.jsx(cr,{}),"Informasi Pengiriman"]}),i.shipping.tracking_number&&r.jsxs(c,{direction:"row",spacing:1,children:[i.shipping.courier&&i.shipping.tracking_number&&E(i.shipping.courier,i.shipping.tracking_number)&&r.jsx(G,{title:"Buka di website kurir",children:r.jsx(U,{size:"small",onClick:()=>{const e=E(i.shipping.courier,i.shipping.tracking_number);e&&window.open(e,"_blank")},sx:{color:"primary.main"},children:r.jsx(fr,{fontSize:"small"})})}),r.jsx(G,{title:"Refresh tracking",children:r.jsx(U,{size:"small",onClick:v,disabled:m,sx:{color:"primary.main"},children:m?r.jsx(dr,{size:20}):r.jsx(kr,{fontSize:"small"})})})]})]}),L&&r.jsx(d,{severity:"warning",sx:{mb:2,borderRadius:2},onClose:()=>p(null),children:L}),r.jsxs(s,{container:!0,spacing:2,children:[r.jsx(s,{item:!0,xs:12,sm:6,children:r.jsxs(t,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Kurir"}),r.jsx(a,{variant:"body1",fontWeight:600,children:i.shipping.courier})]})}),r.jsx(s,{item:!0,xs:12,sm:6,children:r.jsxs(t,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Status Pengiriman"}),r.jsx(a,{variant:"body1",fontWeight:600,children:i.shipping.shipping_status})]})}),i.shipping.tracking_number&&r.jsx(s,{item:!0,xs:12,sm:6,children:r.jsxs(t,{sx:{p:2,backgroundColor:"primary.light",borderRadius:2},children:[r.jsx(a,{variant:"subtitle2",color:"primary.dark",sx:{fontSize:"0.75rem",mb:.5},children:"Nomor Resi"}),r.jsx(a,{variant:"body1",fontWeight:600,color:"primary.main",children:i.shipping.tracking_number})]})}),i.shipping.estimated_delivery&&r.jsx(s,{item:!0,xs:12,sm:6,children:r.jsxs(t,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Estimasi Sampai"}),r.jsx(a,{variant:"body1",fontWeight:600,children:k(i.shipping.estimated_delivery)})]})})]}),n&&r.jsxs(t,{sx:{mt:3,pt:3,borderTop:"1px solid",borderColor:"divider"},children:[r.jsx(a,{variant:"subtitle1",fontWeight:600,sx:{mb:3},children:"Detail Tracking"}),n.data&&r.jsxs(s,{container:!0,spacing:2,sx:{mb:3},children:[n.data.waybill_id&&r.jsx(s,{item:!0,xs:12,sm:6,children:r.jsxs(t,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Waybill ID"}),r.jsx(a,{variant:"body1",fontWeight:600,children:n.data.waybill_id})]})}),n.data.status&&r.jsx(s,{item:!0,xs:12,sm:6,children:r.jsxs(t,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Status Tracking"}),r.jsx(a,{variant:"body1",fontWeight:600,children:n.data.status})]})}),n.data.courier?.company&&r.jsx(s,{item:!0,xs:12,sm:6,children:r.jsxs(t,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5},children:"Kurir"}),r.jsx(a,{variant:"body1",fontWeight:600,children:n.data.courier.company.toUpperCase()}),n.data.courier.service_type&&r.jsx(a,{variant:"caption",color:"text.secondary",children:n.data.courier.service_type})]})}),n.data.link&&r.jsx(s,{item:!0,xs:12,sm:6,children:r.jsxs(t,{sx:{p:2,backgroundColor:"primary.light",borderRadius:2},children:[r.jsx(a,{variant:"subtitle2",color:"primary.dark",sx:{fontSize:"0.75rem",mb:.5},children:"Link Tracking"}),r.jsx(S,{size:"small",variant:"text",onClick:()=>window.open(n.data.link,"_blank"),sx:{p:0,textTransform:"none",color:"primary.main","&:hover":{textDecoration:"underline"}},children:"Buka di Biteship"})]})})]}),n.data&&(n.data.origin||n.data.destination)&&r.jsxs(s,{container:!0,spacing:2,sx:{mb:3},children:[n.data.origin&&r.jsx(s,{item:!0,xs:12,sm:6,children:r.jsxs(t,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:1},children:"Asal Pengiriman"}),r.jsx(a,{variant:"body2",fontWeight:600,sx:{mb:.5},children:n.data.origin.contact_name}),r.jsx(a,{variant:"caption",color:"text.secondary",children:n.data.origin.address})]})}),n.data.destination&&r.jsx(s,{item:!0,xs:12,sm:6,children:r.jsxs(t,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"subtitle2",color:"text.secondary",sx:{fontSize:"0.75rem",mb:1},children:"Tujuan Pengiriman"}),r.jsx(a,{variant:"body2",fontWeight:600,sx:{mb:.5},children:n.data.destination.contact_name}),r.jsx(a,{variant:"caption",color:"text.secondary",children:n.data.destination.address})]})})]}),n.data?.courier&&(n.data.courier.driver_name||n.data.courier.driver_phone)&&r.jsxs(t,{sx:{p:2,backgroundColor:"info.light",borderRadius:2,mb:3},children:[r.jsx(a,{variant:"subtitle2",color:"info.dark",sx:{fontSize:"0.75rem",mb:1},children:"Informasi Kurir"}),n.data.courier.driver_name&&r.jsxs(a,{variant:"body2",fontWeight:600,sx:{mb:.5},children:["Nama Driver: ",n.data.courier.driver_name]}),n.data.courier.driver_phone&&r.jsxs(a,{variant:"body2",color:"text.secondary",children:["No. Telepon: ",n.data.courier.driver_phone]})]}),n.data?.history&&Array.isArray(n.data.history)&&n.data.history.length>0?r.jsxs(t,{children:[r.jsx(a,{variant:"subtitle2",fontWeight:600,sx:{mb:2},children:"Riwayat Tracking"}),r.jsx(c,{spacing:2,children:n.data.history.map((e,l)=>r.jsx(t,{sx:{p:2,backgroundColor:"grey.50",borderRadius:2,borderLeft:"3px solid",borderColor:l===0?"primary.main":"grey.300"},children:r.jsxs(c,{direction:"row",justifyContent:"space-between",alignItems:"flex-start",spacing:2,children:[r.jsxs(t,{sx:{flex:1},children:[r.jsx(a,{variant:"body2",fontWeight:600,sx:{mb:.5},children:e.status?e.status.charAt(0).toUpperCase()+e.status.slice(1):"Update"}),e.note&&r.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.note}),e.service_type&&r.jsx(h,{label:e.service_type,size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:20,mr:1}})]}),e.updated_at&&r.jsx(a,{variant:"caption",color:"text.secondary",sx:{whiteSpace:"nowrap"},children:k(e.updated_at)})]})},l))})]}):r.jsx(d,{severity:"info",sx:{borderRadius:2},children:"Informasi tracking belum tersedia"})]})]})})]}),r.jsx(s,{item:!0,xs:12,lg:4,children:r.jsx(g,{sx:{position:"sticky",top:24,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:"none"},children:r.jsxs(b,{sx:{p:3},children:[r.jsx(a,{variant:"h6",fontWeight:600,sx:{mb:3,color:"text.primary"},children:"Ringkasan Pesanan"}),r.jsxs(c,{spacing:2,children:[r.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"body1",fontWeight:500,children:"Subtotal"}),r.jsx(a,{variant:"body1",fontWeight:600,children:x(Number(i.total_amount))})]}),r.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"body1",fontWeight:500,children:"Biaya Pengiriman"}),r.jsx(a,{variant:"body1",fontWeight:600,children:x(Number(i.shipping_cost))})]}),r.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,backgroundColor:"primary.main",borderRadius:2,color:"white"},children:[r.jsx(a,{variant:"h6",fontWeight:600,children:"Total"}),r.jsx(a,{variant:"h6",fontWeight:700,children:x(Number(i.total_amount)+Number(i.shipping_cost))})]})]}),r.jsx(F,{sx:{my:3}}),r.jsx(a,{variant:"subtitle1",fontWeight:600,sx:{mb:2,color:"text.primary"},children:"Alamat Pengiriman"}),r.jsxs(t,{sx:{p:2,borderRadius:2,backgroundColor:"grey.50"},children:[r.jsx(a,{variant:"body1",fontWeight:600,children:i.address.address_line}),r.jsxs(a,{variant:"body2",color:"text.secondary",children:[i.address.city,", ",i.address.province," ",i.address.postal_code]})]}),(i.payment_status==="unpaid"||i.payment_status==="pending")&&i.status!=="dibatalkan"&&r.jsxs(r.Fragment,{children:[r.jsx(F,{sx:{my:3}}),r.jsx(mr,{order:i,onSuccess:Z,onError:rr,paymentMethod:"bank_transfer"})]})]})})})]})]})]})})})}export{Gr as default};
