import{p as Z,a8 as rr,q as er,aB as ir,r as d,j as r,ag as ar,C as O,v as y,B as n,an as U,T as a,y as x,S as s,x as E,O as R,aq as tr,H as sr,I as $,aA as nr,M as or,E as cr}from"./index-tvCmUXkA.js";import{a as F}from"./orderApi-5cTaBefX.js";import{o as dr}from"./orderApi-BOQ5SOkY.js";import{u as lr}from"./useCurrencyConversion-DM705tyN.js";import{A as u}from"./Alert-iJ2nvuQL.js";import{A as G}from"./ArrowBack-BROWJOPA.js";import{B as pr}from"./Breadcrumbs-BRY0wQO3.js";import{H as xr}from"./Home-FYrVyE1n.js";import{O as mr}from"./Receipt-CJT1sDb7.js";import{G as o}from"./Grid-CE62ACEJ.js";import{C as f,a as v}from"./CardContent-BO7gwO4c.js";import{T as H}from"./Tooltip-CRdXSvuP.js";import{O as hr}from"./OpenInNew-wJc69th9.js";import{R as ur}from"./Refresh-RespFlYJ.js";import{S as gr,a as br,b as jr,R as yr}from"./RadioButtonUnchecked-DAZCd5uw.js";import{C as fr}from"./CheckCircle-CLjEyLHK.js";import{A as vr}from"./Avatar-Cw6JEpzV.js";import"./useSlot-Dd61XFNI.js";import"./Popper-DMWFBkOI.js";function $r(){const l=Z(),{id:k}=rr(),g=er(),{formatPrice:m}=lr(),{showNotification:D}=ir(),[K,w]=d.useState(!0),[S,T]=d.useState(!1),[z,_]=d.useState(null),[i,q]=d.useState(null),[b,P]=d.useState(!1),[p,M]=d.useState(null),[B,j]=d.useState(null),[C,Q]=d.useState(!1),I=e=>new Date(e).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),V=e=>{switch(e){case"belum_bayar":return"warning";case"dikemas":return"primary";case"dikirim":return"info";case"diterima":return"success";case"dibatalkan":return"error";default:return"default"}},L=e=>{switch(e){case"belum_bayar":return"Belum Bayar";case"dikemas":return"Dikemas";case"dikirim":return"Dikirim";case"diterima":return"Diterima";case"dibatalkan":return"Dibatalkan";default:return e}},Y=d.useCallback(async()=>{if(i?.shipping?.tracking_number){P(!0),j(null);try{const e=await dr.trackShipment(i.shipping.tracking_number,i.shipping.courier?.toLowerCase());e.success?M(e):j(e.error||"Gagal mendapatkan informasi tracking")}catch(e){j(e.response?.data?.error||"Gagal mendapatkan informasi tracking")}finally{P(!1)}}},[i?.shipping?.tracking_number,i?.shipping?.courier]),N=(e,t)=>{const c=e.toLowerCase();return{jne:"https://www.jne.co.id/id/tracking/tariff-and-service",jnt:"https://www.jet.co.id/track",sicepat:"https://www.sicepat.com/check-resi",pos:"https://www.posindonesia.co.id/tracking",anteraja:"https://anteraja.id/tracking",ninja:"https://www.ninjaxpress.co.id/tracking",lion:"https://lionparcel.com/tracking",ide:"https://idexpress.com/tracking"}[c]||null},A=async()=>{if(!k){_("ID pesanan tidak valid"),w(!1);return}try{w(!0),_(null);const e=await F.getOrderById(k);if(e.success){const t=e.data;q(t)}else throw new Error("Failed to fetch order")}catch(e){_(e.response?.data?.error||e.message||"Gagal memuat data pesanan")}finally{w(!1)}};d.useEffect(()=>{A()},[k]);const J=(e,t)=>({belum_bayar:t==="paid"?["dikemas","dibatalkan"]:["dibatalkan"],dikemas:["dikirim","dibatalkan"],dikirim:[],diterima:[],dibatalkan:[]})[e]||[],X=async e=>{if(!(!i||e===i.status))try{T(!0);const t=await F.updateOrderStatus(i.id,e);if(t.success)D({type:"success",message:"Status pesanan berhasil diperbarui"}),A();else throw new Error(t.error||"Failed to update order status")}catch(t){D({type:"error",message:t.response?.data?.error||t.message||"Gagal memperbarui status pesanan"})}finally{T(!1)}};return K?r.jsx(ar,{message:"Memuat data pesanan..."}):z||!i?r.jsxs(O,{maxWidth:"xl",sx:{py:4},children:[r.jsx(u,{severity:"error",children:z||"Pesanan tidak ditemukan"}),r.jsx(y,{startIcon:r.jsx(G,{}),onClick:()=>g("/admin/orders"),sx:{mt:2},children:"Kembali ke Daftar Pesanan"})]}):r.jsx(n,{sx:{bgcolor:"grey.50",minHeight:"100vh",pb:4},children:r.jsxs(O,{maxWidth:"xl",sx:{py:4},children:[r.jsxs(pr,{sx:{mb:2},children:[r.jsxs(U,{component:"button",variant:"body2",onClick:()=>g("/admin"),sx:{display:"flex",alignItems:"center",textDecoration:"none",color:"text.secondary","&:hover":{color:"primary.main"}},children:[r.jsx(xr,{sx:{mr:.5,fontSize:"1rem"}}),"Dashboard"]}),r.jsxs(U,{component:"button",variant:"body2",onClick:()=>g("/admin/orders"),sx:{display:"flex",alignItems:"center",textDecoration:"none",color:"text.secondary","&:hover":{color:"primary.main"}},children:[r.jsx(mr,{sx:{mr:.5,fontSize:"1rem"}}),"Pesanan"]}),r.jsxs(a,{variant:"body2",color:"text.primary",fontWeight:500,children:["#",i.id.slice(-8).toUpperCase()]})]}),r.jsx(y,{startIcon:r.jsx(G,{}),onClick:()=>g("/admin/orders"),sx:{mb:3,borderRadius:2,fontWeight:500,color:"text.secondary","&:hover":{color:"primary.main",backgroundColor:"action.hover"}},children:"Kembali ke Daftar Pesanan"}),r.jsx(x,{elevation:0,sx:{mb:3,borderRadius:3,overflow:"hidden",background:`linear-gradient(135deg, ${l.palette.primary.main}15 0%, ${l.palette.primary.light}08 100%)`,border:`1px solid ${l.palette.divider}`},children:r.jsx(n,{sx:{p:4,pb:3},children:r.jsxs(s,{direction:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},spacing:3,children:[r.jsxs(n,{sx:{flex:1},children:[r.jsxs(s,{direction:"row",alignItems:"center",spacing:2,sx:{mb:1.5},children:[r.jsxs(a,{variant:"h4",fontWeight:700,sx:{color:"text.primary"},children:["Order #",i.id.slice(-8).toUpperCase()]}),r.jsx(E,{label:L(i.status),color:V(i.status),size:"small",sx:{height:28,fontWeight:600,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:.5}})]}),r.jsxs(a,{variant:"body2",color:"text.secondary",children:["Dibuat pada ",I(i.created_at)]})]}),r.jsx(n,{sx:{minWidth:{xs:"100%",md:280}},children:(()=>{const e=J(i.status,i.payment_status);if(e.length===0)return null;const t=i.status==="belum_bayar"&&i.payment_status!=="paid";return r.jsxs(s,{spacing:1.5,children:[t&&r.jsx(u,{severity:"warning",sx:{borderRadius:2,fontSize:"0.875rem"},children:"Pesanan belum dibayar"}),e.map(c=>{const h=c==="dikirim",W=c==="dibatalkan";return r.jsx(y,{variant:W?"outlined":"contained",color:W?"error":"primary",fullWidth:!0,startIcon:S?r.jsx(R,{size:16}):null,onClick:()=>X(c),disabled:S,sx:{borderRadius:2,fontWeight:600,py:1.5,textTransform:"none",borderWidth:W?2:1},children:S?"Memproses...":r.jsxs(r.Fragment,{children:[h?"Kirim Pesanan":L(c),h&&r.jsx(a,{variant:"caption",sx:{ml:1,opacity:.9},children:"(Buat Waybill)"})]})},c)})]})})()})]})})}),r.jsxs(o,{container:!0,spacing:3,children:[r.jsx(o,{item:!0,xs:12,lg:8,children:r.jsxs(s,{spacing:3,children:[r.jsx(f,{elevation:0,sx:{borderRadius:3,border:`1px solid ${l.palette.divider}`},children:r.jsxs(v,{sx:{p:3},children:[r.jsxs(s,{direction:"row",alignItems:"center",spacing:1.5,sx:{mb:3},children:[r.jsx(tr,{color:"primary"}),r.jsx(a,{variant:"h6",fontWeight:700,children:"Informasi Pelanggan"})]}),i.user&&r.jsxs(o,{container:!0,spacing:2,children:[r.jsxs(o,{item:!0,xs:12,sm:6,children:[r.jsx(a,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5,display:"block"},children:"Nama"}),r.jsx(a,{variant:"body1",fontWeight:600,children:i.user.full_name})]}),r.jsxs(o,{item:!0,xs:12,sm:6,children:[r.jsx(a,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5,display:"block"},children:"Email"}),r.jsx(a,{variant:"body1",children:i.user.email})]}),i.user.phone&&r.jsxs(o,{item:!0,xs:12,sm:6,children:[r.jsx(a,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5,display:"block"},children:"Telepon"}),r.jsx(a,{variant:"body1",children:i.user.phone})]})]})]})}),i.shipping&&r.jsx(f,{elevation:0,sx:{borderRadius:3,border:`1px solid ${l.palette.divider}`},children:r.jsxs(v,{sx:{p:3},children:[r.jsxs(s,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:3},children:[r.jsxs(s,{direction:"row",alignItems:"center",spacing:1.5,children:[r.jsx(sr,{color:"primary"}),r.jsx(a,{variant:"h6",fontWeight:700,children:"Informasi Pengiriman"})]}),i.shipping.tracking_number&&r.jsxs(s,{direction:"row",spacing:1,children:[i.shipping.courier&&N(i.shipping.courier,i.shipping.tracking_number)&&r.jsx(H,{title:"Buka di website kurir",children:r.jsx($,{size:"small",onClick:()=>{const e=N(i.shipping.courier,i.shipping.tracking_number);e&&window.open(e,"_blank")},sx:{color:"primary.main"},children:r.jsx(hr,{fontSize:"small"})})}),r.jsx(H,{title:"Refresh tracking",children:r.jsx($,{size:"small",onClick:Y,disabled:b,sx:{color:"primary.main"},children:b?r.jsx(R,{size:20}):r.jsx(ur,{fontSize:"small"})})})]})]}),r.jsxs(o,{container:!0,spacing:2,children:[r.jsx(o,{item:!0,xs:12,sm:6,children:r.jsxs(x,{elevation:0,sx:{p:2,bgcolor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5,display:"block"},children:"Kurir"}),r.jsx(a,{variant:"body1",fontWeight:600,children:i.shipping.courier})]})}),r.jsx(o,{item:!0,xs:12,sm:6,children:r.jsxs(x,{elevation:0,sx:{p:2,bgcolor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5,display:"block"},children:"Status Pengiriman"}),r.jsx(a,{variant:"body1",fontWeight:600,children:i.shipping.shipping_status})]})}),i.shipping.tracking_number&&r.jsx(o,{item:!0,xs:12,sm:6,children:r.jsxs(x,{elevation:0,sx:{p:2,bgcolor:"primary.light",borderRadius:2},children:[r.jsx(a,{variant:"caption",color:"primary.dark",sx:{fontSize:"0.75rem",mb:.5,display:"block",fontWeight:600},children:"Nomor Resi"}),r.jsx(a,{variant:"body1",fontWeight:700,color:"primary.main",children:i.shipping.tracking_number})]})}),i.shipping.estimated_delivery&&r.jsx(o,{item:!0,xs:12,sm:6,children:r.jsxs(x,{elevation:0,sx:{p:2,bgcolor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5,display:"block"},children:"Estimasi Sampai"}),r.jsx(a,{variant:"body1",fontWeight:600,children:I(i.shipping.estimated_delivery)})]})}),i.shipping.tracking_number&&r.jsx(o,{item:!0,xs:12,children:r.jsxs(y,{variant:"outlined",onClick:()=>Q(!C),sx:{textTransform:"none",borderRadius:2,mt:1},fullWidth:!0,children:[C?"Sembunyikan":"Lihat"," Detail Tracking"]})})]}),C&&r.jsxs(n,{sx:{mt:4,pt:3,borderTop:`1px solid ${l.palette.divider}`},children:[B&&r.jsx(u,{severity:"warning",sx:{mb:3,borderRadius:2},onClose:()=>j(null),children:B}),b&&!p&&r.jsx(n,{sx:{display:"flex",justifyContent:"center",py:4},children:r.jsx(R,{})}),p?.data?.history&&Array.isArray(p.data.history)&&p.data.history.length>0?r.jsxs(n,{children:[r.jsx(a,{variant:"subtitle1",fontWeight:700,sx:{mb:3},children:"Riwayat Tracking"}),r.jsx(gr,{orientation:"vertical",sx:{"& .MuiStepLabel-root":{alignItems:"flex-start"}},children:p.data.history.map((e,t)=>r.jsx(br,{active:t===0,completed:t>0,children:r.jsxs(jr,{StepIconComponent:()=>r.jsx(n,{sx:{width:24,height:24,borderRadius:"50%",bgcolor:t===0?"primary.main":"grey.300",display:"flex",alignItems:"center",justifyContent:"center",color:"white"},children:t===0?r.jsx(fr,{sx:{fontSize:20}}):r.jsx(yr,{sx:{fontSize:20}})}),children:[r.jsx(a,{variant:"body2",fontWeight:600,sx:{mb:.5},children:e.status?e.status.charAt(0).toUpperCase()+e.status.slice(1):"Update"}),e.note&&r.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.note}),e.updated_at&&r.jsx(a,{variant:"caption",color:"text.secondary",children:I(e.updated_at)})]})},t))})]}):p&&r.jsx(u,{severity:"info",sx:{borderRadius:2},children:"Informasi tracking belum tersedia"}),!p&&!b&&r.jsx(u,{severity:"info",sx:{borderRadius:2},children:"Klik tombol refresh untuk memuat detail tracking"})]})]})}),r.jsx(f,{elevation:0,sx:{borderRadius:3,border:`1px solid ${l.palette.divider}`},children:r.jsxs(v,{sx:{p:3},children:[r.jsxs(s,{direction:"row",alignItems:"center",spacing:1.5,sx:{mb:3},children:[r.jsx(nr,{color:"primary"}),r.jsxs(a,{variant:"h6",fontWeight:700,children:["Item Pesanan (",i.order_items.length,")"]})]}),r.jsx(s,{spacing:2,children:i.order_items.map(e=>{const t=e.product_variant.product.product_images?.[0]?.image_name;return r.jsxs(x,{elevation:0,sx:{display:"flex",alignItems:"center",gap:2,p:2.5,borderRadius:2,bgcolor:"grey.50",border:`1px solid ${l.palette.divider}`,transition:"all 0.2s ease","&:hover":{bgcolor:"grey.100",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"}},children:[r.jsx(vr,{src:t?`/uploads/${t}`:`https://placehold.co/80x80/9682DB/FFFFFF/png?text=${encodeURIComponent(e.product_variant.product.name.substring(0,10))}`,alt:e.product_variant.product.name,sx:{width:90,height:90,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},variant:"rounded"}),r.jsxs(n,{sx:{flex:1,minWidth:0},children:[r.jsx(a,{variant:"subtitle1",fontWeight:600,sx:{mb:1,color:"text.primary",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.3},title:e.product_variant.product.name,children:e.product_variant.product.name}),e.product_variant.variant_options&&e.product_variant.variant_options.length>0&&r.jsx(s,{direction:"row",spacing:.5,sx:{mb:1,flexWrap:"wrap"},children:e.product_variant.variant_options.map((c,h)=>r.jsx(E,{label:c.option_value,size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:22,borderColor:"primary.main",color:"primary.main"}},h))}),r.jsxs(a,{variant:"body2",color:"text.secondary",children:["Qty: ",e.quantity," Ã— ",m(Number(e.price))]})]}),r.jsxs(n,{sx:{textAlign:"right",minWidth:120},children:[r.jsx(a,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.75rem",mb:.5,display:"block"},children:"Total"}),r.jsx(a,{variant:"h6",color:"primary.main",fontWeight:700,children:m(Number(e.price)*Number(e.quantity))})]})]},e.id)})})]})})]})}),r.jsx(o,{item:!0,xs:12,lg:4,children:r.jsx(s,{spacing:3,children:r.jsx(f,{elevation:0,sx:{position:"sticky",top:24,borderRadius:3,border:`1px solid ${l.palette.divider}`},children:r.jsxs(v,{sx:{p:3},children:[r.jsx(a,{variant:"h6",fontWeight:700,sx:{mb:3,color:"text.primary"},children:"Ringkasan Pesanan"}),r.jsxs(s,{spacing:2,children:[r.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,bgcolor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"body1",fontWeight:500,children:"Subtotal"}),r.jsx(a,{variant:"body1",fontWeight:600,children:m(Number(i.total_amount))})]}),r.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",py:2,px:2,bgcolor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"body1",fontWeight:500,children:"Biaya Pengiriman"}),r.jsx(a,{variant:"body1",fontWeight:600,children:m(Number(i.shipping_cost))})]}),r.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",py:2.5,px:2.5,bgcolor:"primary.main",borderRadius:2,color:"white"},children:[r.jsx(a,{variant:"h6",fontWeight:700,children:"Total"}),r.jsx(a,{variant:"h6",fontWeight:700,children:m(Number(i.total_amount)+Number(i.shipping_cost))})]})]}),r.jsx(or,{sx:{my:3}}),r.jsxs(s,{direction:"row",alignItems:"center",spacing:1.5,sx:{mb:2},children:[r.jsx(cr,{color:"primary"}),r.jsx(a,{variant:"subtitle1",fontWeight:700,children:"Alamat Pengiriman"})]}),r.jsxs(x,{elevation:0,sx:{p:2,bgcolor:"grey.50",borderRadius:2},children:[r.jsx(a,{variant:"body1",fontWeight:600,sx:{mb:.5},children:i.address.address_line}),r.jsxs(a,{variant:"body2",color:"text.secondary",children:[i.address.city,", ",i.address.province," ",i.address.postal_code]})]})]})})})})]})]})})}export{$r as default};
